<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Lecture 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Lecture 4</h1>
<blockquote>原文：<a href="https://cs50.harvard.edu/r/notes/4/">https://cs50.harvard.edu/r/notes/4/</a></blockquote>

                    

<ul id="markdown-toc">
  <li><a href="#welcome" id="markdown-toc-welcome">Welcome!</a></li>
  <li><a href="#dplyr" id="markdown-toc-dplyr">dplyr</a>    <ul>
      <li><a href="#select" id="markdown-toc-select"><code class="language-plaintext highlighter-rouge">select</code></a></li>
      <li><a href="#filter" id="markdown-toc-filter"><code class="language-plaintext highlighter-rouge">filter</code></a></li>
      <li><a href="#pipe-operator" id="markdown-toc-pipe-operator">Pipe Operator</a></li>
      <li><a href="#arrange" id="markdown-toc-arrange"><code class="language-plaintext highlighter-rouge">arrange</code></a></li>
      <li><a href="#distinct" id="markdown-toc-distinct"><code class="language-plaintext highlighter-rouge">distinct</code></a></li>
      <li><a href="#writing-data" id="markdown-toc-writing-data">Writing Data</a></li>
      <li><a href="#group_by" id="markdown-toc-group_by"><code class="language-plaintext highlighter-rouge">group_by</code></a></li>
      <li><a href="#summarize" id="markdown-toc-summarize"><code class="language-plaintext highlighter-rouge">summarize</code></a></li>
      <li><a href="#ungroup" id="markdown-toc-ungroup"><code class="language-plaintext highlighter-rouge">ungroup</code></a></li>
    </ul>
  </li>
  <li><a href="#tidyr" id="markdown-toc-tidyr">tidyr</a>    <ul>
      <li><a href="#tidy-data" id="markdown-toc-tidy-data">Tidy Data</a></li>
      <li><a href="#normalizing" id="markdown-toc-normalizing">Normalizing</a></li>
      <li><a href="#pivoting" id="markdown-toc-pivoting">Pivoting</a></li>
    </ul>
  </li>
  <li><a href="#stringr" id="markdown-toc-stringr">stringr</a></li>
  <li><a href="#summing-up" id="markdown-toc-summing-up">Summing Up</a></li>
</ul>

<h2 id="welcome">Welcome!</h2>

<ul>
  <li data-marker="*">Welcome back to CS50’s Introduction to Programming with R!</li>
  <li data-marker="*">Today, we will be learning about tidying data. Indeed, you can imagine many times when tables and data may not be in the shape one would hope!</li>
  <li data-marker="*"><em>Packages</em> are bits of code created by developers that we can install and load into our R programs. These packages can give one functionality within R that does not come natively.</li>
  <li data-marker="*">Packages are stored in R’s <em>library</em>. As such, you can load packages with the <code class="language-plaintext highlighter-rouge">library</code> function.</li>
</ul>

<h2 id="dplyr">dplyr</h2>

<ul>
  <li data-marker="*"><a href="https://dplyr.tidyverse.org/">dplyr</a> is a package within the <a href="https://www.tidyverse.org/">tidyverse</a> that includes functions to manipulate data.</li>
  <li data-marker="*">Within dplyr, a data set called <code class="language-plaintext highlighter-rouge">storms</code> is included, which includes observations of storm data from <a href="https://www.noaa.gov/">NOAA</a>, the United States’ National Oceanic and Atmospheric Administration.</li>
  <li data-marker="*">After loading dplyr or the tidyverse, the <code class="language-plaintext highlighter-rouge">storms</code> data set can be loaded by simply typing <code class="language-plaintext highlighter-rouge">storms</code> in the R console.</li>
  <li data-marker="*">Upon typing <code class="language-plaintext highlighter-rouge">storms</code> notice that a <em>tibble</em> is displayed. A <em>tibble</em> is tidyverse’s “reimagining” of R’s data frame. Notice how rows, row numbers, and various columns are included and labeled. Further, notice the text color that is employed in the <em>tibble</em>.</li>
</ul>

<h3 id="select"><code class="language-plaintext highlighter-rouge">select</code></h3>

<ul>
  <li data-marker="*">
    <p>Let’s locate the strongest storm in the data set. First, let’s remove the columns we don’t need. Consider the following program:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Remove selected columns</span><span class="w">

</span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="w">
  </span><span class="n">storms</span><span class="p">,</span><span class="w">
  </span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">tropicalstorm_force_diameter</span><span class="p">,</span><span class="w"> </span><span class="n">hurricane_force_diameter</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how the <code class="language-plaintext highlighter-rouge">select</code> function within dplyr allows one to determine which columns will be included in a data frame or tibble. <code class="language-plaintext highlighter-rouge">select</code>’s first argument is the data frame (or tibble) to operate on: <code class="language-plaintext highlighter-rouge">storms</code>. <code class="language-plaintext highlighter-rouge">select</code>’s second argument is the vector of columns to be selected. In this case, however, a <code class="language-plaintext highlighter-rouge">!</code> is employed: a <code class="language-plaintext highlighter-rouge">!</code> indicates that the proceeding column names are instead to be excluded. Alternatively, a <code class="language-plaintext highlighter-rouge">-</code> has the same functionality. Running this code will simplify the tibble by removing the above columns.</p>
  </li>
  <li data-marker="*">Typing out all these columns is a bit cumbersome!</li>
  <li data-marker="*">
    <p>Helper functions like <code class="language-plaintext highlighter-rouge">contains</code>, <code class="language-plaintext highlighter-rouge">starts_with</code>, or <code class="language-plaintext highlighter-rouge">ends_with</code> can help with this. Consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Introduce ends_with</span><span class="w">

</span><span class="n">select</span><span class="p">(</span><span class="w">
  </span><span class="n">storms</span><span class="p">,</span><span class="w">
  </span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"diameter"</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">ends_with</code> is employed to exclude all columns that end with <em>diameter</em>. Less code is employed, but the result is the same as before.</p>
  </li>
</ul>

<h3 id="filter"><code class="language-plaintext highlighter-rouge">filter</code></h3>

<ul>
  <li data-marker="*">Another helpful function is <code class="language-plaintext highlighter-rouge">filter</code>, which can be used to filter rows from the data frame.</li>
  <li data-marker="*">
    <p>Consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Find only rows about hurricanes</span><span class="w">

</span><span class="n">filter</span><span class="p">(</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="w">
    </span><span class="n">storms</span><span class="p">,</span><span class="w">
    </span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"diameter"</span><span class="p">))</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"hurricane"</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how the only rows included are those that include <code class="language-plaintext highlighter-rouge">hurricane</code> in the <code class="language-plaintext highlighter-rouge">status</code> column.</p>
  </li>
  <li data-marker="*">Notice how the latest examples have dropped the <code class="language-plaintext highlighter-rouge">dplyr::</code> syntax in the first example. Turns out you don’t need to name the specific package in which a function is defined, unless two or more packages define a function with the same name. In that case, you’ll need to remove ambiguity by specifying which package’s function you want to use.</li>
</ul>

<h3 id="pipe-operator">Pipe Operator</h3>

<ul>
  <li data-marker="*">
    <p>In R, the <em>pipe operator</em> is signified by <code class="language-plaintext highlighter-rouge">|&gt;</code>, which allows one to “pipe” data into a specific function. For example, consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Introduce pipe operator</span><span class="w">

</span><span class="n">storms</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"diameter"</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"hurricane"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">storms</code> is piped to <code class="language-plaintext highlighter-rouge">select</code>, implicitly becoming <code class="language-plaintext highlighter-rouge">select</code>’s first argument. Then, notice how the return value of <code class="language-plaintext highlighter-rouge">select</code> is piped to <code class="language-plaintext highlighter-rouge">filter</code>, implicitly becoming <code class="language-plaintext highlighter-rouge">filter</code>’s first argument. When you use the pipe operator, you can avoid nesting function calls and write your code more sequentially.</p>
  </li>
</ul>

<h3 id="arrange"><code class="language-plaintext highlighter-rouge">arrange</code></h3>

<ul>
  <li data-marker="*">
    <p>Now let’s use the <code class="language-plaintext highlighter-rouge">arrange</code> function to sort our rows:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Find only rows about hurricanes, and arrange highest wind speed to least</span><span class="w">

</span><span class="n">storms</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"force_diameter"</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"hurricane"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">wind</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how the return value of the <code class="language-plaintext highlighter-rouge">select</code> function is piped to <code class="language-plaintext highlighter-rouge">filter</code>, the return value of which is then piped to <code class="language-plaintext highlighter-rouge">arrange</code>. The rows in the resulting data frame are arranged in descending order by value of the <code class="language-plaintext highlighter-rouge">wind</code> column.</p>
  </li>
</ul>

<h3 id="distinct"><code class="language-plaintext highlighter-rouge">distinct</code></h3>

<ul>
  <li data-marker="*">You may notice that this tibble includes many rows of the same storm. Because this data includes many observations of the same storms, this is not a surprise. However, would it not be nice to be able to find only <em>distinct</em> storms?</li>
  <li data-marker="*">The <code class="language-plaintext highlighter-rouge">distinct</code> function allows one to get back distinct items in our tibble.</li>
  <li data-marker="*">Distinct returns distinct rows finding duplicate rows and returning the first row from the set of duplicates.</li>
  <li data-marker="*">By default, <code class="language-plaintext highlighter-rouge">distinct</code> will consider rows to be duplicate only if <em>all</em> values in a row match <em>all</em> values in another row.</li>
  <li data-marker="*">
    <p>However, you can tell <code class="language-plaintext highlighter-rouge">distinct</code> which values to consider when determining whether rows are duplicates. Consider the following code that leverages this ability:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Keep only first observation about each hurricane</span><span class="w">

</span><span class="n">storms</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"force_diameter"</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"hurricane"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">wind</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">distinct</code> is told to only look at the <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">year</code> of each storm to determine if it is a distinct item. <code class="language-plaintext highlighter-rouge">.keep_all = TRUE</code> tells <code class="language-plaintext highlighter-rouge">distinct</code> to still return all the columns for each row.</p>
  </li>
</ul>

<h3 id="writing-data">Writing Data</h3>

<ul>
  <li data-marker="*">It’s possible for us to save our data for later in a CSV file.</li>
  <li data-marker="*">
    <p>Consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Write subset of columns to a CSV</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">storms</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">!</span><span class="nf">c</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">ends_with</span><span class="p">(</span><span class="s2">"force_diameter"</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"hurricane"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">wind</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">wind</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">write.csv</span><span class="p">(</span><span class="s2">"hurricanes.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how the result of the first block of code is stored as <code class="language-plaintext highlighter-rouge">hurricanes</code>. To store <code class="language-plaintext highlighter-rouge">hurricanes</code> as a CSV file, <code class="language-plaintext highlighter-rouge">select</code> first chooses 3 particular columns (<code class="language-plaintext highlighter-rouge">year</code>, <code class="language-plaintext highlighter-rouge">name</code>, and <code class="language-plaintext highlighter-rouge">wind</code>) which are written to a file named <code class="language-plaintext highlighter-rouge">hurricanes.csv</code>.</p>
  </li>
</ul>

<h3 id="group_by"><code class="language-plaintext highlighter-rouge">group_by</code></h3>

<ul>
  <li data-marker="*">Let’s now find the most powerful hurricane in each year.</li>
  <li data-marker="*">
    <p>Consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Find most powerful hurricane for each year</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"hurricanes.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">wind</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">slice_head</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">hurricanes.csv</code> is read into <code class="language-plaintext highlighter-rouge">hurricanes</code>. Then, the function <code class="language-plaintext highlighter-rouge">group_by</code> is employed to group together all hurricanes in each year. For each group, the group is arranged in descending order by <code class="language-plaintext highlighter-rouge">wind</code> using <code class="language-plaintext highlighter-rouge">arrange(desc(wind))</code>. Finally, <code class="language-plaintext highlighter-rouge">slice_head</code> is used to output the top row from each group. Thus, the strongest storm from each year is presented.</p>
  </li>
  <li data-marker="*">
    <p><code class="language-plaintext highlighter-rouge">slice_max</code> selects the largest values within a variable. Consider how this can be employed in our code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Introduce slice_max</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"hurricanes.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">slice_max</span><span class="p">(</span><span class="n">order_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wind</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">hurricanes</code> is grouped by <code class="language-plaintext highlighter-rouge">year</code>. Then, the highest value of <code class="language-plaintext highlighter-rouge">wind</code> is presented using <code class="language-plaintext highlighter-rouge">slice_max</code>. Doing so eliminates the need for <code class="language-plaintext highlighter-rouge">arrange(desc(wind))</code>.</p>
  </li>
</ul>

<h3 id="summarize"><code class="language-plaintext highlighter-rouge">summarize</code></h3>

<ul>
  <li data-marker="*">
    <p>What if we wanted to know the number of hurricanes each year? Consider the following code:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Find number of hurricanes per year</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"hurricanes.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how the function <code class="language-plaintext highlighter-rouge">summarize</code>, employing <code class="language-plaintext highlighter-rouge">n</code>, counts the number of rows in each group.</p>
  </li>
</ul>

<h3 id="ungroup"><code class="language-plaintext highlighter-rouge">ungroup</code></h3>

<ul>
  <li data-marker="*">
    <p>Looking at our <code class="language-plaintext highlighter-rouge">hurricanes</code> data frame, you will notice that there are groups present. Indeed, these groups are by <code class="language-plaintext highlighter-rouge">year</code>. There will be times in future activities where you may wish to ungroup items within your data. Accordingly, consider the following:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Show ungroup</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"hurricanes.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">hurricanes</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">slice_max</span><span class="p">(</span><span class="n">order_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wind</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice that the <code class="language-plaintext highlighter-rouge">ungroup</code> command is employed to remove the groups of the tibble.</p>
  </li>
</ul>

<h2 id="tidyr">tidyr</h2>

<ul>
  <li data-marker="*">dplyr is quite useful when data is already well organized.</li>
  <li data-marker="*">What about situations where the data is not already well organized?</li>
  <li data-marker="*">For that, the tidyr package can be useful!</li>
</ul>

<h3 id="tidy-data">Tidy Data</h3>

<ul>
  <li data-marker="*">
    <p>According to the philosophy of the tidyverse, there are three principles that guide what we would call <em>tidy data</em>.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. Each observation is a row; each row is an observation.
2. Each variable is a column; each column is a variable.
3. Each value is a cell; each cell is a single value.
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>When evaluating data, best to look at the above three principles to see if they are observed.</p>
  </li>
</ul>

<h3 id="normalizing">Normalizing</h3>

<ul>
  <li data-marker="*"><em>Normalizing</em> is the process of converting data such that they fulfill the aforementioned principles.</li>
  <li data-marker="*">Normalizing can also refer to converting data such that they fulfill better design principles beyond the above guidelines.</li>
  <li data-marker="*">
    <p>Download the <code class="language-plaintext highlighter-rouge">students.csv</code> file from the course files and place it in your working directory. Create new code as follows:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read CSV</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"students.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">View</span><span class="p">(</span><span class="n">students</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice that this code loads a CSV file called <code class="language-plaintext highlighter-rouge">students.csv</code> and stores these values in <code class="language-plaintext highlighter-rouge">students</code>.</p>
  </li>
  <li data-marker="*">Examining this data, you may see how they do not follow the principles we mentioned previously. Which principles do you observe not being followed?</li>
</ul>

<h3 id="pivoting">Pivoting</h3>

<ul>
  <li data-marker="*">In the <code class="language-plaintext highlighter-rouge">students</code> data set, you might notice there are row values that should instead be column names: “major” and “GPA.” To be clear, this data set violates the second principle of tidy data: each way a student can vary is <em>not</em> a column.</li>
  <li data-marker="*">We can <em>pivot</em> the data set to turn those variables into columns, thanks to <code class="language-plaintext highlighter-rouge">pivot_wider</code>! <code class="language-plaintext highlighter-rouge">pivot_wider</code> transforms a data set that is “longer” than it should be (i.e., one with variables as row values) and makes it “wider” (i.e., turns those variables into columns).</li>
  <li data-marker="*">
    <p><code class="language-plaintext highlighter-rouge">pivot_wider</code> will transform the <code class="language-plaintext highlighter-rouge">students</code> data set from the below:</p>

    <p><img src="../Images/b2abe2d0d26093da0fd1d68a9802293f.png" alt="`students` before pivoting" data-original-src="https://cs50.harvard.edu/r/notes/4/077.png"/></p>

    <p>into the following:</p>

    <p><img src="../Images/7ba32632526b205660d8d18e34b724bf.png" alt="`students` after pivoting" data-original-src="https://cs50.harvard.edu/r/notes/4/078.png"/></p>
  </li>
  <li data-marker="*">
    <p>But how? Consider the following usage:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Demonstrates pivot_wider</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"students.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pivot_wider</span><span class="p">(</span><span class="w">
  </span><span class="n">students</span><span class="p">,</span><span class="w">
  </span><span class="n">id_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">student</span><span class="p">,</span><span class="w">
  </span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attribute</span><span class="p">,</span><span class="w">
  </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">pivot_wider</code> takes several arguments, explained here:</p>
    <ul>
      <li data-marker="*">The first is the data set to operate on, <code class="language-plaintext highlighter-rouge">students</code>.</li>
      <li data-marker="*">The second argument, <code class="language-plaintext highlighter-rouge">id_cols</code>, specifies which column should ultimately be unique in the transformed data set. Notice how, before <code class="language-plaintext highlighter-rouge">pivot_wider</code>’s transformation, there are duplicate values in the <code class="language-plaintext highlighter-rouge">student</code> column. After <code class="language-plaintext highlighter-rouge">pivot_wider</code>’s transformation, there are unique values in the <code class="language-plaintext highlighter-rouge">student</code> column.</li>
      <li data-marker="*">The third argument, <code class="language-plaintext highlighter-rouge">names_from</code>, specifies which column contains values that should instead be variables (columns). Notice how the values in the <code class="language-plaintext highlighter-rouge">attribute</code> column become columns themselves after <code class="language-plaintext highlighter-rouge">pivot_wider</code>’s transformation.</li>
      <li data-marker="*">Finally, the fourth argument, <code class="language-plaintext highlighter-rouge">values_from</code>, specifies the column from which to populate the values of the new columns. Notice how the values in the <code class="language-plaintext highlighter-rouge">value</code> column are used to populate the new columns after <code class="language-plaintext highlighter-rouge">pivot_wider</code>’s transformation.</li>
    </ul>
  </li>
  <li data-marker="*">Because our data is so much more tidy, we can do so much more with the data!</li>
  <li data-marker="*">
    <p>Consider the following:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Demonstrates calculating average GPA by major</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"students.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pivot_wider</span><span class="p">(</span><span class="w">
  </span><span class="n">students</span><span class="p">,</span><span class="w">
  </span><span class="n">id_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">student</span><span class="p">,</span><span class="w">
  </span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attribute</span><span class="p">,</span><span class="w">
  </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">students</span><span class="o">$</span><span class="n">GPA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">students</span><span class="o">$</span><span class="n">GPA</span><span class="p">)</span><span class="w">

</span><span class="n">students</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">major</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">GPA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">GPA</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how this program leverages <code class="language-plaintext highlighter-rouge">pivot_wider</code> and tidyr to discover the average GPA of the students. <code class="language-plaintext highlighter-rouge">GPA</code> in <code class="language-plaintext highlighter-rouge">students</code> is converted to a numeric value. Then, pipe syntax is used to find the mean of the GPAs.</p>
  </li>
</ul>

<h2 id="stringr">stringr</h2>

<ul>
  <li data-marker="*">The process we described above works well when the values themselves are clean. However, what about when the values themselves aren’t tidy?</li>
  <li data-marker="*">
    <p><code class="language-plaintext highlighter-rouge">stringr</code> offers us a means by which to tidy strings. Download <code class="language-plaintext highlighter-rouge">shows.csv</code> from the course files and place this file in your working directory. Consider the following program:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Tally votes for favorite shows</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"shows.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">votes</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how shows are grouped by <code class="language-plaintext highlighter-rouge">show</code>. Then, the number of <code class="language-plaintext highlighter-rouge">votes</code> is computed. Finally, the <code class="language-plaintext highlighter-rouge">votes</code> are sorted in descending order.</p>
  </li>
  <li data-marker="*">
    <p>Looking at the result of this program, you can see that there are many versions of <em>Avatar: The Last Airbender</em>. We should probably address the whitespace issues first.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Clean up inner whitespace</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"shows.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_trim</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_squish</span><span class="p">()</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">votes</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">str_trim</code> is used to remove whitespace in the front or end of each record. <code class="language-plaintext highlighter-rouge">str_squish</code> is then used to remove extra whitespace <em>between</em> the characters.</p>
  </li>
  <li data-marker="*">
    <p>While all this is very good, there are still some inconsistencies with capitalization. We can resolve as follows:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Clean up capitalization</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"shows.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_trim</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_squish</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_to_title</span><span class="p">()</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">votes</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">str_to_title</code> is used to force title casing on each string.</p>
  </li>
  <li data-marker="*">
    <p>Finally, we can address spelling variants of <em>Avatar: The Last Airbender</em>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Clean up spelling</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"shows.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_trim</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_squish</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">str_to_title</span><span class="p">()</span><span class="w">

</span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="p">[</span><span class="n">str_detect</span><span class="p">(</span><span class="n">shows</span><span class="o">$</span><span class="n">show</span><span class="p">,</span><span class="w"> </span><span class="s2">"Avatar"</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Avatar: The Last Airbender"</span><span class="w">

</span><span class="n">shows</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">votes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">votes</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">str_detect</code> is used to locate instances of <code class="language-plaintext highlighter-rouge">Avatar</code>. Each of these is converted to <code class="language-plaintext highlighter-rouge">Avatar: The Last Airbender</code>.</p>
  </li>
  <li data-marker="*">While these tools can be quite helpful, consider cases where you may need to employ caution and not overwrite correct entries. For example, there are many movies called <em>Avatar</em>! How do we know whether voters didn’t mean to vote for those movies?</li>
</ul>

<h2 id="summing-up">Summing Up</h2>

<p>In this lesson, you learned how to tidy data in R. Specifically, you learned three new packages, which are each part of the tidyverse:</p>

<ul>
  <li data-marker="*">dplyr</li>
  <li data-marker="*">tidyr</li>
  <li data-marker="*">stringr</li>
</ul>

<p>See you next time when we discuss how to visualize our data.</p>


                    
</body>
</html>