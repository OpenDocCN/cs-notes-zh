- en: Lecture 6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://cs50.harvard.edu/r/notes/6/](https://cs50.harvard.edu/r/notes/6/)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Welcome!](#welcome)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Exceptions](#exceptions)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[`message`](#message)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[`warning`](#warning)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[`stop`](#stop)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Unit Tests](#unit-tests)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[testthat](#testthat)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Testing Floating-Point Values](#testing-floating-point-values)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Tolerance](#tolerance)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Test-Driven Development](#test-driven-development)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Behavior-Driven Development](#behavior-driven-development)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Test Coverage](#test-coverage)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Summing Up](#summing-up)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Welcome!
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Welcome back to CS50’s Introduction to Programming with R!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Today, we will be learning about testing programs. We will see how our programs
    can go wrong, how we can handle things when they do, and how to methodically test
    our programs to ensure they behave as we expect!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exceptions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Consider the following program that calculates an average:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how this program attempts to take as its input a vector of numbers and
    output the average.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You can imagine how your user may accidentally pass characters instead of numbers,
    resulting in our `average` function outputting an error.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'These errors are called *exceptions*. Could there be a way by which we could
    check for potential such exceptions? Consider the following update to `average`:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how a conditional, an `if` statement, checks to see if the vector `x`
    is not full of numbers. By convention in the R world, returning a value `NA` is
    appropriate in such an instance.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`message`'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'While this allows our program to run silently, we may wish to let the user
    know that an exception has occurred. One way to alert the user is via the `message`
    function:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how a `message` is sent to the user about why the program is returning
    `NA` instead.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Traditionally, `message` is intended for when something has *not* gone wrong:
    `message` is purely for informational purposes. Thus, we can escalate the importance
    of this information through a `warning`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`warning`'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We can escalate the importance of our `message` to a `warning` as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how the output is now a warning message.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: A `warning` doesn’t stop a program altogether, but it does let a programmer
    know that something has gone wrong.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`stop`'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can imagine situations where you don’t simply want to warn the user; You
    may want to completely stop the function. Consider the following:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how `stop` tells the user we cannot proceed given the input they have
    provided us.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'It is also possible to combine both possibilities. For example, the following
    code looks at both situations where `x` contains non-numeric elements. Similarly,
    this code accommodates situations where there are `NA` values:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how two `if` statements are provided.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Unit Tests
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Unit tests* are used to test our functions and programs.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Consider the following test function for `average` in a separate file:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that this function provides a test case where the numbers `1`, `2`, and
    `3` are provided to the `average` function. Then, some feedback is provided. Notice
    how, in the first line, `source` ensures this test file has access to the `average`
    function.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'It would also be wise to test negative numbers:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how additional tests are provided for positive and negative numbers and
    zero.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We have already written 21 lines of code! Thankfully, programmers have already
    created various test packages or libraries that can be used to test our code.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: testthat
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: testthat is a package for testing R code. It can be loaded by typing `library(testthat)`
    into your console.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'testthat includes a function called `test_that` that can be used to test our
    function:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how the `test_that` function can be told to expect that that the `average`
    of various numbers will equal a certain value, thanks to `expect_equal`. Similarly,
    we can provide the `test_that` function instructions to `expect_warning` when
    the average calculation includes `NA` values. Further, notice how the test is
    divided into various sections. One section tests the calculation of the mean,
    while another tests the warnings.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Running the above test, we discover that the order of our `if` statements in
    our `average` function may be out of order:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how the order of the conditional statements is altered.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We should still test that `average` returns `NA` when given an `NA` value in
    its input, not just that `average` raises a warning!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how we have two separate tests that pass `NA` values as input to `average`.
    One tests for the right return value, while the other tests for a `warning` to
    be raised.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`test_that` has other functions that can assist us in testing, including `expect_error`
    and `expect_no_error`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Using `expect_error` we can modify our code as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how this code expects an error when the input is “quack!” or when characters
    are provided instead of numbers.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Testing Floating-Point Values
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We may wish to provide floating-point values (i.e., decimal values) as input
    to `average`:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how a test for floating-point values is added at the end of the first
    set of tests.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Tolerance
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Floating-point values are unique, in that they are subject to floating-point
    imprecision.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Let’s understand floating-point imprecision by example:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how we see that 0.3 is not represented as precisely 0.3 in R. This is
    a common phenomenon across programming languages, given that there are an infinite
    number of floating-point values and a finite number of bits to represent them.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Because of floating-point imprecision, tests of equality involving floating-point
    values need to allow for some *tolerance*. Tolerance refers to a range of values,
    above or below the expected value, that will be considered—for the sake of the
    test—to be equal to the expected value. Tolerance is often specified in absolute
    terms, such as ± .000001.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `expect_equal` function already provides a level of tolerance that is generally
    acceptable for most use cases. This default can be changed with the `tolerance`
    argument.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You and your team should decide upon what level of precision is expected in
    your calculations.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Test-Driven Development
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'One philosophy of development is called *test-driven development*. In this
    mindset, the belief is that it is best to create a test first before even writing
    the source code that will be tested. Consider the following test:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how you can imagine that a `greet` function should greet a user provided
    as input.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Looking at the test, we could create code that responds to the test:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Notice how this code says `hello` to a user by name.
  prefs: []
  type: TYPE_NORMAL
- en: In test-driven development, writing tests allows programmers to know what functionality
    they should implement. The benefit is that this functionality is then immediately
    testable. Further modifications should always pass the tests one has already written.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Behavior-Driven Development
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Behavior-driven development* is similar in spirit to test-driven development,
    with a greater focus on the behavior of a function in context. In behavior-driven
    development, one might describe what we want the function to do by explicitly
    naming what it should do.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'testthat comes with two functions to implement behavior-driven development,
    `describe` and `it`:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how `describe` includes several code-based descriptions of what `it`
    (the function!) should be able to do.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Test Coverage
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you go off and write tests for your code, consider how comprehensive these
    tests are. Define what is critical for your code to accomplish and create tests
    that exemplify those critical tasks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summing Up
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this lesson, you learned how to test programs in R. Specifically, you learned
    about:'
  prefs: []
  type: TYPE_NORMAL
- en: Exceptions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`message`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`warning`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`stop`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unit Tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: testthat
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing Floating-Point Values
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tolerance
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Test-Driven Development
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Behavior-Driven Development
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Test Coverage
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See you next time when we can package our code and share it with the world.
  prefs: []
  type: TYPE_NORMAL
