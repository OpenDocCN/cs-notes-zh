<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Lecture 9</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Lecture 9</h1>
<blockquote>原文：<a href="https://cs50.harvard.edu/x/notes/9/">https://cs50.harvard.edu/x/notes/9/</a></blockquote>

                    

<ul id="markdown-toc">
  <li><a href="#welcome" id="markdown-toc-welcome">Welcome!</a></li>
  <li><a href="#http-server" id="markdown-toc-http-server">http-server</a></li>
  <li><a href="#flask" id="markdown-toc-flask">Flask</a></li>
  <li><a href="#forms" id="markdown-toc-forms">Forms</a></li>
  <li><a href="#templates" id="markdown-toc-templates">Templates</a></li>
  <li><a href="#request-methods" id="markdown-toc-request-methods">Request Methods</a></li>
  <li><a href="#frosh-ims" id="markdown-toc-frosh-ims">Frosh IMs</a></li>
  <li><a href="#flask-and-sql" id="markdown-toc-flask-and-sql">Flask and SQL</a></li>
  <li><a href="#cookies-and-session" id="markdown-toc-cookies-and-session">Cookies and Session</a></li>
  <li><a href="#shopping-cart" id="markdown-toc-shopping-cart">Shopping Cart</a></li>
  <li><a href="#shows" id="markdown-toc-shows">Shows</a></li>
  <li><a href="#apis" id="markdown-toc-apis">APIs</a></li>
  <li><a href="#json" id="markdown-toc-json">JSON</a></li>
  <li><a href="#summing-up" id="markdown-toc-summing-up">Summing Up</a></li>
</ul>

<h2 id="welcome">Welcome!</h2>

<ul>
  <li data-marker="*">In previous weeks, you have learned numerous programming languages, techniques, and strategies.</li>
  <li data-marker="*">Indeed, this class has been far less of a <em>C class</em> or <em>Python class</em> and far more of a <em>programming class</em>, such that you can go on to follow future trends.</li>
  <li data-marker="*">In these past several weeks, you have learned <em>how to learn</em> about programming.</li>
  <li data-marker="*">Today, we will be moving from HTML and CSS into combining HTML, CSS, SQL, Python, and JavaScript so you can create your own web applications.</li>
  <li data-marker="*">You might consider using the skills you learn this week to create your final project.</li>
</ul>

<h2 id="http-server">http-server</h2>

<ul>
  <li data-marker="*">Up until this point, all HTML you saw was pre-written and static.</li>
  <li data-marker="*">In the past, when you visited a page, the browser downloaded an HTML page, and you were able to view it. These are considered <em>static</em> pages, in that what is programmed in the HTML is exactly what the user sees and downloads <em>client-side</em> to their internet browser.</li>
  <li data-marker="*">Dynamic pages refer to the ability of Python and similar languages to create HTML on-the-fly. Accordingly, you can have web pages that are generated <em>server-side</em> by code based upon the input or behavior of users.</li>
  <li data-marker="*">You have used <code class="language-plaintext highlighter-rouge">http-server</code> in the past to serve your web pages. Today, we are going to utilize a new server that can parse out a web address and perform actions based on the URL provided.</li>
  <li data-marker="*">
    <p>Further, last week, you saw URLs as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/folder/file.html
</code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">file.html</code> is an HTML file inside a folder called <code class="language-plaintext highlighter-rouge">folder</code> at <code class="language-plaintext highlighter-rouge">example.com</code>.</p>
  </li>
</ul>

<h2 id="flask">Flask</h2>

<ul>
  <li data-marker="*">This week, we introduce the ability to engage with <em>routes</em> such as <code class="language-plaintext highlighter-rouge">https://www.example.com/route?key=value</code>, where specific functionality can be generated on the server via the keys and values provided in the URL.</li>
  <li data-marker="*"><em>Flask</em> is a third-party library that allows you to host web applications using the Flask framework, or a micro-framework, within Python.</li>
  <li data-marker="*">You can run Flask by executing <code class="language-plaintext highlighter-rouge">flask run</code> in your terminal window in <a href="https://cs50.dev">cs50.dev</a>.</li>
  <li data-marker="*">To do so, you will need a file called <code class="language-plaintext highlighter-rouge">app.py</code> and another called <code class="language-plaintext highlighter-rouge">requirements.txt</code>. <code class="language-plaintext highlighter-rouge">app.py</code> contains code the tells Flask how to run your web application. <code class="language-plaintext highlighter-rouge">requirements.txt</code> includes a list of the libraries that are required for your Flask application to run.</li>
  <li data-marker="*">
    <p>Here is a sample of <code class="language-plaintext highlighter-rouge">requirements.txt</code>:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Flask</span>
</code></pre></div>    </div>
    <p>Notice only <code class="language-plaintext highlighter-rouge">Flask</code> appears in this file. This is because Flask is required to run the Flask application.</p>
  </li>
  <li data-marker="*">
    <p>Here is a very simple Flask application in <code class="language-plaintext highlighter-rouge">app.py</code>:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Says hello to world by returning a string of text
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">hello, world</span><span class="sh">"</span>
</code></pre></div>    </div>
    <p>Notice that the <code class="language-plaintext highlighter-rouge">/</code> route simply returns the text <code class="language-plaintext highlighter-rouge">hello, world</code>.</p>
  </li>
  <li data-marker="*">
    <p>We can also create code that implements HTML:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Says hello to world by returning a string of HTML
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="sh">'</span><span class="s">&lt;!DOCTYPE html&gt;&lt;html lang=</span><span class="sh">"</span><span class="s">en</span><span class="sh">"</span><span class="s">&gt;&lt;head&gt;&lt;title&gt;hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;hello, world&lt;/body&gt;&lt;/html&gt;</span><span class="sh">'</span>
</code></pre></div>    </div>
    <p>Notice that rather than returning simple text, this provides HTML.</p>
  </li>
  <li data-marker="*">
    <p>Improving our application, we can also serve HTML based upon templates by creating a folder called <code class="language-plaintext highlighter-rouge">templates</code> and creating a file called <code class="language-plaintext highlighter-rouge">index.html</code> with the following code within that folder:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        hello, {{ name }}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
  
</code></pre></div>    </div>
    <p>Notice the double <code class="language-plaintext highlighter-rouge">{{ name }}</code> that is a placeholder for something that will be later provided by our Flask server.</p>
  </li>
  <li data-marker="*">
    <p>Then, in the same folder that the <code class="language-plaintext highlighter-rouge">templates</code> folder appears, create a file called <code class="language-plaintext highlighter-rouge">app.py</code> and add the following code:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Uses request.args.get
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that this code defines <code class="language-plaintext highlighter-rouge">app</code> as the Flask application. Then, it defines the <code class="language-plaintext highlighter-rouge">/</code> route of <code class="language-plaintext highlighter-rouge">app</code> as returning the contents of <code class="language-plaintext highlighter-rouge">index.html</code> with the argument of <code class="language-plaintext highlighter-rouge">name</code>. By default, the <code class="language-plaintext highlighter-rouge">request.args.get</code> function will look for the <code class="language-plaintext highlighter-rouge">name</code> being provided by the user. If no name is provided, it will default to <code class="language-plaintext highlighter-rouge">world</code>. <code class="language-plaintext highlighter-rouge">@app.route</code> is otherwise known as a decorator.</p>
  </li>
  <li data-marker="*">
    <p>You can run this web application by typing <code class="language-plaintext highlighter-rouge">flask run</code> in the terminal window. If Flask does not run, ensure that your syntax is correct in each of the files above. Further, if Flask will not run, make sure your files are organized as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/templates
    index.html
app.py
requirements.txt
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Once you get it running, you will be prompted to click a link. Once you navigate to that webpage, try adding <code class="language-plaintext highlighter-rouge">?name=[Your Name]</code> to the base URL in your browser’s URL bar.</li>
</ul>

<h2 id="forms">Forms</h2>

<ul>
  <li data-marker="*">
    <p>Improving upon our program, we know that most users will not type arguments into the address bar. Instead, programmers rely upon users to fill out forms on web pages. Accordingly, we can modify <code class="language-plaintext highlighter-rouge">index.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/greet"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Greet<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice that a form is now created that takes the user’s name and then passes it off to a route called <code class="language-plaintext highlighter-rouge">/greet</code>. <code class="language-plaintext highlighter-rouge">autocomplete</code> is turned off. Further, a <code class="language-plaintext highlighter-rouge">placeholder</code> with the text <code class="language-plaintext highlighter-rouge">name</code> is included. Further, notice how the <code class="language-plaintext highlighter-rouge">meta</code> tag is used to make the web page mobile-responsive.</p>
  </li>
  <li data-marker="*">
    <p>Further, we can change <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Adds a form, second route
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/greet</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">greet.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">))</span>
</code></pre></div>    </div>
    <p>Notice that the default path will display a form for the user to input their name. The <code class="language-plaintext highlighter-rouge">/greet</code> route will pass the <code class="language-plaintext highlighter-rouge">name</code> to that web page.</p>
  </li>
  <li data-marker="*">
    <p>To finalize this implementation, you will need another template for <code class="language-plaintext highlighter-rouge">greet.html</code> in the <code class="language-plaintext highlighter-rouge">templates</code> folder as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        hello, {{ name }}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice that this route will now render the greeting to the user, followed by their name.</p>
  </li>
</ul>

<h2 id="templates">Templates</h2>

<ul>
  <li data-marker="*">Both of our web pages, <code class="language-plaintext highlighter-rouge">index.html</code> and <code class="language-plaintext highlighter-rouge">greet.html</code>, have much of the same data. Wouldn’t it be nice to allow the body to be unique but copy the same layout from page to page?</li>
  <li data-marker="*">
    <p>First, create a new template called <code class="language-plaintext highlighter-rouge">layout.html</code> and write code as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice that the <code class="language-plaintext highlighter-rouge">{% block body %}{% endblock %}</code> allows for the insertion of other code from other HTML files.</p>
  </li>
  <li data-marker="*">
    <p>Then, modify your <code class="language-plaintext highlighter-rouge">index.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/greet"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Greet<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>

{% endblock %}
</code></pre></div>    </div>
    <p>Notice that the line <code class="language-plaintext highlighter-rouge">{% extends "layout.html" %}</code> tells the server where to get the layout of this page. Then, the <code class="language-plaintext highlighter-rouge">{% block body %}{% endblock %}</code> tells what code to be inserted into <code class="language-plaintext highlighter-rouge">layout.html</code>.</p>
  </li>
  <li data-marker="*">
    <p>Finally, change <code class="language-plaintext highlighter-rouge">greet.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    hello, {{ name }}
{% endblock %}
</code></pre></div>    </div>
    <p>Notice how this code is shorter and more compact.</p>
  </li>
</ul>

<h2 id="request-methods">Request Methods</h2>

<ul>
  <li data-marker="*">You can imagine scenarios where it is not safe to utilize <code class="language-plaintext highlighter-rouge">get</code>, as usernames and passwords would show up in the URL.</li>
  <li data-marker="*">
    <p>We can utilize the method <code class="language-plaintext highlighter-rouge">post</code> to help with this problem by modifying <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Switches to POST
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/greet</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">greet.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">))</span>
</code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">POST</code> is added to the <code class="language-plaintext highlighter-rouge">/greet</code> route, and that we use <code class="language-plaintext highlighter-rouge">request.form.get</code> rather than <code class="language-plaintext highlighter-rouge">request.args.get</code>.</p>
  </li>
  <li data-marker="*">This tells the server to look <em>deeper</em> into the virtual envelope and not reveal the items in <code class="language-plaintext highlighter-rouge">post</code> in the URL.</li>
  <li data-marker="*">
    <p>Still, this code can be advanced further by utilizing a single route for both <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">post</code>. To do this, modify <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Uses a single route
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">greet.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that both <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">post</code> are done in a single routing. However, <code class="language-plaintext highlighter-rouge">request.method</code> is utilized to properly route based on the type of routing requested by the user.</p>
  </li>
  <li data-marker="*">
    <p>Accordingly, you can modify your <code class="language-plaintext highlighter-rouge">index.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Greet<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>

{% endblock %}
</code></pre></div>    </div>
    <p>Notice that the form <code class="language-plaintext highlighter-rouge">action</code> is changed.</p>
  </li>
  <li data-marker="*">
    <p>Still, there is a bug still in this code. With our new implementation, when someone types in no name into the form, <code class="language-plaintext highlighter-rouge">Hello, </code> is displayed without a name. We can improve our code by editing <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Moves default value to template
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">greet.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">name=request.form.get("name"))</code> is changed.</p>
  </li>
  <li data-marker="*">
    <p>Finally, change <code class="language-plaintext highlighter-rouge">greet.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    hello,
    {% if name -%}
        {{ name }}
    {%- else -%}
        world
    {%- endif %}

{% endblock %}
</code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">hello, {{ name }}</code> is changed to allow for a default output when no name is identified.</p>
  </li>
  <li data-marker="*">As we’ve been changing many files, you may wish to compare your final code with <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/hello10/">our final code</a>.</li>
</ul>

<h2 id="frosh-ims">Frosh IMs</h2>

<ul>
  <li data-marker="*">Frosh IMs or <em>froshims</em> is a web application that allows students to register for intramural sports.</li>
  <li data-marker="*">Close all your <code class="language-plaintext highlighter-rouge">hello</code> related windows and create a folder by typing <code class="language-plaintext highlighter-rouge">mkdir froshims</code> in the terminal window. Then, type <code class="language-plaintext highlighter-rouge">cd froshims</code> to browse to this folder. Within, create a directory called templates by typing <code class="language-plaintext highlighter-rouge">mkdir templates</code>.</li>
  <li data-marker="*">
    <p>Next, in the <code class="language-plaintext highlighter-rouge">froshims</code> folder, type <code class="language-plaintext highlighter-rouge">code requirements.txt</code> and code as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flask
</code></pre></div>    </div>
    <p>As before, Flask is required to run a Flask application.</p>
  </li>
  <li data-marker="*">
    <p>Finally, type <code class="language-plaintext highlighter-rouge">code app.py</code> and write code as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Implements a registration form using a select menu, validating sport server-side
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">SPORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">Basketball</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Soccer</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Ultimate Frisbee</span><span class="sh">"</span>
<span class="p">]</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">sports</span><span class="o">=</span><span class="n">SPORTS</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/register</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="c1"># Validate submission
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">sport</span><span class="sh">"</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">failure.html</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Confirm registration
</span>    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">success.html</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that a <code class="language-plaintext highlighter-rouge">failure</code> option is provided, such that a failure message will be displayed to the user if the <code class="language-plaintext highlighter-rouge">name</code> or <code class="language-plaintext highlighter-rouge">sport</code> field is not properly filled out.</p>
  </li>
  <li data-marker="*">
    <p>Next, create a file in the <code class="language-plaintext highlighter-rouge">templates</code> folder called <code class="language-plaintext highlighter-rouge">index.html</code> by typing <code class="language-plaintext highlighter-rouge">code templates/index.html</code> and write code as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/register"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"sport"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">disabled</span> <span class="na">selected</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>Sport<span class="nt">&lt;/option&gt;</span>
            {% for sport in sports %}
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"{{ sport }}"</span><span class="nt">&gt;</span>{{ sport }}<span class="nt">&lt;/option&gt;</span>
            {% endfor %}
        <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Next, create a file called <code class="language-plaintext highlighter-rouge">layout.html</code> by typing <code class="language-plaintext highlighter-rouge">code templates/layout.html</code> and write code as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>froshims<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Fourth, create a file in templates called <code class="language-plaintext highlighter-rouge">success.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    You are registered!
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Finally, create a file in templates called <code class="language-plaintext highlighter-rouge">failure.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    You are not registered!
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Execute <code class="language-plaintext highlighter-rouge">flask run</code> and check out the application at this stage.</li>
  <li data-marker="*">
    <p>You can imagine how we might want to see the various registration options using radio buttons. We can improve <code class="language-plaintext highlighter-rouge">index.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/register"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        {% for sport in sports %}
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"sport"</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"{{ sport }}"</span><span class="nt">&gt;</span> {{ sport }}
        {% endfor %}
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
{% endblock %}
</code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">type</code> has been changed to <code class="language-plaintext highlighter-rouge">radio</code>.</p>
  </li>
  <li data-marker="*">Again, executing <code class="language-plaintext highlighter-rouge">flask run</code> you can see how the interface has now changed.</li>
  <li data-marker="*">
    <p>You can imagine how we might want to accept the registration of many different registrants. We can improve <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Implements a registration form, storing registrants in a dictionary, with error messages
</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">REGISTRANTS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">SPORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">Basketball</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Soccer</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Ultimate Frisbee</span><span class="sh">"</span>
<span class="p">]</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">sports</span><span class="o">=</span><span class="n">SPORTS</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/register</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="c1"># Validate name
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Missing name</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Validate sport
</span>    <span class="n">sport</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">sport</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sport</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Missing sport</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sport</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Invalid sport</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Remember registrant
</span>    <span class="n">REGISTRANTS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sport</span>

    <span class="c1"># Confirm registration
</span>    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/registrants</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/registrants</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">registrants</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">registrants.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">registrants</span><span class="o">=</span><span class="n">REGISTRANTS</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that a dictionary called <code class="language-plaintext highlighter-rouge">REGISTRANTS</code> is used to log the <code class="language-plaintext highlighter-rouge">sport</code> selected by <code class="language-plaintext highlighter-rouge">REGISTRANTS[name]</code>. Also, notice that <code class="language-plaintext highlighter-rouge">registrants=REGISTRANTS</code> passes the dictionary on to this template.</p>
  </li>
  <li data-marker="*">
    <p>Additionally, we can implement <code class="language-plaintext highlighter-rouge">error.html</code>:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Error<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ message }}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"Grumpy Cat"</span> <span class="na">src=</span><span class="s">"/static/cat.jpg"</span><span class="nt">&gt;</span>
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Further, create a new template called <code class="language-plaintext highlighter-rouge">registrants.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Registrants<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;table&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Sport<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            {% for name in registrants %}
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ name }}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ registrants[name] }}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            {% endfor %}
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
{% endblock %}
</code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">{% for name in registrants %}...{% endfor %}</code> will iterate through each of the registrants. Very powerful to be able to iterate on a dynamic web page!</p>
  </li>
  <li data-marker="*">Finally, create a folder called <code class="language-plaintext highlighter-rouge">static</code> in the same folder as <code class="language-plaintext highlighter-rouge">app.py</code>. There, upload the following file of a <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/froshims4/static/cat.jpg">cat</a>.</li>
  <li data-marker="*">Execute <code class="language-plaintext highlighter-rouge">flask run</code> and play with the application.</li>
  <li data-marker="*">You now have a web application! However, there are some security flaws! Because everything is client-side, an adversary could change the HTML and <em>hack</em> a website. Further, this data will not persist if the server is shut down. Could there be some way we could have our data persist even when the server restarts?</li>
</ul>

<h2 id="flask-and-sql">Flask and SQL</h2>
<ul>
  <li data-marker="*">Just as we have seen how Python can interface with a SQL database, we can combine the power of Flask, Python, and SQL to create a web application where data will persist!</li>
  <li data-marker="*">To implement this, you will need to take a number of steps.</li>
  <li data-marker="*">First, download the following <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/froshims4/froshims.db">SQL database</a> into your <code class="language-plaintext highlighter-rouge">froshims</code> folder.</li>
  <li data-marker="*">Execute in the terminal <code class="language-plaintext highlighter-rouge">sqlite3 froshims.db</code> and type <code class="language-plaintext highlighter-rouge">.schema</code> to see the contents of the database file. Further type <code class="language-plaintext highlighter-rouge">SELECT * FROM registrants;</code> to learn about the contents. You’ll notice that there are currently no registrations in the file.</li>
  <li data-marker="*">
    <p>Next, modify <code class="language-plaintext highlighter-rouge">requirements.txt</code> as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cs50
Flask
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Modify <code class="language-plaintext highlighter-rouge">index.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/register"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        {% for sport in sports %}
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"sport"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"{{ sport }}"</span><span class="nt">&gt;</span> {{ sport }}
        {% endfor %}
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Modify <code class="language-plaintext highlighter-rouge">layout.html</code> as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>froshims<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Ensure <code class="language-plaintext highlighter-rouge">error.html</code> appears as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Error<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ message }}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"Grumpy Cat"</span> <span class="na">src=</span><span class="s">"/static/cat.jpg"</span><span class="nt">&gt;</span>
{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Modify <code class="language-plaintext highlighter-rouge">registrants.html</code> to appear as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Registrants<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;table&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Sport<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            {% for registrant in registrants %}
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ registrant.name }}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ registrant.sport }}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>
                        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/deregister"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"{{ registrant.id }}"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Deregister<span class="nt">&lt;/button&gt;</span>
                        <span class="nt">&lt;/form&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            {% endfor %}
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
{% endblock %}
</code></pre></div>    </div>
    <p>Notice that a hidden value <code class="language-plaintext highlighter-rouge">registrant.id</code> is included such that it’s possible to use this <code class="language-plaintext highlighter-rouge">id</code> later in <code class="language-plaintext highlighter-rouge">app.py</code></p>
  </li>
  <li data-marker="*">
    <p>Finally, modify <code class="language-plaintext highlighter-rouge">app.py</code> as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Implements a registration form, storing registrants in a SQLite database, with support for deregistration
</span>
<span class="kn">from</span> <span class="n">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="nc">SQL</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///froshims.db</span><span class="sh">"</span><span class="p">)</span>

<span class="n">SPORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">Basketball</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Soccer</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Ultimate Frisbee</span><span class="sh">"</span>
<span class="p">]</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">sports</span><span class="o">=</span><span class="n">SPORTS</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/deregister</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">deregister</span><span class="p">():</span>

    <span class="c1"># Forget registrant
</span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
        <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">DELETE FROM registrants WHERE id = ?</span><span class="sh">"</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/registrants</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/register</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="c1"># Validate name
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Missing name</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Validate sports
</span>    <span class="n">sports</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">getlist</span><span class="p">(</span><span class="sh">"</span><span class="s">sport</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sports</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Missing sport</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sport</span> <span class="ow">in</span> <span class="n">sports</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sport</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">error.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">Invalid sport</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Remember registrant
</span>    <span class="k">for</span> <span class="n">sport</span> <span class="ow">in</span> <span class="n">sports</span><span class="p">:</span>
        <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO registrants (name, sport) VALUES(?, ?)</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sport</span><span class="p">)</span>

    <span class="c1"># Confirm registration
</span>    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/registrants</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/registrants</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">registrants</span><span class="p">():</span>
    <span class="n">registrants</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM registrants</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">registrants.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">registrants</span><span class="o">=</span><span class="n">registrants</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that the <code class="language-plaintext highlighter-rouge">cs50</code> library is utilized. A route is included for <code class="language-plaintext highlighter-rouge">register</code> for the <code class="language-plaintext highlighter-rouge">post</code> method. This route will take the name and sport taken from the registration form and execute a SQL query to add the <code class="language-plaintext highlighter-rouge">name</code> and the <code class="language-plaintext highlighter-rouge">sport</code> to the <code class="language-plaintext highlighter-rouge">registrants</code> table. The <code class="language-plaintext highlighter-rouge">deregister</code> routes to a SQL query that will grab the user’s <code class="language-plaintext highlighter-rouge">id</code> and utilize that information to deregister this individual.</p>
  </li>
  <li data-marker="*">You can execute <code class="language-plaintext highlighter-rouge">flask run</code> and examine the result.</li>
  <li data-marker="*">If you want to download our implementation of <code class="language-plaintext highlighter-rouge">froshims</code> you can do so <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/froshims5/">here</a>.</li>
  <li data-marker="*">You can read more about Flask in the <a href="https://flask.palletsprojects.com">Flask documentation</a>.</li>
</ul>

<h2 id="cookies-and-session">Cookies and Session</h2>

<ul>
  <li data-marker="*"><code class="language-plaintext highlighter-rouge">app.py</code> is considered a <em>controller</em>. A <em>view</em> is considered what the users see. A <em>model</em> is how data is stored and manipulated. Together, this is referred to as <em>MVC</em> (model, view, controller).</li>
  <li data-marker="*">While the prior implementation of <code class="language-plaintext highlighter-rouge">froshims</code> is useful from an administrative standpoint, where a back-office administrator could add and remove individuals from the database, one can imagine how this code is not safe to implement on a public server.</li>
  <li data-marker="*">For one, bad actors could make decisions on behalf of other users by hitting the deregister button – effectively deleting their recorded answer from the server.</li>
  <li data-marker="*">Web services like Google use login credentials to ensure users only have access to the right data.</li>
  <li data-marker="*">We can actually implement this itself using <em>cookies</em>. Cookies are small files that are stored on your computer such that your computer can communicate with the server and effectively say, “I’m an authorized user that has already logged in.” This authorization through this cookie is called a <em>session</em>.</li>
  <li data-marker="*">
    <p>Cookies may be stored as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/2
Host: accounts.google.com
Cookie: session=value
</code></pre></div>    </div>
    <p>Here, a <code class="language-plaintext highlighter-rouge">session</code> id is stored with a particular <code class="language-plaintext highlighter-rouge">value</code> representing that session.</p>
  </li>
  <li data-marker="*">In the simplest form, we can implement this by creating a folder called <code class="language-plaintext highlighter-rouge">login</code> and then adding the following files.</li>
  <li data-marker="*">
    <p>First, create a file called <code class="language-plaintext highlighter-rouge">requirements.txt</code> that reads as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flask
Flask-Session
</code></pre></div>    </div>
    <p>Notice that in addition to <code class="language-plaintext highlighter-rouge">Flask</code>, we also include <code class="language-plaintext highlighter-rouge">Flask-Session</code>, which is required to support login sessions.</p>
  </li>
  <li data-marker="*">
    <p>Second, in a <code class="language-plaintext highlighter-rouge">templates</code> folder, create a file called <code class="language-plaintext highlighter-rouge">layout.html</code> that appears as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>login<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice this provides a very simple layout with a title and a body.</p>
  </li>
  <li data-marker="*">
    <p>Third, create a file in the <code class="language-plaintext highlighter-rouge">templates</code> folder called <code class="language-plaintext highlighter-rouge">index.html</code> that appears as follows:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    {% if name -%}
        You are logged in as {{ name }}. <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/logout"</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/a&gt;</span>.
    {%- else -%}
        You are not logged in. <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/login"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span>.
    {%- endif %}

{% endblock %}
</code></pre></div>    </div>
    <p>Notice that this file looks to see if <code class="language-plaintext highlighter-rouge">session["name"]</code> exists (elaborated further in <code class="language-plaintext highlighter-rouge">app.py</code> below). If it does, it will display a welcome message. If not, it will recommend you browse to a page to log in.</p>
  </li>
  <li data-marker="*">
    <p>Fourth, create a file called <code class="language-plaintext highlighter-rouge">login.html</code> and add the following code:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/login"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Log In<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>

{% endblock %}
</code></pre></div>    </div>
    <p>Notice this is the layout of a basic login page.</p>
  </li>
  <li data-marker="*">
    <p>Finally, create a file called <code class="language-plaintext highlighter-rouge">app.py</code> and write code as follows:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="n">flask_session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="c1"># Configure app
</span><span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1"># Configure session
</span><span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">SESSION_PERMANENT</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">SESSION_TYPE</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">filesystem</span><span class="sh">"</span>
<span class="nc">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">))</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/login</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">login.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/logout</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice the modified <em>imports</em> at the top of the file, including <code class="language-plaintext highlighter-rouge">session</code>, which will allow you to support sessions. Most importantly, notice how <code class="language-plaintext highlighter-rouge">session["name"]</code> is used in the <code class="language-plaintext highlighter-rouge">login</code> and <code class="language-plaintext highlighter-rouge">logout</code> routes. The <code class="language-plaintext highlighter-rouge">login</code> route will assign the login name provided and assign it to <code class="language-plaintext highlighter-rouge">session["name"]</code>. However, in the <code class="language-plaintext highlighter-rouge">logout</code> route, the logging out is implemented by clearing the value of <code class="language-plaintext highlighter-rouge">session</code>.</p>
  </li>
  <li data-marker="*">The <code class="language-plaintext highlighter-rouge">session</code> abstraction allows you to ensure only a specific user has access to specific data and features in our application. It allows you to ensure that no one acts on behalf of another user, for good or bad!</li>
  <li data-marker="*">If you wish, you can download <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/login/">our implementation</a> of <code class="language-plaintext highlighter-rouge">login</code>.</li>
  <li data-marker="*">You can read more about sessions in the <a href="https://flask.palletsprojects.com/en/stable/api/#flask.session">Flask documentation</a>.</li>
</ul>

<h2 id="shopping-cart">Shopping Cart</h2>

<ul>
  <li data-marker="*">Moving on to a final example of utilizing Flask’s ability to enable a session.</li>
  <li data-marker="*">
    <p>We examined the following code for <code class="language-plaintext highlighter-rouge">store</code> in <code class="language-plaintext highlighter-rouge">app.py</code>. The following code was shown:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="n">flask_session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="c1"># Configure app
</span><span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1"># Connect to database
</span><span class="n">db</span> <span class="o">=</span> <span class="nc">SQL</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///store.db</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Configure session
</span><span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">SESSION_PERMANENT</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">SESSION_TYPE</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">filesystem</span><span class="sh">"</span>
<span class="nc">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM books</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">books.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">books</span><span class="o">=</span><span class="n">books</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/cart</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">cart</span><span class="p">():</span>

    <span class="c1"># Ensure cart exists
</span>    <span class="k">if</span> <span class="sh">"</span><span class="s">cart</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="sh">"</span><span class="s">cart</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># POST
</span>    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">book_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">book_id</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="sh">"</span><span class="s">cart</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">book_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">"</span><span class="s">/cart</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># GET
</span>    <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM books WHERE id IN (?)</span><span class="sh">"</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">"</span><span class="s">cart</span><span class="sh">"</span><span class="p">])</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">cart.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">books</span><span class="o">=</span><span class="n">books</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that <code class="language-plaintext highlighter-rouge">cart</code> is implemented using a list. Items can be added to this list using the <code class="language-plaintext highlighter-rouge">Add to Cart</code> buttons in <code class="language-plaintext highlighter-rouge">books.html</code>. When clicking such a button, the <code class="language-plaintext highlighter-rouge">post</code> method is invoked, where the <code class="language-plaintext highlighter-rouge">id</code> of the item is appended to the <code class="language-plaintext highlighter-rouge">cart</code>. When viewing the cart, invoking the <code class="language-plaintext highlighter-rouge">get</code> method, SQL is executed to display a list of the books in the cart.</p>
  </li>
  <li data-marker="*">
    <p>We also saw the contents of <code class="language-plaintext highlighter-rouge">books.html</code>:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;h1&gt;</span>Books<span class="nt">&lt;/h1&gt;</span>
    {% for book in books %}
        <span class="nt">&lt;h2&gt;</span>{{ book["title"] }}<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/cart"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"{{ book['id'] }}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Add to Cart<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    {% endfor %}

{% endblock %}
</code></pre></div>    </div>
    <p>Notice how this creates the ability to <code class="language-plaintext highlighter-rouge">Add to Cart</code> for each book using <code class="language-plaintext highlighter-rouge">for book in books</code>.</p>
  </li>
  <li data-marker="*">You can see the rest of the files that power this <code class="language-plaintext highlighter-rouge">flask</code> implementation in the <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/store/">source code</a>.</li>
</ul>

<h2 id="shows">Shows</h2>

<ul>
  <li data-marker="*">
    <p>We looked at a pre-designed program called <code class="language-plaintext highlighter-rouge">shows</code>, in <code class="language-plaintext highlighter-rouge">app.py</code>:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Searches for shows using LIKE
</span>
<span class="kn">from</span> <span class="n">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="nc">SQL</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///shows.db</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/search</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
    <span class="n">shows</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM shows WHERE title LIKE ?</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span> <span class="o">+</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">q</span><span class="sh">"</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">search.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">shows</span><span class="o">=</span><span class="n">shows</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice how the <code class="language-plaintext highlighter-rouge">search</code> route allows for a way by which to search for a <code class="language-plaintext highlighter-rouge">show</code>. This search looks for titles <code class="language-plaintext highlighter-rouge">LIKE</code> the one provided by the user.</p>
  </li>
  <li data-marker="*">
    <p>We also examined <code class="language-plaintext highlighter-rouge">index.html</code>:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>shows<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">placeholder=</span><span class="s">"Query"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;ul&gt;&lt;/ul&gt;</span>

        <span class="nt">&lt;script&gt;</span>
            <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">input</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/search?q=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="kd">let</span> <span class="nx">shows</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
                <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">shows</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">shows</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">title</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;lt;</span><span class="dl">'</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&amp;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;amp;</span><span class="dl">'</span><span class="p">);</span>
                    <span class="nx">html</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">&lt;li&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/li&gt;</span><span class="dl">'</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice that the JavaScript <code class="language-plaintext highlighter-rouge">script</code> creates an implementation of autocomplete, where titles that match the <code class="language-plaintext highlighter-rouge">input</code> are displayed.</p>
  </li>
  <li data-marker="*">
    <p>You can see the rest of the files of this implementation in the <a href="https://cdn.cs50.net/2024/fall/lectures/9/src9/shows3/">source code</a>.</p>
  </li>
</ul>

<h2 id="apis">APIs</h2>

<ul>
  <li data-marker="*">An <em>application program interface</em> or <em>API</em> is a series of specifications that allow you to interface with another service. For example, we could utilize IMDB’s API to interface with their database. We might even integrate APIs for handling specific types of data downloadable from a server.</li>
  <li data-marker="*">
    <p>Improving upon <code class="language-plaintext highlighter-rouge">shows</code>, looking at an improvement of <code class="language-plaintext highlighter-rouge">app.py</code>, we saw the following:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Searches for shows using Ajax
</span>
<span class="kn">from</span> <span class="n">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="nc">SQL</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///shows.db</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/search</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">q</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">shows</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM shows WHERE title LIKE ? LIMIT 50</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span> <span class="o">+</span> <span class="n">q</span> <span class="o">+</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">search.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">shows</span><span class="o">=</span><span class="n">shows</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice that the <code class="language-plaintext highlighter-rouge">search</code> route executes a SQL query.</p>
  </li>
  <li data-marker="*">
    <p>Looking at <code class="language-plaintext highlighter-rouge">search.html</code>, you’ll notice that it is very simple:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% for show in shows %}
    <span class="nt">&lt;li&gt;</span>{{ show["title"] }}<span class="nt">&lt;/li&gt;</span>
{% endfor %}
</code></pre></div>    </div>
    <p>Notice that it provides a bulleted list.</p>
  </li>
  <li data-marker="*">
    <p>Finally, looking at <code class="language-plaintext highlighter-rouge">index.html</code>, notice that <em>AJAX</em> code is utilized to power the search:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>shows<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">placeholder=</span><span class="s">"Query"</span> <span class="na">type=</span><span class="s">"search"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;ul&gt;&lt;/ul&gt;</span>

        <span class="nt">&lt;script&gt;</span>
            <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">input</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/search?q=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="kd">let</span> <span class="nx">shows</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">text</span><span class="p">();</span>
                <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">shows</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>Notice an event listener is utilized to dynamically query the server to provide a list that matches the title provided. This will locate the <code class="language-plaintext highlighter-rouge">ul</code> tag in the HTML and modify the web page accordingly to include the list of the matches.</p>
  </li>
  <li data-marker="*">You can read more in the <a href="https://api.jquery.com/category/ajax/">AJAX documentation</a>.</li>
</ul>

<h2 id="json">JSON</h2>

<ul>
  <li data-marker="*"><em>JavaScript Object Notation</em> or <em>JSON</em> is a text file of dictionaries with keys and values. This is a raw, computer-friendly way to get lots of data.</li>
  <li data-marker="*">JSON is a very useful way of getting back data from the server.</li>
  <li data-marker="*">
    <p>You can see this in action in the <code class="language-plaintext highlighter-rouge">index.html</code> we examined together:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>shows<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">placeholder=</span><span class="s">"Query"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;ul&gt;&lt;/ul&gt;</span>

        <span class="nt">&lt;script&gt;</span>
            <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">input</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/search?q=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="kd">let</span> <span class="nx">shows</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>
                <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">shows</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">shows</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">title</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;lt;</span><span class="dl">'</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">&amp;</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&amp;amp;</span><span class="dl">'</span><span class="p">);</span>
                    <span class="nx">html</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">&lt;li&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/li&gt;</span><span class="dl">'</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nb">document</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <p>While the above may be somewhat cryptic, it provides a starting point for you to research JSON on your own to see how it can be implemented in your own web applications.</p>
  </li>
  <li data-marker="*">
    <p>Further, we examined <code class="language-plaintext highlighter-rouge">app.py</code> to see how the JSON response is obtained:</p>

    <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Searches for shows using Ajax with JSON
</span>
<span class="kn">from</span> <span class="n">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="nc">SQL</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///shows.db</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">index.html</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/search</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">q</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">shows</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM shows WHERE title LIKE ? LIMIT 50</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span> <span class="o">+</span> <span class="n">q</span> <span class="o">+</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="nf">jsonify</span><span class="p">(</span><span class="n">shows</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>Notice how <code class="language-plaintext highlighter-rouge">jsonify</code> is used to convert the result into a readable format acceptable by contemporary web applications.</p>
  </li>
  <li data-marker="*">You can read more in the <a href="https://www.json.org/json-en.html">JSON documentation</a>.</li>
  <li data-marker="*">In summary, you now have the ability to complete your own web applications using Python, Flask, HTML, and SQL.</li>
</ul>

<h2 id="summing-up">Summing Up</h2>
<p>In this lesson, you learned how to utilize Python, SQL, and Flask to create web applications. Specifically, we discussed…</p>
<ul>
  <li data-marker="*">Flask</li>
  <li data-marker="*">Forms</li>
  <li data-marker="*">Templates</li>
  <li data-marker="*">Request Methods</li>
  <li data-marker="*">Flask and SQL</li>
  <li data-marker="*">Cookies and Session</li>
  <li data-marker="*">APIs</li>
  <li data-marker="*">JSON</li>
</ul>

<p>See you next time for our final lecture for this term at <a href="https://websites.harvard.edu/memhall/home-2/buildings/sanders-theatre/">Sanders Theatre</a>!</p>


                    
</body>
</html>