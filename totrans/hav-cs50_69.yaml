- en: Lecture 4
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://cs50.harvard.edu/web/notes/4/](https://cs50.harvard.edu/web/notes/4/)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Introduction](#introduction)'
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[SQL](#sql)'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Databases](#databases)'
  id: totrans-4
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Column Types](#column-types)'
  id: totrans-5
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Tables](#tables)'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[SELECT](#select)'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Working with SQL in the Terminal](#working-with-sql-in-the-terminal)'
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Functions](#functions)'
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[UPDATE](#update)'
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[DELETE](#delete)'
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Other Clauses](#other-clauses)'
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Joining Tables](#joining-tables)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[JOIN Query](#join-query)'
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Indexing](#indexing)'
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[SQL Vulnerabilities](#sql-vulnerabilities)'
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Django Models](#django-models)'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Migrations](#migrations)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Shell](#shell)'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Starting our application](#starting-our-application)'
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Django Admin](#django-admin)'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Many-to-Many Relationships](#many-to-many-relationships)'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Users](#users)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So far, we’ve discussed how to build simple web pages using HTML and CSS, and
    how to use Git and GitHub in order to keep track of changes to our code and collaborate
    with others. We also familiarized ourselves with the Python programming language,
    and started using Django to create web applications.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Today, we’ll learn about using SQL and Django models to efficiently store and
    access data.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SQL
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[SQL](https://www.w3schools.com/sql/), or Structured Query Language, is a programming
    language that allows us to update and query databases.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '![SQL logo](../Images/b70b5244f7237ca9215bcb5722fcc3b1.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
- en: Databases
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Before we get into how to use the SQL language, we should discuss how our data
    is stored. When using SQL, we’ll work with a [relational database](https://www.oracle.com/database/what-is-a-relational-database/#:~:text=A%20relational%20database%20is%20a,of%20representing%20data%20in%20tables.)
    where we can find all of our data stored in a number of [tables](https://www.essentialsql.com/what-is-a-database-table/).
    Each of these tables is made up of a set number of columns and a flexible number
    of rows.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: To illustrate how to work with SQL, we’ll use the example of a website for an
    airline used to keep track of flights and passengers. In the following table,
    we see that we’re keeping track of a number of flights, each of which has an `origin`,
    a `destination`, and a `duration`.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: '![Flights 0](../Images/e40d08c2dea81c611e702279114442ab.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
- en: 'There are several different relational database management systems that are
    commonly used to store information, and that can easily interact with SQL commands:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '[MySQL](https://www.mysql.com/)'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PostgreSQL](https://www.postgresql.org/)'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[SQLite](https://www.sqlite.org/index.html)'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: …
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The first two, MySQL and PostgreSQL, are heavier-duty database management systems
    that are typically run on servers separate from those running a website. SQLite,
    on the other hand, is a lighter-weight system that can store all of its data in
    a single file. We’ll be using SQLite throughout this course, as it is the default
    system used by Django.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Column Types
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Just as we worked with several different variable types in Python, SQLite has
    [types](https://www.sqlite.org/datatype3.html) that represent different forms
    of information. Other management systems may have different data types, but all
    are fairly similar to those of SQLite:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '`TEXT`: For strings of text (Ex. a person’s name)'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`NUMERIC`: A more general form of numeric data (Ex. A date or boolean value)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`INTEGER`: Any non-decimal number (Ex. a person’s age)'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`REAL`: Any real number (Ex. a person’s weight)'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BLOB` (Binary Large Object): Any other binary data that we may want to store
    in our database (Ex. an image)'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tables
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, to actually get started with using SQL to interact with a database, let’s
    begin by creating a new table. The [command to create a new table](https://www.w3schools.com/sql/sql_create_table.asp)
    looks something like this:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'In the above command, we’re creating a new table that we’ve decided to call
    `flights`, and we’ve added four columns to this table:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '`id`: It is often helpful to have an number that allows us to uniquely identify
    each row in a table. Here we have specified that `id` is an integer, and also
    that it is our [primary key](https://www.w3schools.com/sql/sql_primarykey.ASP),
    meaning it is our unique identifier. We have additionally specified that it will
    `AUTOINCREMENT`, which means we will not have to provide an id every time we add
    to the table because it will be done automatically.'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`origin`: Here we’ve specified that this will be a text field, and by writing
    `NOT NULL` we have required that it have a value.'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`destination`: Again we’ve specified that this will be a text field and prevented
    it from being null.'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`duration`: Again this value cannot be null, but this time it is represented
    by an integer rather than as text.'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We just saw the `NOT NULL` and `PRIMARY KEY` constraint when making a column,
    but there are several other [constraints](https://www.tutorialspoint.com/sqlite/sqlite_constraints.htm)
    available to us:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '`CHECK`: Makes sure certain constraints are met before allowing a row to be
    added/modified'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`DEFAULT`: Provides a default value if no value is given'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`NOT NULL`: Makes sure a value is provided'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`PRIMARY KEY`: Indicates this is the primary way of searching for a row in
    the database'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`UNIQUE`: Ensures that no two rows have the same value in that column.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: …
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Now that we’ve seen how to create a table, let’s look at how we can add rows
    to it. In SQL, we do this using the `INSERT` command:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In the above command, we’ve specified the table name we wish to insert into,
    then provided a list of the column names we will be providing information on,
    and then specified the `VALUES` we would like to fill that row in the table, making
    sure the `VALUES` come in the same order as our corresponding list of columns.
    Note that we don’t need to provide a value for `id` because it is automatically
    incrementing.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: SELECT
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Once a table has been populated with some rows, we’ll probably want a way to
    access data within that table. We do this using SQL’s [SELECT](https://www.w3schools.com/sql/sql_select.asp)
    query. The simplest `SELECT` query into our flights table might look something
    like this:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The above command (*) retrieves all of the data from our flights table
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '![all](../Images/69852a3e7e06a0efa0e74e0e1e7fa699.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
- en: It may be the case though that we don’t really need all of the columns from
    the database, just origin and destination. To access just these columns, we can
    replace the * with the column names we would like access to. The following query
    returns all of the origins and destinations.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Just two cols](../Images/ae882208febb4fb7fe987d5e321caee1.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
- en: 'As our tables get larger and larger, we will also want to narrow down which
    rows our query returns. We do this by adding a [WHERE](https://www.w3schools.com/sql/sql_where.asp)
    followed by some condition. For example, the following command selects only row
    with an `id` of `3`:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![only one row](../Images/ea58dc1cd934e2acd0a3932e5e322b58.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
- en: e can filter by any column, not just `id`!
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Origin is New York](../Images/350e97a53a7439a3d55afba84da56dad.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
- en: Working with SQL in the Terminal
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that we know some basic SQL commands, let’s test them out in the terminal!
    In order to work with SQLite on your computer, you must first [download SQLite](https://www.sqlite.org/download.html).
    (We won’t use it in lecture, but you can also [download DB Browser](https://sqlitebrowser.org/dl/)
    for a more user-friendly way to run SQL queries.)
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: 'We can start by creating a file for our database either by manually creating
    a new file, or running `touch flights.sql` in the terminal. Now, if we run `sqlite3
    flights.sql` in the terminal, we’ll be brought to a SQLite prompt where we can
    run SQL commands:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We can also use more than just equality to filter out our flights. For integer
    and real values, we can use greater than or less than:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![> 500](../Images/e11da8a28a30662d0a2f93a6e7598c26.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: 'And we can also use other logic ([AND, OR](https://www.w3schools.com/sql/sql_and_or.asp))
    like in Python:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![> 500 and paris](../Images/4deda8ff62715d9b4a92761f42a019e9.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
- en: '[PRE9]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![> 500 or paris](../Images/aa4fe1c1c2358daa429a3396dab9465f.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
- en: 'We can also use the keyword [IN](https://www.w3schools.com/sql/sql_in.asp)
    to see if a bit of data is one of several options:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![in](../Images/4c8527f627a0b599af2ca9376ac66eb3.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
- en: We can even use regular expressions to search words more broadly using the [LIKE](https://www.w3schools.com/sql/sql_like.asp)
    keyword. The below query finds all results with an `a` in the origin, by using
    `%` as a wildcard character.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![Origin has an ''a''](../Images/17ec4465ad5ecf0649393ad2fe2af2be.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
- en: Functions
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There are also a number of SQL functions we can apply to the results of a query.
    These can be useful if we don’t need all of the data returned by a query, but
    just some summary statistics of the data.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '[AVERAGE](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[COUNT](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MAX](https://www.w3schools.com/sql/sql_min_max.asp)'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MIN](https://www.w3schools.com/sql/sql_min_max.asp)'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[SUM](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: …
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: UPDATE
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We’ve now seen how to add to and search tables, but we may also want to be able
    update rows of a table that already exist. We do this using the [UPDATE](https://www.w3schools.com/sql/sql_update.asp)
    command as shown below. As you may have guessed by reading this out loud, the
    command finds any flights that go from New York to London, and then sets their
    durations to 430.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: DELETE
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We also might want the ability to delete rows from our database, and we can
    do this using the [DELETE](https://www.w3schools.com/sql/sql_delete.asp) command.
    The following code will remove all flights that land in Tokyo:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Other Clauses
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There are a number of additional clauses we can use to control queries coming
    back to us
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: '[LIMIT](https://www.w3schools.com/sql/sql_top.asp): Limits the number of results
    returned by a query'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[ORDER BY](https://www.w3schools.com/sql/sql_orderby.asp): Orders the results
    based on a specified column'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[GROUP BY](https://www.w3schools.com/sql/sql_groupby.asp): Groups results by
    a specified column'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[HAVING](https://www.w3schools.com/sql/sql_having.asp): Allows for additional
    constraints based on the number of results'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Joining Tables
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So far, we’ve only been working with one table at a time, but many databases
    in practice are populated by a number of tables that all relate to each other
    in some way. In our flights example, let’s imagine we also want to add an airport
    code to go with the city. The way our table is currently set up, we would have
    to add two more columns to go with each row. We would also be repeating information,
    as we would have to write in multiple places that city X is associated with code
    Y.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: One way we can solve this problem is by deciding to have one table that keeps
    track of flights, and then another table keeping track of airports. The second
    table might look something like this
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '![Airport Table](../Images/9fdb1efdc701ef2ac7dec66bc2a3de25.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
- en: Now we have a table relating codes and cities, rather than storing an entire
    city name in our flights table, it will save storage space if we’re able to just
    save the `id` of that airport. Therefore, we should rewrite the flights table
    accordingly. Since we’re using the `id` column of the airports table to populate
    `origin_id` and `destination_id`, we call those values [Foreign Keys](https://www.w3schools.com/sql/sql_foreignkey.asp)
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '![New Flights](../Images/4a83baa5ff3b5d982579a0fdb013216d.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: In addition to flights and airports, an airline might also want to store data
    about its passengers, like which flight each passenger will be on. Using the power
    of relational databases, we can add another table that stores first and last names,
    and a foreign key representing the flight they are on
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: '![Simple Passengers Table](../Images/7a7a5599c37632dcd0ec064ea1eaec4c.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
- en: We can do even better than this though, as the same person may be on more than
    one flight. To account for this, we can create a `people` table that stores first
    and last names, and a `passengers` table that pairs people with flights
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: '![People](../Images/7b2f93d51ce147940f23f5366e700954.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
- en: '![Passengers](../Images/5d8fb8de416783edefc907f16e987279.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
- en: ecause in this case a single person can be on many flights and a single flight
    can have many people, we call the relationship between `flights` and `people`
    a **Many to Many** relationship. The `passengers` table that connects the two
    is known as an **association table**.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: JOIN Query
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Although our data is now more efficiently stored, it seems like it may be harder
    to query our data. Thankfully, SQL has a [JOIN](https://www.w3schools.com/sql/sql_join.asp)
    query where we can combine two tables for the purposes of another query.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, let’s say we want to find the origin, destination, and first name
    of every trip a passenger is taking. Also for simplicity in this table, we’re
    going to be using the unoptimized `passengers` table that includes the flight
    id, first name, and last name. The first part of this query looks fairly familiar:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'But we run into a problem here because `first` is stored in the `passengers`
    table, while `origin` and `destination` are stored in the `flights` table. We
    solve this by joining the two tables using the fact that `flight_id` in the `passengers`
    table corresponds to `id` in the `flights` table:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![Join blurry](../Images/91b9b7b4abfd1b8d2e76f7a6a52e58ad.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
- en: We’ve just used something called an [INNER JOIN](https://www.w3schools.com/sql/sql_join_inner.asp),
    which means we are ignoring rows that have no matches between the tables, but
    there are other types of joins, including [**LEFT JOIN**s](https://www.w3schools.com/sql/sql_join_left.asp),
    [**RIGHT JOIN**s](https://www.w3schools.com/sql/sql_join_right.asp), and [**FULL
    OUTER JOIN**s](https://www.w3schools.com/sql/sql_join_full.asp), which we won’t
    discuss here in detail.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: Indexing
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'One way we can make our queries more efficient when dealing with large tables
    is to create an index similar to the index you might see in the back of a textbook.
    For example, if we know that we’ll often look up passengers by their last name,
    we could create an index from last name to id using the command:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: SQL Vulnerabilities
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that we know the basics of using SQL to work with data, it’s important to
    point out the main vulnerabilities associated with using SQL. We’ll start with
    [SQL Injection](https://www.w3schools.com/sql/sql_injection.asp).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: 'A SQL injection attack is when a malicious user enters SQL code as input on
    a site in order to bypass the sites security measures. For example, let’s say
    we have a table storing usernames and passwords, and then a login form on the
    home site of a page. We may search for the user using a query such as:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'A user named Harry might go to this site and type `harry` as a username and
    `12345` as a password, in which case the query would look like this:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'A hacker, on the other hand, might type `harry" --` as a username and nothing
    as a password. It turns out that `--` stands for a comment in SQL, meaning the
    query would look like:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Because in this query the password checking has been commented out, the hacker
    can log into Harry’s account without knowing their password. To solve this problem,
    we can use:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Escape characters to make sure SQL treats the input as plain text and not as
    SQL code.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: An abstraction layer on top of SQL which includes its own escape sequence, so
    we don’t have to write SQL queries ourselves.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The other main vulnerability when it comes to SQL is known as a [Race Condition](https://searchstorage.techtarget.com/definition/race-condition#:~:text=A%20race%20condition%20is%20an,sequence%20to%20be%20done%20correctly.).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: A race condition is a situation that occurs when multiple queries to a database
    occur simultaneously. When these are not adequately handled, problems can arise
    in the precise times that databases are updated. For example, let’s say I have
    $150 in my bank account. A race condition could occur if I log into my bank account
    on both my phone and my laptop, and attempt to withdraw $100 on each device. If
    the bank’s software developers did not deal with race conditions correctly, then
    I may be able to withdraw $200 from an account with only $150 in it. One potential
    solution for this problem would be locking the database. We could not allow any
    other interaction with the database until one transaction has been completed.
    In the bank example, after clicking navigating to the “Make a Withdrawl” page
    on my computer, the bank might not allow me to navigate to that page on my phone.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: Django Models
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Django Models](https://docs.djangoproject.com/en/4.0/topics/db/models/) are
    a level of [abstraction](https://techterms.com/definition/abstraction) on top
    of SQL that allow us to work with databases using Python classes and objects rather
    than direct SQL queries.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: Let’s get started on using models by creating a django project for our airline,
    and creating an app within that project.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now we’ll have to go through the process of adding an app as usual:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: Add `flights` to the `INSTALLED_APPS` list in `settings.py`
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add a route for `flights` in `urls.py`:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Create a `urls.py` file within the `flights` application. And fill it with standard
    `urls.py` imports and lists.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now, rather than creating actual paths and getting started on `views.py`, we’ll
    create some models in the `models.py` file. In this file, we’ll outline what data
    we want to store in our application. Then, Django will determine the SQL syntax
    necessary to store information on each of our models. Let’s take a look at what
    a model for a single flight might look like:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Let’s take a look at what’s going on in this model definition:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: In the first line, we create a new model that **extends** Django’s model class.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Below, we add fields for origin, destination, and duration. The first two are
    [Char Fields](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#charfield),
    meaning they store strings, and the third is an [Integer Field](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#integerfield).
    These are just two of many [built-in Django Field classes](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes)
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We specify maximum lengths of 64 for the two Character Fields. you can check
    the specifications available for a given field by checking the [documentation](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes).
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Migrations
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now, even though we’ve created a model, we do not yet have a database to store
    this information. to create a database from our models, we navigate to the main
    directory of our project and run the command.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: This command creates some Python files that will create or edit our database
    to be able to store what we have in our models. You should get an output that
    looks something like the one below, and if you navigate to your `migrations` directory,
    you’ll notice a new file was created for us
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: '![migrations output 0](../Images/ecf5781609bc8e50dcb00361ef4f95f7.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
- en: Next, to apply these migrations to our database, we run the command
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Now, you’ll see some default migrations have been applied along with our own,
    and you’ll also notice that we now have a file called `db.sqlite3` in our project’s
    directory
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: '![migrate output](../Images/1ffd0fc6b384cbd3678be3b0e5f32455.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
- en: Shell
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Now, to begin working adding information to and manipulating this database,
    we can enter Django’s shell where we can run Python commands within our project.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'When we query our database, we see that we get just one flight called `Flight
    object (1)`. This isn’t a very informative name, but we can fix that. Inside `models.py`,
    we’ll define a `__str__` function that provides instructions for how to turn a
    Flight object into a string:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now, when we go back to the shell, our output is a bit more readable:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'This is a good start, but thinking back to earlier, we don’t want to have to
    store the city name as an origin and destination for every flight, so we probably
    want another model for an airport that is somehow related to the flight model:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'We’ve seen everything in our new `Airport` class before, but the changes to
    the `origin` and `destination` fields within the `Flight` class are new to us:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: We specify that the `origin` and `destination` fields are each [Foreign Keys](https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_one/),
    which means they refer to another object.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: By entering `Airport` as our first argument, we are specifying the type of object
    this field refers to.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The next argument, `on_delete=models.CASCADE` gives instructions for what should
    happen if an airport is deleted. In this case, we specify that when an airport
    is deleted, all flights associated with it should also be deleted. There are [several
    other options](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.on_delete)
    in addition to `CASCADE`.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We provide a [related name](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.related_name),
    which gives us a way to search for all flights with a given airport as their origin
    or destination.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Every time we make changes in `models.py`, we have to make migrations and then
    migrate. Note that you may have to delete your existing flight from New York to
    London, as it doesn’t fit in with the new database structure.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Now, let’s try these new models out in the Django shell:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Starting our application
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We can now begin to build an application around this process of using models
    to interact with a database. Let’s begin by creating an index route for our airline.
    Inside `urls.py`:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Inside `views.py`:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Inside our new `layout.html` file:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Inside a new `index.html` file:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: What we’ve done here is created a default page where we have a list of all flights
    we’ve created so far. When we open up the page now, it looks like this
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: '![Just one on the list](../Images/ebd91751b7f4c65c7f9e987b6f6ce180.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
- en: 'Now, let’s add some more flights to our application by returning to the Django
    shell:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now, when we visit our site again
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
- en: '![Two flights](../Images/7ebb0c6c490f6df5acdb4e9ad15a4996.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
- en: Django Admin
  id: totrans-211
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since it is so common for developers to have to create new objects like we’ve
    been doing in the shell, Django comes with a [default admin interface](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)
    that allows us to do this more easily. To begin using this tool, we must first
    create an administrative user:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Now, we must add our models to the admin application by entering the `admin.py`
    file within our app, and importing and registering our models. This tells Django
    which models we would like to have access to in the admin app.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Now, when we visit our site and add `/admin` to the url, we can log into a page
    that looks like this
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: '![login](../Images/6d589b2411be559826d7a1bc9212e533.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
- en: After loggin in, you’ll be brought to a page like the one below where you can
    create, edit, and delete objects stored in the database
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
- en: '![admin page](../Images/e5449c35f2b183e06e5d580f6714499f.png)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
- en: 'Now, let’s add a few more pages to our site. We’ll begin by adding the ability
    to click on a flight to get more information about it. To do this, let’s create
    a URL path that includes the `id` of a flight:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Then, in `views.py` we will create a `flight` function that takes in a flight
    id and renders a new html page:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Now we’ll create a template to display this flight information with a link back
    to the home page
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Finally, we need to add the ability to link from one page to another, so we’ll
    modify our index page to include links:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Now our homepage looks like this
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: '![new home](../Images/0df402245e6e4111e6cfd34a3739647e.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
- en: And when we click on flight 5, for example, we’re brought to this page
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: '![One flight](../Images/8b0f46fbeb486526d63531607a49cf5f.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
- en: Many-to-Many Relationships
  id: totrans-232
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now, let’s work on integrating passengers into our models. We’ll create a passenger
    model to start:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: As we discussed, passengers have a **Many to Many** relationship with flights,
    which we describe in Django using the ManyToManyField.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The first argument in this field is the class of objects that this one is related
    to.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We have provided the argument `blank=True` which means a passenger can have
    no flights
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We have added a `related_name` that serves the same purpose as it did earlier:
    it will allow us to find all passengers on a given flight.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To actually make these changes, we must make migrations and migrate. We can
    then register the Passenger model in `admin.py` and visit the admin page to create
    some passengers!
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: Now that we’ve added some passengers, let’s update our flight page so that it
    displays all passengers on a flight. We’ll first visit `views.py` and update our
    flight view to provide a list of passengers as context. We access the list using
    the related name we defined earlier.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Now, add a list of passengers to `flight.html`:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: At this point, when we click on flight 5, we see
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
- en: '![new flight 5](../Images/e2901e4aac6569bcb1772205501c93af.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
- en: 'Now, let’s work on giving visitors to our site the ability to book a flight.
    We’ll do this by adding a booking route in `urls.py`:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now, we’ll add a book function to `views.py` that adds a passenger to a flight:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Next, we’ll add some context to our flight template so that the page has access
    to everyone who is not currently a passenger on the flight using Django’s ability
    to [exclude](https://docs.djangoproject.com/en/4.0/topics/db/queries/#retrieving-specific-objects-with-filters)
    certain objects from a query:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Now, we’ll add a form to our flight page’s HTML using a select input field:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Now, let’s see what the site looks like when I go to a flight page and then
    add a passenger
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: '![form](../Images/48fc8dfc2cd2c41b3e2fa6413721c1c5.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
- en: '![submitted](../Images/a6bc6f2e34a1cec6de4a20b2b809b650.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
- en: 'Another advantage of using the Django admin app is that it is customizable.
    For example, if we wish to see all aspects of a flight in the admin interface,
    we can create a new class within `admin.py` and add it as an argument when registering
    the `Flight` model:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Now, when we visit the admin page for flights, we can see the `id` as well
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: '![admin table](../Images/c27c80eab17ca59fb3ed9b500ed644dc.png)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
- en: Check out [Django’s admin documentation](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)
    to find more ways to customize the admin app.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: Users
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The last thing we’ll discuss in lecture today is the idea of authentication,
    or allowing users to log in and out of a website. Fortunately, Django makes this
    very easy for us, so let’s go through an example of how we would do this. We’ll
    start by creating a new app called `users`. Here we’ll go through all the normal
    steps of creating a new app, but in our new `urls.py` file, we’ll add a few more
    routes:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 今天讲座的最后我们将讨论认证的概念，即允许用户登录和退出网站。幸运的是，Django为我们简化了这一过程，让我们通过一个示例来看看我们如何实现。我们首先创建一个名为`users`的新应用。在这里，我们将完成创建新应用的所有常规步骤，但在我们的新`urls.py`文件中，我们将添加一些额外的路由：
- en: '[PRE51]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Let’s begin by creating a form where a user can log in. We’ll create a `layout.html`
    file as always, and then create a `login.html` file which contains a form, and
    that displays a message if one exists.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从创建一个用户可以登录的表单开始。我们将像往常一样创建一个`layout.html`文件，然后创建一个`login.html`文件，该文件包含一个表单，并在存在消息时显示该消息。
- en: '[PRE52]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Now, in `views.py`, we’ll add three functions:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在`views.py`中，我们将添加三个函数：
- en: '[PRE53]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Next, we can head to the admin site and add some users. After doing that, we’ll
    go back to `views.py` and update our `login_view` function to handle a `POST`
    request with a username and password:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们可以前往管理站点并添加一些用户。完成之后，我们将回到`views.py`并更新我们的`login_view`函数以处理带有用户名和密码的`POST`请求：
- en: '[PRE54]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Now, we’ll create the `user.html` file that the `index` function renders when
    a user is authenticated:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个`user.html`文件，当用户认证时，`index`函数将渲染此文件：
- en: '[PRE55]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Finally, to allow the user to log out, we’ll update the `logout_view` function
    so that it uses Django’s built-in `logout` function:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了允许用户登出，我们将更新`logout_view`函数，使其使用Django的内置`logout`函数：
- en: '[PRE56]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Now that we’re finished, here’s a demonstration of the site
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成，这是一个网站的演示
- en: '![Demo](../Images/60c45d3b167af8807d31d2e68bc434b1.png)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![演示](../Images/60c45d3b167af8807d31d2e68bc434b1.png)'
- en: 'That’s all for this lecture! Next time, we’ll learn our second programming
    language of the course: JavaScript.'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 这节课就到这里！下次，我们将学习课程中的第二种编程语言：JavaScript。
