- en: Lecture 7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://cs50.harvard.edu/r/notes/7/](https://cs50.harvard.edu/r/notes/7/)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Welcome!](#welcome)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Packages](#packages)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Package Structure](#package-structure)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[devtools](#devtools)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Writing Tests](#writing-tests)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Writing R Code](#writing-r-code)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[`NAMESPACE`](#namespace)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Testing Code](#testing-code)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Writing Documentation](#writing-documentation)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Building Packages](#building-packages)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Updating Packages](#updating-packages)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Using and Sharing Packages](#using-and-sharing-packages)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Summing Up](#summing-up)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Welcome!
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Welcome back to CS50’s Introduction to Programming with R!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Today, we will be learning about packaging and distributing our programs. This
    way, we can share them with the world!
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Today, we are going to be building and packaging a program called `ducksay`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you have taken one of our other CS50 courses, you might be aware of a program
    called `cowsay`. It takes some piece of text and creates an image of a cow saying
    that text. We will be building `ducksay` in that same spirit.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Packages* are source code that has been compiled so that it can be distributed.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Package Structure
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Packages should be held within a folder that is the same name as the package.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We can do so by typing the following commands in the R console:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that these commands create a directory called `ducksay` and then set
    the working directory to `ducksay`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Packages generally have a structure as follows within the main folder:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The `DESCRIPTION` file will include a description of the package, including
    who wrote it. The `NAMESPACE` file will include a list of functions we want to
    make available to the users of our package. `man` is a folder that holds the manual
    (documentation) for the package. `R` includes the R code for the package. Finally,
    `tests` holds all the tests that we want to be able to run to ensure our package
    behaves as we expect.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'We can create a `DESCRIPTION` file by typing `file.create("DESCRIPTION")` into
    the R console. We can now open this file and code as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how the package is named and titled. Then, a description is provided.
    Authors are included. Finally, the license is provided under which this package
    is offered. You can learn more about these fields in the `DESCRIPTION` file [documentation](https://cran.r-project.org/doc/manuals/R-exts.html#The-DESCRIPTION-file).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'As you can see by the `DESCRIPTION` file above, we also need a `LICENSE` file.
    We can code that as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Fill in the `...` with the present year. Notice how the year of the license
    and the copyright holder is named.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: devtools
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A package called devtools allows us to create packages faster.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In particular, `devtools` comes with utilities for creating the necessary folder
    structure for our package’s tests and R code.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We can load devtools by typing `library(devtools)` into the R console, assuming
    it’s already installed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing Tests
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Thanks to the devtools package, we can easily use testthat to develop tests
    for packages we author.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Then, we can type `use_testthat()` to invoke the ability to use testthat. Our
    `DESCRIPTION` file will be automatically modified as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that the package will suggest that one should have testthat version 3.0.0
    or above installed. This may vary depending on the version of testthat that you’ve
    installed.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Inside our `tests/testthat` folder, created by `use_testthat`, we can create
    our first test, `test-ducksay.R`, as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that `expect_match` looks for the string `hello, world` in the output
    of `ducksay`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Writing R Code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Continuing our use of devtools we can now type the following in the R console:
    `use_r("ducksay")`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This command will create a folder called `R` and a file called `ducksay.R`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now, it’s time to provide some functionality within our program that we will
    package. This functionality should match the test that we wrote.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Write code for `ducksay.R` as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '`NAMESPACE`'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As mentioned previously, we need to provide information about what functions
    are available to the end users of this package in a file called `NAMESPACE`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To do so, you can type `file.create("NAMESPACE")` in your console. Then, edit
    this file as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: This file simply makes the `ducksay` function available to the end user of the
    package.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We can now type `load_all()` into the R console to load all the available functions
    named in `NAMESPACE`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing Code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You can now run `test()` to test our function. No errors should result.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Further, you can now use `ducksay` in RStudio after you have loaded the functions
    of this package.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Updating our tests, let’s test to see if a duck appears in `ducksay`:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how this test looks to see if a duck is represented. Additionally, notice
    how `fixed = TRUE`, as described in the lecture, prevents the test from misinterpreting
    some of the characters within the duck as being part of something called a regular
    expression. Suffice to say for now, a regular expression is not what we’d like!
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Writing Documentation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can now document how to use our function. Typically, we can type `?ducksay`
    to see documentation. However, we have not created our documentation yet.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Documentation is written in a type of language called a markup language. A markup
    language provides syntax for specifying the formatting of a document.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can write your documentation by typing:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The first command creates a folder called `man`. The second creates our documentation
    file.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Modify your documentation file as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice how the `name`, `title`, `description`, `usage`, and other sections are
    provided. You can learn more about these elements by reading the [documentation](https://cran.r-project.org/doc/manuals/R-exts.html#Writing-R-documentation-files)
    on R documentation files.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now, it’s time to wrap things up and share our package.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building Packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Once a package’s contents are ready to be bundled together and distributed,
    one of two commands can be used to initiate a *build*:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that `build` is a devtools function and can be run directly from the
    R console. `R CMD build` can be run from the computer’s terminal outside of R.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Running `build`, you will see a `.gz` file will be outputted within your working
    directory.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Updating Packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To update our code, we can open our test file and update our test as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that a new test is added that looks for “quack!”
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'With this test in mind, we can now update our source code to allow for the
    inputting of any phrase, which, in turn, will be stated by the duck:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that a default `phrase`, “hello, world” is provided. If another `phrase`
    is provided, it will say that `phrase` instead.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Similarly, we can update our documentation file as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that `value` is updated. Further, `arguments` is also updated. Another
    example is provided in `examples`.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We can run `build` again to include our modifications.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This package can now be shared with others.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using and Sharing Packages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let’s now create a program called `greet.R` that uses this package.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We can set the working directory away from `ducksay` by typing `setwd("..")`
    in the R console. This will move our working directory to one directory higher
    than that of `ducksay`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Next, we can type `file.create("greet.R")` to create a new file. Modify this
    file as follows:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Notice that this program loads `ducksay`. Then, the code uses this new library.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'While this works on our computer, being that we developed this package locally,
    others will need to install this package. To do so, one of the following commands
    can be used:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: As discussed in previous lectures, the top command can be run directly within
    RStudio and is built into R itself. The other command can be run in the computer’s
    terminal. It is also built into R.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'To install our package, we can run the following in our console: `install.packages("ducksay_1.0.tar.gz")`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can share your code using CRAN, GitHub, and even email.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summing Up
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In this lesson, you learned how to package your programs in R. Specifically,
    you learned about:'
  prefs: []
  type: TYPE_NORMAL
- en: Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Package Structure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: devtools
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing Tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing R Code
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`NAMESPACE`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing Code
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing Documentation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Updating Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using and Sharing Packages
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this course, you learned many things about R and programming with R. You
    learned how to represent data, transform data, apply functions, tidy data, visualize
    data, test programs, and package programs. In all, we hope that you have found
    this material helpful to you. We also hope that you will take what you have learned
    to do great good in the world.
  prefs: []
  type: TYPE_NORMAL
- en: This was CS50’s Introduction to Programming with R.
  prefs: []
  type: TYPE_NORMAL
