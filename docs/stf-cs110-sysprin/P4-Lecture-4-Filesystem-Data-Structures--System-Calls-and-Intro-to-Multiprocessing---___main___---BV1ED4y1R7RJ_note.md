![](img/c5b69340c585f582e2f65bbaf36c1a1e_1.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_3.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_4.png)

# CS110 è¯¾ç¨‹ç¬¬å››è®²ï¼šæ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„ã€ç³»ç»Ÿè°ƒç”¨ä¸å¤šè¿›ç¨‹ç®€ä»‹ ğŸ–¥ï¸

![](img/c5b69340c585f582e2f65bbaf36c1a1e_6.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ“ä½œç³»ç»Ÿå¦‚ä½•é€šè¿‡æ•°æ®ç»“æ„ç®¡ç†æ–‡ä»¶å’Œè¿›ç¨‹ï¼Œç†è§£ç³»ç»Ÿè°ƒç”¨çš„å·¥ä½œåŸç†ï¼Œå¹¶åˆæ­¥æ¥è§¦å¤šè¿›ç¨‹ç¼–ç¨‹çš„æ¦‚å¿µã€‚

## æ¦‚è¿° ğŸ“‹

![](img/c5b69340c585f582e2f65bbaf36c1a1e_8.png)

æ“ä½œç³»ç»Ÿéœ€è¦é«˜æ•ˆåœ°ç®¡ç†è®¡ç®—æœºèµ„æºï¼Œç‰¹åˆ«æ˜¯æ–‡ä»¶å’Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ã€‚æœ¬èŠ‚è¯¾å°†æ¢è®¨Linuxç³»ç»Ÿç”¨äºè·Ÿè¸ªè¿™äº›èµ„æºçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œè§£é‡Šç”¨æˆ·ç¨‹åºå¦‚ä½•é€šè¿‡ç³»ç»Ÿè°ƒç”¨å®‰å…¨åœ°ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œå¹¶ä»‹ç»å¦‚ä½•åˆ›å»ºå’Œç®¡ç†å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_10.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_12.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_14.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_16.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_17.png)

---

## æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„ ğŸ“

![](img/c5b69340c585f582e2f65bbaf36c1a1e_19.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬æåˆ°äº†æ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†èµ„æºã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ“ä½œç³»ç»Ÿå†…éƒ¨ç”¨äºè·Ÿè¸ªæ–‡ä»¶å’Œè¿›ç¨‹çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_21.png)

åœ¨Linuxä¸­ï¼Œä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºè¢«ç§°ä¸º**è¿›ç¨‹**ã€‚æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ª**è¿›ç¨‹æ§åˆ¶å—**ï¼Œå…¶ä¸­åŒ…å«äº†è¯¥è¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™äº›è¿›ç¨‹æ§åˆ¶å—è¢«ç»„ç»‡åœ¨ä¸€ä¸ªç§°ä¸º**è¿›ç¨‹è¡¨**çš„å…¨å±€æ•°æ®ç»“æ„ä¸­ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_23.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_25.png)

è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†æ˜¯**æè¿°ç¬¦è¡¨**ã€‚è¿™æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨äºè·Ÿè¸ªè¯¥è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰â€œæ–‡ä»¶â€ã€‚åœ¨Unix/Linuxå“²å­¦ä¸­ï¼Œè®¸å¤šèµ„æºï¼ˆå¦‚ç½‘ç»œè¿æ¥ã€ç»ˆç«¯ï¼‰éƒ½è¢«æŠ½è±¡ä¸ºæ–‡ä»¶ã€‚å› æ­¤ï¼Œæè¿°ç¬¦è¡¨ä¸ä»…è®°å½•å¸¸è§„æ–‡ä»¶ï¼Œä¹Ÿè®°å½•è¿™äº›æŠ½è±¡èµ„æºã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_27.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_29.png)

æ¯ä¸ªè¿›ç¨‹åœ¨å¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè·å¾—ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼š
*   **0**: æ ‡å‡†è¾“å…¥ (`stdin`)
*   **1**: æ ‡å‡†è¾“å‡º (`stdout`)
*   **2**: æ ‡å‡†é”™è¯¯ (`stderr`)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_31.png)

è¿™äº›æè¿°ç¬¦é€šå¸¸è¿æ¥åˆ°ç”¨æˆ·çš„ç»ˆç«¯ã€‚æˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æ‰§è¡Œ`read`ã€`write`ã€`open`ã€`close`ç­‰æ“ä½œã€‚

### æ•°æ®ç»“æ„å±‚çº§

![](img/c5b69340c585f582e2f65bbaf36c1a1e_33.png)

ä»¥ä¸‹æ˜¯æ–‡ä»¶æè¿°ç¬¦èƒŒåçš„æ•°æ®ç»“æ„å±‚çº§å…³ç³»ï¼š

![](img/c5b69340c585f582e2f65bbaf36c1a1e_35.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_37.png)

1.  **æè¿°ç¬¦è¡¨**: æ¯ä¸ªè¿›ç¨‹ç‹¬æœ‰ï¼Œå­˜å‚¨å…¶æ‰“å¼€æ–‡ä»¶çš„å¼•ç”¨ã€‚
2.  **æ‰“å¼€æ–‡ä»¶è¡¨**: ç³»ç»Ÿå…¨å±€å…±äº«ã€‚å½“æè¿°ç¬¦æŒ‡å‘ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼Œå®ƒå®é™…é“¾æ¥åˆ°ä¸€ä¸ª**æ‰“å¼€æ–‡ä»¶è¡¨é¡¹**ã€‚è¯¥è¡¨é¡¹å­˜å‚¨äº†æ–‡ä»¶çš„**è®¿é—®æ¨¡å¼**ï¼ˆå¦‚åªè¯»ã€è¯»å†™ï¼‰å’Œå½“å‰**è¯»å†™ä½ç½®**ï¼ˆæ¸¸æ ‡ï¼‰ã€‚
    *   å…¬å¼ï¼š`æ‰“å¼€æ–‡ä»¶è¡¨é¡¹ = {æ¨¡å¼ï¼Œ æ¸¸æ ‡ï¼Œ å¼•ç”¨è®¡æ•°ï¼Œ ...}`
3.  **v-nodeè¡¨**: ç³»ç»Ÿå…¨å±€å…±äº«ã€‚æ¯ä¸ªæ‰“å¼€æ–‡ä»¶è¡¨é¡¹æŒ‡å‘ä¸€ä¸ª**v-node**ï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰ã€‚v-nodeæ˜¯ç£ç›˜ä¸Šæ–‡ä»¶å…ƒæ•°æ®ï¼ˆå­˜å‚¨åœ¨**i-node**ä¸­ï¼‰çš„å†…å­˜ç¼“å­˜å‰¯æœ¬ï¼ŒåŒ…å«äº†æ–‡ä»¶ç±»å‹ã€å¤§å°ã€æƒé™ç­‰ä¿¡æ¯ã€‚
    *   å…¬å¼ï¼š`v-node â‰ˆ å†…å­˜ä¸­çš„ i-node ç¼“å­˜`

![](img/c5b69340c585f582e2f65bbaf36c1a1e_39.png)

è¿™ç§å±‚çº§ç»“æ„å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œå…±äº«ç»ˆç«¯è¾“å‡ºï¼‰ï¼ŒåŒæ—¶åˆèƒ½è®©æ¯ä¸ªè¿›ç¨‹ç»´æŠ¤è‡ªå·±ç‹¬ç«‹çš„è¯»å†™ä½ç½®ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_41.png)

**æ ¸å¿ƒæ¦‚å¿µå›¾ç¤º**ï¼š
```
è¿›ç¨‹Aæè¿°ç¬¦è¡¨[3] ---> å…¨å±€æ‰“å¼€æ–‡ä»¶è¡¨é¡¹X ---> å…¨å±€v-nodeè¡¨é¡¹V (é“¾æ¥åˆ°ç£ç›˜i-node)
è¿›ç¨‹Bæè¿°ç¬¦è¡¨[4] ---> å…¨å±€æ‰“å¼€æ–‡ä»¶è¡¨é¡¹Y ---> å…¨å±€v-nodeè¡¨é¡¹V (é“¾æ¥åˆ°ç£ç›˜i-node)
```
ï¼ˆå³ä½¿è¿›ç¨‹Aå’ŒBæ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½æœ‰ç‹¬ç«‹çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹Xå’ŒYï¼Œä»è€Œæ‹¥æœ‰ç‹¬ç«‹çš„æ¸¸æ ‡ã€‚ï¼‰

![](img/c5b69340c585f582e2f65bbaf36c1a1e_43.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_45.png)

---

## ç³»ç»Ÿè°ƒç”¨ ğŸ”§

![](img/c5b69340c585f582e2f65bbaf36c1a1e_47.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_49.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_51.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_52.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬äº†è§£äº†æ“ä½œç³»ç»Ÿå†…éƒ¨çš„æ•°æ®ç»“æ„ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹ç”¨æˆ·ç¨‹åºå¦‚ä½•é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸è¿™äº›å—ä¿æŠ¤çš„å†…æ ¸ç»“æ„è¿›è¡Œäº¤äº’ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_54.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_56.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_58.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_60.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_62.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_63.png)

ç³»ç»Ÿè°ƒç”¨æ˜¯ç¨‹åºä¸æ“ä½œç³»ç»Ÿå†…æ ¸äº¤äº’çš„æ¥å£ï¼Œç”¨äºæ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œï¼Œå¦‚æ–‡ä»¶æ“ä½œã€è¿›ç¨‹åˆ›å»ºç­‰ã€‚æ™®é€šå‡½æ•°è°ƒç”¨æ— æ³•æä¾›å¿…è¦çš„å®‰å…¨éš”ç¦»ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_65.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_67.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_69.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_71.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_73.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_75.png)

### ä¸ºä»€ä¹ˆéœ€è¦ç³»ç»Ÿè°ƒç”¨ï¼Ÿ

![](img/c5b69340c585f582e2f65bbaf36c1a1e_77.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_79.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_81.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_83.png)

ç”¨æˆ·ç¨‹åºè¿è¡Œåœ¨**ç”¨æˆ·æ¨¡å¼**ï¼Œåªèƒ½è®¿é—®è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚è€Œæ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œåœ¨**å†…æ ¸æ¨¡å¼**ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰å†…å­˜å’Œç¡¬ä»¶ã€‚ç³»ç»Ÿè°ƒç”¨æ˜¯ç”¨æˆ·æ¨¡å¼ç¨‹åºè¯·æ±‚å†…æ ¸æ¨¡å¼æœåŠ¡çš„å®‰å…¨æ¡¥æ¢ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_85.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_87.png)

### ç³»ç»Ÿè°ƒç”¨å¦‚ä½•å·¥ä½œï¼Ÿ

![](img/c5b69340c585f582e2f65bbaf36c1a1e_89.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_91.png)

ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæµç¨‹ä¸æ™®é€šå‡½æ•°è°ƒç”¨ä¸åŒï¼š

![](img/c5b69340c585f582e2f65bbaf36c1a1e_93.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_95.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_97.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_99.png)

1.  **å‡†å¤‡å‚æ•°**: å°†ç³»ç»Ÿè°ƒç”¨ç¼–å·ï¼ˆä¾‹å¦‚ï¼Œ`open`å¯¹åº”ç¼–å·2ï¼‰å’Œå‚æ•°æ”¾å…¥æŒ‡å®šçš„CPUå¯„å­˜å™¨ã€‚
    *   ä»£ç ç¤ºä¾‹ï¼ˆæ¦‚å¿µæ€§æ±‡ç¼–ï¼‰ï¼š
        ```asm
        mov rax, 2       ; ç³»ç»Ÿè°ƒç”¨ç¼–å· (open)
        mov rdi, filename ; ç¬¬ä¸€ä¸ªå‚æ•° (æ–‡ä»¶åæŒ‡é’ˆ)
        mov rsi, flags    ; ç¬¬äºŒä¸ªå‚æ•° (æ‰“å¼€æ ‡å¿—)
        mov rdx, mode     ; ç¬¬ä¸‰ä¸ªå‚æ•° (æ–‡ä»¶æ¨¡å¼)
        ```
2.  **è§¦å‘ä¸­æ–­**: æ‰§è¡Œ`syscall`æŒ‡ä»¤ã€‚è¿™ä¼šè§¦å‘ä¸€ä¸ªè½¯ä¸­æ–­ï¼Œå°†CPUæ§åˆ¶æƒä»ç”¨æˆ·æ¨¡å¼åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ã€‚
3.  **å†…æ ¸å¤„ç†**: å†…æ ¸çš„ä¸­æ–­å¤„ç†ç¨‹åºæ ¹æ®å¯„å­˜å™¨ä¸­çš„ç¼–å·è¯†åˆ«è¯·æ±‚ï¼Œæ‰§è¡Œç›¸åº”çš„å†…æ ¸å‡½æ•°ï¼ˆå¦‚çœŸæ­£çš„`open`æ“ä½œï¼‰ã€‚
4.  **è¿”å›ç»“æœ**: å†…æ ¸å°†ç»“æœï¼ˆæˆåŠŸåˆ™è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥åˆ™è¿”å›-1ï¼‰æ”¾å…¥`rax`å¯„å­˜å™¨ï¼Œå¹¶åˆ‡æ¢å›ç”¨æˆ·æ¨¡å¼ï¼Œç¨‹åºä»`syscall`æŒ‡ä»¤ä¹‹åç»§ç»­æ‰§è¡Œã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_101.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_102.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_104.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_105.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_107.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_109.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_111.png)

**é”™è¯¯å¤„ç†**ï¼šå¦‚æœç³»ç»Ÿè°ƒç”¨å¤±è´¥ï¼Œå†…æ ¸é™¤äº†åœ¨`rax`ä¸­è¿”å›-1ï¼Œè¿˜ä¼šè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡`errno`æ¥æŒ‡ç¤ºå…·ä½“çš„é”™è¯¯åŸå› ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_113.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_115.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_116.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_118.png)

---

![](img/c5b69340c585f582e2f65bbaf36c1a1e_120.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_122.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_124.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_126.png)

## å¤šè¿›ç¨‹ç¼–ç¨‹ç®€ä»‹ ğŸ‘¥

å‰é¢æˆ‘ä»¬è®¨è®ºäº†å•ä¸ªè¿›ç¨‹å¦‚ä½•è¿è¡Œã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•è®©ä¸€ä¸ªç¨‹åºåˆ›å»ºå¹¶ç®¡ç†å¤šä¸ªåŒæ—¶æ‰§è¡Œçš„è¿›ç¨‹ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_128.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_130.png)

ç°ä»£æ“ä½œç³»ç»Ÿæ”¯æŒ**å¤šä»»åŠ¡å¤„ç†**ï¼Œå¯ä»¥å¹¶å‘è¿è¡Œå¤šä¸ªç¨‹åºã€‚æ¯ä¸ªè¿è¡Œä¸­çš„ç¨‹åºéƒ½æ˜¯ä¸€ä¸ª**è¿›ç¨‹**ï¼Œæ‹¥æœ‰å”¯ä¸€çš„**è¿›ç¨‹ID**ã€‚

### åˆ›å»ºæ–°è¿›ç¨‹ï¼š`fork`ç³»ç»Ÿè°ƒç”¨

`fork`ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹ç§°ä¸º**å­è¿›ç¨‹**ï¼Œè°ƒç”¨`fork`çš„è¿›ç¨‹ç§°ä¸º**çˆ¶è¿›ç¨‹**ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_132.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_134.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_136.png)

`fork`çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼š**å®ƒåªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä½†ä¼šè¿”å›ä¸¤æ¬¡**â€”â€”åˆ†åˆ«åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­è¿”å›ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_138.png)

*   åœ¨**çˆ¶è¿›ç¨‹**ä¸­ï¼Œ`fork`è¿”å›æ–°åˆ›å»ºçš„å­è¿›ç¨‹çš„PIDã€‚
*   åœ¨**å­è¿›ç¨‹**ä¸­ï¼Œ`fork`è¿”å›0ã€‚
*   å¦‚æœ`fork`å¤±è´¥ï¼Œåˆ™è¿”å›-1ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_140.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_142.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_144.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_146.png)

ä»£ç ç¤ºä¾‹ï¼š
```c
#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>

![](img/c5b69340c585f582e2f65bbaf36c1a1e_148.png)

int main() {
    pid_t pid = fork(); // åœ¨è¿™é‡Œï¼Œè¿›ç¨‹ä¸€åˆ†ä¸ºäºŒ
    if (pid == 0) {
        // å­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç 
        printf("Hello from child process! My PID is %d.\n", getpid());
    } else if (pid > 0) {
        // çˆ¶è¿›ç¨‹æ‰§è¡Œçš„ä»£ç 
        printf("Hello from parent process! My childâ€˜s PID is %d.\n", pid);
    } else {
        // forkå¤±è´¥
        perror("fork failed");
    }
    return 0;
}
```

![](img/c5b69340c585f582e2f65bbaf36c1a1e_150.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_152.png)

### `fork`çš„è¯­ä¹‰ç»†èŠ‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_154.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_156.png)

*   **ç»§æ‰¿ä¸å¤åˆ¶**ï¼šå­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ï¼Œå®ƒè·å¾—çˆ¶è¿›ç¨‹ä»£ç ã€æ•°æ®æ®µã€å †æ ˆå’Œæ–‡ä»¶æè¿°ç¬¦è¡¨çš„**å‰¯æœ¬**ã€‚ç„¶è€Œï¼Œç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨**å†™æ—¶å¤åˆ¶**æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ï¼Œåªæœ‰åœ¨ä»»ä¸€è¿›ç¨‹è¯•å›¾ä¿®æ”¹æ•°æ®æ—¶ï¼Œæ‰ä¼šçœŸæ­£å¤åˆ¶å†…å­˜é¡µï¼Œè¿™æé«˜äº†æ•ˆç‡ã€‚
*   **æ‰§è¡Œæµ**ï¼š`fork`è°ƒç”¨åï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä»`fork`è°ƒç”¨ä¹‹åçš„ä¸‹ä¸€è¡Œä»£ç å¼€å§‹å¹¶å‘æ‰§è¡Œã€‚æ‰§è¡Œé¡ºåºç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å†³å®šï¼Œæ˜¯**éç¡®å®šæ€§çš„**ã€‚
*   **ç‹¬ç«‹æ€§**ï¼šçˆ¶å­è¿›ç¨‹æœ‰å„è‡ªç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹çš„å˜é‡ï¼Œä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_158.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_160.png)

### ä¸€ä¸ª`fork`ç¤ºä¾‹ï¼šè¿›ç¨‹æ ‘

![](img/c5b69340c585f582e2f65bbaf36c1a1e_162.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_163.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_165.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_167.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_169.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_171.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_173.png)

ä»¥ä¸‹ç¨‹åºæ¼”ç¤ºäº†å¤šæ¬¡è°ƒç”¨`fork`å¦‚ä½•åˆ›å»ºä¸€æ£µè¿›ç¨‹æ ‘ï¼š

![](img/c5b69340c585f582e2f65bbaf36c1a1e_175.png)

```c
#include <stdio.h>
#include <unistd.h>
#include <assert.h>

![](img/c5b69340c585f582e2f65bbaf36c1a1e_177.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_179.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_181.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_183.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_184.png)

int main() {
    char trail[] = "ABCD";
    for (int i = 0; trail[i] != â€˜\0â€˜; i++) {
        printf("%c", trail[i]);
        pid_t pid = fork();
        assert(pid >= 0);
    }
    printf("\n");
    return 0;
}
```

![](img/c5b69340c585f582e2f65bbaf36c1a1e_186.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_188.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_189.png)

è¿™ä¸ªç¨‹åºä¼šæ‰“å°å‡ºç±»ä¼¼`A B B C C C C D D D D D D D`çš„è¾“å‡ºï¼Œä½†å­—æ¯çš„é¡ºåºå’Œæ¢è¡Œç¬¦çš„ä½ç½®æ¯æ¬¡è¿è¡Œéƒ½å¯èƒ½ä¸åŒï¼Œè¿™ç”ŸåŠ¨åœ°å±•ç¤ºäº†å¤šè¿›ç¨‹æ‰§è¡Œçš„å¹¶å‘æ€§å’Œéç¡®å®šæ€§ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_191.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_193.png)

---

![](img/c5b69340c585f582e2f65bbaf36c1a1e_195.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_197.png)

## æ€»ç»“ ğŸ¯

![](img/c5b69340c585f582e2f65bbaf36c1a1e_199.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_201.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ï¼š

![](img/c5b69340c585f582e2f65bbaf36c1a1e_203.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_205.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_206.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_208.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_210.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_212.png)

1.  **æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„**ï¼šäº†è§£äº†Linuxå¦‚ä½•é€šè¿‡è¿›ç¨‹æ§åˆ¶å—ã€æè¿°ç¬¦è¡¨ã€æ‰“å¼€æ–‡ä»¶è¡¨å’Œv-nodeè¡¨çš„å¤šå±‚ç»“æ„æ¥é«˜æ•ˆç®¡ç†æ–‡ä»¶å’Œè¿›ç¨‹èµ„æºã€‚
2.  **ç³»ç»Ÿè°ƒç”¨**ï¼šç†è§£äº†ç³»ç»Ÿè°ƒç”¨ä½œä¸ºç”¨æˆ·ç¨‹åºä¸å†…æ ¸å®‰å…¨äº¤äº’çš„æœºåˆ¶ï¼ŒåŒ…æ‹¬å…¶å·¥ä½œåŸç†ï¼ˆé€šè¿‡`syscall`æŒ‡ä»¤å’Œå¯„å­˜å™¨ä¼ é€’å‚æ•°ï¼‰ä¸æ™®é€šå‡½æ•°è°ƒç”¨çš„æœ¬è´¨åŒºåˆ«ã€‚
3.  **å¤šè¿›ç¨‹ç¼–ç¨‹åŸºç¡€**ï¼šæŒæ¡äº†ä½¿ç”¨`fork`ç³»ç»Ÿè°ƒç”¨åˆ›å»ºæ–°è¿›ç¨‹çš„æ–¹æ³•ï¼Œç†è§£äº†çˆ¶å­è¿›ç¨‹çš„å…³ç³»ã€`fork`çš„è¿”å›è¯­ä¹‰ã€å†™æ—¶å¤åˆ¶æœºåˆ¶ä»¥åŠå¤šè¿›ç¨‹æ‰§è¡Œçš„å¹¶å‘æ€§å’Œéç¡®å®šæ€§ã€‚

![](img/c5b69340c585f582e2f65bbaf36c1a1e_214.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_216.png)

![](img/c5b69340c585f582e2f65bbaf36c1a1e_218.png)

è¿™äº›æ¦‚å¿µæ˜¯ç†è§£æ“ä½œç³»ç»Ÿå·¥ä½œåŸç†å’Œè¿›è¡Œç³»ç»Ÿçº§ç¼–ç¨‹çš„åŸºçŸ³ã€‚åœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦‚ä½•åè°ƒå¤šä¸ªè¿›ç¨‹ï¼ˆä¾‹å¦‚ï¼Œè®©çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼‰ï¼Œä»¥åŠæ›´å¼ºå¤§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚