# CS110 è¯¾ç¨‹ P2ï¼šæ–‡ä»¶ç³»ç»Ÿä¸ `umask` è¯¦è§£ ğŸ“

![](img/cbc9d80603f5807b8374eb9f12191323_1.png)

![](img/cbc9d80603f5807b8374eb9f12191323_3.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹  Unix æ–‡ä»¶ç³»ç»Ÿä¸­çš„æƒé™ç®¡ç†æ ¸å¿ƒæ¦‚å¿µ `umask`ï¼Œå¹¶å¤ä¹ ä½œä¸šä¸€çš„ç›¸å…³èƒŒæ™¯çŸ¥è¯†ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œå¹¶ç¼–å†™ä¸€ä¸ªç®€å•çš„æ–‡ä»¶æœç´¢ç¨‹åºã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_5.png)

![](img/cbc9d80603f5807b8374eb9f12191323_6.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_8.png)

![](img/cbc9d80603f5807b8374eb9f12191323_10.png)

## æ¦‚è¿°ï¼š`umask` ä¸ç”¨æˆ·æƒé™æ§åˆ¶

![](img/cbc9d80603f5807b8374eb9f12191323_12.png)

![](img/cbc9d80603f5807b8374eb9f12191323_14.png)

![](img/cbc9d80603f5807b8374eb9f12191323_15.png)

![](img/cbc9d80603f5807b8374eb9f12191323_17.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†æ–‡ä»¶çš„åŸºæœ¬æƒé™ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹ `umask`ï¼ˆç”¨æˆ·æ–‡ä»¶åˆ›å»ºæ©ç ï¼‰å¦‚ä½•è®©ç”¨æˆ·æ§åˆ¶æ–°åˆ›å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_19.png)

![](img/cbc9d80603f5807b8374eb9f12191323_21.png)

![](img/cbc9d80603f5807b8374eb9f12191323_23.png)

`umask` çš„æ ¸å¿ƒæ˜¯è®©ç”¨æˆ·æ§åˆ¶æ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚å®ƒçš„ä½œç”¨ä¸æ˜¯è®©ç¨‹åºå»è®¾ç½®å„ç§æƒé™ï¼Œè€Œæ˜¯è®©ç”¨æˆ·å£°æ˜ï¼šâ€œå½“ä¸€ä¸ªç¨‹åºä¸ºæˆ‘åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œæˆ‘ä¸å¸Œæœ›å®ƒç»™å…¨ä¸–ç•Œè¯»å–æƒé™ã€‚â€ è¿™ç”±ç”¨æˆ·æ¥æ§åˆ¶ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_25.png)

![](img/cbc9d80603f5807b8374eb9f12191323_27.png)

![](img/cbc9d80603f5807b8374eb9f12191323_29.png)

![](img/cbc9d80603f5807b8374eb9f12191323_31.png)

![](img/cbc9d80603f5807b8374eb9f12191323_33.png)

åœ¨ç»ˆç«¯è¾“å…¥ `umask` å‘½ä»¤ï¼Œå®ƒä¼šæ˜¾ç¤ºå½“å‰çš„ç”¨æˆ·æ©ç ã€‚ä¾‹å¦‚ï¼Œè¾“å‡º `0077`ã€‚è¿™é‡Œçš„ç¬¬ä¸€ä¸ª `0` è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°å­—ã€‚`077` æ„å‘³ç€ç”¨æˆ·ï¼ˆæ‰€æœ‰è€…ï¼‰å¯ä»¥è®¾ç½®ä»»ä½•æƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰ï¼Œä½†ç»„å’Œå…¶ä»–äººï¼ˆéæ‰€æœ‰è€…ï¼‰çš„å†™æƒé™è¢«å±è”½ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_35.png)

**å…¬å¼**ï¼šæ–°æ–‡ä»¶çš„æœ€ç»ˆæƒé™ = ç¨‹åºè¯·æ±‚çš„æƒé™ & (~umask)

![](img/cbc9d80603f5807b8374eb9f12191323_37.png)

![](img/cbc9d80603f5807b8374eb9f12191323_39.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_41.png)

![](img/cbc9d80603f5807b8374eb9f12191323_43.png)

![](img/cbc9d80603f5807b8374eb9f12191323_45.png)

![](img/cbc9d80603f5807b8374eb9f12191323_46.png)

![](img/cbc9d80603f5807b8374eb9f12191323_48.png)

![](img/cbc9d80603f5807b8374eb9f12191323_50.png)

## `umask` å·¥ä½œåŸç†ç¤ºä¾‹

![](img/cbc9d80603f5807b8374eb9f12191323_52.png)

![](img/cbc9d80603f5807b8374eb9f12191323_54.png)

![](img/cbc9d80603f5807b8374eb9f12191323_56.png)

![](img/cbc9d80603f5807b8374eb9f12191323_58.png)

ä»¥ä¸‹æ˜¯ `umask` å¦‚ä½•å½±å“æ–‡ä»¶åˆ›å»ºçš„ç¤ºä¾‹ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_60.png)

![](img/cbc9d80603f5807b8374eb9f12191323_62.png)

![](img/cbc9d80603f5807b8374eb9f12191323_64.png)

![](img/cbc9d80603f5807b8374eb9f12191323_65.png)

![](img/cbc9d80603f5807b8374eb9f12191323_67.png)

![](img/cbc9d80603f5807b8374eb9f12191323_69.png)

1.  **é»˜è®¤æƒ…å†µ**ï¼šå½“ `umask` ä¸º `0077` æ—¶ï¼Œ`touch` å‘½ä»¤å°è¯•ä¸ºæ–°æ–‡ä»¶è®¾ç½® `rw-rw-rw-`ï¼ˆ0666ï¼‰æƒé™ã€‚åº”ç”¨ `umask` åï¼Œç»„å’Œå…¶ä»–äººçš„å†™æƒé™è¢«å±è”½ï¼Œæœ€ç»ˆæ–‡ä»¶æƒé™å˜ä¸º `rw-------`ï¼ˆ0600ï¼‰ã€‚
    ```bash
    $ umask 0077
    $ touch test1.txt
    $ ls -l test1.txt
    -rw------- 1 user group 0 Sep 10 10:00 test1.txt
    ```

![](img/cbc9d80603f5807b8374eb9f12191323_71.png)

![](img/cbc9d80603f5807b8374eb9f12191323_73.png)

![](img/cbc9d80603f5807b8374eb9f12191323_75.png)

![](img/cbc9d80603f5807b8374eb9f12191323_76.png)

![](img/cbc9d80603f5807b8374eb9f12191323_77.png)

![](img/cbc9d80603f5807b8374eb9f12191323_79.png)

![](img/cbc9d80603f5807b8374eb9f12191323_81.png)

2.  **æ›´æ”¹ `umask`**ï¼šå¦‚æœå°† `umask` æ”¹ä¸º `0000`ï¼Œåˆ™ç¨‹åºè¯·æ±‚çš„æ‰€æœ‰æƒé™éƒ½ä¼šè¢«å…è®¸ã€‚
    ```bash
    $ umask 0000
    $ touch test2.txt
    $ ls -l test2.txt
    -rw-rw-rw- 1 user group 0 Sep 10 10:00 test2.txt
    ```

![](img/cbc9d80603f5807b8374eb9f12191323_83.png)

![](img/cbc9d80603f5807b8374eb9f12191323_85.png)

![](img/cbc9d80603f5807b8374eb9f12191323_87.png)

![](img/cbc9d80603f5807b8374eb9f12191323_88.png)

`umask` æ˜¯åè½¬åº”ç”¨çš„ï¼šå®ƒå±è”½ï¼ˆç½®0ï¼‰çš„ä½ï¼Œè¡¨ç¤ºä¸å…è®¸è®¾ç½®çš„æƒé™ã€‚ç¨‹åºå°è¯•è®¾ç½®çš„æƒé™ä¼šä¸ `umask` çš„åç è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆæƒé™ã€‚

---

## æ–‡ä»¶æƒé™çš„è¡¨ç¤º

![](img/cbc9d80603f5807b8374eb9f12191323_90.png)

![](img/cbc9d80603f5807b8374eb9f12191323_92.png)

![](img/cbc9d80603f5807b8374eb9f12191323_94.png)

æ–‡ä»¶æƒé™åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šæ‰€æœ‰è€…ï¼ˆçº¢è‰²ï¼‰ã€ç»„ï¼ˆç»¿è‰²ï¼‰å’Œå…¶ä»–äººï¼ˆè“è‰²ï¼‰ã€‚æ¯ä¸ªéƒ¨åˆ†ç”± `r`ï¼ˆè¯»ï¼‰ã€`w`ï¼ˆå†™ï¼‰ã€`x`ï¼ˆæ‰§è¡Œï¼‰ä¸‰ä¸ªä½è¡¨ç¤ºã€‚

ä¾‹å¦‚ï¼Œæƒé™ `rw-rw-rw-` å¯¹åº”çš„äºŒè¿›åˆ¶æ˜¯ `110110110`ï¼Œè½¬æ¢ä¸ºå…«è¿›åˆ¶å°±æ˜¯ `666`ã€‚å› æ­¤ï¼Œ`chmod 666 file` å‘½ä»¤ä¼šå°†æ–‡ä»¶æƒé™è®¾ç½®ä¸º `rw-rw-rw-`ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_96.png)

**å…¬å¼**ï¼šæƒé™å…«è¿›åˆ¶è®¡ç®—ï¼š`r=4, w=2, x=1`ã€‚å°†æ‰€æœ‰è€…ã€ç»„ã€å…¶ä»–äººçš„æƒé™å€¼åˆ†åˆ«ç›¸åŠ å³å¯ã€‚ä¾‹å¦‚ `rw-r--r--` = `4+2, 4, 4` = `644`ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_98.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_100.png)

![](img/cbc9d80603f5807b8374eb9f12191323_102.png)

## å…³äºç”¨æˆ·ç»„

æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…å’Œä¸€ä¸ªæ‰€å±ç»„ã€‚ä½ å¯ä»¥ä½¿ç”¨ `groups` å‘½ä»¤æŸ¥çœ‹ä½ å±äºå“ªäº›ç»„ã€‚ä½¿ç”¨ `ls -l` å‘½ä»¤æ—¶ï¼Œè¾“å‡ºä¸­çš„ç¬¬äºŒåˆ—å°±æ˜¯æ–‡ä»¶çš„æ‰€å±ç»„ã€‚

---

![](img/cbc9d80603f5807b8374eb9f12191323_104.png)

## ä½œä¸šä¸€ï¼šå‡¯æ–‡Â·è´è‚¯çš„å…­åº¦åˆ†éš” ğŸ¬

![](img/cbc9d80603f5807b8374eb9f12191323_106.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬è®¨è®ºäº†ç³»ç»Ÿæƒé™ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹æœ¬å‘¨çš„ä½œä¸šã€‚ä½œä¸šä¸€çš„ç›®çš„æ˜¯å¤ä¹  CS106B å’Œ CS107 çš„ç¼–ç¨‹æŠ€èƒ½ï¼Œå¹¶ç»ƒä¹  C++ ç¼–ç¨‹ã€‚

ä½œä¸šè¦æ±‚ä½ å®ç°â€œå‡¯æ–‡Â·è´è‚¯çš„å…­åº¦åˆ†éš”â€æ¸¸æˆã€‚ç¨‹åºé€šè¿‡ä¸¤ä¸ªå¤§å‹æ•°æ®åº“æ–‡ä»¶ï¼ˆæ¼”å‘˜æ–‡ä»¶å’Œç”µå½±æ–‡ä»¶ï¼‰æŸ¥æ‰¾ä»»æ„ä¸¤ä½æ¼”å‘˜ä¹‹é—´çš„æœ€çŸ­åˆä½œè·¯å¾„ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_108.png)

**æ ¸å¿ƒæ“ä½œ**ï¼š
1.  **äºŒåˆ†æŸ¥æ‰¾**ï¼šæ•°æ®åº“æ–‡ä»¶å·²æ’åºï¼Œä½ éœ€è¦ä½¿ç”¨ `lower_bound` ç®—æ³•è¿›è¡Œé«˜æ•ˆæŸ¥æ‰¾ã€‚
2.  **å¹¿åº¦ä¼˜å…ˆæœç´¢**ï¼šä½¿ç”¨é˜Ÿåˆ—ï¼ˆæˆ–åˆ—è¡¨ï¼‰æ¥å¯»æ‰¾æ¼”å‘˜ä¹‹é—´çš„æœ€çŸ­è¿æ¥è·¯å¾„ã€‚
3.  **C++ Lambda è¡¨è¾¾å¼**ï¼šä½œä¸šè¦æ±‚ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¸º `lower_bound` æä¾›è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_110.png)

![](img/cbc9d80603f5807b8374eb9f12191323_112.png)

![](img/cbc9d80603f5807b8374eb9f12191323_114.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_116.png)

![](img/cbc9d80603f5807b8374eb9f12191323_118.png)

## C++ Lambda è¡¨è¾¾å¼ç®€ä»‹

Lambda è¡¨è¾¾å¼æ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­å†…è”å®šä¹‰å¹¶ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è¿™åœ¨éœ€è¦ä¼ é€’ç®€çŸ­é€»è¾‘æ—¶éå¸¸æ–¹ä¾¿ã€‚

**åŸºæœ¬è¯­æ³•**ï¼š
```cpp
[capture](parameters) -> return_type { function_body }
```

**ç¤ºä¾‹**ï¼šä¸€ä¸ªå°†å‘é‡ä¸­æ¯ä¸ªå…ƒç´ åŠ ä¸ŠæŸå€¼çš„ Lambdaã€‚
```cpp
vector<int> vec = {1, 2, 3};
int val = 12;
// Lambda æ•è·äº†å¤–éƒ¨å˜é‡ val
for_each(vec.begin(), vec.end(), [val](int &x) { x += val; });
```

![](img/cbc9d80603f5807b8374eb9f12191323_120.png)

![](img/cbc9d80603f5807b8374eb9f12191323_122.png)

![](img/cbc9d80603f5807b8374eb9f12191323_124.png)

![](img/cbc9d80603f5807b8374eb9f12191323_126.png)

![](img/cbc9d80603f5807b8374eb9f12191323_128.png)

Lambda çš„â€œæ•è·â€åŠŸèƒ½æ˜¯å…¶å¼ºå¤§ä¹‹å¤„ï¼Œå®ƒå…è®¸å‡½æ•°è®¿é—®å¹¶æ“ä½œå…¶å®šä¹‰ä½œç”¨åŸŸå†…çš„å˜é‡ï¼Œè€Œæ— éœ€é€šè¿‡å‚æ•°ä¼ é€’ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_130.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_132.png)

![](img/cbc9d80603f5807b8374eb9f12191323_134.png)

![](img/cbc9d80603f5807b8374eb9f12191323_136.png)

![](img/cbc9d80603f5807b8374eb9f12191323_137.png)

![](img/cbc9d80603f5807b8374eb9f12191323_139.png)

![](img/cbc9d80603f5807b8374eb9f12191323_140.png)

## ç³»ç»Ÿè°ƒç”¨ï¼šä½çº§æ–‡ä»¶ I/O

![](img/cbc9d80603f5807b8374eb9f12191323_142.png)

ç†è§£äº†é«˜çº§ä»»åŠ¡åï¼Œæˆ‘ä»¬å›åˆ°æ–‡ä»¶ç³»ç»ŸåŸºç¡€ã€‚Unix æä¾›äº† `read` å’Œ `write` ç­‰ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œä½çº§æ–‡ä»¶æ“ä½œã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_144.png)

![](img/cbc9d80603f5807b8374eb9f12191323_145.png)

![](img/cbc9d80603f5807b8374eb9f12191323_147.png)

![](img/cbc9d80603f5807b8374eb9f12191323_149.png)

![](img/cbc9d80603f5807b8374eb9f12191323_151.png)

![](img/cbc9d80603f5807b8374eb9f12191323_153.png)

**`copy` ç¨‹åºç¤ºä¾‹**ï¼šä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ–‡ä»¶å¤åˆ¶ç¨‹åºï¼Œæ¼”ç¤ºäº† `read` å’Œ `write` çš„åŸºæœ¬ç”¨æ³•ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_155.png)

![](img/cbc9d80603f5807b8374eb9f12191323_157.png)

![](img/cbc9d80603f5807b8374eb9f12191323_159.png)

![](img/cbc9d80603f5807b8374eb9f12191323_161.png)

```c
#include <fcntl.h>
#include <unistd.h>
#define BUFSIZE 1024

![](img/cbc9d80603f5807b8374eb9f12191323_163.png)

![](img/cbc9d80603f5807b8374eb9f12191323_165.png)

![](img/cbc9d80603f5807b8374eb9f12191323_167.png)

![](img/cbc9d80603f5807b8374eb9f12191323_169.png)

int main() {
    int infd = open("input.txt", O_RDONLY);
    int outfd = open("output.txt", O_WRONLY | O_CREAT | O_TRUNC, 0644);
    char buffer[BUFSIZE];
    ssize_t bytesRead;
    while ((bytesRead = read(infd, buffer, BUFSIZE)) > 0) {
        ssize_t bytesWritten = 0;
        while (bytesWritten < bytesRead) {
            ssize_t result = write(outfd, buffer + bytesWritten, bytesRead - bytesWritten);
            if (result == -1) { /* å¤„ç†é”™è¯¯ */ break; }
            bytesWritten += result;
        }
    }
    close(infd);
    close(outfd);
    return 0;
}
```
**å…³é”®ç‚¹**ï¼š
*   `read` å’Œ `write` è°ƒç”¨å¯èƒ½ä¸ä¼šä¸€æ¬¡æ€§è¯»å®Œæˆ–å†™å®Œè¯·æ±‚çš„æ‰€æœ‰å­—èŠ‚ï¼Œéœ€è¦å¾ªç¯å¤„ç†ã€‚
*   `O_TRUNC` æ ‡å¿—è¡¨ç¤ºå¦‚æœè¾“å‡ºæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™å…ˆæ¸…ç©ºå…¶å†…å®¹ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_171.png)

![](img/cbc9d80603f5807b8374eb9f12191323_173.png)

![](img/cbc9d80603f5807b8374eb9f12191323_175.png)

![](img/cbc9d80603f5807b8374eb9f12191323_177.png)

![](img/cbc9d80603f5807b8374eb9f12191323_179.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_181.png)

![](img/cbc9d80603f5807b8374eb9f12191323_183.png)

![](img/cbc9d80603f5807b8374eb9f12191323_185.png)

## å®ç° `find` å‘½ä»¤çš„æ ¸å¿ƒï¼š`stat` ä¸ç›®å½•éå†

![](img/cbc9d80603f5807b8374eb9f12191323_187.png)

![](img/cbc9d80603f5807b8374eb9f12191323_189.png)

![](img/cbc9d80603f5807b8374eb9f12191323_191.png)

æœ€åï¼Œæˆ‘ä»¬æ¢è®¨å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨å®ç°ç±»ä¼¼ `find` çš„å‘½ä»¤ï¼Œè¿™éœ€è¦ç”¨åˆ° `stat`/`lstat` å’Œç›®å½•éå†å‡½æ•°ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_193.png)

![](img/cbc9d80603f5807b8374eb9f12191323_195.png)

![](img/cbc9d80603f5807b8374eb9f12191323_197.png)

**`stat` ä¸ `lstat`**ï¼š
*   è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„å…ƒä¿¡æ¯ï¼Œå¹¶å¡«å……åˆ°ä¸€ä¸ª `struct stat` ç»“æ„ä¸­ã€‚
*   åŒºåˆ«åœ¨äºå¯¹å¾…ç¬¦å·é“¾æ¥ï¼š`lstat` è¿”å›é“¾æ¥æœ¬èº«çš„ä¿¡æ¯ï¼Œè€Œ `stat` è¿”å›é“¾æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_199.png)

![](img/cbc9d80603f5807b8374eb9f12191323_201.png)

**å®ç°æ€è·¯**ï¼š
1.  ä½¿ç”¨ `lstat` æ£€æŸ¥ç»™å®šè·¯å¾„æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•ã€‚
2.  å¦‚æœæ˜¯ç›®å½•ï¼Œä½¿ç”¨ `opendir`ã€`readdir`ã€`closedir` å‡½æ•°éå†å…¶ä¸­çš„æ‰€æœ‰æ¡ç›®ã€‚
3.  å¯¹äºæ¯ä¸ªæ¡ç›®ï¼Œé€’å½’è°ƒç”¨æœç´¢å‡½æ•°ã€‚
4.  å¦‚æœæ˜¯æ™®é€šæ–‡ä»¶ï¼Œåˆ™ä¸ç›®æ ‡æ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_202.png)

![](img/cbc9d80603f5807b8374eb9f12191323_204.png)

![](img/cbc9d80603f5807b8374eb9f12191323_206.png)

![](img/cbc9d80603f5807b8374eb9f12191323_208.png)

**ä»£ç æ¡†æ¶**ï¼š
```c
void list_matches(const char *dirpath, const char *pattern) {
    DIR *dir = opendir(dirpath);
    struct dirent *entry;
    while ((entry = readdir(dir)) != NULL) {
        // è·³è¿‡ "." å’Œ ".."
        if (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0) continue;
        // æ„å»ºå®Œæ•´è·¯å¾„
        char fullpath[PATH_MAX];
        snprintf(fullpath, sizeof(fullpath), "%s/%s", dirpath, entry->d_name);
        struct stat st;
        lstat(fullpath, &st);
        if (S_ISDIR(st.st_mode)) {
            // å¦‚æœæ˜¯ç›®å½•ï¼Œé€’å½’æœç´¢
            list_matches(fullpath, pattern);
        } else if (S_ISREG(st.st_mode)) {
            // å¦‚æœæ˜¯æ™®é€šæ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…æ¨¡å¼
            if (strcmp(entry->d_name, pattern) == 0) {
                printf("%s\n", fullpath);
            }
        }
        // å¿½ç•¥ç¬¦å·é“¾æ¥ç­‰å…¶ä»–ç±»å‹
    }
    closedir(dir);
}
```

![](img/cbc9d80603f5807b8374eb9f12191323_210.png)

![](img/cbc9d80603f5807b8374eb9f12191323_212.png)

---

![](img/cbc9d80603f5807b8374eb9f12191323_214.png)

## æ€»ç»“

![](img/cbc9d80603f5807b8374eb9f12191323_216.png)

![](img/cbc9d80603f5807b8374eb9f12191323_218.png)

![](img/cbc9d80603f5807b8374eb9f12191323_220.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ï¼š
1.  **`umask`** çš„ä½œç”¨ä¸å·¥ä½œåŸç†ï¼Œå®ƒå…è®¸ç”¨æˆ·æ§åˆ¶æ–°æ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚
2.  **ä½œä¸šä¸€**çš„æ ¸å¿ƒè¦æ±‚ï¼šä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œ C++ Lambda è¡¨è¾¾å¼è§£å†³æ¼”å‘˜å…³è”é—®é¢˜ã€‚
3.  ä½¿ç”¨ **`read`/`write` ç³»ç»Ÿè°ƒç”¨**è¿›è¡Œä½çº§æ–‡ä»¶æ“ä½œï¼Œå¹¶ç†è§£äº†å®ƒä»¬å¯èƒ½éœ€è¦å¾ªç¯å¤„ç†ã€‚
4.  ä½¿ç”¨ **`stat`/`lstat`** è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶ç»“åˆç›®å½•éå†å‡½æ•°å®ç°äº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶æœç´¢ç¨‹åºé€»è¾‘ã€‚

![](img/cbc9d80603f5807b8374eb9f12191323_222.png)

![](img/cbc9d80603f5807b8374eb9f12191323_224.png)

è¿™äº›çŸ¥è¯†æ˜¯æ·±å…¥ç†è§£ Unix ç³»ç»Ÿç¼–ç¨‹å’Œå®Œæˆåç»­ä½œä¸šçš„åŸºç¡€ã€‚