![](img/048b7e540d7f0db4c80128b8a9481077_1.png)

![](img/048b7e540d7f0db4c80128b8a9481077_3.png)

# ğŸ½ï¸ è¯¾ç¨‹ P12ï¼šç¬¬11è®² å¤šçº¿ç¨‹ã€æ¡ä»¶å˜é‡å’Œä¿¡å·é‡

![](img/048b7e540d7f0db4c80128b8a9481077_5.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„ç»å…¸é—®é¢˜â€”â€”å“²å­¦å®¶å°±é¤é—®é¢˜ã€‚æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•é€šè¿‡äº’æ–¥é”ã€æ¡ä»¶å˜é‡å’Œä¿¡å·é‡æ¥è§£å†³çº¿ç¨‹é—´çš„èµ„æºç«äº‰ä¸æ­»é”é—®é¢˜ï¼Œå¹¶ç¼–å†™ä»£ç è¿›è¡Œå®è·µã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_7.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_9.png)

## ğŸ“… è¯¾ç¨‹å®‰æ’ä¸æœŸä¸­æé†’

æœ¬å‘¨æ²¡æœ‰å®éªŒè¯¾ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè¦æ±‚å¤§å®¶è§‚çœ‹ä¸€ä¸ªçº¦äº”åˆ†é’Ÿçš„çŸ­è§†é¢‘ã€‚è¿™ä¸ªè§†é¢‘æ˜¯æ–¯å¦ç¦æ¯•ä¸šç”Ÿå…³äºè®¡ç®—æœºç§‘å­¦çš„ç®€çŸ­åˆ†äº«ã€‚è§‚çœ‹è¯¥è§†é¢‘å°†ä½œä¸ºæœ¬å‘¨çš„å®éªŒç­¾åˆ°ã€‚å¤§å®¶å¯ä»¥åˆ©ç”¨è¿™ä¸€å°æ—¶äºŒååˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œå­¦ä¹ æˆ–å®Œæˆå…¶ä»–è¯¾ç¨‹ä½œä¸šã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_11.png)

![](img/048b7e540d7f0db4c80128b8a9481077_13.png)

![](img/048b7e540d7f0db4c80128b8a9481077_15.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_17.png)

![](img/048b7e540d7f0db4c80128b8a9481077_19.png)

## ğŸ” å›é¡¾ä¸è°ƒè¯•ï¼šä¸€ä¸ªç¼–è¯‘é”™è¯¯çš„è§£å†³

![](img/048b7e540d7f0db4c80128b8a9481077_21.png)

åœ¨ä¸Šä¸€èŠ‚è¯¾çš„ç¼–ç æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚é—®é¢˜å‡ºç°åœ¨å‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°æ—¶ï¼Œç±»å‹ä¸åŒ¹é…ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬è¯•å›¾å°†ä¸€ä¸ª `size_t` ç±»å‹çš„å˜é‡ä»¥ `unsigned int` ç±»å‹çš„å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚ç¼–è¯‘å™¨å› æ­¤æŠ¥é”™ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_23.png)

![](img/048b7e540d7f0db4c80128b8a9481077_25.png)

![](img/048b7e540d7f0db4c80128b8a9481077_27.png)

![](img/048b7e540d7f0db4c80128b8a9481077_29.png)

**è§£å†³æ–¹æ¡ˆ**æ˜¯ä¿®æ­£ç±»å‹å£°æ˜ï¼Œç¡®ä¿ä¼ é€’çš„å¼•ç”¨ç±»å‹ä¸å‚æ•°æœŸæœ›çš„ç±»å‹å®Œå…¨ä¸€è‡´ã€‚ä¿®æ­£åä»£ç å¦‚ä¸‹ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_31.png)

![](img/048b7e540d7f0db4c80128b8a9481077_33.png)

![](img/048b7e540d7f0db4c80128b8a9481077_35.png)

![](img/048b7e540d7f0db4c80128b8a9481077_37.png)

```cpp
// ä¿®æ­£å‰ï¼šä¼ é€’äº†é”™è¯¯çš„ç±»å‹å¼•ç”¨
threadFunction(..., (unsigned int&)remainingTickets, ...);

![](img/048b7e540d7f0db4c80128b8a9481077_39.png)

![](img/048b7e540d7f0db4c80128b8a9481077_41.png)

// ä¿®æ­£åï¼šä½¿ç”¨æ­£ç¡®çš„ size_t ç±»å‹
threadFunction(..., (size_t&)remainingTickets, ...);
```

![](img/048b7e540d7f0db4c80128b8a9481077_43.png)

![](img/048b7e540d7f0db4c80128b8a9481077_45.png)

![](img/048b7e540d7f0db4c80128b8a9481077_47.png)

![](img/048b7e540d7f0db4c80128b8a9481077_49.png)

![](img/048b7e540d7f0db4c80128b8a9481077_51.png)

![](img/048b7e540d7f0db4c80128b8a9481077_53.png)

è¿™ä¸ªé”™è¯¯æé†’æˆ‘ä»¬ï¼Œç¼–ç¨‹ä¸­é‡åˆ°éš¾ä»¥å‘ç°çš„ Bug æ˜¯å¸¸äº‹ï¼Œå³ä½¿ç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜ä¹Ÿä¸ä¾‹å¤–ã€‚å…³é”®åœ¨äºè€å¿ƒåˆ†æå’Œè°ƒè¯•ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_55.png)

![](img/048b7e540d7f0db4c80128b8a9481077_57.png)

![](img/048b7e540d7f0db4c80128b8a9481077_59.png)

![](img/048b7e540d7f0db4c80128b8a9481077_61.png)

![](img/048b7e540d7f0db4c80128b8a9481077_63.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_65.png)

![](img/048b7e540d7f0db4c80128b8a9481077_67.png)

## ğŸ§  å“²å­¦å®¶å°±é¤é—®é¢˜ä»‹ç»

![](img/048b7e540d7f0db4c80128b8a9481077_69.png)

![](img/048b7e540d7f0db4c80128b8a9481077_71.png)

![](img/048b7e540d7f0db4c80128b8a9481077_73.png)

![](img/048b7e540d7f0db4c80128b8a9481077_75.png)

å“²å­¦å®¶å°±é¤é—®é¢˜æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªç»å…¸æ­»é”æ¡ˆä¾‹ã€‚å®ƒæè¿°äº†äº”ä½å“²å­¦å®¶å›´ååœ¨åœ†æ¡Œæ—ï¼Œæ¯äººé¢å‰æœ‰ä¸€ç¢—æ„é¢ï¼Œæ¯ä¸¤äººä¹‹é—´æ”¾æœ‰ä¸€æŠŠå‰å­ã€‚å“²å­¦å®¶äº¤æ›¿è¿›è¡Œæ€è€ƒå’Œè¿›é¤ã€‚

**è¿›é¤è§„åˆ™**ï¼š
1.  å“²å­¦å®¶å¿…é¡»åŒæ—¶æ‹¿åˆ°å·¦æ‰‹è¾¹å’Œå³æ‰‹è¾¹çš„ä¸¤æŠŠå‰å­æ‰èƒ½è¿›é¤ã€‚
2.  è¿›é¤å®Œæ¯•åï¼Œå“²å­¦å®¶ä¼šæ”¾ä¸‹ä¸¤æŠŠå‰å­ï¼Œç»§ç»­æ€è€ƒã€‚

**æ ¸å¿ƒçŸ›ç›¾**ï¼šå¦‚æœæ‰€æœ‰å“²å­¦å®¶åŒæ—¶æ‹¿èµ·è‡ªå·±å·¦æ‰‹è¾¹çš„å‰å­ï¼Œé‚£ä¹ˆæ¯ä¸ªäººéƒ½ä¼šç­‰å¾…å³æ‰‹è¾¹çš„å‰å­è¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´**æ­»é”**â€”â€”æ‰€æœ‰äººéƒ½æ— æ³•è¿›é¤ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_77.png)

![](img/048b7e540d7f0db4c80128b8a9481077_79.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä»£ç æ¨¡æ‹Ÿè¿™ä¸ªé—®é¢˜ï¼Œå¹¶å°è¯•è§£å†³å®ƒã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_81.png)

![](img/048b7e540d7f0db4c80128b8a9481077_83.png)

![](img/048b7e540d7f0db4c80128b8a9481077_85.png)

![](img/048b7e540d7f0db4c80128b8a9481077_87.png)

![](img/048b7e540d7f0db4c80128b8a9481077_89.png)

![](img/048b7e540d7f0db4c80128b8a9481077_91.png)

---

## âš™ï¸ åŸºç¡€å®ç°ï¼šä½¿ç”¨äº’æ–¥é”æ¨¡æ‹Ÿ

![](img/048b7e540d7f0db4c80128b8a9481077_93.png)

![](img/048b7e540d7f0db4c80128b8a9481077_95.png)

![](img/048b7e540d7f0db4c80128b8a9481077_97.png)

é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨äº’æ–¥é”ï¼ˆ`mutex`ï¼‰æ¥æ¨¡æ‹Ÿå‰å­ã€‚æ¯ä¸ªå‰å­å¯¹åº”ä¸€ä¸ªäº’æ–¥é”ï¼Œå“²å­¦å®¶å¿…é¡»æˆåŠŸé”å®šï¼ˆæ‹¿èµ·ï¼‰å·¦å³ä¸¤æŠŠå‰å­æ‰èƒ½è¿›é¤ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_99.png)

ä»¥ä¸‹æ˜¯å“²å­¦å®¶çº¿ç¨‹çš„ä¸»è¦è¡Œä¸ºé€»è¾‘ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_101.png)

![](img/048b7e540d7f0db4c80128b8a9481077_103.png)

```cpp
void philosopher(size_t id, mutex& leftFork, mutex& rightFork) {
    for (size_t i = 0; i < 3; ++i) { // æ¯ä¸ªå“²å­¦å®¶è¿›è¡Œ3è½®æ€è€ƒ-è¿›é¤
        think(id); // æ€è€ƒä¸€æ®µæ—¶é—´
        eat(id, leftFork, rightFork); // å°è¯•è¿›é¤
    }
}

![](img/048b7e540d7f0db4c80128b8a9481077_105.png)

![](img/048b7e540d7f0db4c80128b8a9481077_107.png)

![](img/048b7e540d7f0db4c80128b8a9481077_109.png)

void eat(size_t id, mutex& leftFork, mutex& rightFork) {
    leftFork.lock();   // æ‹¿èµ·å·¦æ‰‹è¾¹çš„å‰å­
    rightFork.lock();  // æ‹¿èµ·å³æ‰‹è¾¹çš„å‰å­
    // ... æ¨¡æ‹Ÿè¿›é¤ ...
    rightFork.unlock(); // æ”¾ä¸‹å³æ‰‹è¾¹çš„å‰å­
    leftFork.unlock();  // æ”¾ä¸‹å·¦æ‰‹è¾¹çš„å‰å­
}
```

![](img/048b7e540d7f0db4c80128b8a9481077_111.png)

![](img/048b7e540d7f0db4c80128b8a9481077_113.png)

åœ¨ä¸»å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»º5ä¸ªå“²å­¦å®¶çº¿ç¨‹å’Œ5ä¸ªå‰å­ï¼ˆäº’æ–¥é”ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå“²å­¦å®¶åˆ†é…å…¶å·¦å³å‰å­ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_115.png)

![](img/048b7e540d7f0db4c80128b8a9481077_117.png)

**è¿è¡Œé£é™©**ï¼šå¦‚æœæ‰€æœ‰å“²å­¦å®¶åŒæ—¶æ‰§è¡Œï¼Œææœ‰å¯èƒ½å‘ç”Ÿæ­»é”ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰çº¿ç¨‹å¼€å§‹è¿›é£Ÿå‰æ’å…¥ä¸€ä¸ªç»Ÿä¸€çš„å»¶è¿Ÿæ¥äººä¸ºè§¦å‘è¿™ç§æ­»é”æ¡ä»¶ã€‚

```cpp
// åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¯åŠ¨æ‰€æœ‰å“²å­¦å®¶çº¿ç¨‹å‰
sleep_for(milliseconds(5000)); // ç­‰å¾…5ç§’ï¼Œè®©æ‰€æœ‰çº¿ç¨‹å‡†å¤‡å°±ç»ª
```

![](img/048b7e540d7f0db4c80128b8a9481077_119.png)

![](img/048b7e540d7f0db4c80128b8a9481077_121.png)

![](img/048b7e540d7f0db4c80128b8a9481077_123.png)

è¿™æ ·ï¼Œæ‰€æœ‰å“²å­¦å®¶çº¿ç¨‹ä¼šå‡ ä¹åŒæ—¶å°è¯•è·å–å‰å­ï¼Œä»è€Œæš´éœ²å‡ºæ­»é”é—®é¢˜ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_125.png)

![](img/048b7e540d7f0db4c80128b8a9481077_127.png)

![](img/048b7e540d7f0db4c80128b8a9481077_129.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_131.png)

![](img/048b7e540d7f0db4c80128b8a9481077_133.png)

![](img/048b7e540d7f0db4c80128b8a9481077_135.png)

## ğŸš« è§£å†³æ­»é”æ–¹æ¡ˆä¸€ï¼šå¼•å…¥è®¸å¯è¯ï¼ˆå¿™ç­‰å¾…ï¼‰

![](img/048b7e540d7f0db4c80128b8a9481077_137.png)

![](img/048b7e540d7f0db4c80128b8a9481077_139.png)

![](img/048b7e540d7f0db4c80128b8a9481077_141.png)

![](img/048b7e540d7f0db4c80128b8a9481077_143.png)

![](img/048b7e540d7f0db4c80128b8a9481077_145.png)

![](img/048b7e540d7f0db4c80128b8a9481077_147.png)

ä¸ºäº†é˜²æ­¢æ­»é”ï¼Œä¸€ä¸ªæ€è·¯æ˜¯é™åˆ¶åŒæ—¶å°è¯•è¿›é¤çš„å“²å­¦å®¶æ•°é‡ã€‚ä¾‹å¦‚ï¼Œåªå…è®¸æœ€å¤š4ä½å“²å­¦å®¶åŒæ—¶å°è¯•æ‹¿å‰å­ã€‚æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªâ€œè®¸å¯è¯â€è®¡æ•°å™¨æ¥å®ç°è¿™ä¸ªé™åˆ¶ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_149.png)

![](img/048b7e540d7f0db4c80128b8a9481077_151.png)

![](img/048b7e540d7f0db4c80128b8a9481077_153.png)

![](img/048b7e540d7f0db4c80128b8a9481077_155.png)

**å®ç°é€»è¾‘**ï¼š
1.  è®¾ç½®åˆå§‹è®¸å¯è¯æ•°é‡ä¸º4ï¼ˆæ¯”å“²å­¦å®¶æ€»æ•°å°‘1ï¼‰ã€‚
2.  å“²å­¦å®¶åœ¨å°è¯•æ‹¿å‰å­å‰ï¼Œå¿…é¡»å…ˆè·å¾—ä¸€ä¸ªè®¸å¯è¯ã€‚
3.  å¦‚æœæ²¡æœ‰è®¸å¯è¯å¯ç”¨ï¼Œå“²å­¦å®¶å¿…é¡»ç­‰å¾…ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_157.png)

ä»¥ä¸‹æ˜¯â€œç­‰å¾…è®¸å¯è¯â€å‡½æ•°çš„åˆæ­¥å®ç°ï¼Œå®ƒé‡‡ç”¨â€œå¿™ç­‰å¾…â€ç­–ç•¥ï¼Œå³ä¸æ–­å¾ªç¯æ£€æŸ¥ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_159.png)

![](img/048b7e540d7f0db4c80128b8a9481077_161.png)

![](img/048b7e540d7f0db4c80128b8a9481077_162.png)

![](img/048b7e540d7f0db4c80128b8a9481077_164.png)

```cpp
void waitForPermission(size_t& permits, mutex& permitsLock) {
    while (true) {
        permitsLock.lock();
        if (permits > 0) {
            permits--; // è·å–ä¸€ä¸ªè®¸å¯è¯
            permitsLock.unlock();
            break; // æˆåŠŸè·å¾—ï¼Œé€€å‡ºå¾ªç¯
        }
        permitsLock.unlock();
        // å¿™ç­‰å¾…ï¼šæœªè·å¾—è®¸å¯è¯ï¼Œä¼‘çœ ä¸€å°æ®µæ—¶é—´åé‡è¯•
        sleep_for(milliseconds(10));
    }
}
```

![](img/048b7e540d7f0db4c80128b8a9481077_166.png)

![](img/048b7e540d7f0db4c80128b8a9481077_168.png)

![](img/048b7e540d7f0db4c80128b8a9481077_170.png)

**ç¼ºç‚¹**ï¼šå¿™ç­‰å¾…ä¼šæŒç»­æ¶ˆè€—CPUèµ„æºï¼Œæ•ˆç‡ä½ä¸‹ã€‚å“²å­¦å®¶çº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šä¸æ–­è¢«å”¤é†’å’Œä¼‘çœ ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_172.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_174.png)

![](img/048b7e540d7f0db4c80128b8a9481077_176.png)

## âœ… è§£å†³æ­»é”æ–¹æ¡ˆäºŒï¼šä½¿ç”¨æ¡ä»¶å˜é‡

ä¸ºäº†æ›´é«˜æ•ˆåœ°ç­‰å¾…ï¼Œæˆ‘ä»¬ä½¿ç”¨**æ¡ä»¶å˜é‡**ã€‚æ¡ä»¶å˜é‡å…è®¸çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ä¸»åŠ¨è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œå¹¶åœ¨æ¡ä»¶å¯èƒ½æ»¡è¶³æ—¶è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚

æˆ‘ä»¬ä½¿ç”¨ `condition_variable_any` å’Œ `mutex` é…åˆå·¥ä½œã€‚å…³é”®å·¥å…·æ˜¯ **`lock_guard`**ï¼Œå®ƒèƒ½è‡ªåŠ¨ç®¡ç†äº’æ–¥é”çš„ä¸Šé”ä¸è§£é”ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_178.png)

![](img/048b7e540d7f0db4c80128b8a9481077_180.png)

![](img/048b7e540d7f0db4c80128b8a9481077_182.png)

![](img/048b7e540d7f0db4c80128b8a9481077_184.png)

**æ”¹è¿›åçš„ `waitForPermission` å‡½æ•°**ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_186.png)

![](img/048b7e540d7f0db4c80128b8a9481077_188.png)

![](img/048b7e540d7f0db4c80128b8a9481077_190.png)

![](img/048b7e540d7f0db4c80128b8a9481077_192.png)

![](img/048b7e540d7f0db4c80128b8a9481077_194.png)

![](img/048b7e540d7f0db4c80128b8a9481077_196.png)

```cpp
void waitForPermission(size_t& permits, mutex& m, condition_variable_any& cv) {
    lock_guard<mutex> lg(m); // æ„é€ æ—¶ä¸Šé”ï¼Œææ„æ—¶è‡ªåŠ¨è§£é”
    // ä½¿ç”¨lambdaè¡¨è¾¾å¼ä½œä¸ºç­‰å¾…æ¡ä»¶
    cv.wait(m, [&permits] { return permits > 0; });
    permits--; // è·å¾—è®¸å¯è¯
    // lock_guard è¶…å‡ºä½œç”¨åŸŸï¼Œè‡ªåŠ¨è§£é”m
}
```

![](img/048b7e540d7f0db4c80128b8a9481077_198.png)

**å¯¹åº”çš„ `grantPermission` å‡½æ•°**ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_200.png)

![](img/048b7e540d7f0db4c80128b8a9481077_202.png)

![](img/048b7e540d7f0db4c80128b8a9481077_204.png)

```cpp
void grantPermission(size_t& permits, mutex& m, condition_variable_any& cv) {
    lock_guard<mutex> lg(m);
    permits++; // é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯
    if (permits == 1) { // å¦‚æœè®¸å¯è¯ä»0å˜ä¸º1ï¼Œå¯èƒ½æœ‰çº¿ç¨‹åœ¨ç­‰å¾…
        cv.notify_all(); // é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
    }
}
```

![](img/048b7e540d7f0db4c80128b8a9481077_206.png)

![](img/048b7e540d7f0db4c80128b8a9481077_208.png)

![](img/048b7e540d7f0db4c80128b8a9481077_210.png)

**å·¥ä½œæµç¨‹**ï¼š
1.  å“²å­¦å®¶çº¿ç¨‹è°ƒç”¨ `waitForPermission`ã€‚å¦‚æœ `permits > 0`ï¼Œåˆ™ç«‹å³å‡å°‘è®¸å¯å¹¶ç»§ç»­ã€‚
2.  å¦‚æœ `permits == 0`ï¼Œ`cv.wait()` ä¼šè§£é”äº’æ–¥é” `m` å¹¶ä½¿çº¿ç¨‹ä¼‘çœ ã€‚
3.  å½“æœ‰å“²å­¦å®¶è¿›é¤å®Œæ¯•ï¼Œè°ƒç”¨ `grantPermission` å¢åŠ è®¸å¯ï¼Œå¹¶è°ƒç”¨ `cv.notify_all()` å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚
4.  è¢«å”¤é†’çš„çº¿ç¨‹ä¼šé‡æ–°è·å–é”å¹¶æ£€æŸ¥æ¡ä»¶ï¼ŒæˆåŠŸè€…è·å¾—è®¸å¯è¯ã€‚

è¿™ç§æ–¹å¼é¿å…äº†å¿™ç­‰å¾…ï¼Œè®©çº¿ç¨‹åœ¨ç­‰å¾…æœŸé—´å®Œå…¨ä¸æ¶ˆè€—CPUèµ„æºã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_212.png)

![](img/048b7e540d7f0db4c80128b8a9481077_214.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_216.png)

## ğŸš¦ è§£å†³æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ä¿¡å·é‡

![](img/048b7e540d7f0db4c80128b8a9481077_218.png)

![](img/048b7e540d7f0db4c80128b8a9481077_220.png)

![](img/048b7e540d7f0db4c80128b8a9481077_222.png)

![](img/048b7e540d7f0db4c80128b8a9481077_224.png)

æ¡ä»¶å˜é‡çš„æ¨¡å¼éå¸¸é€šç”¨ï¼Œä»¥è‡³äºå¯ä»¥è¢«å°è£…æˆä¸€ä¸ªæ›´é«˜çº§çš„å·¥å…·â€”â€”**ä¿¡å·é‡**ã€‚ä¿¡å·é‡ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæä¾›äº† `wait`ï¼ˆè·å–èµ„æºï¼‰å’Œ `signal`ï¼ˆé‡Šæ”¾èµ„æºï¼‰ä¸¤ç§åŸå­æ“ä½œã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_226.png)

![](img/048b7e540d7f0db4c80128b8a9481077_228.png)

åœ¨C++æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰ç›´æ¥æä¾›ä¿¡å·é‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ©ç”¨ `mutex` å’Œ `condition_variable_any` å®ç°å®ƒï¼Œæˆ–è€…ä½¿ç”¨è¯¾ç¨‹æä¾›çš„å°è£…ç±»ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_230.png)

![](img/048b7e540d7f0db4c80128b8a9481077_232.png)

![](img/048b7e540d7f0db4c80128b8a9481077_234.png)

![](img/048b7e540d7f0db4c80128b8a9481077_236.png)

**ä½¿ç”¨ä¿¡å·é‡ç®€åŒ–å“²å­¦å®¶é—®é¢˜**ï¼š

```cpp
// å£°æ˜ä¸€ä¸ªåˆå§‹å€¼ä¸º4çš„ä¿¡å·é‡
semaphore permits(4);

![](img/048b7e540d7f0db4c80128b8a9481077_238.png)

![](img/048b7e540d7f0db4c80128b8a9481077_240.png)

![](img/048b7e540d7f0db4c80128b8a9481077_242.png)

// åœ¨å“²å­¦å®¶çº¿ç¨‹ä¸­ï¼Œæ›¿æ¢ä¹‹å‰çš„ waitForPermission å’Œ grantPermission
void philosopher(size_t id, mutex& leftFork, mutex& rightFork, semaphore& permits) {
    for (size_t i = 0; i < 3; ++i) {
        think(id);
        permits.wait();    // ç­‰å¾…å¹¶è·å¾—ä¸€ä¸ªè®¸å¯è¯ï¼ˆä¿¡å·é‡å†…éƒ¨æ“ä½œï¼‰
        eat(id, leftFork, rightFork);
        permits.signal();  // é‡Šæ”¾è®¸å¯è¯
    }
}
```

ä¿¡å·é‡çš„ `wait()` å’Œ `signal()` æ–¹æ³•å†…éƒ¨å·²ç»å°è£…äº†é”å’Œæ¡ä»¶å˜é‡çš„é€»è¾‘ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ¸…æ™°ã€‚**äº’æ–¥é”æœ¬è´¨ä¸Šå°±æ˜¯åˆå§‹å€¼ä¸º1çš„ä¿¡å·é‡**ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_244.png)

![](img/048b7e540d7f0db4c80128b8a9481077_246.png)

![](img/048b7e540d7f0db4c80128b8a9481077_248.png)

![](img/048b7e540d7f0db4c80128b8a9481077_250.png)

---

![](img/048b7e540d7f0db4c80128b8a9481077_252.png)

![](img/048b7e540d7f0db4c80128b8a9481077_254.png)

![](img/048b7e540d7f0db4c80128b8a9481077_256.png)

## ğŸ“š æœ¬èŠ‚è¯¾æ€»ç»“

![](img/048b7e540d7f0db4c80128b8a9481077_258.png)

![](img/048b7e540d7f0db4c80128b8a9481077_260.png)

![](img/048b7e540d7f0db4c80128b8a9481077_261.png)

![](img/048b7e540d7f0db4c80128b8a9481077_263.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ï¼š

![](img/048b7e540d7f0db4c80128b8a9481077_265.png)

![](img/048b7e540d7f0db4c80128b8a9481077_267.png)

![](img/048b7e540d7f0db4c80128b8a9481077_269.png)

1.  **å“²å­¦å®¶å°±é¤é—®é¢˜**ï¼šä¸€ä¸ªç»å…¸çš„å¤šçº¿ç¨‹æ­»é”åœºæ™¯ã€‚
2.  **äº’æ–¥é”**ï¼šç”¨äºä¿æŠ¤å…±äº«èµ„æºï¼ˆå‰å­ï¼‰ï¼Œä½†ç›´æ¥ä½¿ç”¨å¯èƒ½å¯¼è‡´æ­»é”ã€‚
3.  **è®¸å¯è¯æ¨¡å¼**ï¼šé€šè¿‡é™åˆ¶å¹¶å‘æ•°é‡æ¥é¢„é˜²æ­»é”ã€‚
4.  **å¿™ç­‰å¾…çš„ç¼ºç‚¹**ï¼šä½æ•ˆä¸”æ¶ˆè€—CPUã€‚
5.  **æ¡ä»¶å˜é‡**ï¼šä¸äº’æ–¥é”é…åˆï¼Œè®©çº¿ç¨‹èƒ½é«˜æ•ˆç­‰å¾…æ¡ä»¶æˆç†Ÿï¼Œå¹¶é€šè¿‡ `lock_guard` è‡ªåŠ¨ç®¡ç†é”çš„ç”Ÿå‘½å‘¨æœŸã€‚
6.  **ä¿¡å·é‡**ï¼šä¸€ä¸ªæ›´é«˜çº§çš„åŒæ­¥åŸè¯­ï¼ŒåŸºäºæ¡ä»¶å˜é‡å°è£…ï¼Œç”¨äºç®¡ç†ä¸€ç»„èµ„æºçš„è®¿é—®è®¸å¯ï¼Œæå¤§ç®€åŒ–äº†ä»£ç ã€‚

![](img/048b7e540d7f0db4c80128b8a9481077_271.png)

![](img/048b7e540d7f0db4c80128b8a9481077_273.png)

é€šè¿‡ä»åŸºç¡€å®ç°åˆ°é«˜çº§åŒæ­¥åŸè¯­çš„æ¼”è¿›ï¼Œæˆ‘ä»¬æŒæ¡äº†è§£å†³å¤æ‚çº¿ç¨‹åŒæ­¥é—®é¢˜çš„å¤šç§å·¥å…·å’Œæ€è·¯ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œåº”æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³•ã€‚