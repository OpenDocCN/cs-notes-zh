![](img/1175ce1bb2aa4c74fdf727bbf8d79962_1.png)

# ç½‘ç»œç³»ç»Ÿè°ƒç”¨æ•™ç¨‹ P17ï¼šç¬¬16è®² ğŸŒ

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_3.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç½‘ç»œç¼–ç¨‹ä¸­çš„æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•é€šè¿‡å¥—æ¥å­—ï¼ˆsocketï¼‰å®ç°ä¸åŒè®¡ç®—æœºä¹‹é—´çš„é€šä¿¡ã€‚æˆ‘ä»¬å°†ä»è§£æä¸»æœºåå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°åˆ›å»ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¥—æ¥å­—çš„å…·ä½“æ­¥éª¤ã€‚

---

## ä¸»æœºåè§£æä¸IPåœ°å€è·å– ğŸ”

ä¸Šä¸€èŠ‚æˆ‘ä»¬è®¨è®ºäº†å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹çš„äº¤äº’ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ï¼šå¦‚ä½•å°†äººç±»å¯è¯»çš„ä¸»æœºåï¼ˆå¦‚ `www.facebook.com`ï¼‰è½¬æ¢ä¸ºè®¡ç®—æœºå¯è¯†åˆ«çš„IPåœ°å€ã€‚

### `gethostbyname` å‡½æ•°

`gethostbyname` å‡½æ•°ç”¨äºæ ¹æ®ä¸»æœºåè·å–å…¶å¯¹åº”çš„IPåœ°å€ä¿¡æ¯ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªä¸»æœºåå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ª `struct hostent` ç»“æ„ä½“æŒ‡é’ˆã€‚

```c
struct hostent *gethostbyname(const char *name);
```

å¦‚æœè§£æå¤±è´¥ï¼Œè¯¥å‡½æ•°è¿”å› `NULL`ã€‚å¤±è´¥åŸå› å¯èƒ½æ˜¯DNSæœåŠ¡å™¨æ•…éšœã€ç½‘ç»œé—®é¢˜æˆ–ä¸»æœºåä¸å­˜åœ¨ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_5.png)

### `struct hostent` ç»“æ„ä½“

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_7.png)

è¯¥ç»“æ„ä½“åŒ…å«äº†ä¸»æœºçš„è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå­—æ®µï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_9.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_11.png)

*   `h_name`: æŒ‡å‘å®˜æ–¹ä¸»æœºåçš„æŒ‡é’ˆã€‚
*   `h_aliases`: ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºè¯¥ä¸»æœºçš„åˆ«ååˆ—è¡¨ã€‚åˆ—è¡¨ä»¥ `NULL` æŒ‡é’ˆç»“æŸã€‚
*   `h_addrtype`: åœ°å€ç±»å‹ï¼Œä¾‹å¦‚ `AF_INET` ä»£è¡¨IPv4åœ°å€ã€‚
*   `h_length`: åœ°å€é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚å¯¹äºIPv4ï¼Œæ­¤å€¼ä¸º4ã€‚
*   `h_addr_list`: ä¸€ä¸ªæŒ‡å‘ç½‘ç»œåœ°å€æŒ‡é’ˆæ•°ç»„çš„æŒ‡é’ˆã€‚å¯¹äºIPv4ï¼Œæ¯ä¸ªåœ°å€æ˜¯ä¸€ä¸ª `struct in_addr`ã€‚åˆ—è¡¨ä»¥ `NULL` æŒ‡é’ˆç»“æŸã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_13.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_15.png)

`struct in_addr` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ä½“ï¼Œé€šå¸¸åªåŒ…å«ä¸€ä¸ªæˆå‘˜ `s_addr`ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¨ç¤ºIPv4åœ°å€çš„32ä½æ— ç¬¦å·æ•´æ•°ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_17.png)

### å­—èŠ‚åºé—®é¢˜

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_19.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_21.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_22.png)

è®¡ç®—æœºå­˜å‚¨å¤šå­—èŠ‚æ•°æ®ï¼ˆå¦‚32ä½IPåœ°å€ï¼‰æœ‰ä¸¤ç§é¡ºåºï¼š**å°ç«¯åº**ï¼ˆä½ä½å­—èŠ‚åœ¨å‰ï¼‰å’Œ**å¤§ç«¯åº**ï¼ˆé«˜ä½å­—èŠ‚åœ¨å‰ï¼‰ã€‚ä¸ºäº†ä¿è¯ç½‘ç»œé€šä¿¡çš„ä¸€è‡´æ€§ï¼Œæ•°æ®åœ¨å‘é€å‰éœ€è¦è½¬æ¢ä¸º**ç½‘ç»œå­—èŠ‚åº**ï¼ˆå¤§ç«¯åºï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‡½æ•°è¿›è¡Œè½¬æ¢ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_24.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_26.png)

*   `htons()`: å°†16ä½çŸ­æ•´å‹ï¼ˆå¦‚ç«¯å£å·ï¼‰ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚
*   `htonl()`: å°†32ä½é•¿æ•´å‹ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚
*   `ntohs()`: å°†16ä½çŸ­æ•´å‹ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢å›ä¸»æœºå­—èŠ‚åºã€‚
*   `ntohl()`: å°†32ä½é•¿æ•´å‹ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢å›ä¸»æœºå­—èŠ‚åºã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_28.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_30.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_32.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_34.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_36.png)

### ç¤ºä¾‹ï¼šè§£æä¸»æœºå

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_38.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_40.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_42.png)

ä»¥ä¸‹æ˜¯ä½¿ç”¨ `gethostbyname` å’Œ `inet_ntop`ï¼ˆå°†ç½‘ç»œåœ°å€è½¬æ¢ä¸ºç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²ï¼‰çš„ä»£ç ç¤ºä¾‹ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_44.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_46.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_48.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_50.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_52.png)

```c
#include <netdb.h>
#include <arpa/inet.h>
#include <stdio.h>

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_54.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_56.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_58.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_60.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_62.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_64.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_66.png)

void resolve_hostname(const char* hostname) {
    struct hostent *he = gethostbyname(hostname);
    if (he == NULL) {
        fprintf(stderr, "æ— æ³•è§£æä¸»æœºå: %s\n", hostname);
        return;
    }

    printf("å®˜æ–¹åç§°: %s\n", he->h_name);

    // éå†åœ°å€åˆ—è¡¨
    struct in_addr **addr_list = (struct in_addr **)he->h_addr_list;
    for (int i = 0; addr_list[i] != NULL; i++) {
        char ip_str[INET_ADDRSTRLEN];
        inet_ntop(AF_INET, addr_list[i], ip_str, sizeof(ip_str));
        printf("IPåœ°å€ %d: %s\n", i+1, ip_str);
    }
}
```

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_68.png)

---

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_70.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_72.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_74.png)

## å¥—æ¥å­—åœ°å€ç»“æ„ ğŸ—ï¸

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_76.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_78.png)

åœ¨æ·±å…¥åˆ›å»ºå¥—æ¥å­—ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ç”¨äºè¡¨ç¤ºç½‘ç»œåœ°å€çš„é€šç”¨ç»“æ„ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_80.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_82.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_84.png)

### é€šç”¨å¥—æ¥å­—åœ°å€ï¼š`struct sockaddr`

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_86.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_88.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_90.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_92.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_94.png)

è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„åœ°å€ç»“æ„ï¼Œç”¨äºåœ¨å‡½æ•°è°ƒç”¨ä¸­ä¼ é€’åœ°å€ä¿¡æ¯ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_96.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_98.png)

```c
struct sockaddr {
    sa_family_t sa_family; // åœ°å€æ—ï¼ˆå¦‚ AF_INET, AF_INET6ï¼‰
    char        sa_data[14]; // åè®®åœ°å€
};
```

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_100.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_102.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_104.png)

### äº’è”ç½‘å¥—æ¥å­—åœ°å€ï¼ˆIPv4ï¼‰ï¼š`struct sockaddr_in`

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_106.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_108.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_110.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_112.png)

è¿™æ˜¯å®é™…ç”¨äºIPv4é€šä¿¡çš„åœ°å€ç»“æ„ã€‚å®ƒåŒ…å«å…·ä½“çš„åœ°å€ä¿¡æ¯ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_114.png)

```c
struct sockaddr_in {
    sa_family_t    sin_family; // åœ°å€æ—ï¼Œå¿…é¡»ä¸º AF_INET
    in_port_t      sin_port;   // ç«¯å£å·ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰
    struct in_addr sin_addr;   // IPv4åœ°å€
    unsigned char  sin_zero[8]; // å¡«å……å­—æ®µï¼Œé€šå¸¸è®¾ä¸º0
};
```

### ç±»å‹è½¬æ¢

ç”±äºåƒ `connect`ã€`bind` è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨æ¥æ”¶é€šç”¨çš„ `struct sockaddr*` æŒ‡é’ˆï¼Œæˆ‘ä»¬åœ¨ä¼ é€’ `struct sockaddr_in` åœ°å€æ—¶éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_116.png)

```c
struct sockaddr_in server_addr;
// ... å¡«å…… server_addr ...
connect(sockfd, (struct sockaddr *)&server_addr, sizeof(server_addr));
```

ç³»ç»Ÿè°ƒç”¨å†…éƒ¨é€šè¿‡æ£€æŸ¥ `sa_family` å­—æ®µæ¥åˆ¤æ–­å…·ä½“çš„åœ°å€ç±»å‹å¹¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_118.png)

---

## åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­— ğŸ–¥ï¸â¡ï¸ğŸŒ

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_120.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_122.png)

å®¢æˆ·ç«¯å¥—æ¥å­—ç”¨äºä¸»åŠ¨å‘èµ·ä¸è¿œç¨‹æœåŠ¡å™¨çš„è¿æ¥ã€‚

åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

1.  **è§£ææœåŠ¡å™¨ä¸»æœºå**ï¼šä½¿ç”¨ `gethostbyname` è·å–æœåŠ¡å™¨çš„IPåœ°å€ã€‚
2.  **åˆ›å»ºå¥—æ¥å­—æè¿°ç¬¦**ï¼šä½¿ç”¨ `socket()` ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„å¥—æ¥å­—ã€‚
3.  **å¡«å……æœåŠ¡å™¨åœ°å€ç»“æ„**ï¼šåˆ›å»ºä¸€ä¸ª `struct sockaddr_in`ï¼Œå¡«å…¥æœåŠ¡å™¨IPã€ç«¯å£ï¼Œå¹¶ç¡®ä¿å­—èŠ‚åºæ­£ç¡®ã€‚
4.  **å‘èµ·è¿æ¥**ï¼šä½¿ç”¨ `connect()` ç³»ç»Ÿè°ƒç”¨å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚
5.  **é”™è¯¯å¤„ç†**ï¼šå¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œéœ€è¦å¦¥å–„å…³é—­å·²æ‰“å¼€çš„å¥—æ¥å­—æè¿°ç¬¦ã€‚

ä»¥ä¸‹æ˜¯æ ¸å¿ƒä»£ç æ¡†æ¶ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_124.png)

```c
int create_client_socket(const char* hostname, int port) {
    // 1. è§£æä¸»æœºå
    struct hostent *he = gethostbyname(hostname);
    if (he == NULL) return -1;

    // 2. åˆ›å»ºå¥—æ¥å­—
    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0) return -1;

    // 3. å¡«å……æœåŠ¡å™¨åœ°å€
    struct sockaddr_in server_addr;
    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(port); // è½¬æ¢ç«¯å£å­—èŠ‚åº
    // å¤åˆ¶IPåœ°å€ï¼Œæ³¨æ„h_addr_listæ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆ
    server_addr.sin_addr = *((struct in_addr *)he->h_addr_list[0]);

    // 4. å‘èµ·è¿æ¥
    if (connect(sockfd, (struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
        close(sockfd); // 5. è¿æ¥å¤±è´¥ï¼Œå…³é—­å¥—æ¥å­—
        return -1;
    }
    // è¿æ¥æˆåŠŸï¼Œè¿”å›å¥—æ¥å­—æè¿°ç¬¦
    return sockfd;
}
```

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_126.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_128.png)

**æ³¨æ„**ï¼šè°ƒç”¨æ­¤å‡½æ•°æˆåŠŸè·å–å¥—æ¥å­—åï¼Œä½¿ç”¨è€…è´Ÿè´£åœ¨é€šä¿¡ç»“æŸæ—¶è°ƒç”¨ `close()` å…³é—­å®ƒã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_130.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_132.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_134.png)

---

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_136.png)

## åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­— ğŸŒâ¡ï¸ğŸ–¥ï¸

æœåŠ¡å™¨å¥—æ¥å­—ç”¨äºåœ¨æœ¬åœ°ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_138.png)

åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_140.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_142.png)

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_144.png)

1.  **åˆ›å»ºå¥—æ¥å­—æè¿°ç¬¦**ï¼šä½¿ç”¨ `socket()` ç³»ç»Ÿè°ƒç”¨ã€‚
2.  **å¡«å……æœ¬åœ°åœ°å€ç»“æ„**ï¼šåˆ›å»ºä¸€ä¸ª `struct sockaddr_in`ã€‚é€šå¸¸å°†IPåœ°å€è®¾ç½®ä¸º `INADDR_ANY`ï¼ˆ0.0.0.0ï¼‰ï¼Œè¡¨ç¤ºç›‘å¬æœ¬æœºæ‰€æœ‰ç½‘ç»œæ¥å£ã€‚ç«¯å£è®¾ç½®ä¸ºè¦ç›‘å¬çš„ç«¯å£ã€‚
3.  **ç»‘å®šåœ°å€**ï¼šä½¿ç”¨ `bind()` ç³»ç»Ÿè°ƒç”¨å°†å¥—æ¥å­—ä¸ç‰¹å®šçš„IPåœ°å€å’Œç«¯å£ç»‘å®šã€‚
4.  **å¼€å§‹ç›‘å¬**ï¼šä½¿ç”¨ `listen()` ç³»ç»Ÿè°ƒç”¨ï¼Œå°†å¥—æ¥å­—ç½®äºè¢«åŠ¨ç›‘å¬æ¨¡å¼ï¼Œå‡†å¤‡æ¥å—è¿æ¥ã€‚
5.  **é”™è¯¯å¤„ç†**ï¼šå¦‚æœç»‘å®šæˆ–ç›‘å¬å¤±è´¥ï¼Œéœ€è¦å…³é—­å¥—æ¥å­—ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_146.png)

ä»¥ä¸‹æ˜¯æ ¸å¿ƒä»£ç æ¡†æ¶ï¼š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_148.png)

```c
int create_server_socket(int port, int backlog) {
    // 1. åˆ›å»ºå¥—æ¥å­—
    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0) return -1;

    // 2. å¡«å……æœ¬åœ°åœ°å€ï¼ˆå…è®¸ä»»ä½•æ¥å£è¿æ¥ï¼‰
    struct sockaddr_in server_addr;
    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_addr.s_addr = htonl(INADDR_ANY); // ç›‘å¬æ‰€æœ‰IP
    server_addr.sin_port = htons(port); // è®¾ç½®ç›‘å¬ç«¯å£

    // 3. ç»‘å®šåœ°å€
    if (bind(sockfd, (struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
        close(sockfd);
        return -1;
    }

    // 4. å¼€å§‹ç›‘å¬
    // backlogå‚æ•°å®šä¹‰äº†ç­‰å¾…è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦
    if (listen(sockfd, backlog) < 0) {
        close(sockfd);
        return -1;
    }
    // ç›‘å¬æˆåŠŸï¼Œè¿”å›æœåŠ¡å™¨å¥—æ¥å­—æè¿°ç¬¦
    return sockfd;
}
```

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_150.png)

**å…³é”®ç‚¹è¯´æ˜**ï¼š
*   `INADDR_ANY`ï¼šä¸€ä¸ªç‰¹æ®Šåœ°å€ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ„¿æ„æ¥å—æ¥è‡ªä»»ä½•ç½‘ç»œæ¥å£ï¼ˆå¦‚ä»¥å¤ªç½‘ã€Wi-Fiï¼‰çš„è¿æ¥ã€‚
*   `listen()` çš„ `backlog` å‚æ•°ï¼šæŒ‡å®šäº†å†…æ ¸ä¸ºæ­¤å¥—æ¥å­—æ’é˜Ÿçš„æœ€å¤§æœªå®Œæˆè¿æ¥æ•°ã€‚è¶…è¿‡æ­¤æ•°é‡çš„è¿æ¥è¯·æ±‚å¯èƒ½ä¼šè¢«æ‹’ç»ã€‚

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_152.png)

æœåŠ¡å™¨å¥—æ¥å­—åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨ `accept()` ç³»ç»Ÿè°ƒç”¨æ¥æ¥å—å…·ä½“çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œè¯¥è°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡çš„**æ–°å¥—æ¥å­—æè¿°ç¬¦**ã€‚åŸå§‹çš„æœåŠ¡å™¨å¥—æ¥å­—ç»§ç»­ç”¨äºç›‘å¬æ–°çš„è¿æ¥è¯·æ±‚ã€‚

---

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_154.png)

## æ€»ç»“ ğŸ“š

![](img/1175ce1bb2aa4c74fdf727bbf8d79962_156.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ç½‘ç»œç³»ç»Ÿè°ƒç”¨çš„æ ¸å¿ƒå†…å®¹ï¼š

1.  **ä¸»æœºåè§£æ**ï¼šä½¿ç”¨ `gethostbyname` å°†åŸŸåè½¬æ¢ä¸ºIPåœ°å€ï¼Œå¹¶ç†è§£äº† `struct hostent` ç»“æ„ä½“å’Œç½‘ç»œå­—èŠ‚åºçš„æ¦‚å¿µã€‚
2.  **å¥—æ¥å­—åœ°å€ç»“æ„**ï¼šäº†è§£äº†é€šç”¨çš„ `struct sockaddr` å’Œå…·ä½“çš„ `struct sockaddr_in`ï¼ˆIPv4ï¼‰ç»“æ„ä½“ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç±»å‹è½¬æ¢ã€‚
3.  **å®¢æˆ·ç«¯å¥—æ¥å­—**ï¼šæŒæ¡äº†åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥çš„æµç¨‹ï¼šè§£æä¸»æœºå -> åˆ›å»ºå¥—æ¥å­— -> å¡«å……åœ°å€ -> è°ƒç”¨ `connect()`ã€‚
4.  **æœåŠ¡å™¨å¥—æ¥å­—**ï¼šæŒæ¡äº†åˆ›å»ºæœåŠ¡å™¨ç›‘å¬ç«¯å£çš„æµç¨‹ï¼šåˆ›å»ºå¥—æ¥å­— -> å¡«å……åœ°å€ï¼ˆå¸¸ä½¿ç”¨ `INADDR_ANY`ï¼‰ -> è°ƒç”¨ `bind()` -> è°ƒç”¨ `listen()`ã€‚

ç†è§£è¿™äº›åŸºç¡€ç³»ç»Ÿè°ƒç”¨æ˜¯è¿›è¡Œæ›´é«˜çº§ç½‘ç»œç¼–ç¨‹ï¼ˆå¦‚æ„å»ºHTTPæœåŠ¡å™¨ã€èŠå¤©ç¨‹åºç­‰ï¼‰çš„åŸºçŸ³ã€‚è®°ä½ï¼Œç½‘ç»œç¼–ç¨‹æ¶‰åŠè®¸å¤šç»†èŠ‚å’Œè¾¹ç•Œæƒ…å†µï¼Œå……åˆ†çš„æµ‹è¯•å’Œé”™è¯¯å¤„ç†è‡³å…³é‡è¦ã€‚