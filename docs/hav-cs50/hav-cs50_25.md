# 讲座 3

> 原文：[`cs50.harvard.edu/cybersecurity/notes/3/`](https://cs50.harvard.edu/cybersecurity/notes/3/)

+   保护软件

+   钓鱼攻击

+   代码注入

+   反射攻击

+   存储攻击

+   字符转义

+   HTTP 头部

+   SQL 注入

+   预处理语句

+   命令注入

+   开发者工具

+   服务器端验证

+   跨站请求伪造 (CSRF)

+   任意代码执行 (ACE)

+   开源软件

+   封闭源代码软件

+   应用商店

+   软件包管理器

+   漏洞赏金

+   识别漏洞

+   总结

## 保护软件

+   这是 CS50 的网络安全入门。

+   这周，让我们专注于保护你使用的软件或你创建的软件。

+   上次，我们介绍了各种攻击，攻击者可以使用这些攻击从你那里获取信息。

## 钓鱼攻击

+   我们介绍了一种称为 *钓鱼攻击* 的攻击，其中攻击者欺骗你提供某种信息。

+   例如，在网站的源代码中，在 HTML 语言中，你可能看到如下代码：

    [PRE0]

    注意，上面的代码中，一个段落开始并结束。它以一个开标签和一个闭标签开始。

+   类似地，网页中的链接使用一种称为 *锚点标签* 的特定类型的标签，将用户从一个网页带到另一个网页。

+   这样的代码看起来是这样的：

    [PRE1]

    注意，此代码是一个锚点标签，允许用户点击“哈佛”一词并访问 `harvard.edu`。

+   在实际的网页上，你可以将鼠标移到这样的链接上，并看到这个精确链接将带你去哪里。

+   攻击者可能会利用你注意力不集中的弱点，声称你正在链接到一个网页，而实际上你正在链接到另一个网页。

+   例如，攻击者可能提供如下代码：

    [PRE2]

    注意，此代码是一个锚点标签，它欺骗用户点击 `https://harvard.edu`，而实际上它浏览到的是 `yale.edu`。虽然用户会认为他们点击的是哈佛的链接，但实际上他们正在浏览耶鲁。

+   你可以想象这种策略如何被攻击者用来欺骗你，让你认为你正在访问一个网站，而实际上你正在访问另一个网站。

+   攻击者经常创建网站的假版本，目的就是为了欺骗用户在这些网站上输入敏感信息。例如，如果你是一名哈佛学生访问这样的假哈佛网站，你可能会尝试登录并提供你的用户名和密码给攻击者。

## 代码注入

+   *跨站脚本攻击*，或称 *XSS*，是一种攻击形式，其中网站被欺骗通过用户的输入运行恶意代码。

+   例如，在 Google 上，当你搜索“猫”这个术语时，注意这个术语如何在屏幕上的其他地方出现，显示这个搜索的结果数量。

+   想象一下，一个对网络略知一二的对手可能会将代码作为输入插入，以此来欺骗网站运行此类代码。

+   例如，考虑以下可能被插入搜索字段的代码：

    [PRE3]

    注意，此脚本显示了一个通知，说“攻击。”虽然由于安全原因，Google 网站不会显示此类通知，但这代表了对手可能尝试的事情。

+   如果网站盲目地复制用户输入并输出对手输入的内容，这将是一个重大的安全问题。

## 反射攻击

+   *反射攻击* 是一种利用网站接受输入的方式，欺骗用户的浏览器发送请求信息，从而导致攻击的攻击方式。

+   想象一下，一个用户可能会被欺骗点击一个结构如下链接：

    [PRE4]

    注意，此链接包含上面展示的精确脚本，该脚本旨在在用户的屏幕上创建攻击警报。

+   用户的操作会欺骗他们自己的网络浏览器反射回针对用户的攻击。

## 存储攻击

+   一个网站可能会受到攻击，被欺骗存储恶意代码。

+   想象一下，有人可能会通过电子邮件发送恶意代码。如果电子邮件提供商盲目接受发送给它的任何代码，接收恶意代码的任何人可能都会成为攻击的受害者。

## 字符转义

+   服务使用 *字符转义* 作为防止此类攻击的一种方式。软件应该转义可能引起麻烦的字符，这些字符代表常见的基于编码的字符。

+   例如，以下代码...

    [PRE5]

    将由安全软件输出...

    [PRE6]

    虽然有点晦涩，但请注意 `&lt;` 用于转义可能对软件构成威胁的潜在字符。上述输出的结果变成了恶意代码的纯文本表示。

+   常见的转义字符包括：

    +   `&lt;`，这是小于号，“<”

    +   `&gt;`，这是大于号，“>”

    +   `&amp;`，这是和号，“&”

    +   `&quot;`，这是双引号，“, 本身

    +   `&apos;`，这是单引号，“‘”

## HTTP 头部

+   回想一下，*HTTP 头部* 是提供给浏览器的一些附加指令。

+   考虑以下头部：

    [PRE7]

    注意，上述网站头部的安全策略仅允许通过单独的文件加载 JavaScript，通常以 `.js` 结尾。因此，当此安全策略生效时，HTML 中的 `<script>` 标签不会被浏览器运行。

+   同样，以下头部将只允许从 `.css` 文件加载 CSS：

    [PRE8]

    注意 `style-src` 指示仅允许从 `.css` 文件加载的 CSS。

## SQL 注入

+   *结构化查询语言* 或 *SQL* 是一种编程语言，允许从数据库中检索特定信息。

+   考虑攻击者可能如何尝试欺骗 SQL 执行恶意代码。

+   考虑以下 SQL 代码：

    [PRE9]

    注意，这里插入的用户输入的用户名被插入到 SQL 代码中。

+   永远不要信任用户的输入。

+   所有输入都应清理，以确保所有用户输入都被转义。

+   假设攻击者将以下代码插入到用户名字段中：

    [PRE10]

    注意，除了用户名外，还插入了恶意代码。

+   由于上述输入，结果是以下内容：

    [PRE11]

    注意，攻击者的恶意输入向查询中添加了额外的代码。结果是系统中的所有用户都被删除。系统上的每个账户都被删除。

+   假设用户被要求如下输入用户名和密码：

    [PRE12]

    注意用户被要求输入用户名和密码。

+   攻击者可能会将以下内容插入到密码字段中：

    [PRE13]

+   然后，以下 SQL 代码将执行：

    [PRE14]

    注意语法上，这会导致向数据库中的所有用户提供。

+   为了更清楚地看到这一点，注意下面添加了额外的括号：

    [PRE15]

    注意，此代码将显示所有用户名和密码组合为真的用户 `OR` 所有用户。

+   事实上，上述输入始终为真。通过这种安全漏洞，攻击者可能了解系统上所有用户的信息，包括管理员。

## 预处理语句

+   *预处理语句* 是预先设计的代码片段，可以正确处理许多数据库功能，包括用户输入。

+   这样的语句，例如，确保用户输入的数据被正确转义。

+   预处理语句将采用以下代码…

    [PRE16]

    并将其替换为…

    [PRE17]

+   预处理语句将查找任何 `'` 字符并将其替换为 `''`。因此，我们上面显示的先前攻击将通过预处理语句呈现：

    [PRE18]

    注意，在“malan”的末尾的 `'` 被替换为 `''`，使恶意代码无法运行。

+   结果是恶意字符被转义，使得恶意代码无法运行。

## 命令注入

+   *命令行界面* 是一种使用基于文本的命令来运行计算机系统的方法，与点击菜单和按钮相反。

+   *命令注入* 攻击是在底层系统本身发出命令。

+   如果从用户输入传递命令到命令行，可能会造成灾难性的后果。

+   两个常见的漏洞点是 `system` 和 `eval`，在这些地方，如果你未对用户输入进行清理，恶意命令可能会在系统上执行。

+   总是阅读文档以了解如何转义用户的输入。

## 开发者工具

+   让我们回到 HTML 和网络的世界。

+   在浏览器上下文中，*开发者工具* 允许你探索网页中的一些底层代码。

+   考虑我们可以使用开发者工具做什么。以下是文本框的代码：

    [PRE19]

    注意这创建了一种称为复选框的输入类型。此外，注意这个文本框已被禁用，无法通过`disabled`属性使用。

+   也许 HTML 安全性的一个挑战是 HTML 驻留在用户的电脑上。因此，用户可能能够更改他们电脑上的本地文件。

+   拥有通过开发者工具访问自己电脑上 HTML 的用户可以更改 HTML。

    [PRE20]

    注意这里 HTML 的本地副本已移除`disabled`属性。

+   你永远不应该只信任客户端验证。

+   类似地，考虑以下 HTML：

    [PRE21]

    注意这个文本输入是`required`。

+   可以访问开发者工具的人可以取消此输入的要求，如下所示：

    [PRE22]

    注意，已移除`required`属性。

+   再次强调，永远不要相信客户端验证将确保你的 Web 应用程序的安全性。

## 服务器端验证

+   *服务器端验证*提供安全功能，以确保用户输入是适当和安全的。

+   虽然这个主题超出了本课程的范围，但只需相信一个原则：用户输入应该在服务器端进行验证。永远不要信任用户输入。

## 跨站请求伪造 (CSRF)

+   另一个威胁被称为*跨站请求伪造*或*CSRF*。

+   网站使用两种主要方法与用户交互，称为`GET`和`POST`方法。

+   `GET`从服务器获取信息。

+   你可能会考虑亚马逊如何使用`GET`方法来处理以下 HTML：

    [PRE23]

    注意单击一下就可以购买这个产品。

+   你可以想象如何欺骗某人购买他们不打算购买的东西。

+   一个人可以提供一个自动尝试购买产品的图片：

    [PRE24]

    注意这里没有提供图片。相反，浏览器将尝试使用这个网页执行`GET`方法，可能进行未经授权或不需要的购买。

+   同样，对手可以使用`POST`方法进行未经授权的购买。

+   考虑以下“立即购买”按钮的 HTML 代码：

    [PRE25]

    注意一个网页表单，如上所述实现，可能会让人天真地认为自己是安全的，免受未经授权的购买。因为这个表单包含一个亚马逊用于验证的`hidden`值，从理论上讲，它可能会让程序员认为用户是安全的。

+   然而，正如许多漏洞的情况一样，这种安全感是错误的。

+   事实上，只需添加几行代码就可以颠覆上述情况。想象一下，一个对手在自己的网站上（不是亚马逊的）有以下代码：

    [PRE26]

    注意一个对手网站上的几行代码可以定位到一个表单并自动提交它。

+   这种欺骗用户在另一个网站上执行命令的能力是 CSRF（跨站请求伪造）的本质。

+   保护此类攻击的一种方法是在每个用户处由服务器生成一个秘密值的*CSRF 令牌*。因此，服务器将验证用户提交的 CSRF 令牌是否与服务器期望的令牌匹配。

+   这些令牌通常通过 HTML 头提交。

## 随意代码执行 (ACE)

+   *随意代码执行*，或 *ACE*，是在软件中执行不属于预期代码的行为。

+   其中一种威胁被称为 *缓冲区溢出*，其中软件被输入所淹没。这种输入溢出到内存的其他区域，导致程序故障。例如，软件可能期望输入短长度，但用户输入了大量长度的输入。

+   另一个类似的威胁被称为 *栈溢出*，其中溢出可以用来插入和执行恶意代码。

+   有时，这样的攻击可以用于 *破解* 或绕过注册或付费使用软件的需求。

+   此外，这些攻击可以用于 *逆向工程* 来查看代码的功能。

## 开源软件

+   绕过这种威胁的一种方法是通过使用和创建 *开源软件*。这种软件的代码可以轻松在线发布，任何人都可以查看。

+   可以审计代码，确保安全威胁更少。

+   这些软件仍然容易受到攻击。

## 封闭源代码软件

+   *封闭源代码软件* 是开源软件的对立面。

+   这种软件的代码对公众不可用，因此可能对对手的攻击更不脆弱。

+   然而，在开源软件（数千双眼睛在寻找软件中的漏洞）和封闭源代码软件（代码对公众隐藏）之间有一个权衡。

## 应用商店

+   *应用商店* 由谷歌和苹果等实体运营，他们监控提交的代码是否存在对抗意图。

+   当你只安装授权软件时，你比安装任何开发者提供的软件（不使用应用商店）要安全得多。

+   应用商店使用加密技术，只接受由授权开发者签名的软件或代码。反过来，应用商店使用数字签名来签名软件。因此，操作系统可以确保只安装了授权的、签名的软件。

## 软件包管理器

+   *软件包管理器* 采用类似的签名机制，以确保从第三方下载的内容是可信的。然而，并不能保证完全安全。

+   尽管如此，我们总是试图提高对手安装对抗性代码的门槛。

## 缺陷赏金

+   *缺陷赏金* 是个人发现并报告软件漏洞的付费机会。

+   这样的赏金可能会有效地影响潜在的对手，使他们选择为了发现漏洞而获得报酬，而不是作为攻击者部署它们。

## 识别漏洞

+   开发者可以检查 *常见漏洞和暴露* 或 *CVE* 编号数据库，以了解全球对手在做什么。

+   此外，他们可能会检查 *常见漏洞评分系统* 或 *CVSS*，以了解这种威胁的严重程度。

+   此外，还有一个 *漏洞预测评分系统* 或 *EPSS*，允许开发者看到全球漏洞的潜在风险，以便他们优先考虑他们的安全工作。

+   *已知的漏洞利用* 或 *KEV* 数据库是已知漏洞的列表。

## 总结

在本课中，你学习了如何确保软件的安全性。你学习了...

+   对手如何利用钓鱼、代码注入、反射攻击、SQL 注入和存储攻击等攻击手段渗透软件；

+   字符转义、HTML 头、预编译语句和服务器端验证如何帮助阻止对手的攻击；

+   应用商店、包管理器和开发者签名如何帮助防止恶意代码的安装；

+   网络安全领域的专家如何追踪漏洞利用。

次次见！
