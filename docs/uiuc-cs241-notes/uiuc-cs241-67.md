# 文件系统，第三部分：权限

## 提醒我权限再次是什么意思？

每个文件和目录都有一组 9 个权限位和一个类型字段

+   r，读取文件的权限

+   w，写入文件的权限

+   x，执行文件的权限

chmod 777

| chmod | 7 | 7 | 7 |
| --- | --- | --- | --- |
| 01 | 111 | 111 | 111 |
| d | rwx | rwx | rwx |
| 1 | 2 | 3 | 4 |

1.  文件类型

1.  所有者权限

1.  组权限

1.  其他人的权限

`mknod`更改第一个字段，文件的类型。`chmod`接受一个数字和一个文件，并更改权限位。

文件有一个所有者。如果您的进程具有与所有者相同的用户 ID（或 root），则第一个三元组中的权限适用于您。如果您与文件在同一组中（所有文件也属于一个组），则下一组权限位适用于您。如果以上都不适用，则最后一个三元组适用于您。

## 如何更改文件的权限？

使用`chmod`（简称“更改文件模式位”）

有一个系统调用，`int chmod(const char *path, mode_t mode);`但我们将集中在 shell 命令上。使用`chmod`的两种常见方法是使用八进制值或使用符号字符串：

```cpp
$ chmod 644 file1
$ chmod 755 file2
$ chmod 700 file3
$ chmod ugo-w file4
$ chmod o-rx file4 
```

基于 8（'八进制'）位数字描述了每个角色的权限：拥有文件的用户，组和其他人。八进制数是给三种权限的三个值的总和：读取（4），写入（2），执行（1）

示例：chmod 755 myfile

+   r + w + x = 数字

+   用户具有 4+2+1，完全权限

+   组具有 4+0+1，读取和执行权限

+   所有用户都有 4+0+1，读取和执行权限

## 如何从 ls 中读取权限字符串？

使用`ls -l'。请注意，权限将以'drwxrwxrwx'格式输出。第一个字符表示文件类型。第一个字符的可能值：

+   （-）常规文件

+   （d）目录

+   （c）字符设备文件\

+   （l）符号链接

+   （p）管道

+   （b）块设备

+   （s）套接字

## 什么是 sudo？

使用`sudo`成为机器上的管理员。例如通常（除非在'/etc/fstab'文件中明确指定，您需要 root 访问权限才能挂载文件系统）。`sudo`可用于临时以 root 身份运行命令（前提是用户具有 sudo 权限）

```cpp
$ sudo mount /dev/sda2 /stuff/mydisk
$ sudo adduser fred 
```

## 如何更改文件的所有权？

使用`chown 用户名文件名`

## 如何从代码中设置权限？

`chmod(const char *path, mode_t mode);`

## 为什么有些文件是'setuid'？这是什么意思？

在运行文件时，设置用户 ID 的位会更改与进程关联的用户。这通常用于需要以 root 身份运行但由非 root 用户执行的命令。一个例子是`sudo`

在执行时设置组 ID 会更改进程所在的组。

## 它们为什么有用？

最常见的用例是用户可以在程序运行期间具有 root（管理员）访问权限。

## sudo 以什么权限运行？

```cpp
$ ls -l /usr/bin/sudo
-r-s--x--x  1 root  wheel  327920 Oct 24 09:04 /usr/bin/sudo 
```

's'位表示执行和设置 uid；进程的有效用户 ID 将与父进程不同。在这个例子中，它将是 root

## getuid（）和 geteuid（）之间有什么区别？

+   `getuid`返回真实用户 ID（如果以 root 身份登录，则为零）

+   `geteuid`返回有效用户 ID（如果作为 root 运行，例如由于程序上设置了 setuid 标志，则为零）

## 如何确保只有特权用户可以运行我的代码？

+   通过调用`geteuid()`来检查用户的有效权限。返回值为零表示程序有效地作为 root 运行。

[转到文件系统：第四部分](https://github.com/angrave/SystemProgramming/wiki/File-System,-Part-4:-Working-with-directories)
