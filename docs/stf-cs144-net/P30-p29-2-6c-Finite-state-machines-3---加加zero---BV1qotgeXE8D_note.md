# 课程P30：有限状态机（三）🚀

在本节课中，我们将继续学习有限状态机，通过一个具体的TCP连接状态转换案例，来理解当程序调用`listen`、接收到`SYN`以及调用`close`时，状态是如何变化的。

---

## 状态转换案例分析 🔍

上一节我们介绍了有限状态机的基本概念。本节中，我们通过一个具体问题来观察状态机的运行过程。

第一个问题的答案是“在LISTEN状态”。我们来分析原因。

系统从**CLOSED**状态开始。当用户程序调用`listen()`函数时，系统状态转换为**LISTEN**状态。

随后，当socket接收到一个**SYN**（同步）数据包时，状态从**LISTEN**转换为**SYN_RECEIVED**状态。

在**SYN_RECEIVED**状态时，如果用户程序调用了`close()`函数，系统将沿着标有“close”事件的状态转移边进行转换。

---

## 核心步骤总结 📝

以下是上述过程的关键步骤总结：

1.  **初始状态**：**CLOSED**。
2.  **触发事件**：程序调用 `listen()`。
3.  **状态转换**：**CLOSED** → **LISTEN**。
4.  **触发事件**：Socket 接收到 **SYN** 包。
5.  **状态转换**：**LISTEN** → **SYN_RECEIVED**。
6.  **触发事件**：程序调用 `close()`。
7.  **状态转换**：从 **SYN_RECEIVED** 状态，根据“close”事件转移边进入下一个状态（通常是**CLOSED**或**TIME_WAIT**，取决于具体实现）。

---

本节课中，我们一起学习了TCP连接建立过程中一个典型的状态转换路径。我们看到了从**CLOSED**开始，经过**LISTEN**和**SYN_RECEIVED**状态，最终可能因`close`调用而结束的过程。理解这些状态和转换是掌握网络编程中socket行为的基础。