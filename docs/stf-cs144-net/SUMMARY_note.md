# 斯坦福 CS144 计算机网络教程 📚

在本教程中，我们将系统性地学习计算机网络的核心概念，从互联网基础、协议栈分层，到传输层、网络层、数据链路层以及网络安全等高级主题。课程内容基于斯坦福大学CS144课程，旨在为初学者构建清晰、完整的知识体系。

---

## 课程 1：互联网与IP协议 🌐

### 概述
在本节中，我们将学习互联网的基本概念和IP协议的基础知识，了解数据包如何在网络中传输。

### 1.0 互联网与IP简介
互联网是一个全球性的网络系统，连接了数十亿台设备。IP协议是互联网的核心，负责在不同设备之间寻址和路由数据包。

### 1.1 应用程序的一天
一个典型的网络应用程序，如网页浏览器，通过一系列网络交互获取数据。这个过程涉及多个协议层的协作。

### 1.2 四层互联网模型
为了简化网络设计，互联网协议栈被分为四层。以下是各层的功能：
*   **应用层**：处理特定应用程序的细节，如HTTP、FTP。
*   **传输层**：提供端到端的通信服务，如TCP、UDP。
*   **网络层**：负责将数据包从源主机路由到目标主机，主要协议是IP。
*   **链路层**：处理在单一链路上（如以太网）的数据帧传输。

### 1.3 IP服务模型
IP协议提供一种“尽力而为”的无连接数据包交付服务。它不保证数据包的顺序、可靠性或及时性。

### 1.4 数据包的一生
一个数据包从源主机出发，经过多个路由器的转发，最终到达目标主机。每个路由器根据IP地址决定数据包的下一跳。

### 1.5 分组交换原理
分组交换允许来自不同源的数据包共享同一条网络链路，从而提高资源利用率。数据被分割成较小的“包”进行传输。

### 1.6 分层原理
分层将复杂的网络问题分解为更小、更易管理的部分。每一层为其上层提供服务，并利用其下层的服务。

### 1.7 封装原理
当数据从上向下通过协议栈时，每一层都会在数据前添加自己的头部（有时还有尾部）。这个过程称为封装。
例如，一个HTTP消息会被封装在TCP段中，TCP段又被封装在IP数据报中，最后IP数据报被封装在以太网帧中。

### 1.8 字节序
计算机系统在内存中存储多字节数据时有两种方式：大端序和小端序。网络传输通常使用**大端序**（网络字节序）。
*   **大端序**：最高有效字节存储在最低内存地址。
*   **小端序**：最低有效字节存储在最低内存地址。

### 1.9 IPv4地址
IPv4地址是一个32位的数字，用于唯一标识网络中的设备。它通常以点分十进制表示，如 `192.168.1.1`。
一个IPv4地址包含网络部分和主机部分，子网掩码用于区分这两部分。

### 1.10 最长前缀匹配
当路由器转发IP数据包时，它会在路由表中查找与目标IP地址最匹配的表项。匹配规则是选择具有最长网络前缀（即最具体）的路由。

### 1.11 地址解析协议
ARP用于在本地网络中，根据已知的IP地址查找对应的MAC地址。其工作原理是通过广播ARP请求并等待目标主机回复。

### 1.12 互联网与IP回顾
本节我们介绍了互联网的基础架构、IP协议的服务模型、数据包的旅程、协议分层与封装、网络寻址以及本地地址解析。

---

## 课程 2：传输层 🚚

### 概述
上一节我们介绍了网络层如何将数据包送达目标主机。本节中，我们来看看传输层如何为运行在主机上的应用程序提供通信服务。

### 2.0 传输层简介
传输层位于网络层之上，负责提供应用程序之间的逻辑通信信道。

### 2.1 TCP服务模型
TCP提供可靠的、面向连接的、基于字节流的服务。它确保数据按序、无差错地交付，并提供流量控制和拥塞控制。

### 2.2 UDP服务模型
UDP提供不可靠的、无连接的数据报服务。它简单高效，但不保证交付、顺序或防止重复。

### 2.3 ICMP服务模型
ICMP是网络层的辅助协议，用于传递控制信息和错误报告，例如“目的不可达”或“回显请求/应答”。

### 2.4 端到端原则
该原则指出，某些功能（如可靠传输）最好在通信的端点（即应用程序）实现，而不是在网络的中间节点（如路由器）强制实现。

### 2.5 差错检测
传输层使用校验和等机制来检测数据在传输过程中是否发生错误。例如，TCP和UDP头部都包含校验和字段。

### 2.6 有限状态机
TCP连接的管理可以通过有限状态机来建模，它描述了连接在不同事件（如收到SYN包）下的状态转换。

### 2.7 停等协议
一种简单的可靠传输协议。发送方每发送一个数据包后，必须等待接收方的确认，才能发送下一个包。效率较低。

### 2.8 滑动窗口协议
为了提高效率，滑动窗口协议允许发送方在未收到确认的情况下，连续发送多个数据包。窗口大小决定了可以发送的未确认包的数量。

### 2.9 可靠通信——重传策略
当数据包丢失或损坏时，需要重传。常见的策略有：
*   **回退N帧**：从出错的包开始重传所有后续包。
*   **选择重传**：只重传具体出错的包。

### 2.10 可靠通信——TCP头部
TCP头部包含实现可靠传输的关键字段，以下是部分核心字段：
```
源端口 (16位) | 目的端口 (16位)
序列号 (32位)
确认号 (32位)
数据偏移 | 保留 | 标志位 | 窗口大小 (16位)
校验和 (16位) | 紧急指针 (16位)
选项 (可选)
```
其中，**序列号**和**确认号**用于实现可靠性和顺序性。

### 2.11 可靠通信——连接建立与拆除
TCP使用三次握手建立连接，使用四次挥手拆除连接，以确保双方同步状态。

### 2.12 传输层回顾
本节我们学习了TCP和UDP的核心服务模型，探讨了实现可靠传输的机制，包括差错检测、滑动窗口、重传策略以及TCP连接的生命周期管理。

---

## 课程 3：分组交换 📦

### 概述
在了解了端到端的传输服务后，我们需要深入网络内部。本节将探讨数据包在网络中是如何被交换和转发的，以及相关的排队与延迟问题。

### 3.0 分组交换简介
分组交换是现代计算机网络的基础，它允许数据包动态地共享网络路径。

### 3.1 网络与互联网历史
了解分组交换和互联网的发展历史，有助于理解其设计原则和现状。

### 3.2 分组交换原理——什么是分组交换
分组交换将消息分割成带有地址信息的数据包，每个包独立地在网络中路由，到达目的地后再重新组装。

### 3.3 分组交换原理——术语：端到端延迟与排队延迟
数据包从源到目的的总时间称为端到端延迟。它由以下几部分构成：
*   **处理延迟**
*   **排队延迟**
*   **传输延迟**
*   **传播延迟**

### 3.4 分组交换原理——播放缓冲区
流媒体等应用使用播放缓冲区来抵消网络延迟和抖动带来的影响，确保平滑播放。

### 3.5 分组交换原理——简单确定性队列模型
该模型用于分析数据包在路由器缓冲区中的排队行为。当到达速率超过输出链路的服务速率时，就会产生队列。

### 3.6 分组交换原理——队列模型特性
队列的特性包括平均队列长度、平均等待时间以及丢包概率。这些特性受流量强度和到达过程的影响。

### 3.7 分组交换实践——交换与转发 (1)
网络设备（如交换机、路由器）根据转发表将数据包从输入端口移动到正确的输出端口。

### 3.8 分组交换实践——交换与转发 (2)
转发决策可以基于数据链路层地址（如交换机）或网络层地址（如路由器）。

### 3.9 分组交换原理——速率保证
某些网络服务需要保证最小带宽。这可以通过流量整形、调度算法（如加权公平队列）来实现。

### 3.10 分组交换原理——延迟保证
对延迟敏感的应用（如语音）需要延迟上限保证。这通常需要复杂的资源预留和调度机制。

### 3.11 分组交换回顾
本节我们探讨了分组交换的核心思想，分析了数据包在网络节点中经历的延迟构成，并简要介绍了为特定流量提供服务质量保证的基本概念。

---

## 课程 4：拥塞控制 🚦

### 概述
当网络中的流量需求超过其承载能力时，就会发生拥塞。本节我们将学习TCP如何通过拥塞控制机制来避免网络过载并公平分享带宽。

### 4.0 拥塞控制简介
拥塞控制是TCP协议的关键组成部分，旨在动态调整发送速率以适应网络状况。

### 4.1 拥塞控制基础
拥塞表现为数据包延迟增加、丢失率上升。TCP通过感知丢包（作为拥塞信号）来调整其发送窗口。

### 4.2 拥塞控制基础 2
拥塞控制的目标是：**效率**（充分利用带宽）、**公平性**（多个流平等分享带宽）和**收敛性**（快速达到稳定状态）。

### 4.3 拥塞控制——单AIMD流动态
AIMD是TCP拥塞控制的核心算法：
*   **加性增**：每个RTT无丢包时，拥塞窗口`cwnd`增加1个MSS。
    `cwnd = cwnd + MSS * (MSS / cwnd)` （近似于每RTT增加1MSS）
*   **乘性减**：检测到丢包时，`cwnd`减半。
    `cwnd = cwnd / 2`

### 4.4 AIMD多流动态
当多个TCP流共享同一瓶颈链路时，AIMD算法能使它们最终收敛到公平分享带宽的状态。

### 4.5 TCP Tahoe
TCP Tahoe是早期的拥塞控制实现，包含慢启动、拥塞避免、快速重传等基本机制。

### 4.6 TCP RTT估计
TCP通过测量样本RTT并计算加权平均来估计往返时间，这对于设置重传超时至关重要。
`EstimatedRTT = (1 - α) * EstimatedRTT + α * SampleRTT` （通常α=0.125）

### 4.7 拥塞控制——TCP Reno与New Reno
TCP Reno在Tahoe基础上增加了快速恢复机制，在发生单个丢包时能避免退出拥塞避免阶段，提升性能。New Reno进一步改进了对多个丢包的处理。

### 4.8 拥塞控制——AIMD
我们再次审视AIMD，理解其数学特性如何自然地导向效率和公平。

### 4.9 技能——阅读RFC
RFC是定义互联网标准的官方文档。学习如何阅读RFC是理解协议细节的重要技能。

### 4.11 拥塞控制回顾
本节我们深入学习了TCP拥塞控制的工作原理，从基础的AIMD算法到具体的Tahoe、Reno实现，理解了TCP如何通过调整发送窗口来响应网络拥塞。

---

## 课程 5：应用层与NAT 🖥️

### 概述
网络存在的最终目的是服务于应用。本节我们将了解常见的应用层协议（如HTTP、DNS）以及网络地址转换如何影响应用通信。

### 5.0 应用与NAT简介
应用层协议定义了应用程序之间交换报文的格式和规则。NAT则是一种广泛使用的技术，用于缓解IPv4地址短缺问题。

### 5.1 NAT简介
NAT设备位于私有网络和公共互联网之间，将内部私有IP地址转换为公共IP地址，使多台设备可以共享一个公网IP上网。

### 5.2 NAT类型
根据映射和行为的不同，NAT主要分为以下几类：
*   **完全锥型NAT**
*   **受限锥型NAT**
*   **端口受限锥型NAT**
*   **对称型NAT**

### 5.3 NAT的影响
NAT破坏了互联网的端到端原则，可能阻碍某些对等连接应用（如P2P、IP语音）的正常工作。

### 5.4 NAT操作
NAT维护一个转换表，记录内部（私有IP:端口）到外部（公有IP:端口）的映射关系。

### 5.5 HTTP
HTTP是万维网的数据通信基础。它是一个无状态的请求/响应协议。
一个简单的HTTP GET请求如下：
```
GET /index.html HTTP/1.1
Host: www.example.com
```

### 5.6 HTTP/1.1持久连接
HTTP/1.1默认使用持久连接，允许在单个TCP连接上发送多个请求和响应，减少了建立连接的开销。

### 5.7 BitTorrent
BitTorrent是一种流行的P2P文件共享协议，它将文件分片，下载者同时也在为其他下载者上传已获得的片段，从而分散服务器压力。

### 5.8 DNS (域名系统)
DNS将人类可读的域名（如`www.stanford.edu`）转换为机器可读的IP地址。它是一个分布式的层级数据库系统。

### 5.11 DHCP
DHCP用于为网络中的主机自动分配IP地址、子网掩码、默认网关等配置信息，简化了网络管理。

### 5.12 应用与NAT回顾
本节我们学习了关键的应用层协议如何工作，并探讨了NAT技术的工作原理及其对网络应用架构带来的挑战和影响。

---

## 课程 6：路由 🗺️

### 概述
数据包能够穿越复杂的互联网到达目的地，依赖于高效的路由算法和协议。本节我们将学习网络内部和网络之间是如何决定数据包转发路径的。

### 6.0 路由简介
路由是指导数据包从源网络传输到目的网络的过程，由路由器根据路由表执行。

### 6.1 路由——洪泛、源路由与生成树
早期或特殊的路由方法包括：
*   **洪泛**：向所有端口转发，简单但浪费带宽。
*   **源路由**：由发送方指定完整路径。
*   **生成树**：用于在交换网络中避免环路，确保任意两点间只有一条活动路径。

### 6.2 路由——贝尔曼-福特算法
一种分布式动态规划算法，每个节点基于邻居节点的信息迭代计算到所有目的地的最短路径。适用于距离矢量路由协议。

### 6.3 路由——迪杰斯特拉算法
一种集中式贪心算法，计算从一个源节点到网络中所有其他节点的最短路径。适用于链路状态路由协议。

### 6.4 路由——互联网 (RIP, OSPF) 与自治系统
互联网被划分为多个自治系统。AS内部使用内部网关协议，如RIP（基于距离矢量）或OSPF（基于链路状态）。

### 6.5 路由——BGP
BGP是用于在AS之间交换路由信息的外部网关协议。它基于路径矢量算法，决策过程不仅考虑距离，还考虑策略（如AS路径、来源）。

### 6.6 路由——组播
组播允许将数据包一次性高效地发送给一组接收者，适用于视频会议、内容分发等场景。

### 6.7 路由——生成树协议
STP及其演进版本用于在以太网等二层网络中防止广播风暴，通过阻塞冗余链路来构建一个无环的树状拓扑。

### 6.8 IPv6
IPv6是下一代IP协议，主要解决IPv4地址耗尽问题。它提供巨大的地址空间、简化的报头格式以及更好的安全性和扩展性支持。

### 6.9 路由回顾
本节我们学习了从基础算法到实际协议的路由知识，涵盖了AS内部和AS之间的路由，并展望了IPv6的未来。

---

## 课程 7：底层网络 🔌

### 概述
网络协议栈的底部是物理层和链路层，它们负责在直接的物理链路上传输原始比特。本节我们将探索信号、错误处理以及共享介质访问等底层原理。

### 7.0 底层简介
物理层处理电信号、光信号等物理介质的传输。链路层负责在直接相连的节点之间可靠地传输数据帧。

### 7.1 物理与链路原理——香农容量与调制
香农定理给出了信道在存在噪声情况下的最大理论传输速率：
`C = B * log2(1 + S/N)`
其中，`C`是信道容量，`B`是带宽，`S/N`是信噪比。调制技术将数字比特映射到模拟信号波形上进行传输。

### 7.2 物理与链路原理——比特错误
由于噪声和干扰，传输过程中可能发生比特错误。误码率是衡量链路质量的重要指标。

### 7.3 物理与链路原理——时钟
发送方和接收方需要时钟同步，以便接收方能准确地在正确的时间点对信号进行采样，识别比特。

### 7.4 物理与链路原理——前向纠错与里德-所罗门码
FEC通过在数据中添加冗余纠错码，使得接收方能够检测并纠正一定数量的错误，而无需重传。里德-所罗门码是一种强大的FEC编码。

### 7.5 物理与链路原理——MAC与CSMA/CD
MAC协议解决多个设备如何共享同一传输介质的问题。CSMA/CD用于传统以太网：先监听，如果信道空闲则发送，如果冲突则回退重试。

### 7.6 物理与链路实践——以太网
以太网是最常见的局域网技术。它定义了帧格式、MAC地址以及CSMA/CD（对于半双工）等标准。

### 7.7 无线网络——其不同之处
无线信道具有广播性、衰减大、干扰多、隐藏终端/暴露终端等特点，使得其MAC协议设计比有线网络更复杂。

### 7.8 无线网络原理——MAC
无线网络需要专门的MAC协议来管理对共享无线信道的访问。

### 7.9 无线网络原理——CSMA/CA
载波侦听多路访问/冲突避免是Wi-Fi等无线网络的基础。由于难以检测冲突，它采用ACK确认和随机退避来避免冲突。

### 7.10 无线网络原理——RTS/CTS
请求发送/清除发送机制用于解决隐藏终端问题。通过短控制帧预约信道，减少数据帧冲突的概率。

### 7.11 无线网络原理——