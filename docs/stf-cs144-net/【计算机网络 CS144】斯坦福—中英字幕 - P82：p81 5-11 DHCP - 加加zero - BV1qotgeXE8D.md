# 【计算机网络 CS144】斯坦福—中英字幕 - P82：p81 5-11 DHCP - 加加zero - BV1qotgeXE8D

![](img/160efb60227ee6a9dfdeed586ed5ad3a_0.png)

所以，在这个关于名字和地址的视频中，我要谈谈动态主机配置协议或dhcp，这可能是你每天访问互联网时都会使用的东西，所以，如果你后退一步，思考我们需要与什么通信，IP与互联网协议，基本上。

主机需要三种东西，它首先需要一个IP地址，它需要一个你可以给其他节点以发送数据包的地址，以及你可以将其自己的数据包发送的地址，这些节点，节点可以发送回给它的，它需要一个子网掩码。

所以它需要了解哪些节点属于其本地子网，相对于其他节点，它必须，嗯，通过本地网关进行通信，它还需要知道网关路由器，这样，如果通知不在本地子网中，下一个跳点的IP地址是什么。

或者是向外部子网目的地的第一个跳点，所以，这些都是你需要的，以在互联网上作为整体的IP进行通信，此外，通常，有一个第四个东西非常有用，那就是域名系统服务器的IP地址或域名系统服务器，嗯。

这基本上允许你将像www这样的域名，Cnn，嗯，点com转换为IP地址，所以你不需要这个本身来与IP通信，如果你只知道IP地址，但是对大多数应用来说，以及对人来说，非常有用，所以它是一个基本问题。

你买一台新的电脑，并将其插入网络，你需要这三个东西，以及希望有这个第四个东西，你怎么得到这些，你怎么得到这些值，在旧时，就像实际上当我，嗯，我的第一年在大学，嗯，你会从系统管理员那里得到它们。

所以你会填写一个网络请求表，然后几天后你会得到一张纸条，嗯，上面有你的重要值，它包含了你的IP地址和你的子网掩码，它包含了你的网关地址，并且它包含了DNS服务器地址，所以你会得到一张纸。

上面写着这四件事，并且一张通常的复印件写着嗯，好的，拿这些值，这就是你怎么打开控制面板，然后在这里输入它们的方法，那就是基本上嗯，你怎么配置你机器的方法，所以这就是我如何让食物变棕色的。

当我在1995年以研究生的身份去的那里时，嗯，到我毕业时，虽然，嗯，他们离开了，所以如果你想象一下，这可以工作，嗯，但是所有的问题都来了，嗯，如果你的机器像，如果我把我的机器搬到朋友的那里，嗯。

朋友的房间，它就不再工作了，因为那台特定的机器是为那个特定的网络拓扑中的某个插座配置的，所以问题是这个问题能持续多久，所以回到，然后嗯，当你填写纸条时，它持续了一年，实际上。

如果在一年内某个特定的时间点你没有要求它，你就无法得到它，所以这些地址和配置每年都会发放，最后一个问题是，你们如何收集未使用的条目，所以如果我只想要一台机器，你为我的机器插电三天。

这是否意味着我必须为整个一年分配一个条目，答案是肯定的，因此，尽管这起作用，但它极其效率低下，所以，今天计算机使用的方法，这就是青铜开始使用的方法，在我毕业时，整个校园被称为dhcp的东西。

动态主机配置协议，规范在rfc二十一三十一中，基本上，当一个机器连接到网络时，它可以从dhcp服务器请求其配置，嗯，如果可以的话，只需请求您的配置，告诉我我的IP地址，我的子网掩码是什么。

我的网关是什么，我的DNS服务器是什么，这解决了我列出的三大主要问题，如果您移动得当，您只需重新请求，您位于网络的不同部分，您需要一段时间的特定配置，它持续多久，当DHCP服务器给您分配配置时。

它与最少关联，意味着这个配置对于这个时间段来说是好的，然后如果您接近租赁期的结束，您可以重新请求相同的配置，通常服务器会给您，所以有方法可以续租租赁期，这些租赁期，然后使垃圾收集变得极其容易。

因为如果有人没有重新请求，您可以回收，说那个IP地址，所以基本的交互，您在DHCP中看到的基本数据包交换是，有一个基本的四步交换，然后有这个可选的释放，嗯，所以当一个节点首次加入网络时，并且它一无所知。

它会发送一个发现消息，我想要发现哪些DHCP服务器在外面，以及他们可能提供给您的配置，所以客户端发送一个发现，然后DNS，抱歉，能够听到那个发现的DHCP服务器，回应一个提议，所以这里是服务器。

并且可以连接多个服务器，您可能会收到多个提议，他们会说这里，我将提供这个配置，然后客户端选择其中一个配置，并向起源的DHCP服务器发送请求，说好，我想要请求您向我提供的配置，然后服务器因为确认。

说我已确认您可以获得那个配置，这个配置在其租赁期无效，嗯，并且，如果客户想要，它可以提前释放它，或者如果租赁期开始接近结束，它会重新请求，所以请求机制既在响应也在提供，但也是续租租赁期的一种方式。

所以让我们先以客户和两个服务器为例，客户连接到网络并发送一个DHCP发现消息作为广播，这是一个广播，服务器A和服务器B都在这里，这个消息必须有两个DHCP服务器，嗯，那些可以听到发现广播的服务器。

假设两者都回应了不同配置的报价，所以这里有报价b和报价a，客户，嗯，看到这两个报价，决定它想要报价b，所以它然后发送一个请求说，我想要请求您提供的配置，服务器B可以然后确认并说，好的，你已经有了。

服务器A没有听到报价的请求，所以到某个时候，这个报价就会超时现在，客户A已经配置，它有一个IP地址，它有所有必要的通信工具，嗯，如果这个报价的租赁期，嗯，即将结束，它可以重新请求，并说，收到确认。

它会这样做，你当然知道，在租赁期到期之前，所以租赁期已经被延长，然后它也可以可选择发送被称为释放的消息，并说，哦，实际上，我已经完成这个了，在实际操作中，客户往往不这样做，他们只是让租赁期到期。

但你有时在控制面板中看到它，你可以说释放，我会在这给你展示一个Mac上的例子，所以这将是一个基本的DHCP序列或消息交换，所以我说你发送这些消息，这些消息的样子看起来是什么问题。

这里是你试图启动ip地址，你在没有ip信息的情况下试图获取起始ip配置，所以它工作的方式是，客户端向端口六十七发送udp包，这是来自端口六十八的dhcp端口，它发送这些包。

它不知道hcp服务器的ip地址，所以它将它们发送到广播ip地址，并且也使它们来自广播ip地址，由于它没有IP地址，我在DC服务器歪曲不在精确同一链路的情况下的案例中，你可以有中继器将它们转发到链路之间。

而且大多数交换机等设备实际上只会将广播包转发到它们所有的，所有端口，所以，你是如何启动这个的，这是通过使用特殊的IP地址使用UDP包进行通信的，然后，一旦一个节点接收到，嗯。

它的配置现在就会以自己的IP地址启动，因此，这就是我们看到的消息交换，所以你从我的imac开始，发送一个dohp，我们发现它发送这个，所以这是我的源以太网地址，零四五十四五十三十七十八e四。

它发送到以太网广播地址，所以是全一的，源地址是零零零，源ip地址，目的地ip地址是二五五二五五二五五二五五二五五，你可以看到它正从源UDP端口发送，端口868发送到站端口67，你可以查看这消息的内部。

是的，这基本上就是DC到基本的，嗯，DHCP，嗯，发现消息发送一次，没有听到任何东西，所以它第二秒后重试，听不到任何声音，然后两秒半后重新尝试，然后它听到了两个报价，嗯。

这可能是对这两个不同的发现的响应，嗯，谁知道你可以说相同的交易ID，所以第一个报价是从十三十三零二发送到IP地址十三十三，点一点九四，第二个是十三十三三，不想要一百八十八，但是如果你查看以太网帧的内部。

这些是从某些设备发送的，并且它们被发送到我的以太网地址，所以这些是在我发现后发送的提议，你也可以通过交易ID来告诉，所以这是为了这个IP地址而目的地的，因为我的节点知道它没有IP地址，这变成了事实。

信息和所以这里是回复，这个提议，并且这里有所有这些配置，信息基本上在这里说，我向你提供一个IP地址为10。33。1。94，在这里映射为10。33。1。94，在第二个中，也是一样的，你会看到它为10。

333提供，嗯，3。188，所以你有两个不同的IP地址，你知道我想要什么吗，结果，这个消息中包含了各种选项，它还将告诉我子网掩码，255。255。255。48，它还将告诉我路由器的地址10。33。0。

1，它还将告诉我域名服务器，它将告诉我我的域名服务器，这里有三个服务器，我可以使用其中一个，71，六十四七五五五一二一和九十九，所以它要告诉你一个域名，哦，你在斯坦福edu。

所以这些提议包含所有这些信息，我可以用它来配置我的主机当它启动时，然后对这些提议的响应中，嗯，我设备发送一个dhcp请求，所以现在它正在发送，这里是为我的地址发送广播，地址发送，它广播其请求，嗯。

如果我们看看哪个，IP地址，它选择了对吗，所以这里有所有这个信息，所有这些标志选项，所以参数请求列表，所以我正在请求一个特定的子网掩码路由器，嗯，一个特定的子网询问一个特定的路由器，域名服务器。

等等等等，你可以在这里看到，我的节点最终请求了第一个报价，所以十三点三三一九四，嗯，而且它也最终请求了嗯，一个主机名，菲利普斯ima，所以，它说嘿，我想回应请求，我想请求报价，嗯。

你对十到三十三一九四的报价，九九九四，然后dhcp服务器嗯，确认了这个以及所有，让我们看看我的配置是什么，那就是我们实际上看到的，所以我的ip地址是十到三十三，点一九四。

我的子网掩码是二五五二五五二四八零，我的顺序是十到三三零一，如果你去检查。

![](img/160efb60227ee6a9dfdeed586ed5ad3a_2.png)

![](img/160efb60227ee6a9dfdeed586ed5ad3a_3.png)