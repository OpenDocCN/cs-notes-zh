# 课程 P84：路由基础 🧭

在本节课中，我们将学习计算机网络中一个核心概念：路由。我们将探讨数据包如何通过像互联网这样的大型网络，从源点传输到目的地，并了解构建路由表的关键算法。

---

## 概述

我们已经在前面的课程中多次假设，数据包能够从互联网的一端送达另一端。本节我们将深入探讨实现这一目标的具体机制和方法，即数据包如何被转发和路由通过互联网。

---

## 源路由的设想

一个最直接的思路是：让每个数据包自身携带它需要经过的所有路由器列表。这样，数据包就能根据内部包含的路径信息在网络中找到自己的路。

**核心概念示例（伪代码）**：
```
数据包结构 {
    载荷数据;
    路径列表: [路由器A, 路由器B, ..., 路由器Z];
}
```

然而，这种方法被称为**源路由**。它被认为是低效的，并可能带来安全风险。因此，互联网并未采用这种方式。

---

## 互联网的实际方法：转发表

上一节我们介绍了源路由的设想，本节中我们来看看互联网实际采用的方法。互联网使用**转发表**。每个路由器都维护一个转发表，它告诉路由器：对于每一个目标网络地址（通常表示为前缀），应该将数据包发送到哪一个“下一跳”路由器。

因此，关键问题转变为：如何生成和填充这些转发表中的数据？

---

## 构建路由表：分布式算法

为了实现转发表的自动填充，我们使用算法。这些算法以**分布式**的方式运行，使得各个路由器能够自行计算出应放入转发表中的条目。

基本方法是：路由器共同协作，为网络构建一个**生成树**。生成树是一种没有环路的树形结构，它覆盖网络中的所有节点。树的根在目的地，叶子是所有可能的源点。这样，任何源点都可以沿着树的结构将消息发送到那个目的地。

以下是构建这种树状结构的两种广为人知的算法：

1.  **贝尔曼-福特算法**（又称**距离向量算法**）：在即将到来的视频中，你将看到它为何得名。
2.  **迪杰斯特拉算法**（又称**最短路径优先算法**或**链路状态算法**）：这是目前更广泛使用的替代方法。

我们将在后续视频中详细描述这两种算法。

---

## 互联网的层次结构：自治系统

我们还将看到这些算法如何在今天的互联网上实际使用。首先，互联网是许多不同网络的集合，每个网络都有自己的管理域，称为**自治系统**。

例如，斯坦福大学是一个自治系统（实际上它包含多个）。大型互联网服务提供商也可能拥有多个自治系统。自治系统有不同的类型，例如，像斯坦福这样的网络通常不负责在互联网核心中转发电信流量，它扮演着“边缘”或“存根”的角色。

在自治系统**内部**，主要使用两种路由协议：

*   **RIP**：一种距离向量协议。
*   **OSPF**：一种链路状态协议。目前，几乎所有人都使用OSPF来定义其自治系统内部的路由表。

然而，在自治系统**之间**，路由使用不同的协议：**BGP**（边界网关协议）。因为自治系统并不总是愿意完全暴露其内部网络结构，所以BGP增加了一些额外机制（例如记录数据包可能经过的路径），允许自治系统在隐藏内部细节的同时，提供足够信息让路由器选择路径。

---

## 总结

本节课中，我们一起学习了路由的基础概念。我们从简单的源路由设想开始，了解了互联网实际依赖的转发表机制。我们探讨了用于填充转发表的两种核心分布式算法（距离向量和链路状态），并认识了互联网的层次化结构——由自治系统构成，其内部和之间使用不同的路由协议（如OSPF和BGP）。至此，你应该对数据包穿越网络的不同策略有了初步的理解。