# 【计算机网络 CS144】斯坦福—中英字幕 - P83：p82 5-12 Applications and NATs (recap) - 加加zero - BV1qotgeXE8D

在这一单元中，你将学习到当今互联网上的一些主要应用，以及nats或网络地址翻译器如何使它们复杂化，现在，你购买的新网通常表现得相当良好，但是，仍然有许多旧的mat在外面，它们有一些麻烦或困难的行为。



![](img/87fe47c23f8fb919f765947d74a8b6d0_1.png)

让我们从这一单元开始讨论nats，你将学习到网络地址翻译器的是什么以及它如何工作，它是一台路由器，允许许多设备共享一个ip地址，它这样做是通过重新编写通过它的数据包。



![](img/87fe47c23f8fb919f765947d74a8b6d0_3.png)

并且该设备有一个外部地址，用于与外部世界通信，这是一个可以公开路由的IP地址，它管理一组或一个私有内部地址的子网。



![](img/87fe47c23f8fb919f765947d74a8b6d0_5.png)

例如，所有以十开头的IP地址，或所有以1开头的IP地址，九十二点一六十八，然后该设备将一个私有地址分配给自己，例如，一九二点。



![](img/87fe47c23f8fb919f765947d74a8b6d0_7.png)

一，六十八点零一，零点一零，然后，将剩余的地址分配给内部网络的设备，如果你有一个家庭无线路由器，它可能也充当网络设备，使用一九二点一，六十八点零的i p子网，G，四个地址，你学习到。

当内部网络中的nat路由一个包到外部互联网时。

![](img/87fe47c23f8fb919f765947d74a8b6d0_9.png)

它会修改包头，以便它看起来像包是从nat的单个外部ip地址来的。

![](img/87fe47c23f8fb919f765947d74a8b6d0_11.png)

这实际上是将来自不同内部地址的包。

![](img/87fe47c23f8fb919f765947d74a8b6d0_13.png)

以同一个外部ip地址打包，以便此工作正常进行，它需要一种方式来区分流入相反方向的回复包。

![](img/87fe47c23f8fb919f765947d74a8b6d0_15.png)

以便它可以正确地将它们转发给正确的内部设备。

![](img/87fe47c23f8fb919f765947d74a8b6d0_17.png)

nat设备通过修改传输端口号来实现这一点，以编码来自哪个内部设备。

![](img/87fe47c23f8fb919f765947d74a8b6d0_19.png)

传输流来自，这意味着nat知道传输层头并修改它们。

![](img/87fe47c23f8fb919f765947d74a8b6d0_21.png)

当外部互联网的包到达时，它检查传输法院号是否匹配到一个内部设备的映射，如果匹配，它修改它并转发到内部网络，因为那台设备通常只创建从内部IP地址到外部端口号的映射，当包流向外部世界时。

它对来自外部世界的包不知道做什么，试图达到内部设备的包，对于某些，这是安全的好处，默认，你只能创建向外的连接，保护你的内部设备免受来自外部世界的攻击，但对于其他人，这是一件麻烦事。

因为你无法从外部世界向内部发起新的tcp连接，网络会将tcp包丢弃。

![](img/87fe47c23f8fb919f765947d74a8b6d0_23.png)

有各种各样的nap设计，并且有许多方法将ip地址映射到向外的端口号，我们在这个单元中看到了一些，每个都有其自己的复杂性，普遍的共识是，简单的，限制较少的数学映射更好，因为它们给人一种端到端的连接性外观。



![](img/87fe47c23f8fb919f765947d74a8b6d0_25.png)

你还学习了一些人们用来绕过这些问题的技术，比如NAT打洞和同时打开。

![](img/87fe47c23f8fb919f765947d74a8b6d0_27.png)

但这一单元的主要收获是NAT，使它在互联网上部署应用程序变得困难。

![](img/87fe47c23f8fb919f765947d74a8b6d0_29.png)

那些需要外部世界设置TCP连接到NAT后面的设备的应用程序，并且部署新的传输协议困难，因为网络设备不知道如何处理它们。



![](img/87fe47c23f8fb919f765947d74a8b6d0_31.png)

总的来说，当人们创建新的传输协议时。

![](img/87fe47c23f8fb919f765947d74a8b6d0_33.png)

他们或伪装为tcp，或运行在udp之上，你学习了域名系统，使用udp的应用程序。

![](img/87fe47c23f8fb919f765947d74a8b6d0_35.png)

一方面，它是关键基础设施，没有它，互联网将大大减少其实用性，另一方面，它只是一个应用程序，你学习到域名系统的基本思想是，你可以有层次化的名称。



![](img/87fe47c23f8fb919f765947d74a8b6d0_37.png)

例如，斯坦福，教育，指向被称为记录的不同种类的信息，例如，你可以问i的地址是什么，P，V，www的四个地址，斯坦福，Edu是，你可以问斯坦福的名称服务器是什么，Edu是，你可以问cs。dot。

stanford的邮件服务器是什么，Edu是，你学习到域名系统通过服务器的层次结构工作。

![](img/87fe47c23f8fb919f765947d74a8b6d0_39.png)

例如，要找到www的地址，stanford。edu，你先问根服务器，你可以在哪里找到关于edu的信息，然后问edu，你可以在哪里找到关于stanford的信息，然后最后向斯坦福询问www的地址。

stanford。edu，这些记录中的每一条，地址记录，以及在每个步骤中的名称服务器记录可以经常缓存很长时间，以减少负载，为了使缓存工作得更好，经常，许多客户端共享解析器，那样为你查询域名系统的计算机。

它可以缓存所有这些结果并分享它们给客户端，那样，斯坦福只需要对谷歌进行一次查找。

![](img/87fe47c23f8fb919f765947d74a8b6d0_41.png)

只要记录存在，而不是让每个笔记本电脑联系谷歌的dns服务器。

![](img/87fe47c23f8fb919f765947d74a8b6d0_43.png)

服务器，http是超文本传输协议，它运行在tcp上，我们一直在使用相同的http版本，那就是版本1。1，现在已经用了将近二十年了，基本上它没有变化，你学到http是一个请求响应协议。

请求和响应都是ASCII文本，这对它有用，因为它很容易阅读，你学到http1。1的一个重大改进是与称为，HTTP/1。0中的保持连接，每个请求都在单独的tcp连接上进行，所以。

要下载包含40个资源的页面，你的客户端必须打开40个tcp连接，http1。1允许客户端请求多个资源，所有这些都在同一连接上进行，这意味着花费在握手阶段的时间更少。

并且tcp连接有更多的时间来增长其拥塞窗口，你学习如何大致计算下载一个完整页面和其所有资源的时间，使用此，你看到连接设置时间对tcp连接可能是一个显著的开销，那仅传输一小部分数据。

最后你听到了一些关于快速spd的信息，成为HTTP/2。0基础的协议。

![](img/87fe47c23f8fb919f765947d74a8b6d0_45.png)

你学到的第三个应用是像hp的bittorrent，bittorrent使用tcp，但与hp不同，hp是一个客户端服务器应用，bittorrent是一个由许多协作的客户端组成的大型集合，称为swarm。

使用bittorrent共享大型，例如，100兆字节的文件，bittorrent将这些文件分解为较小的片段，称为片，你学习每个bittorrent客户端都会打开连接到数十。

有时甚至多达一百其他客户的连接，客户端使用最稀有的第一个策略从其他客户端请求数据，所以它试图避免片从swarm中消失，并且也要去除瓶颈，你也会了解到，尽管BT乐于从许多同伴那里请求数据。

但它在向BT发送数据时非常谨慎，试图建立一个激励系统，在那里你想要贡献数据，让别人从你那里转移，所以它工作的方式是一个节点，会向发送数据最多的同伴发送数据，这样就能。

从这里获取数据的最佳方式是向更好的同伴发送数据，找出谁，那些最好的同伴就是它，偶尔开始向一个新的随机同伴发送数据，以便在交换中发现新的潜在伙伴，这个算法被称为tit for tat算法。



![](img/87fe47c23f8fb919f765947d74a8b6d0_47.png)

所以你已经在互联网上看到了三个主要的应用，今天，你看到了，如何简单的UDP和TCP提供的抽象可以被用于复杂的方式，用于非常有趣的应用，你也学习了网络地址转换器如何复杂化应用。

通过使它难以发现同伴或建立连接，以及一些绕过它们的技巧，你现在应该对一些你可以使用的技术有了良好的理解。



![](img/87fe47c23f8fb919f765947d74a8b6d0_49.png)