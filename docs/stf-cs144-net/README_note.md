# 斯坦福 CS144 计算机网络笔记 📚

在本节课中，我们将学习计算机网络的基础概念，特别是关于网络协议栈、数据包传输以及可靠数据传输的基本原理。我们将从宏观的网络架构开始，逐步深入到数据包处理的具体细节。

## 1. 网络协议栈概述 🌐

上一节我们介绍了课程的整体目标，本节中我们来看看网络通信的基石——协议栈。

计算机网络通信依赖于一个分层的模型，即网络协议栈。每一层都有其特定的职责，下层为上层提供服务。最经典的模型是TCP/IP五层模型，从下至上依次是：物理层、链路层、网络层、传输层和应用层。

以下是TCP/IP五层模型各层的核心功能：

*   **物理层**：负责在物理媒介上传输原始的比特流。
*   **链路层**：负责在直接相连的两个节点（如同一局域网内的两台主机）之间传输数据帧。
*   **网络层**：负责在不同网络的主机之间进行逻辑寻址和路由，将数据包从源主机发送到目的主机。核心协议是IP。
*   **传输层**：负责为运行在不同主机上的应用程序提供端到端的通信服务。核心协议是TCP和UDP。
*   **应用层**：包含了各种网络应用程序及其协议，如HTTP、FTP、SMTP等。

## 2. 数据包、报文段与帧 📦

理解了分层模型后，我们需要知道数据在这些层之间是如何被封装和传递的。

数据在协议栈中自上而下传递时，每一层都会在数据前加上本层的头部信息（有时还有尾部），这个过程称为封装。封装后的数据单元在不同层有不同的名称。

以下是各层数据单元的称谓：

*   在应用层，数据被称为**报文**。
*   传输层将报文加上TCP或UDP头部后，形成的单元称为**报文段**。
*   网络层将报文段加上IP头部后，形成的单元称为**数据包**或**分组**。
*   链路层将数据包加上帧头部和帧尾部后，形成的单元称为**帧**。

这个过程可以用一个简单的公式表示：
`应用层数据 + 传输层头部 = 报文段`
`报文段 + 网络层头部 = 数据包`
`数据包 + 链路层头部和尾部 = 帧`

## 3. 可靠数据传输原理 ⚙️

网络层（IP）提供的是“尽力而为”的不可靠服务，数据包可能丢失、重复或乱序。因此，传输层（如TCP）必须在其之上实现可靠的数据传输。

可靠数据传输需要解决三个核心问题：**丢包、损坏和乱序**。其基本原理是：确认、重传和序列号。

以下是实现可靠数据传输的关键机制：

*   **序列号**：为发送的每一个字节或数据块分配一个唯一的编号，用于标识数据顺序。
*   **确认**：接收方收到数据后，向发送方返回一个确认信息，告知已成功接收到的数据序列号。
*   **重传定时器**：发送方发送数据后启动一个定时器。如果在定时器超时前未收到对应的确认，则认为数据丢失，触发重传。
*   **校验和**：用于检测数据在传输过程中是否发生比特错误（损坏）。

一个最简单的可靠数据传输协议（停等协议）的发送方伪代码如下：
```
while (有数据要发送) {
    发送当前数据包；
    启动定时器；
    while (true) {
        if (收到ACK) {
            停止定时器；
            准备发送下一个包；
            break；
        }
        if (定时器超时) {
            重传当前数据包；
            重启定时器；
        }
    }
}
```

## 4. TCP与UDP对比 🔄

传输层有两个主要协议：TCP和UDP，它们为应用提供了不同的服务模型。

TCP提供的是面向连接的、可靠的字节流服务。UDP提供的是无连接的、不可靠的数据报服务。选择哪种协议取决于应用程序的需求。

以下是TCP和UDP的主要区别：

*   **连接性**：TCP需要先建立连接，UDP不需要。
*   **可靠性**：TCP通过确认和重传保证可靠，UDP不保证。
*   **有序性**：TCP保证数据按序到达，UDP不保证。
*   **速度与开销**：TCP头部大，机制复杂，延迟高；UDP头部小，机制简单，延迟低。
*   **流量控制**：TCP有，UDP无。
*   **拥塞控制**：TCP有，UDP无。
*   **典型应用**：TCP用于Web浏览、电子邮件、文件传输；UDP用于DNS查询、视频流、在线游戏。

## 总结 📝

本节课中我们一起学习了计算机网络的基础知识。我们从网络协议栈的分层模型开始，了解了数据如何从应用层的报文被层层封装成链路层的帧。接着，我们探讨了在不可靠的IP网络上实现可靠数据传输的核心原理，包括序列号、确认和重传机制。最后，我们对比了传输层两大协议TCP和UDP的特点与适用场景。理解这些概念是后续深入学习网络协议细节和实现的基础。