![](img/7bfc4f744e76574e5b1b5a6a9013232b_0.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_2.png)

# 课程 P57：多流情况下的AIMD算法 🚦

![](img/7bfc4f744e76574e5b1b5a6a9013232b_4.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_6.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_7.png)

在本节课中，我们将要学习AIMD（加性增乘性减）算法在网络中存在多个并发数据流时的工作原理。我们将重点关注其动态特性、吞吐量计算以及与单流情况的区别。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_9.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_11.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_13.png)

---

![](img/7bfc4f744e76574e5b1b5a6a9013232b_15.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_17.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_18.png)

## 概述

![](img/7bfc4f744e76574e5b1b5a6a9013232b_20.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_22.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_24.png)

上一节我们介绍了在单一主导流量下，AIMD算法如何通过控制窗口大小来管理网络拥塞。本节中我们来看看当网络中存在大量并发数据流时，AIMD的行为会发生怎样的变化。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_26.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_28.png)

AIMD是 **Additive Increase Multiplicative Decrease** 的缩写。它通过调整**窗口大小**来控制网络中“在途数据包”（即已发送但未确认的数据包）的数量，从而间接管理拥塞。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_30.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_32.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_34.png)

---

![](img/7bfc4f744e76574e5b1b5a6a9013232b_36.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_38.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_40.png)

## 单流与多流的核心区别

![](img/7bfc4f744e76574e5b1b5a6a9013232b_42.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_44.png)

在单一流量场景中，AIMD的“锯齿”波形与往返时间（RTT）同步变化。然而，在互联网的真实环境中，路由器通常需要同时处理成千上万个数据流。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_46.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_48.png)

当网络中存在大量流量时，路由器缓冲区中会混杂着来自不同流的众多数据包。此时，任何单一流的数据包通常只占缓冲区总容量的一小部分。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_50.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_52.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_54.png)

由于缓冲区几乎总是被高度占用，数据包经历的排队延迟相对稳定。因此，一个非常合理的假设是：**在多流情况下，往返时间RTT基本保持恒定**。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_56.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_58.png)

这与单流情况形成鲜明对比。在单流情况下，窗口增大时RTT也会随之增加，导致吞吐量曲线的顶部边缘弯曲。而在多流情况下，RTT恒定，使得AIMD的吞吐量曲线呈现标准的直角三角形锯齿状。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_60.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_62.png)

---

![](img/7bfc4f744e76574e5b1b5a6a9013232b_64.png)

## 多流下的吞吐量分析

![](img/7bfc4f744e76574e5b1b5a6a9013232b_66.png)

一个流的吞吐量，即每秒发送的字节或数据包数量，可以通过其窗口大小和RTT计算。在每个RTT周期内，发送的数据量等于当前的窗口大小。

因此，流的吞吐量 `T` 与其窗口大小 `W` 成正比，与RTT `R` 成反比，关系可以表示为：

![](img/7bfc4f744e76574e5b1b5a6a9013232b_68.png)

**`T ∝ W / R`**

由于我们假设RTT `R` 是常数，因此**平均吞吐量就与平均窗口大小成正比**。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_70.png)

---

![](img/7bfc4f744e76574e5b1b5a6a9013232b_72.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_74.png)

## 吞吐量与丢包率的关系

![](img/7bfc4f744e76574e5b1b5a6a9013232b_76.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_78.png)

接下来，我们通过几何方法推导吞吐量 `T`、RTT `R` 和丢包概率 `p` 之间的关系。

以下是分析步骤：

![](img/7bfc4f744e76574e5b1b5a6a9013232b_80.png)

1.  **观察锯齿图形**：在一个完整的AIMD周期（从一次丢包到下一次丢包）中，窗口大小从 `W_max/2` 线性增加到 `W_max`。
2.  **计算周期内发送量**：这个周期内发送的数据总量 `A`，等于图中直角三角形的面积。经过计算可得：
    **`A = (3/8) * W_max²`**
3.  **建立与丢包率的联系**：每次发送 `A` 量的数据，就会发生一次丢包。因此，丢包概率 `p` 是发送量的倒数：
    **`p = 1 / A`**
4.  **推导吞吐量公式**：吞吐量 `T` 是周期内发送量 `A` 除以周期时长。周期时长等于步数 `(W_max/2)` 乘以常数RTT `R`。结合以上关系，最终得到著名的**平方根公式**：

![](img/7bfc4f744e76574e5b1b5a6a9013232b_82.png)

**`T ≈ (√(3/2)) / (R * √p)`**

![](img/7bfc4f744e76574e5b1b5a6a9013232b_84.png)

---

## 公式的启示

![](img/7bfc4f744e76574e5b1b5a6a9013232b_86.png)

这个简洁的公式揭示了AIMD在多流环境下的两个关键特性：

1.  **吞吐量与RTT成反比**：`T ∝ 1/R`
    *   这意味着与更远（RTT更大）的服务器通信时，流获得的吞吐量会更低。这通常被视为AIMD的一个缺点，因为它“惩罚”了距离更远的流量。

2.  **吞吐量与丢包率的平方根成反比**：`T ∝ 1/√p`
    *   当丢包率 `p` 趋近于0时，吞吐量 `T` 理论上会趋近于无穷大。这正反映了AIMD的行为：如果没有丢包信号，发送方的窗口就会无限增长，失去“刹车”机制。这再次印证了**丢包是AIMD进行拥塞控制的核心信号**。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_88.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_90.png)

---

![](img/7bfc4f744e76574e5b1b5a6a9013232b_92.png)

## 总结

![](img/7bfc4f744e76574e5b1b5a6a9013232b_94.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_96.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_98.png)

本节课中我们一起学习了AIMD算法在多流量网络环境下的表现。我们了解到：

![](img/7bfc4f744e76574e5b1b5a6a9013232b_100.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_102.png)

*   当网络承载许多流时，每个流独立遵循AIMD规则，通过“锯齿”过程探索合适的窗口大小。
*   由于缓冲区被大量流共享且持续高占用，可以假设RTT基本恒定。
*   由此推导出吞吐量公式 **`T ≈ k / (R * √p)`**，它表明吞吐量对**往返时间RTT**和**丢包概率p**都非常敏感。

![](img/7bfc4f744e76574e5b1b5a6a9013232b_104.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_106.png)

![](img/7bfc4f744e76574e5b1b5a6a9013232b_107.png)

AIMD是TCP拥塞控制算法的基石之一。在接下来的课程中，我们将看到TCP如何将AIMD与其他多种机制结合，构成一个更完善、高效的拥塞控制工具箱。