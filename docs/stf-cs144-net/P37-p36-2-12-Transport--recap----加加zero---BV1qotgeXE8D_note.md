![](img/073b7f2be6df5be9db5b3a0a6ea28633_0.png)

# 课程 P37：传输层协议回顾 📚

![](img/073b7f2be6df5be9db5b3a0a6ea28633_2.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_4.png)

在本节课中，我们将回顾传输层协议的核心知识。我们将重点学习三种最重要的传输层协议：TCP、UDP和ICMP，并深入理解它们的工作原理、应用场景以及指导互联网设计的端到端原则。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_6.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_8.png)

## 概述 📖

![](img/073b7f2be6df5be9db5b3a0a6ea28633_10.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_12.png)

传输层是网络协议栈中的关键一层，负责为应用程序提供端到端的通信服务。本单元主要探讨了三种广泛使用的传输层协议：TCP、UDP和ICMP。TCP提供了可靠的字节流传输服务，UDP提供了简单的无连接数据报服务，而ICMP则用于网络诊断和错误报告。此外，我们还学习了指导互联网设计的核心原则——端到端原则。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_14.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_16.png)

## 三种核心传输层协议 🔧

![](img/073b7f2be6df5be9db5b3a0a6ea28633_18.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_20.png)

上一节我们介绍了本课程的整体目标，本节中我们来看看三种核心的传输层协议。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_22.png)

### 1. 传输控制协议 (TCP) 🌐

![](img/073b7f2be6df5be9db5b3a0a6ea28633_24.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_26.png)

第一个是TCP，即传输控制协议。超过95%的互联网应用使用TCP，它几乎被普遍采用。这是因为TCP提供了几乎所有应用都希望的**可靠的端到端的双向字节流服务**。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_28.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_30.png)

本单元的大部分内容都围绕TCP展开。我们学习了如何检测在传输途中丢失或损坏的数据包，并深入探讨了TCP用于成功重传数据的机制，直到数据被正确送达。我们花费了相当多的时间，探索了在不同不可靠的网络环境中实现可靠数据传输的各种方法。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_32.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_33.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_35.png)

### 2. 用户数据报协议 (UDP) 📦

![](img/073b7f2be6df5be9db5b3a0a6ea28633_37.png)

我们研究的第二个传输层是UDP，即用户数据报协议。UDP被那些不需要TCP所提供的保证交付服务的应用程序使用。这可能是因为应用程序自身以私有的方式处理重传，或者是因为应用程序本身只需要尽力而为的交付。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_39.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_41.png)

UDP所做的只是获取应用数据，并创建一个UDP数据报。这个数据报标识出数据应该发送到的目标应用程序。在接收端，UDP也仅负责将数据递交给对应的应用。尽管使用UDP的应用相对较少，但我们看到了DNS（域名系统）和DHCP（动态主机配置协议）这两个典型的例子。它们都是简单的请求-响应查询协议。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_43.png)

### 3. 互联网控制消息协议 (ICMP) ⚠️

![](img/073b7f2be6df5be9db5b3a0a6ea28633_45.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_47.png)

我们学习的第三个协议是ICMP，即互联网控制消息协议。ICMP的主要工作是在网络出现问题时发送反馈信息。例如，如果一台路由器收到了一个IP数据包，但却不知道下一步该将其发送到哪里，那么它会向数据包的源地址发送一条ICMP消息，通知源主机这个情况。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_49.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_51.png)

ICMP非常有用，它可以帮助我们理解为什么端到端的通信无法正常工作。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_53.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_55.png)

## 端到端原则 🧠

![](img/073b7f2be6df5be9db5b3a0a6ea28633_57.png)

最后，你学习了指导互联网设计的最重要的总体架构原则之一，这个原则至今仍在引导我们的思考。它被称为**端到端原则**。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_59.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_61.png)

我们学习了端到端原则的两个版本：
*   **温和版本**：有些功能只能在网络的边缘（即端主机上）被正确、完整地实现。可靠的文件传输和安全就是两个我们见过的例子。虽然允许在网络内部添加功能来辅助这些特性，但这些辅助功能不能替代端到端的实现。
*   **强力版本**：如果一个功能能够在端主机上实现，那么我们就应该这样做。其基本思想是网络本身应该保持简单、高效，尽可能减少内置功能，以避免引入错误、降低速度或需要频繁升级。这个原则假设端主机（如笔记本电脑或智能手机）足够智能，能够实现应用程序所需的许多功能。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_63.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_65.png)

## 本单元核心知识点总结 📝

![](img/073b7f2be6df5be9db5b3a0a6ea28633_67.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_69.png)

在本单元中，我们主要学习了以下五个主题：

![](img/073b7f2be6df5be9db5b3a0a6ea28633_71.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_73.png)

以下是本单元涵盖的五个主要知识点：

![](img/073b7f2be6df5be9db5b3a0a6ea28633_75.png)

1.  **三种广泛使用的传输层**：
    *   **TCP**：用于在应用程序之间可靠地传递字节流。
    *   **UDP**：用于在应用程序之间不可靠地传递数据报。
    *   **ICMP**：用于检测和报告网络错误。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_77.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_79.png)

2.  **TCP的工作原理**：我们特别强调了TCP如何可靠地在两个应用程序之间传递字节。你学习了如何检测数据错误和丢失的数据包，以及如何重传数据包。我们还探讨了几种不同的重传策略，包括**选择性重传**和**回退N帧**。你学习了基本的TCP机制如何使用确认（ACK）和**滑动窗口**来跟踪已发送但未确认的字节。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_81.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_83.png)

3.  **UDP的工作原理**：我们解释了UDP如何工作，以及为什么它只被少数特定的应用程序使用。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_85.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_87.png)

4.  **ICMP的工作原理**：我们解释了ICMP如何工作，以及它如何帮助我们检测通信中断，并监控两个端主机之间的路由性能。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_89.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_90.png)

5.  **端到端原则**：这是互联网设计以及本课程中涉及的许多其他通信系统的一个重要总体原则。在你进入业界并运用网络专业知识时，你会发现许多人会引用这个原则来指导他们的设计决策。

![](img/073b7f2be6df5be9db5b3a0a6ea28633_92.png)

## 总结 🎯

![](img/073b7f2be6df5be9db5b3a0a6ea28633_94.png)

![](img/073b7f2be6df5be9db5b3a0a6ea28633_96.png)

本节课中我们一起学习了传输层的核心内容。现在，你应该对三种传输层协议（TCP、UDP、ICMP）有了很好的理解。你应该理解不同的数据包重传策略，以及TCP为什么使用滑动窗口机制。你也应该知道TCP为什么使用连接、连接是如何建立的，以及用于维护连接状态的有限状态机。这些知识是理解现代网络通信的基础。