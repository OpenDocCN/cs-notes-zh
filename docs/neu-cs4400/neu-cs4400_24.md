# 实现第一类函数星期二，1 月 24 日

> PLAI §6（使用了一些来自 PLAI §5 的内容，我们稍后会讨论）

这是一个简单的计划，但它与函数在我们的语言中如何使用直接相关。我们知道`{call {fun {x} E1} E2}`等同于一个`with`表达式，但这里的新事物是我们允许仅仅写`{fun ...}`表达式本身，因此我们需要为其赋予一些含义。这个表达式的含义，或者说这个表达式的值，大致应该是“一个需要为`x`插入值的表达式”。换句话说，我们的语言将具有这些新类型的值，其中包含一个稍后要评估的表达式。

有三种基本方法可以将编程语言分类为与函数处理方式相关的：

1.  一阶：函数不是真正的值。它们不能被其他函数使用或返回作为值。这意味着它们不能被存储在数据结构中。这是大多数“传统”语言过去所具有的特征。（你将在作业 4 中实现这样一种语言。）

    这样一种语言的例子是在 HtDP 中使用的初学者学生语言，该语言故意是一阶的，以帮助学生编写正确的代码（在通常将函数用作值的早期阶段通常是错误的情况下）。很难找到属于这一类别的实用现代语言。

1.  高阶：函数可以接收和返回其他函数作为值。这就是你在 C 和现代 Fortran 中得到的东西。

1.  第一类：函数是具有其他值所有权利的值。特别是，它们可以被提供给其他函数，从函数返回，存储在数据结构中，并且可以在运行时创建新函数。（大多数现代语言都具有第一类函数。）

最后一类是最有趣的。在过去，复杂表达式不是第一类的，因为它们不能自由组合。这在机器码中仍然是这样：正如我们之前所见，要计算一个表达式，例如

```
(-b + sqrt(b² - 4*a*c)) / 2a
```

你必须像这样做：

```
x = b * by = 4 * ay = y * cx = x - yx = sqrt(x)y = -bx = y + xy = 2 * as = x / y
```

换句话说，每个中间值都需要有自己的名称。但是使用适当的（“高级”）编程语言（至少大多数…），你可以只写原始表达式，而不为这些值命名。

使用第一类函数时会发生类似的事情 — 可以有消耗和返回函数的复杂表达式，它们不需要被命名。

如果我们可以使我们的`fun`表达式工作，我们得到的正是这个：它生成一个函数，你可以选择将其绑定到一个名称，或者不绑定。重要的是该值独立于名称存在。

这对编程语言的“个性”产生了重大影响，我们将会看到。事实上，仅仅添加这个特性就会使我们的语言比仅具有高阶或一阶函数的语言更加先进。

* * *
