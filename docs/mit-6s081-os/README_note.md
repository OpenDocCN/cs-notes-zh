# MIT 6.S081 操作系统工程笔记：课程01 - 操作系统接口 🖥️

在本节课中，我们将学习操作系统接口的核心概念。操作系统是计算机硬件与应用软件之间的桥梁，它通过一系列接口（系统调用）为应用程序提供服务，如进程管理、内存分配和文件操作。理解这些接口是掌握操作系统工作原理的第一步。

## 什么是操作系统接口？

上一节我们概述了课程目标，本节中我们来看看操作系统接口的具体定义。操作系统接口是一组抽象，它将硬件资源（如CPU、内存、磁盘）的功能封装起来，提供给应用程序使用。应用程序通过系统调用来请求这些服务，而无需直接操作复杂的硬件。

## 核心任务：进程管理

进程是正在执行的程序实例。操作系统负责创建、调度和终止进程。每个进程都拥有独立的地址空间，确保进程间的隔离与安全。

以下是进程管理相关的关键系统调用：

*   **fork()**: 创建当前进程的一个副本（子进程）。子进程从`fork()`调用之后开始执行。
*   **exec()**: 加载一个新的程序到当前进程的内存中，并开始执行它。这通常会替换掉当前进程的地址空间。
*   **wait()**: 父进程调用此函数来等待子进程结束。
*   **exit()**: 进程调用此函数来终止自己。

一个典型的进程创建与执行流程代码如下：
```c
int pid = fork();
if(pid == 0) {
    // 子进程
    exec("echo", argv);
} else {
    // 父进程
    wait();
}
```

## 核心任务：内存管理

操作系统为每个进程提供独立的虚拟地址空间，让进程感觉自己独占了全部内存。它通过页表将虚拟地址映射到物理地址，并负责内存的分配与回收。

关键概念包括：
*   **sbrk()**: 系统调用，用于增长或收缩进程的堆内存。
*   **虚拟地址**：进程看到的地址。
*   **物理地址**：实际内存硬件中的地址。
*   **页表**：存储虚拟地址到物理地址映射关系的数据结构。

地址转换的简化公式可以表示为：
**物理地址 = 页表[虚拟地址 / 页大小] * 页大小 + (虚拟地址 % 页大小)**

## 核心任务：文件描述符

文件描述符是一个整数，它是进程访问操作系统管理的资源（如文件、管道、设备）的通用接口。这体现了Unix“一切皆文件”的设计哲学。

以下是文件描述符相关的操作：

*   **open()**: 打开或创建一个文件，返回一个文件描述符。
*   **read(fd, buf, n)**: 从文件描述符`fd`中读取最多`n`个字节到缓冲区`buf`。
*   **write(fd, buf, n)**: 将缓冲区`buf`中的`n`个字节写入文件描述符`fd`。
*   **close(fd)**: 关闭文件描述符，释放相关资源。
*   **dup()**: 复制一个已有的文件描述符。

## I/O重定向与管道

理解了基础的文件操作后，我们来看看两个强大的功能：I/O重定向和管道。它们通过操作文件描述符来实现。

*   **I/O重定向**：通过关闭标准输出（文件描述符1）并打开一个文件，使得后续本应输出到屏幕的内容被写入文件。例如，Shell中的 `echo hello > output.txt`。
*   **管道（pipe）**：创建一个单向通信通道。它返回两个文件描述符，一个用于读，一个用于写。通常与`fork()`结合，让一个进程写入管道，另一个进程从管道读取，从而实现进程间通信。Shell中的 `ls | grep key` 就使用了管道。

## 课程总结

本节课中我们一起学习了操作系统接口的核心组成部分。我们了解到，操作系统通过进程管理、内存管理和文件描述符这三个主要抽象来为应用程序提供服务。进程管理让我们能够运行多个程序；内存管理为每个进程提供了独立且安全的地址空间；而文件描述符则是访问各种I/O资源的统一模型。掌握这些基础接口是后续深入理解操作系统内部机制的关键。