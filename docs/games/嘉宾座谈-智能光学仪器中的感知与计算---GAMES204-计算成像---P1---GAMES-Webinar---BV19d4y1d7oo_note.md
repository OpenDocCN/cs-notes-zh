![](img/ecae866eb2b35f258c5858a79e28f9dc_0.png)

# GAMES204-计算成像 课程笔记 P1：智能光学仪器中的感知与计算 👁️‍🗨️💡

![](img/ecae866eb2b35f258c5858a79e28f9dc_2.png)

在本节课中，我们将学习智能光学仪器中的两个核心概念：波前传感与可微分光学。课程内容基于加州大学伯克利分校王崇利博士的分享，涵盖了其博士期间及博士后阶段的前沿研究工作。

---

## 概述：波前传感的重要性 🌊

波前描述了光波在传播过程中，相同相位点所构成的曲面。理想的波前是平滑的，但实际光学系统中，由于像差（如大气湍流、透镜缺陷）的存在，波前会发生畸变。测量这种畸变（即波前传感）对于许多领域至关重要。

*   **天文学**：校正大气湍流对星光成像的影响。
*   **显微镜学**：获取生物样本的相位信息，揭示其拓扑结构。
*   **眼科**：测量人眼像差，用于配镜或激光手术。

上一节我们介绍了波前传感的基本概念，本节中我们来看看如何测量波前。

---

## 波前传感的传统方法 📐

![](img/ecae866eb2b35f258c5858a79e28f9dc_4.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_6.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_8.png)

由于图像传感器只能探测光强，无法直接探测光的相位或传播方向，因此需要特殊的光学设计来间接测量波前梯度。

![](img/ecae866eb2b35f258c5858a79e28f9dc_10.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_12.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_14.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_16.png)

以下是几种传统的波前传感方法：

![](img/ecae866eb2b35f258c5858a79e28f9dc_18.png)

*   **微透镜阵列**：将微透镜阵列置于传感器前。平面波会聚焦成规则点阵，畸变波前则会导致点阵偏移。通过追踪每个子光斑的偏移量，可以反推波前局部梯度。
*   **横向剪切干涉**：使用周期性光栅等元件对波前进行编码，产生干涉图样。通过分析图样的变化来求解波前，这种方法通常能获得比微透镜阵列更高的横向分辨率。
*   **基于光场传输的方法**：在不同轴向位置采集多张图像，通过求解光场传输方程来重建波前。

---

![](img/ecae866eb2b35f258c5858a79e28f9dc_20.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_21.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_23.png)

## 编码波前传感器：一种统一且高效的方案 🔢

![](img/ecae866eb2b35f258c5858a79e28f9dc_25.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_27.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_29.png)

尽管方法多样，但存在统一的理论框架来描述它们。一个自然的问题是：是否存在某种“最优”的波前传感器设计？

![](img/ecae866eb2b35f258c5858a79e28f9dc_31.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_33.png)

王崇利博士的研究提出了一种**编码波前传感器**。其核心思想是：用一块紧贴传感器（距离约1-2毫米）的**随机二元编码掩膜板**替代传统的周期性微透镜阵列或光栅。这块掩膜板由大量随机分布的透光（1）与不透光（0）的小孔组成。

**工作原理**：
1.  **标定**：在平行光（理想平面波）照射下，传感器会记录下一幅固定的**散斑图样**。这是因为掩膜板与传感器距离很近，衍射效应显著。
2.  **测量**：当存在畸变波前时，入射光的方向发生微小改变，导致传感器上的散斑图样整体发生**平移**。
3.  **求解**：每个像素上散斑的位移量，与该点波前的横向梯度成正比。这本质上是一个**光流估计**问题。通过计算两幅图像（标定图与畸变图）之间的像素位移场，再对梯度场进行积分，即可重建出完整的波前。

![](img/ecae866eb2b35f258c5858a79e28f9dc_35.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_37.png)

其数学模型可以简化为求解位移场 `s`：
`s = z * λ * ∇φ`
其中 `z` 是掩膜板到传感器的距离，`λ` 是波长，`∇φ` 是波前相位梯度。

![](img/ecae866eb2b35f258c5858a79e28f9dc_39.png)

**优势**：
*   **硬件-软件解耦**：掩膜板是随机的，无需精密加工特定周期结构。算法适用于任何随机图案。
*   **高效**：算法可在GPU上实现实时处理（如50帧/秒）。
*   **紧凑**：整个装置可以做得非常小巧。

![](img/ecae866eb2b35f258c5858a79e28f9dc_41.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_43.png)

**实验展示**：该系统成功测量了球面波、热空气湍流引起的动态波前畸变等，并验证了其高精度和实时性。

---

![](img/ecae866eb2b35f258c5858a79e28f9dc_45.png)

## 应用一：自适应光学 🔄

![](img/ecae866eb2b35f258c5858a79e28f9dc_47.png)

获得波前信息后，最直接的应用就是**自适应光学**——实时测量并校正光学系统中的像差。

![](img/ecae866eb2b35f258c5858a79e28f9dc_49.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_50.png)

**系统工作流程**：
1.  波前传感器实时测量来自“导星”的畸变波前。
2.  控制器计算所需的校正量。
3.  校正器（如变形镜）施加反向的波前，补偿畸变。
4.  校正后的光波对目标进行成像，获得清晰图像。

研究团队搭建了自适应光学演示系统。使用一个红外波长的引导光进行波前测量（避免在可见光成像中留下痕迹），用空间光调制器作为校正器。实验表明，该系统能有效校正由畸变透镜片引入的像差，恢复图像细节。与纯软件的反卷积方法相比，硬件校正避免了算法假设不成立带来的伪影问题。

---

## 应用二：定量相位显微成像 🔬

![](img/ecae866eb2b35f258c5858a79e28f9dc_52.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_54.png)

在显微镜中，许多生物样本是透明的，明场成像对比度低。但如果能获取光的**相位**信息，就能得到样本的厚度、折射率分布等拓扑结构。

将编码波前传感器作为显微镜的探测器，只需拍摄**一张**散斑图样，即可同时重建出样本的**振幅**（吸收信息）和**相位**信息。
`光场 = 振幅 * exp(i * 相位)`

**进一步应用——数字重聚焦**：由于获得了完整的复光场信息，可以在数值上模拟光波传播。这意味着无需物理移动镜头或样本，就能在计算机中实现不同焦平面的图像序列，观察样本的三维结构。

---

![](img/ecae866eb2b35f258c5858a79e28f9dc_56.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_58.png)

## 过渡到可微分光学 🤖

![](img/ecae866eb2b35f258c5858a79e28f9dc_60.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_62.png)

上一部分我们看到了如何通过创新的传感器设计解决感知问题。接下来，我们将视角从“感知”转向“计算”，探讨如何利用现代计算工具（特别是自动微分）来优化光学系统本身，这就是**可微分光学**。

![](img/ecae866eb2b35f258c5858a79e28f9dc_64.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_66.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_68.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_70.png)

---

## 什么是可微分光学？ 📈

在计算成像中，我们经常需要解决逆问题：从观测到的图像 `y` 中，估计我们感兴趣的参数 `x`（如场景、像差、光学参数）。这通常通过最小化损失函数 `L = || f(x) - y ||` 来实现，其中 `f` 是正向成像模型。

现代优化（如基于梯度的下降法）和深度学习严重依赖于计算梯度 `∂L/∂x`。根据链式法则，这需要知道正向模型 `f` 的雅可比矩阵 `∂f/∂x`。**可微分光学**的目标就是构建一个完全可微分的正向光学仿真引擎，使得 `f` 和 `∂f/∂x` 都可计算。

**好处**：
1.  **便捷的逆问题求解**：可直接使用梯度下降法优化 `x`。
2.  **硬件-软件协同设计**：梯度可以从前端神经网络反向传播到前端光学硬件的设计参数，实现端到端的联合优化。

---

## 可微分光线追踪引擎 ⚙️

王崇利博士及其合作者开发了一个可微分的光线追踪引擎。其核心挑战在于：光线与复杂光学曲面的求交计算通常需要迭代算法，若直接用自动微分库包装整个迭代过程，将导致巨大的内存消耗。

**关键贡献**：他们提出了一种混合方法。先用传统的数值迭代方法（不记录计算图）求解光线-曲面的交点。在得到最终解后，**仅对最后一步**应用自动微分，手动编码该步骤的梯度。这样既保证了结果的正确性和可微性，又极大地降低了内存开销。

**应用展示**：
*   **透镜设计**：优化单透镜、非球面透镜甚至自由曲面的参数，以最小化光斑尺寸或实现特定的光场分布。
*   **渲染与色差校正**：可微分地渲染通过光学系统的图像，并优化透镜设计来校正色差。
*   **系统标定与数字孪生**：给定一个实际拍摄的光斑图像，通过优化仿真模型中的参数（如透镜位置、曲率），使仿真结果与实测匹配，从而构建光学系统的“数字孪生”，用于参数标定和误差评估。

该引擎已开源，为光学设计与计算成像研究提供了强大工具。

---

## 前沿探索：OzVision——超彩色视网膜投影显示 🎨

![](img/ecae866eb2b35f258c5858a79e28f9dc_72.png)

最后，王崇利博士分享了其在伯克利参与的一项极具前瞻性的研究：**OzVision**（或称超彩色视网膜投影显示）。这项研究旨在将计算图形学延伸到人类视觉感知的最终端——视网膜。

![](img/ecae866eb2b35f258c5858a79e28f9dc_74.png)

![](img/ecae866eb2b35f258c5858a79e28f9dc_76.png)

**核心思想**：传统显示器的像素是均匀的，无法控制光在视网膜上具体感光细胞（视锥细胞）的刺激。人类有三种视锥细胞（L, M, S），分别对长、中、短波敏感，它们的响应曲线决定了我们看到的颜色范围（色域）。OzVision 利用**自适应光学扫描激光检眼镜**，可以：
1.  **高分辨率成像**：实时追踪视网膜上单个视锥细胞的位置和类型。
2.  **精准刺激**：用激光束精确地瞄准并控制照射在每个特定类型视锥细胞上的光强。

**革命性效果**：通过独立编程对三种视锥细胞的刺激强度组合，可以突破人类视觉的物理限制。例如，**仅用一束绿色激光**，通过调整对不同细胞的刺激比例，能让受试者“看到”红色、橙色或黄色的图像。这实现了：
*   **扩展色域**：让人看到传统显示无法呈现的颜色。
*   **色盲辅助**：理论上能让红绿色盲患者分辨红色和绿色。

这项工作首次在中文平台公开，是连接计算成像、视觉科学和图形学的跨学科前沿探索。

---

## 总结 🎯

![](img/ecae866eb2b35f258c5858a79e28f9dc_78.png)

本节课我们一起学习了智能光学仪器中感知与计算的两个关键方向：

![](img/ecae866eb2b35f258c5858a79e28f9dc_80.png)

1.  **波前传感与计算**：从传统方法到创新的编码波前传感器，展示了如何通过硬件设计与算法结合，高效感知光波的相位信息，并应用于自适应光学和定量相位显微成像。
2.  **可微分光学**：介绍了如何构建可微分的正向光学模型，从而利用梯度优化实现透镜设计、系统标定和软硬件协同设计，为计算成像提供了强大的基础工具。
3.  **前沿展望**：探讨了OzVision这一颠覆性概念，展示了通过精准控制视网膜层面的光刺激，如何扩展人类视觉感知的边界，开启了计算成像服务于视觉科学的新篇章。

这些内容体现了计算成像领域的深度与广度，从基础原理到尖端应用，从改善现有仪器到创造全新的视觉体验。希望本教程能为初学者提供一个清晰而有趣的入门视角。