![](img/c0feffbbc6f466415ea735f02495849e_0.png)

# GAMES105-计算机角色动画基础 - 第五讲：数据驱动的角色动画 📊

在本节课中，我们将要学习数据驱动角色动画的两个核心部分：如何获取运动数据，以及如何使用这些数据来生成流畅、可交互的动画。

![](img/c0feffbbc6f466415ea735f02495849e_2.png)

---

![](img/c0feffbbc6f466415ea735f02495849e_4.png)

![](img/c0feffbbc6f466415ea735f02495849e_6.png)

## 第一部分：运动数据的获取 🎬

![](img/c0feffbbc6f466415ea735f02495849e_8.png)

![](img/c0feffbbc6f466415ea735f02495849e_10.png)

![](img/c0feffbbc6f466415ea735f02495849e_12.png)

![](img/c0feffbbc6f466415ea735f02495849e_14.png)

上一节我们介绍了基于关键帧的动画技术。本节中我们来看看如何通过运动捕捉技术来获取高质量的运动数据。

![](img/c0feffbbc6f466415ea735f02495849e_16.png)

![](img/c0feffbbc6f466415ea735f02495849e_18.png)

![](img/c0feffbbc6f466415ea735f02495849e_20.png)

![](img/c0feffbbc6f466415ea735f02495849e_22.png)

运动捕捉技术在现代电影、游戏、虚拟偶像、体育训练、医疗康复和机器人等领域都有广泛应用。它通过传感器采集真实人体的运动信息，并将其转化为数字角色的动作。

![](img/c0feffbbc6f466415ea735f02495849e_24.png)

### 运动捕捉技术的发展历程

以下是运动捕捉技术发展过程中的几个关键节点：

*   **早期动作分析**：摄影术兴起后，人们开始使用连拍记录和分析动作。例如，Eadweard Muybridge通过连拍证明了马在奔跑时四蹄会同时离地。
*   **转描技术**：动画师将真人表演拍摄下来，然后逐帧描摹到卡通角色上。这项技术被用于早期迪士尼电影（如《白雪公主》）和中国第一部动画长片《铁扇公主》中，以降低制作成本并保证质量。
*   **三维转描**：在三维动画软件中，动画师可以参照视频手动摆出角色的姿势，本质上仍是手动转描。
*   **现代运动捕捉系统**：通过计算机图形学技术，自动从输入的图像或传感器信息中重建出三维动作。

### 现代运动捕捉系统类型

现代运动捕捉系统主要分为以下几类，各有优缺点：

![](img/c0feffbbc6f466415ea735f02495849e_26.png)

![](img/c0feffbbc6f466415ea735f02495849e_28.png)

*   **基于外骨骼的系统**：原理是测量穿戴式外骨骼各关节的角度。其优点是原理简单，在手部捕捉中仍较常见。缺点是限制演员动作，且不适合复杂或地面动作。
*   **基于惯性传感器的系统**：将惯性测量单元（IMU）绑在身体各部位，通过传感器数据计算相对运动，再用逆运动学求解关节旋转。其优点是对场地要求低，活动范围大。缺点是存在积分漂移问题，需要结合脚部着地等先验知识或其他传感器（如磁力计、光流）来校正。
*   **基于光学的系统（标记点）**：这是目前的主流方案。演员穿戴反光标记点，由多个标定好的红外相机同时拍摄。通过多视角几何原理，重建出标记点的三维位置，进而反推关节姿态。其优点是精度高。缺点是需要专用场地、相机数量多、成本高昂，且存在标记点遮挡、丢失、误识别等问题，需要大量后处理。
*   **基于光学的系统（无标记点）**：使用多个标定好的RGB相机，通过计算机视觉算法识别图像中的人体关节点，再进行三维重建。其优点是无须穿戴标记点。缺点是精度和鲁棒性受光照、衣物影响，对脚趾、手指等细节捕捉较难。
*   **基于深度相机的系统**：如微软Kinect，提供深度信息，可用于实时姿态估计。其优点是成本较低。缺点是信息量有限，在遮挡、转身时容易出错，精度和鲁棒性低于光学动捕。
*   **运动估计方法**：指从单目视频等信息不足的输入中估计姿态，存在歧义性，通常需要利用大量数据先验进行估计，并非严格意义上的“捕捉”。例如，仅用VR头盔和手柄（3个追踪点）来估计全身姿态，就是一个具有挑战性的研究问题。

![](img/c0feffbbc6f466415ea735f02495849e_30.png)

![](img/c0feffbbc6f466415ea735f02495849e_32.png)

![](img/c0feffbbc6f466415ea735f02495849e_34.png)

![](img/c0feffbbc6f466415ea735f02495849e_36.png)

![](img/c0feffbbc6f466415ea735f02495849e_38.png)

---

![](img/c0feffbbc6f466415ea735f02495849e_40.png)

![](img/c0feffbbc6f466415ea735f02495849e_42.png)

![](img/c0feffbbc6f466415ea735f02495849e_44.png)

![](img/c0feffbbc6f466415ea735f02495849e_46.png)

![](img/c0feffbbc6f466415ea735f02495849e_48.png)

## 第二部分：运动数据的使用 ⚙️

假设我们已经获得了处理好的运动数据，本节中我们来看看如何将这些数据片段组合起来，生成连续的动画。

通常的流程包括：动作重定向、动作编辑、动作连接与混合，最终构建动作图以实现可交互的动画。

### 动作重定向

![](img/c0feffbbc6f466415ea735f02495849e_50.png)

动作重定向是将捕捉自演员的动作数据，应用到骨骼结构、比例可能完全不同的虚拟角色上的过程。这是一个复杂的问题，处理不当会导致脚部打滑、浮空、穿模等缺陷。

![](img/c0feffbbc6f466415ea735f02495849e_52.png)

一个简化的重定向流程如下：

![](img/c0feffbbc6f466415ea735f02495849e_54.png)

1.  **建立关节映射**：将动捕骨骼的关节与角色骨骼的关节对应起来。
2.  **调整整体缩放**：根据角色腿长等比例，对根关节位移进行缩放，使脚部能接触地面。
3.  **处理T-Pose差异**：计算并应用T-Pose与A-Pose之间的旋转差值。
4.  **处理多余关节**：对于角色有而动捕数据中没有的关节，可将其旋转设为零或取相邻关节的平均值。
5.  **解决穿模问题**：通常需要使用逆运动学进行局部调整。

![](img/c0feffbbc6f466415ea735f02495849e_56.png)

另一种思路是，不直接复制关节旋转，而是记录并重定向关键点（如手、脚、根关节）的位置，然后在目标角色上使用逆运动学求解全身姿态，可能获得更好的效果。

### 动作的连接与混合

![](img/c0feffbbc6f466415ea735f02495849e_58.png)

我们通常拥有多段动作片段，需要将它们平滑地连接起来，例如从走路过渡到跑步。

![](img/c0feffbbc6f466415ea735f02495849e_60.png)

最直接的方法是在两个动作的相似帧（如脚部着地帧）进行切换，但这会产生突兀的跳跃感。为了平滑过渡，我们可以在切换点前后取若干帧，进行插值混合。

![](img/c0feffbbc6f466415ea735f02495849e_62.png)

![](img/c0feffbbc6f466415ea735f02495849e_64.png)

**插值公式**可以表示为：
`P(t) = (1 - α(t)) * P_A(t) + α(t) * P_B(t)`
其中，`P_A`和`P_B`分别是前后动作的姿势，`α(t)`是一个从0到1变化的混合权重函数，可以是线性或更平滑的函数（如二次函数）。

然而，如果两段动作的全局朝向或位置不一致，直接插值仍会不自然（如突然转身）。因此，在混合前需要进行**动作对齐**。

### 动作对齐与朝向坐标系

我们引入一个**朝向坐标系**来辅助对齐。该坐标系通常定义如下：
*   **原点**：根关节在地面上的投影。
*   **朝向**：通常定义为角色面朝的方向（如局部坐标系的Z轴方向），并且只保留绕世界Y轴的旋转分量。

假设在切换时刻，前一个动作的朝向坐标系为 `F1`，后一个动作对应帧的朝向坐标系为 `F2`。我们需要将后一个动作的所有帧，都变换到 `F1` 坐标系下。

**坐标变换公式**为：
对于后一动作的每一帧姿势 `P`，其对齐后的根关节朝向 `R'` 和位置 `T'` 可通过下式计算：
`R' = R_{1}^{-1} * R * R_{2}`
`T' = R_{1}^{-1} * (T - T_{2}) + T_{1}`
其中，`(R, T)` 是原始姿势在 `F2` 下的表示，`(R_{1}, T_{1})` 和 `(R_{2}, T_{2})` 分别是 `F1` 和 `F2` 相对于世界坐标系的变换。经过此变换，两段动作就在切换点实现了对齐，之后再进行插值混合，就能得到平滑的过渡效果。

有些动画数据会预先去除根关节的全局运动，只保留相对姿态。这样在使用时，可以根据游戏逻辑实时计算出根关节的轨迹和朝向，再将动作“放置”上去，简化了连接过程。

### 动作图

为了管理大量动作片段并实现复杂的可交互动画，我们使用**动作图**。动作图本质上是一个状态机：
*   **节点**：代表一个动作片段（或一个姿态）。
*   **边**：代表两个动作片段之间可以进行的过渡。边的权重通常基于两个连接帧的姿态距离。

构建动作图的一种方法是：给定一段长动作序列，计算所有帧两两之间的姿态距离，形成一个距离图。距离图中的局部最小值点，通常就是良好的潜在连接点。通过设定阈值，可以自动或半自动地构建出动作图。

在运行时，系统根据用户输入、环境状态等信息，实时决定当前动作完成后应过渡到图中的哪个下一个动作节点，从而实现角色对控制的响应。

动作图的优点是直观、可控。缺点是图结构可能很复杂，响应速度受动作片段长度限制，且构建高质量的图需要精心设计或手动处理。

![](img/c0feffbbc6f466415ea735f02495849e_66.png)

![](img/c0feffbbc6f466415ea735f02495849e_68.png)

### 运动匹配

**运动匹配**是一种较新的数据驱动动画技术。与动作图基于片段切换不同，运动匹配在每一帧（或每几帧）都在整个运动数据库中搜索与当前状态最匹配的下一帧姿态。

**匹配准则**是一个自定义的距离函数，它同时考虑当前姿态与目标姿态的相似性，以及目标姿态是否满足用户控制需求（如移动方向、速度）。

找到匹配帧后，通过插值混合过渡到该姿态。运动匹配的优点是响应更灵敏、动画质量高，且对原始数据要求较低（不需要预先切割成片段）。缺点是对距离函数设计敏感，可控性相对较弱。

![](img/c0feffbbc6f466415ea735f02495849e_70.png)

![](img/c0feffbbc6f466415ea735f02495849e_72.png)

---

![](img/c0feffbbc6f466415ea735f02495849e_74.png)

![](img/c0feffbbc6f466415ea735f02495849e_76.png)

## 总结 📝

![](img/c0feffbbc6f466415ea735f02495849e_78.png)

本节课中我们一起学习了数据驱动角色动画的核心内容。

*   在**数据获取**部分，我们回顾了运动捕捉技术的发展，并详细介绍了基于外骨骼、惯性传感器、光学（有/无标记点）、深度相机等不同原理的运动捕捉系统，分析了它们各自的优缺点和应用场景。
*   在**数据使用**部分，我们首先探讨了将动捕数据重定向到不同角色面临的挑战和基本方法。接着，我们学习了如何通过**插值混合**和**基于朝向坐标系的对齐**技术，将不同的动作片段平滑地连接起来。最后，我们介绍了**动作图**和**运动匹配**这两种利用运动数据库生成可交互动画的高级框架，理解了它们的基本原理和特点。

![](img/c0feffbbc6f466415ea735f02495849e_80.png)

通过本节课的学习，你应该对如何获取和处理运动数据来创造生动的角色动画有了一个全面的认识。