![](img/c289e823a19418c6d43cc214a3d8a1aa_1.png)

# GAMES401-泛动引擎(PeriDyno)物理仿真编程与实践 - P6：近场动力学（Peridynamics）并行编程与实践 🧵

在本节课中，我们将要学习近场动力学（Peridynamics）的基础理论、核心算法及其在GPU上的并行实现。近场动力学是一种处理材料非连续变形（如断裂、撕裂）的仿真方法，它摒弃了传统连续介质力学中基于“接触面”的假设，转而采用基于“长程力”和“键”的离散积分模型。我们将重点介绍一种高效的求解技术——半隐式连续迭代法，用于处理非线性超弹性材料的仿真问题。

---

## 近场动力学基础理论 🔬

上一节我们介绍了本课程的整体框架，本节中我们来看看近场动力学的基础理论。近场动力学与传统连续介质力学有本质区别。

传统连续介质力学建立在“接触力”的假设之上。它假设从物体中取出的任意一个微元，其内力施加在微元的表面上（例如立方体的六个面）。这本质上是一个理想的数学模型，将微观分子间的作用力理想化为无限小距离的“面接触”。该模型适用于拓扑变化不大的连续介质，但在处理撕裂、崩塌等非连续问题时存在困难。

近场动力学则摒弃了“面接触”的观念，其框架更接近分子动力学。它假设物质点之间的相互作用是“长程力”，类似于原子或分子间的吸引或排斥力。其核心区别在于用“非局部”的积分方程替代了传统“局部”的偏微分方程。它不计算某点的导数，而是直接建模两个物质点之间的相互作用。

### 核心概念：态（State）与键（Bond）

近场动力学中最重要的两个概念是“键”和“态”。

*   **键**：连接两个相邻物质点`x`和`x'`的虚拟连接，代表了它们之间的相互作用关系。
*   **态**：一个映射函数，其自变量是一个“键”，因变量是一个张量（如标量、向量）。它描述了该键所对应的物理量（如形变、应力）的变化。

例如，一个“形变态”`Y`可以将初始构型中的一个向量键`ξ = x' - x`，映射到变形后构型中的一个新向量`y' - y`。通过枚举中心点所有相邻的键，就可以离散地描述该点周围的形变状态，而无需计算偏导数。这种方法对映射函数的连续性没有要求，因此天生适合处理非连续问题。

### 态的代数运算

基于“态”可以构建一个代数空间，并进行各种运算。以下是常见的几种运算：

*   **加法**：两个同阶的态可以相加。
*   **组合**：一个`m`阶态与一个一阶（向量）态可以进行组合操作。
*   **点积与内积**：类似于向量的点积，但需要在所有邻域上进行积分。
*   **并矢**：两个向量态`a`和`b`可以并矢形成一个二阶张量`a ⊗ b`，这在描述形变状态时非常有用。

需要注意的是，在文献中，态常用下划线标记（如`a`），以区别于传统连续介质力学中的量。

---

## 形变与应力的态描述 📐

上一节我们介绍了态的基本概念，本节中我们来看看如何用态来描述形变和应力。

在传统连续介质力学中，形变用一个二阶张量（形变梯度`F`）描述，它可以通过对位移场求偏导得到。这种方法要求位移场连续可微，无法描述非连续形变。

在近场动力学中，我们用“形变态”`Y`来描述形变。对于中心点`x`和邻点`x‘`，形变态直接给出了变形后的相对位置向量`y‘ - y`。它不需要求导，可以独立描述每个键的形变，因此天然能够处理带有尖角或断裂的非连续形变。代价是存储和计算量通常比传统方法高。

应力的描述也类似：
*   传统方法：使用柯西应力张量`σ`等，并通过本构关系`σ = C : ε`与应变相联系。
*   近场动力学：使用“应力态”`T`，它同样是键的函数。应力态与形变态之间也存在映射关系`T = T(Y)`，用于描述材料特性。

### 近场动力学模型分类

根据应力态`T`的定义方式，主要分为两类模型：

1.  **键基模型**：最早由Silling提出。物质点`x`和`x‘`之间的相互作用力只与连接它们的键有关，并且大小相等、方向相反。这类似于弹簧模型，但无法模拟泊松比不为0.25的材料。
2.  **态基模型**：物质点`x`和`x‘`之间的力不仅取决于它们之间的键，还取决于`x`与所有邻点键的状态。这可以模拟各种泊松比。态基模型又分为：
    *   **普通态基模型**：相互作用力方向仍沿`x`与`x‘`的连线方向，易于保证动量和角动量守恒。
    *   **非普通态基模型**：相互作用力方向可以不沿连线方向，模型设计更灵活，但需要额外约束以保证物理守恒律。

近场动力学的运动方程最终可以离散化为：
```
m_i * a_i = Σ_j ( T[x]〈x‘ - x〉 - T[x‘]〈x - x‘〉 ) * V_j + b_i
```
其中，`m_i`是质量，`a_i`是加速度，`T`是应力态，`V_j`是邻点体积，`b_i`是外力。求和是对所有邻点`j`进行。

---

## 投影动力学与优化求解框架 ⚙️

上一节我们得到了近场动力学的运动方程，本节中我们来看看如何高效求解它，特别是对于非线性超弹性材料。

传统的显式积分方法因稳定性要求，需要极小时步，效率低下。我们可以将动力学问题转化为一个能量最小化的优化问题。系统的总能量通常包含两部分：
*   **惯性项**：与预测位置和最终位置之间的偏差有关，是一个二次项。
*   **势能项**：包括弹性能、接触能等，可能是非线性的。

**投影动力学** 的核心思想是将这个优化问题分裂为两步：
1.  **全局步**：处理“简单的”部分，通常是惯性项和部分势能项，希望其形式便于全局求解（如线性方程组）。
2.  **局部步**：处理“复杂的”部分，如非线性的接触约束，这些问题通常可以独立地、并行地在每个小单元（如三角形面片、接触对）上求解。

然而，标准的投影动力学要求全局步必须是二次型（线性），这对于非线性的超弹性能量项不适用。为此，我们引入了**投影近场动力学**框架，允许在全局步中处理一部分非线性项。

---

## 半隐式连续迭代法 🔄

上一节我们提出了需要在全局步中处理非线性项的问题，本节中我们介绍解决该问题的核心算法——半隐式连续迭代法。

对于非线性方程`f(x)=0`，牛顿法需要计算并求逆海森矩阵，在高维（如几百万自由度）且模型复杂（如近场动力学）时非常困难且不易并行。

**连续迭代法**是一种替代方案。其核心是构造一个函数`g(x)`，将求解`f(x)=0`转化为寻找`g(x) = x`的不动点。通过迭代`x_{k+1} = g(x_k)`来逼近解。该方法并行友好，但收敛性依赖于`g(x)`的构造。

**半隐式连续迭代法**是针对近场动力学方程特点设计的。我们将运动方程中关于未知位置`y_i`的项进行拆分：
*   将系数恒为正的项保留在左边，进行**隐式**处理。
*   将系数恒为负的项移到右边，并用上一次迭代的值代入，进行**显式**处理。

这样处理后的方程形式为：
```
y_i = (1 / (1 + a_ii)) * y_i^* + Σ_{j≠i} ( a_ij / (1 + a_ii) ) * y_j
```
其中`a_ij`恒为正。这确保了新解`y_i`是其预测位置`y_i^*`和邻点位置`y_j`的凸组合，从而保证了迭代过程的稳定性与收敛性。

### 算法步骤与超弹性材料应用

1.  **线性化与拆分**：对于超弹性材料，其应力源于应变能密度函数`Ψ`。通过极分解将形变梯度`F`分解为旋转`R`和拉伸`U`。将对角化的拉伸部分`U`（其主值为λ₁, λ₂, λ₃）对应的力进行正负拆分。
2.  **迭代求解**：在每次全局步迭代中，将显式部分用当前值代入，求解一个关于隐式部分的线性方程组（类似于雅可比迭代）。
3.  **线搜索**：为防止在能量平缓区迭代“超调”，我们基于一阶泰勒展开进行一步线搜索，快速找到使能量下降的步长，避免多次尝试带来的性能波动。

该方法非常适合GPU并行，因为它避免了海森矩阵计算，主要计算是局部3x3矩阵求逆和稀疏矩阵迭代，收敛速度在前中期很快。

---

## 局部步处理与演示 🎮

上一节我们解决了全局步的非线性求解，本节中我们简要介绍局部步的处理并展示仿真结果。

局部步主要负责处理非光滑的非线性约束，例如布料的自碰撞与互碰撞。我们采用基于**对数障碍函数**的IPC方法。
*   **梯度下降求解**：每个接触约束可以独立并行地处理，使用梯度下降法寻找满足非穿透约束的位置修正。
*   **技巧处理**：
    *   对障碍函数进行平滑截断，防止数值爆炸。
    *   结合连续碰撞检测技术，防止大步长下的穿透。
    *   对于布料等共维结构，引入沿法向的“虚拟键”来稳定形变梯度的计算，防止矩阵奇异。

### 仿真演示

以下是一些使用所述方法实现的仿真场景演示：
*   **单层布料**：与刚性物体碰撞、 draping 测试。
*   **多层布料**：模拟多层布料堆叠下落时的复杂接触与褶皱。
*   **布料撕裂**（算法支持，演示略）：展示了近场动力学处理材料断裂的天然优势。

![](img/c289e823a19418c6d43cc214a3d8a1aa_3.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_5.png)

这些仿真案例验证了半隐式连续迭代法结合投影近场动力学框架，能够稳定、高效地模拟非线性超弹性材料的大变形、复杂接触行为。

![](img/c289e823a19418c6d43cc214a3d8a1aa_7.png)

---

![](img/c289e823a19418c6d43cc214a3d8a1aa_9.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_11.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_12.png)

## 总结 📝

![](img/c289e823a19418c6d43cc214a3d8a1aa_14.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_16.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_18.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_20.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_22.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_24.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_26.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_27.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_29.png)

本节课中我们一起学习了近场动力学并行编程与实践的核心内容。

![](img/c289e823a19418c6d43cc214a3d8a1aa_31.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_33.png)

我们首先介绍了近场动力学的基础理论，理解了其通过“键”和“态”描述非局部相互作用的原理，以及与传统连续介质力学的区别。接着，我们探讨了如何将动力学问题转化为优化问题，并针对非线性求解的难点，重点讲解了**投影近场动力学框架**和其中的关键算法——**半隐式连续迭代法**。该方法通过巧妙的项拆分，将非线性问题转化为迭代求解的线性问题，兼具了稳定性、高效性和优异的GPU并行潜力。最后，我们了解了局部步如何处理接触碰撞，并观看了相关仿真演示。

![](img/c289e823a19418c6d43cc214a3d8a1aa_35.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_37.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_39.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_41.png)

![](img/c289e823a19418c6d43cc214a3d8a1aa_43.png)

通过本课的学习，你应该对近场动力学这一强大的非连续仿真方法有了入门了解，并掌握了一种高效求解非线性仿真问题的实用算法思路。