# 垃圾邮件的经济学

**注意：** 这些讲座笔记略有修改，来自2014年6.858 [课程网站](http://css.csail.mit.edu/6.858/2014/schedule.html)。

## 网络攻击的经济学

到目前为止，我们已经处理了安全性的*技术*方面（缓冲区溢出，同源策略，Tor等）。

+   *主要关注点：* 对手如何破坏系统？我们制定威胁模型，然后尝试使我们的系统对抗该威胁模型。

+   *另一种观点：* *为什么*攻击者试图破坏我们的安全政策？

    +   一些类型的攻击出于意识形态原因（例如，公民政治抗议；政府审查，Stuxnet）。对于这些类型的攻击，金钱不是主要动机。

        +   让这些攻击变得更困难很难，除了通常“使计算机更安全”。

        +   经济处罚可能涉及威慑，即在犯罪被发现后的处罚。然而，计算机和网络目前的问责制很差。 *例子：* Stuxnet是从哪里来的？我们有一些好主意，但我们能在法庭上打赢官司吗？我们应该去哪个法庭？

    +   然而，许多种类的计算机犯罪受到经济动机的驱使（例如，国家支持的工业间谍活动；垃圾邮件）。

+   要赚钱就得花钱！

    +   攻击者需要建立基础设施来支持攻击。 *例子：* 用于发动攻击的机器，用于处理非法金融交易的银行。

    +   或许我们可以通过使攻击者的基础设施成本过高来阻止他们？ *例子：* 如果发送垃圾邮件变得不赚钱，垃圾邮件发送者将停止发送垃圾邮件！

今天的讲座，我们将专注于涉及重要经济因素的攻击。

+   *例子：* 在中国，垃圾邮件发送者经常雇用“短信车”。这些车辆拦截手机和手机基站之间的通信。车辆发现电话号码，然后向这些号码发送垃圾短信。一辆车每天可以发送20万条短信！

    +   拦截设备成本：`~$1,600`

    +   每天利润：`~$1,600`

    +   被抓到罚款：< $5,000`

    +   由于很少被抓到，垃圾车是一项利润丰厚的生意。

        +   此外，中国移动运营商每条垃圾短信都能赚钱，因此运营商有动机继续允许垃圾短信传播。

        +   运营商定义特殊的“106前缀”号码，这些号码不受一天可以发送多少条短信的正常限制。106号码应该用于非商业目的（例如，公司与员工联系），但55%的中国短信垃圾邮件来自106号码。

    +   [《经济学家》，“垃圾短信：惹人厌烦的106种方式。”2014年11月29日](http://www.economist.com/news/china/21635062-china-flounders-its-efforts-combat-text-messaging-spam-106-ways-annoy)

+   有许多公司交易“网络武器”。 *例子：* Endgame。

    +   $1.5百万美元：Endgame将为您提供数百万台未打补丁机器的IP地址和物理位置。

    +   250万美元：终极目标将向您出售一个“零日订阅包”，每年提供25个漏洞利用。

谁从网络武器交易商那里购买漏洞利用？政府？公司（例如，“反击”计划）？……？

有一个市场可以购买和出售攻击者可以用于恶意目的的各种资源。

+   被入侵的系统

    +   整个被入侵的机器。

    +   访问被入侵的网站（例如，发布垃圾邮件、链接、重定向、恶意软件）。

    +   被入侵的电子邮件帐户（例如，Gmail）。

    +   在现有僵尸网络上运行服务（垃圾邮件，DoS）。

+   工具

    +   恶意软件套件

    +   漏洞、利用

+   被盗信息

    +   社会保障号、信用卡号、电子邮件地址等。

## 垃圾邮件生态系统

本文重点讨论垃圾邮件生态系统（特别是药品、仿冒商品和软件的销售）。主要有三个步骤：

1.  广告：以某种方式让用户点击链接。

1.  点击支持：展示一个将成为点击目标的网站。

1.  认识到：允许用户购买东西、发送货款，然后收到产品。

最终，资金来自这个链条中的最后一部分，当用户购买东西时。

+   许多组件是外包的或通过联盟计划支持的：垃圾邮件发送者充当广告商，但联盟处理大部分/全部后端工作（例如，与银行合作）。

+   垃圾邮件发送者通常按佣金工作，获得他们带来的资金的30%--50%。

接下来，我们将详细讨论这三个步骤，并探讨可能的干扰方式。

### 广告：如何让用户点击链接？

+   *典型方法：* 发送电子邮件垃圾邮件。（其他方法也有效：博客/评论垃圾邮件，在社交网络中发送垃圾邮件，……）

+   *发送垃圾邮件的成本：* 每百万封垃圾邮件的零售价为60美元。

    +   直接操作垃圾邮件僵尸网络的实际成本要低得多。

    +   垃圾邮件电子邮件的投递和点击率非常低，因此发送垃圾邮件必须非常便宜才能盈利。

    +   一些相同人员之前的研究：

        +   发送了约3.5亿封垃圾邮件

        +   约10,000次点击，28次购买尝试

+   我们如何让发送垃圾邮件变得更加昂贵？

    +   *IP级别黑名单：* 一段时间内有效，但只有对手拥有少量IP时才有效。

    +   *发送电子邮件收费？*

        +   旧想法，以各种形式存在：金钱、计算、验证码。

        +   这可能有效吗？我们如何让每个人立即采用这种方法？

        +   即使每个人同时采用这种方法，这也会起作用吗？如果用户设备被入侵怎么办？（但即使桌面设备被入侵，按照每条消息收费可能是一个很高的门槛，可以大大减少垃圾邮件，因为生成垃圾邮件需要非常便宜才能盈利！）

+   对手的三种解决方案：

    +   大规模僵尸网络提供许多IP地址。

    +   被入侵的网络邮件帐户提供特殊IP地址访问。

        +   雅虎、Gmail、Hotmail无法被列入黑名单。

    +   劫持IP地址（使用BGP公告）。

+   然而，解决方法并非免费，对垃圾邮件发送者会产生一些成本。

    +   发送垃圾邮件的成本在IP级别黑名单出现之前甚至更低。

僵尸网络通常用于发送垃圾邮件。

+   典型架构

    +   许多运行僵尸网络软件的被入侵终端用户机器。

    +   用于向僵尸发送命令的命令和控制（C&C）服务器/基础设施。

    +   机器人定期从C&C基础设施获取新任务。

+   单个僵尸机器具有各种有用资源：

    +   物理：IP地址（用于发送垃圾邮件），网络带宽，CPU周期。

    +   数据：电子邮件联系人（用于发送垃圾邮件），信用卡号码，...

+   防止僵尸机器发送垃圾邮件很困难--可能有数百万个僵尸IP！

将您的恶意软件安装在终端主机上需要多少费用？

+   每个主机的价格：美国主机约为$0.10，亚洲主机约为$0.01。

+   似乎难以防止；许多用户将乐意运行任意可执行文件。

命令和控制架构是什么样的？

+   集中式C&C基础设施：对手需要“防弹”主机（即，拒绝来自银行、法律机构的关闭请求）。

    +   防弹主机收取风险溢价。

+   如果托管服务被关闭怎么办？

    +   对手可以使用DNS进行重定向。此外，使用“快速流动”技术，攻击者可以快速更改与主机名关联的IP地址。

        +   攻击者创建一个服务器IP地址列表（可能有数百或数千个IP）；攻击者将每个IP绑定到主机名上，持续时间很短（例如，300秒）。

    +   摧毁僵尸网络的DNS域名有多难？

        +   可以关闭域名的注册，也可以关闭域名的DNS服务器。

        +   对手可以使用域名流动，跨越许多独立的注册商。

            +   更难摧毁：需要注册商之间的协调！

            +   Conficker发生了：它足够重要/重要...

+   分散的C&C基础设施：点对点网络。

    +   允许僵尸网络主控操作更少或不需要服务器；难以摧毁。

被入侵的Webmail帐户也可以用于发送垃圾邮件。

+   非常有效的交付机制：每个人都接受来自Yahoo、Gmail等的电子邮件。

+   Webmail提供商有动机防止帐户被盗。

    1.  如果供应商不阻止垃圾邮件，那么*所有*来自该供应商的邮件可能会被标记为垃圾邮件！

    1.  供应商通过广告赚取服务费，因此供应商需要真实用户点击广告。

+   供应商如何检测垃圾邮件？

    +   监视每个帐户发送的消息，检测可疑模式。

    +   对于可疑消息和初始注册/最初几条消息，使用验证码：向用户呈现图像/声音，要求用户转录--这对人类来说应该很容易，但对计算机来说很难。

+   获取被入侵的Webmail帐户有多难？

    +   每个帐户的价格：在Yahoo、Gmail、Hotmail等上大约为$0.01-0.05。

为什么Webmail帐户如此便宜？验证码发生了什么？

+   对手构建服务来解决验证码；这只是一个金钱问题。

    +   结果相当便宜：每个验证码约为$0.001，延迟低。

    +   令人惊讶的是，这主要是由人类完成的：攻击者可以将工作外包给任何廉价劳动力的国家。[也可以使用亚马逊的Mechanical Turk：这是一个众包网络服务，允许人类处理计算机难以执行的任务。]

+   攻击者可以重复使用验证码在另一个站点上，要求正常访客解决它，而不是雇佣某人来解决攻击者。

+   供应商可以对垃圾邮件发送者实施更频繁的检查，但如果检查太频繁，普通用户可能会感到恼火。

    +   *示例:* Gmail允许您启用双因素身份验证。在这种方案中，当您从之前未知的计算机上打开Gmail时，Google会通过短信向您发送验证代码。

### 点击支持：用户联系DNS将主机名转换为IP地址

然后，用户联系相关的网络服务器。因此，垃圾邮件发送者需要：

1.  注册一个域名。

1.  运行一个DNS服务器。

1.  运行一个网络服务器。

**Q:** 为什么垃圾邮件发送者要费心使用域名？为什么不直接使用原始IP地址来提供内容？

+   **A1:** 用户可能不太可能点击包含原始IP地址的链接？

+   **A2:** 更强的原因是，使用一层间接性使得保持内容服务器活跃变得更容易。

    +   如果执法机构注销域名或禁用DNS服务器，但服务器仍然活跃，垃圾邮件发送者可以注册一个新的域名并创建一个新的DNS服务器。

重定向站点：

+   垃圾邮件URL通常指向重定向站点。

    +   免费的重定向服务如bit.ly或其他URL缩短服务。

    +   受损站点也可以执行重定向到垃圾邮件服务器。

+   重定向站点很有用，因为垃圾邮件过滤系统可能会将URL列入黑名单。

    +   一个受欢迎的站点作为重定向平台非常有用：要阻止垃圾邮件，过滤软件必须将受欢迎的网站列入黑名单！

+   垃圾邮件发送者有时会将僵尸网络用作网络服务器或代理。

    +   这隐藏了真实网络服务器的IP地址；再次间接！

在某些情况下，单个联盟提供商将运行一些或所有这些服务。

**Q:** 执法机构不能只是关闭联盟计划吗？

+   **A:** 理论上是的，但要关闭整个组织可能会很困难。此外，还有相当数量的联盟计划。

**Q:** 关闭单个域名或网络服务器有多困难？

+   **A:** 取决于注册商或托管提供商[请参见论文中的图3、4、5]。

    +   只有少数几个注册商为许多联盟提供域名托管；同样，只有少数几个AS为许多联盟提供网络服务器托管。

    +   只有少数几个联盟商将他们的域名、域名服务器和网络服务器分布在许多注册商和AS之间。

    +   防弹主机提供商更昂贵，但数量众多；即使它们被关闭，相对容易替换。

### *实现阶段*发生了什么？

1.  用户支付商品费用。

1.  用户通过邮件收到商品（或下载软件）。

付款协议：几乎总是信用卡。信用卡信息沿着这个流程传输：

```
 Customer
      |---->Merchant
             |----> Payment processor (helps the
                     |  merchant deal with the
                     |  payment protocol)
                     |
                     |-->Acquiring bank (merchant's)
                            |-->Association network
                                  | (e.g., Visa)
                                  |
                                  |---> Issuing bank
                                        (customer's) 
```

+   发卡银行决定交易是否看起来合法，如果是，就会发送批准回来。

+   PharmaLeaks 论文：一些计划每年收入超过 1000 万美元！

对于实物商品，供应商通常会直接将商品运送给购买者（这被称为*"drop shipping"*）。

+   Drop shipping 意味着联盟计划不需要自己储存实物产品。

+   作者推测供应商很多，因此没有供应端瓶颈。

**Q:** 为什么垃圾邮件发送者正确分类他们的信用卡交易？

+   **A:** 协会网络（例如 Visa 或 Mastercard）对错误编码的交易收取高额罚款！可以推测，协会网络不希望因掩盖金融交易的真实目的而惹上麻烦。

**Q:** 为什么垃圾邮件发送者实际上会发货？

+   **A:** 信用卡公司跟踪"退单"请求的数量（即客户要求信用卡公司退还涉及破损交易的资金的次数）。

    +   如果退单交易数量过高（>1%），信用卡公司会对此进行处罚。

    +   因此，对于垃圾邮件发送者频繁向客户收费但不发货是不可持续的，特别是如果. . .

    +   只有少数几家银行愿意与垃圾邮件发送者互动！（*论文中的表格 V，图 5*）

        +   CCS'12 论文：在 2 年内只见过 30 家收单银行！

        +   因此，一个有效的垃圾邮件预防技术是专注于那些少数几家银行。为什么呢？

            1.  切换银行的成本很高。

            1.  切换的财务风险。

        +   但我们实际上能做些什么呢？

            +   说服发卡银行将这些收单银行列入黑名单？

            +   试图说服这些银行停止与垃圾邮件发送者打交道？这可能有些棘手："由于知识产权保护存在不一致性，甚至在这些银行所在的国家，像药品这样的商品的销售是否违法都不清楚。"（第四部分.D）

                +   垃圾邮件是令人反感的，但*并非总是犯罪*。

                +   例如，一些联盟客户可能不是来自垃圾邮件，而是来自合法的谷歌搜索！

自这篇论文发表以来，信用卡网络已经采取了一些行动。

+   论文发表后，一些药房和软件供应商对 Visa 提出了投诉（作者使用 Visa 卡进行垃圾邮件购买）。

+   作为回应，Visa 进行了一些政策变更：

    +   所有药品销售现在被标记为高风险；如果一家银行作为高风险商户的收单行，那么该银行将受到更严格的监管（例如，银行需要参与风险管理计划）。

    +   Visa 的运营指南现在明确列举并禁止非法销售药品和侵权商品。

        +   新语言使得 Visa 可以积极对收单银行进行罚款。

        +   一些联盟计划的回应是要求客户提交身份证明（目的是过滤掉安全研究人员的测试购买）。然而，这会损害销售，因为客户不愿提供他们的身份信息。

## 伦理

这篇论文是否引起了道德关注？作者是否通过购买他们的商品支持了垃圾邮件发送者？

一些公司发起了“反击”活动，以报复知识产权盗窃，或阻止涉及其机器的僵尸网络。

+   *示例:* 2013 年，微软、美国运通、PayPal 和其他一些公司关闭了一个大型僵尸网络。微软随后告知受影响用户应该修补他们的机器。

+   微软的法律推理：僵尸网络正在侵犯微软商标。越来越多的公司正在使用新颖的法律论点采取行动对抗僵尸网络... 这是一个好主意吗？

## 参考文献

+   [关于 CAPTCHA - 在经济背景下理解 CAPTCHA 解决服务](http://css.csail.mit.edu/6.858/2013/readings/captcha-econ.pdf)

+   [无价：支付在滥用广告商品中的作用](http://css.csail.mit.edu/6.858/2013/readings/priceless.pdf) [CCS'12]

+   [PharmaLeaks: 理解在线药品联盟计划的业务](http://css.csail.mit.edu/6.858/2013/readings/pharmaleaks.pdf)

+   [实证网络犯罪研究议程](https://www.usenix.org/conference/usenixatc11/agenda-empirical-cyber-crime-research)

+   [为什么尼日利亚骗子会说他们来自尼日利亚？](http://research.microsoft.com/pubs/167719/whyfromnigeria.pdf)

一些问题可能已经在[这里](http://css.csail.mit.edu/6.858/2014/quiz.html)

## 2011 年测验 2

Q8: 一个“占领北桥”抗议者建立了一个 Twitter 账户以假名广播消息。为了保持匿名，他决定使用 Tor 登录该账户。他从可信来源安装了 Tor 并启用了它，启动 Firefox，输入 www.twitter.com 到浏览器中，然后继续登录。由于他使用 Tor，现在可能有哪些对手能够以某种方式危害抗议者？忽略 Tor 客户端本身的安全漏洞。

A8: 抗议者容易受到恶意出口节点拦截他的非 HTTPS 保护连接的影响。（由于 Tor 明确涉及通过出口节点代理，这比拦截公共互联网上的 HTTP 更容易。）

Q9: 抗议者现在使用相同的 Firefox 浏览器连接到另一个托管讨论论坛的网站，也通过 Tor 连接（但只在建立新的 Tor 电路后）。他的目标是确保 Twitter 和论坛不能勾结以确定同一人访问了 Twitter 和论坛。为了避免第三方跟踪，他在访问不同网站之间从浏览器中删除所有 cookie、HTML5 客户端存储、历史记录等。在没有软件漏洞和大量其他流量的情况下，对手如何能够相关他最初访问 Twitter 和他访问论坛，假设没有软件漏洞，以及大量其他流量到两个网站？

A9: 对手可以通过用户代理字符串、浏览器上安装的插件、窗口尺寸等对抗议者的浏览器进行指纹识别，这可能足以强烈相关这两次访问。

* * *

## 2012 年测验 2

Q2：Alyssa想要了解在Tor上运行的隐藏服务的身份。她计划设置一个恶意的Tor OR，设置一个在该恶意Tor OR上的会合点，并将这个会合点的地址发送给隐藏服务的介绍点。然后，当隐藏服务连接到恶意的会合点时，恶意的Tor OR将记录连接来自何处。

Alyssa的计划会奏效吗？为什么会或者为什么不会？

A2：不会奏效。一个新的Tor电路被构建在
