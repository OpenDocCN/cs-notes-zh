![](img/dd62a9f03c722e31cccf5a89e300e729_0.png)

# 课程 P32：第 24 讲 - 缓存：直接映射 I 💾

在本节课中，我们将要学习计算机体系结构中的一个核心概念——缓存。我们将探讨为什么需要缓存，它是如何工作的，以及它如何帮助弥合快速处理器与慢速主存之间的速度差距。

## 概述 📋

期中考试已经结束。今天，我们有一位客座讲师卡罗琳，她将为我们介绍缓存。缓存是处理器和主存之间的一个高速存储层，旨在减少访问数据的延迟。

## 二进制前缀 🔢

在深入缓存之前，我们需要了解一些基础概念。计算机科学中常用两种前缀系统：国际单位制（SI）前缀和二进制（IEC）前缀。

SI前缀基于十进制，例如：
*   **千（K）**：10³ = 1,000
*   **兆（M）**：10⁶ = 1,000,000
*   **吉（G）**：10⁹ = 1,000,000,000

然而，计算机以二进制工作，因此使用基于2的幂次的二进制前缀更为方便：
*   **基比（Ki）**：2¹⁰ = 1,024
*   **梅比（Mi）**：2²⁰ = 1,048,576
*   **吉比（Gi）**：2³⁰ = 1,073,741,824

![](img/dd62a9f03c722e31cccf5a89e300e729_2.png)

硬盘制造商通常使用SI前缀，而操作系统则使用二进制前缀，这解释了为什么标称1TB的硬盘在系统中显示为约931GB。了解这一区别对于后续计算很重要。

![](img/dd62a9f03c722e31cccf5a89e300e729_4.png)

## 内存层次结构 🗂️

![](img/dd62a9f03c722e31cccf5a89e300e729_6.png)

![](img/dd62a9f03c722e31cccf5a89e300e729_8.png)

上一节我们介绍了二进制前缀，本节中我们来看看计算机的存储系统是如何组织的。

计算机的存储系统是一个层次结构，从快到慢、从贵到便宜、从小到大的排列如下：
1.  **寄存器**：位于CPU内部，速度最快，容量最小。
2.  **缓存**：位于CPU和主存之间。
3.  **主存（DRAM）**：容量大，但速度慢于缓存。
4.  **磁盘（二级存储）**：容量最大，速度最慢。

处理器速度的增长远快于内存访问速度的增长，这导致了“内存墙”问题。缓存的目的就是在这个速度鸿沟上架起一座桥梁。

## 缓存的基本概念 🧠

理解了内存层次结构后，我们来看看缓存是如何工作的。

缓存是主存中**最近被使用数据**的一个副本，它被放置在离处理器更近的位置（通常在CPU芯片上）。其核心思想基于两个**局部性原理**：
*   **时间局部性**：如果一个数据被访问，那么它在不久的将来很可能再次被访问。
*   **空间局部性**：如果一个内存地址被访问，那么它附近的内存地址很可能也会被访问。

缓存通过预取数据块（而不仅仅是单个字节）来利用空间局部性。大多数现代处理器有独立的**指令缓存（I-Cache）**和**数据缓存（D-Cache）**。

当CPU需要访问数据时，系统首先检查缓存。如果数据在缓存中（称为**缓存命中**），则直接使用，速度很快。如果不在缓存中（称为**缓存缺失**），则需从主存中加载数据块到缓存，然后再提供给CPU，这个过程较慢。

## 缓存的组织与设计 🏗️

缓存要高效工作，必须有合理的组织方式。主要有三种映射策略：

1.  **直接映射**：每个主存地址只能映射到缓存中**唯一一个**特定位置。
2.  **全相联映射**：每个主存地址可以映射到缓存中的**任何一个**位置。
3.  **组相联映射**：折中方案。缓存分成若干组，每个主存地址可以映射到**特定组内的任何一个**位置。

为了快速定位数据，内存地址通常被划分为几个部分：**标签（Tag）、索引（Index）、偏移量（Offset）**。我们将在后续课程中详细讨论。

## 多级缓存与性能考量 ⚡

单一的缓存可能不足以完全解决问题。现代计算机通常采用**多级缓存**（L1, L2, L3）。
*   **L1缓存**：最小最快，紧挨着CPU核心。
*   **L2缓存**：更大稍慢。
*   **L3缓存**：更大更慢，可能由多个核心共享。

访问数据时，CPU依次查找L1 -> L2 -> L3 -> 主存。

![](img/dd62a9f03c722e31cccf5a89e300e729_10.png)

缓存并不总是带来性能提升。在最坏情况下，如果程序访问模式导致持续的**缓存缺失**，那么总的访问时间将是 **缓存访问时间 + 主存访问时间**，反而比直接访问主存更慢。缓存性能通常用**平均内存访问时间（AMAT）**来衡量。

![](img/dd62a9f03c722e31cccf5a89e300e729_11.png)

## 总结 🎯

本节课中我们一起学习了：
1.  **二进制前缀（SI vs IEC）**的区别及其重要性。
2.  计算机的**内存层次结构**以及“内存墙”问题。
3.  **缓存**的基本概念和工作原理，其核心是**时间局部性**和**空间局部性**。
4.  缓存的三种主要组织方式：**直接映射、全相联映射、组相联映射**。
5.  **多级缓存**的概念以及缓存对程序性能的复杂影响。

![](img/dd62a9f03c722e31cccf5a89e300e729_13.png)

缓存是硬件设计中对“以空间换时间”策略的经典应用。理解缓存行为对于编写高性能程序至关重要。在接下来的课程中，我们将深入探讨直接映射缓存的具体实现细节。