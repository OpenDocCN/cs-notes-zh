# 9.4   微分方程的数值解

> 原文：[`introcs.cs.princeton.edu/java/94diffeq`](https://introcs.cs.princeton.edu/java/94diffeq)

本节正在大力施工中。

解微分方程是科学和工程中的一个基本问题。微分方程是...例如：y' = -2y，y(0) = 1 有解析解 y(x) = exp(-2x)。拉普拉斯方程 d²φ/dx² + d²φ/dy² = 0 加上一些边界条件。有时我们可以使用微积分找到封闭形式的解。然而，一般情况下我们必须求助于数值逼近。ODE = 所有因变量都是单个自变量的函数的微分方程，如第一个例子中。PDE = 所有因变量都是几个自变量的函数的微分方程，如第二个例子中。

**欧拉方法。** 在 18 世纪，莱昂哈德·欧拉发明了一种简单的方案来数值逼近 ODE 的解。给定形式为 dy/dx = f(x, y)的一阶 ODE，满足初始边界条件 y(x[0]) = y[0]，我们在 x[n] = x[0] + hn 的一系列值 x[n]上估计函数 y(x)。参数 h 被称为*步长*。如果 y[n]是在 x[n]处对 y(x)的近似，则我们可以通过 f(x[n], y[n])来近似 x[n]处的梯度。我们通过假设梯度在 x[n]和 x[n+1]之间的区间内保持不变来估计 y[n+1]。这导致以下方法：

![欧拉方法](img/d7826809141b34d9504f45818d99dba2.png)

我们将 h 设得越小，逼近就越准确。但这样做会增加计算量。相关的截断误差可以通过将上述估计与泰勒级数逼近进行比较来形式化。

![欧拉方法误差](img/e2e9e211585d5ba2c47e9bb07fa54c69.png)

我们看到截断误差大约为 O(h²)。如果误差是累积的（保守假设），那么从 x[0] = 0 到 x[n] = 1 的总误差为 O(h)。称为一阶方法。为了保持相对误差低于 1E-6，我们必须进行 100 万步。请注意，如果步长太大，那么欧拉方法会变得不稳定。

*Lorenz 吸引子。* Lorenz 方程是以下微分方程组

![Lorenz 方程](img/931a01cda6199db87e562771dafb7df5.png)

程序 Butterfly.java 使用欧拉方法数值解 Lorenz 方程并绘制轨迹(x, z)。

| ![Lorenz 方程](img/628bd590877d427da0afcfea9fa6cc52.png) |     | ![Lorenz 方程](img/760d14c23f93ab1001cbed919806d85c.png) |
| --- | --- | --- |

程序 Lorenz.java 绘制了 Lorenz 方程具有略有不同初始条件的两条轨迹。这种扰动最终导致显着不同的行为。这就是所谓的蝴蝶效应的起源。这里有一个很好的[演示](http://www.cmp.caltech.edu/~mcc/chaos_new/Lorenz.html)。

**龙格-库塔方法。** 欧拉方法在实践中不使用，因为每步的截断误差相对较大，与其他方法相比。此外，如果步长太大，欧拉方法会变得不稳定。欧拉方法仅在步骤开始时使用第一导数信息。龙格-库塔方法在区间中的几个点上采样导数。在计算函数 f(x, y)和提高准确性之间存在权衡。四阶龙格-库塔方法是一个受欢迎的平衡点。

![龙格-库塔方法](img/aa3ff6caf1a6e4f196df54fd31e05947.png)

这是一个四阶方法。

**N 体模拟。** 艾萨克·牛顿爵士在他著名的《自然哲学的数学原理》中于 1687 年制定了控制两个粒子在彼此之间的引力影响下运动的原则。然而，牛顿无法解决三个或更多粒子的问题。事实上，三个或更多粒子的系统只能通过数值方法来解决。我们将描述一种经典的数值解法，广泛应用于研究宇宙学、等离子物理、半导体、流体动力学和天体物理等复杂物理系统。科学家们还将相同的技术应用于其他成对相互作用，包括库仑力、比奥-萨瓦尔定律和范德瓦尔斯力。

我们首先回顾牛顿描述行星运动的数学模型。牛顿的普遍引力定律断言，两个粒子之间的引力强度由 F = Gm[1]m[2] / R²给出，其中 G 是普遍引力常数，m[1]和 m[2]是两个粒子的质量，R 是它们之间的距离。力是矢量量，一个粒子对另一个粒子的拉力作用在它们之间的直线上。牛顿的第二运动定律 F = ma 将力与加速度联系起来。让 m[i]表示粒子 i 的质量，让 r[i]表示其位置矢量（作为时间 t 的函数）。结合牛顿的两个定律，我们得到了描述粒子运动的微分方程组。

![N 体方程](img/939e851791254e1de7b6ccc9baf67ae0.png)

由于粒子的加速度仅取决于其他粒子的位置而不是它们的速度（这可能是粒子在电磁场中的情况），我们可以使用一种称为*跃点法*的专门数值积分方法。这是大多数天体物理模拟重力系统的基础。在这种方案中，我们离散化时间，并以时间量子 dt 的增量增加时间变量*t*。我们保持每个粒子的位置和速度，但它们相位差半个时间步长（这解释了跃点法的名称）。下面的步骤说明了如何演化粒子的位置和速度。这里

![跃点法](img/def48cdad58815341fee6ef3e75ce899.png)

詹姆斯·M·斯通，普林斯顿大学天体物理学，“我们发现的宇宙中一些最基本的事实（例如太阳中心的温度）只有通过计算方法才能知道。”

**椭圆型偏微分方程。** *椭圆型偏微分方程*涉及空间的二阶导数，但不涉及时间。科学计算中的一个重大挑战是用于解决椭圆型偏微分方程的快速多极方法。其中最简单且最重要的例子之一是[Laplace's equation](http://en.wikipedia.org/wiki/Laplace's_equation)：d²φ/dx² + d²φ/dy² = 0。它在许多科学应用中用于模拟电场、引力场和流体势。它描述了热传输的稳态、非受限含水层中的稳态水位高度。我们只知道边界上的值，因此没有初始条件，欧拉方法不适用。为了数值求解，我们可以在一个方形网格上使用有限差分方法。

![拉普拉斯方程](img/b1572dff0660862ebfb82f4aca32a4df.png)

点的电压是其最近邻的平均值。称为*松弛算法*或*高斯-赛德尔*。程序 Laplace.java 在平面上数值解拉普拉斯方程，其四个边界墙的电势固定为：左（30），右（70），上（100）和下（0）。在每一步中，我们使每个单元格成为其四个邻居的平均值。我们始终使用最新值（不一定与上一步相同）。我们使用整数范围从 0（蓝色）到 100（红色）绘制所有点。我们绘制电势等于 10 的倍数的点为白色，以突出等势线。请注意，由于平均性质，最大值和最小值在边界点处实现。下图显示了 0、500、1,000 和 10,000 次迭代后的电势。收敛速度较慢。

> | ![拉普拉斯方程](img/0a26809336eb3ed16cd7f60e4dae2117.png) | ![拉普拉斯方程](img/1f02fd07ca81ae6d8977ab267c334a5f.png) | ![拉普拉斯方程](img/c0e49f3157394a371d160d5d23bf3cf2.png)  | ![拉普拉斯方���](img/ad0f2ad61db57ee01deaa89ecb5b16f7.png) |
> | --- | --- | --- | --- |

收敛缓慢。瓶颈是绘制到屏幕上。为了加快速度，我们在使用海龟图形绘制到屏幕之前执行 100 次更新。该方法也可以通过选择更好的初始电势估计（而不是选择任意值）来加快速度。

其他技术：解线性方程组。通常涉及大型但稀疏和带状矩阵。在一维中，拉普拉斯方程的有限差分方案产生一个三对角线性方程组。

![拉普拉斯方程的三对角线性方程组](img/d7184cdd7f645f0aa457a5e9ffc2d1ad.png)

易于并行化的变体：雅可比迭代，逐次超松弛，红黑排序。在二维中使用多重网格方法（在几个尺度上离散化网格，使信息传播更快），共轭梯度，或者如果有周期性边界则使用 FFT。

#### Q + A

Q. 为什么使用跳跃法而不是欧拉法或龙格-库塔法？

A. 跳跃法对于积分哈密顿系统更稳定。它是*辛波形*的，这意味着它保留了特定于哈密顿系统的性质（线性动量和角动量的守恒，时间可逆性，以及离散哈密顿能量的守恒）。相比之下，普通数值方法会变得耗散，并表现出不正确的长期行为。

Q. 有关 Java 中数字计算的好资源吗？

A. 尝试[Java numerics](http://math.nist.gov/javanumerics/)。

#### 练习

1.  （由 Tamara Broderick 建议的示例）编写一个程序 LaplaceSquare.java 来解决拉普拉斯方程，其中网格边界上的电势固定为 0，中心有一个面积为 1/9 的内部正方形，电势固定为 100。

1.  解决带有 L 形内部边界的拉普拉斯方程。

#### 创意练习

1.  **跳伞者。** 假设跳伞者的下降用以下微分方程建模：d²x/dt² = 9.8 - 0.01 (dx/dt)²，其中 x 是距离投放区的距离（米）。最初 x(0) = 0，x'(0) = 0。估计经过 3 秒后的行程。估计终端速度。使用 dt = 1。

1.  **泊松方程。** 泊松方程是：dφ/dx² + dφ/dy² = f(x, y)。

1.  **SIR 流行病学模型。** [SIR 模型](http://www.esam.northwestern.edu/~chopp/ESAM252-3/lab6.pdf)测量了宿主人群中易感、感染和康复个体的数量。给定一个固定的人口，让 S(t)表示在时间 t 时患有传染性但不致命疾病的易感人群的比例；让 I(t)表示在时间 t 时感染的比例；让 R(t)表示已康复的比例。让β表示感染者感染易感者的速率。让γ表示感染者从疾病中康复的速率。描述人群中易感、感染和康复人群比例的微分方程为![SIR 模型](img/a14f625c419ae3842e2ef87c4eaf98d3.png)

    第一个方程模拟了感染率；第二个说人口是封闭的；第三个模拟了康复率。流行病学家使用这个简单模型来跟踪麻疹和埃博拉的感染率。[香港流感](http://www.math.duke.edu/education/ccp/materials/diffcalc/sir/sir2.html)：最初有 790 万人，10 人感染，0 人康复。因此 S(0) = 1，I(0) = 1.27E-6，R(0) = 0。估计平均感染期为 3 天，所以γ = 1/3，感染率为每天一个新人，所以β = 1/2。为 t = 0 到 200 以不同颜色绘制 S(t)、I(t)和 R(t)。

    天花：1/γ = 14 天，1/μ = 27375 天，1/β = 27389/20。玉米病：1/γ = 20 天，1/μ = 60 天，1/β = 80/5。

1.  **Logistic 映射。** 编写一个程序 LogisticMap.java，绘制 Logistic 映射的*bifurcation diagram*。Logistic 方程为：y[n+1] = 4 r y[n] (1 - y[n])。对于 r 在 0.7 到 1.0 之间的每个值，初始化 y[0] = 0.5，执行 1,000 次迭代并丢弃它们，然后在 y 轴上绘制接下来的 100 次迭代。![Logistic map](img/logistic800.png)

1.  **化学工程中的 ODE 初值问题。** [控制发酵罐的方程](http://www.glue.umd.edu/~nsw/ench250/ode.htm)。

1.  **捕食-被捕食者动态。** 在 Lotka-Volterra 模型中，有一种动物群体（捕食者）以另一种动物群体（被捕食者）为食。这里是一些近似代表了哈德逊湾公司从 1852 年开始观察到的[猞猁和雪兔](http://www-rohan.sdsu.edu/~jmahaffy/courses/f00/math122/labs/labj/q3v1.htm)种群的数据。x_t 表示雪兔（被捕食者）的数量，y_t 表示在时间 t 时生活的猞猁（捕食者）的数量。雪兔是素食动物，我们假设出生的雪兔数量与时间 t 时存活的雪兔数量成比例（出生率α）。猞猁与雪兔之间的决定性相遇的概率与雪兔和猞猁数量的乘积成比例（杀伤率β）。我们假设猞猁没有天敌，死亡数量与出生率γ成比例。我们还假设出生的猞猁数量与雪兔数量成比例。

    |

    ```
    dx/dt = α x - β x y
    dy/dt = γ x y - δ y

    ```

    |

    平衡点：(0, 0)或(δ / γ, α / β)。不稳定。α = 1，β = 0.01，γ = 0.02，δ = 1。

    x_0 = 20，y_0 = 20。

    1.  使用欧拉方法。

    1.  使用 4 阶龙格-库塔方法。
