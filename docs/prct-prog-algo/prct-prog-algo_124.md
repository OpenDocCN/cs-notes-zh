# 5\.   解析组合学

> 原文：[`aofa.cs.princeton.edu/50ac`](https://aofa.cs.princeton.edu/50ac)
> 
> 译者：[飞龙](https://github.com/wizardforcel)
> 
> 协议：[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)

本章介绍了*解析组合学*，这是一种现代方法，用于研究我们在算法分析中经常遇到的组合结构。这种方法的基础是组合结构通常由简单的形式规则定义，这些规则是学习其属性的关键。这一观察的最终结果之一是，相对较小的一组*转移定理*最终产生了我们寻求的数量的准确近似值。图 5.1 概述了这个过程。生成函数是解析组合学中研究的中心对象。首先，我们直接将组合对象的形式定义转换为枚举对象或描述其属性的生成函数的定义。其次，我们使用经典数学分析来提取生成函数系数的估计。

## 5.1 形式基础

## 5.2 无标记类的符号方法

## 5.3 标记类的符号方法

## 5.4 参数的符号方法

**定理 5.3**（无标记类 OBGF 的符��方法）设$\cal A$和$\cal B$是组合对象的无标记类。如果$A(z, u)$和$B(z, u)$分别是与$\cal A$和$\cal B$相关联的 OBGF，其中$z$标记大小，$u$标记参数，则

$A(z, u)+B(z, u)$是与$\cal A +\cal B$相关联的 OBGF，

$A(z, u)B(z, u)$是与$\cal A \times \cal B$相关联的 OBGF，以及

$\displaystyle{1\over 1-A(z, u)}$是与$SEQ({\cal A})$相关联的 OBGF。

*证明。* 省略。

*二叉树中的叶子节点。* 一个大小为$N$的二叉树中，具有两个外部子节点的内部节点的比例是多少？这些节点被称为*叶子节点*。你可以检查$N=0,1,2,3,$和$4$时这些节点的总数分别为$0,1,2,6,$和$20$。通过除以卡特兰数，相关比例分别为$0,1,1,6/5$和$10/7$。在 BGF 中，$$T(z, u) = \sum_{t\in\cal T}z^{|t|}u^{\hbox{leaves}(t)}$$ 下列是$z⁰$，$z¹$，$z²$，$z³$，$z⁴$的系数，直接反映在图 5.2 中的树中：$$u⁰$$ $$u¹$$ $$u¹+ u¹$$ $$u¹+ u¹+ u²+ u¹+ u¹$$ $$u¹+ u¹+u²+u¹+u¹+u²+u²+u¹+u¹+u²+u¹+u¹+u²+u².$$ 将这些项相加，我们知道$$T(z, u) = 1 + z¹u + 2z²u + z³(4u + u²) + z⁴(8u + 6u²) + \ldots\,.$$ 检查小值，我们发现$$T(z, 1) = 1 + z¹ + 2z² + 5z³ + 14z⁴ + \ldots$$ 和$$T_u(z, 1) = z¹ + 2z² + 6z³ + 20z⁴ + \ldots$$ 如预期。为了用符号方法推导 GF 方程，我们在标准递归构造的两侧加上${\cal Z}_{\bullet}$得到$${\cal T} + {\cal Z}_{\bullet}= {\cal E} + {\cal Z}_{\bullet} + {\cal Z}_{\bullet}\times{\cal T} \times{\cal T}.$$ 这给了我们一种标记叶子节点的方法（通过在右侧的${\cal Z}_{\bullet}$项上使用 BGF $zu$）并平衡大小为 1 的树的方程。应用定理 5.3（在左侧的${\cal Z}_{\bullet}$项上使用 BGF $z$，在最右侧的项上使用${\cal Z}_{\bullet}$因子，因为两者都不对应叶子节点）立即给出了功能方程$$T(z, u) + z=1+zu+zT(z, u)².$$ 设置$u=1$得到了卡特兰数的 OGF，对$u$求导并在$u=1$处求值得到$$\eqalign{ T_u(z, 1) &= z + 2zT(1,z)T_u(z, 1)\cr &= {z\over 1- 2zT(z, 1)}\cr &= {z\over\sqrt{1-4z}}.\cr }$$ 因此，在大小为$n$的二叉树中，具有两个外部节点的内部节点的平均数量是$${[z^n]\displaystyle{z\over\sqrt{1-4z}}\over\displaystyle{1\over n+1}{2n\choose n}}={\displaystyle{2n-2\choose n-1}\over\displaystyle{1\over n+1}{2n\choose n}}={(n+1)n\over2(2n-1)}$$ 在极限情况下趋向于$n/4$。二叉树中约有$1/4$的内部节点是叶子节点。

## 5.5 生成函数系数渐近性

**定理 5.5**（收敛半径转移定理）设 $f(z)$ 的收敛半径严格大于 1，并假设 $f(1)\ne0$。对于任意实数 $\alpha\not\in\{0,-1,-2,\ldots\}$，有 $$[z^n] {f(z)\over (1-z)^\alpha}\sim f(1) {n+\alpha-1\choose n}\sim {f(1)\over \Gamma(\alpha)}n^{\alpha-1}。**证明。**设 $f(z)$ 的收敛半径 $>r$，其中 $r>1$。我们知道从收敛半径界限得到 $f_n\equiv[z^n]f(z)=O(r^{-n})$，特别地，和 $\sum_n f_n$ 以几何速度收敛到 $f(1)$。然后分析卷积很简单：$$\eqalign{ [z^n] {f(z)\over(1-z)^{\alpha}} &=f_0 {n+\alpha-1\choose n}+f_1 {n+\alpha-2\choose n-1} +\cdots+f_n {\alpha-1\choose 0}\cr &={n+\alpha-1\choose n}\Bigl(f_0+f_1{n\over n+\alpha-1}\cr &\qquad\qquad+f_2{n(n-1)\over (n+\alpha-1)(n+\alpha-2)}\cr &\qquad\qquad+f_3{n(n-1)(n-2)\over (n+\alpha-1)(n+\alpha-2)(n+\alpha-3)}+\cdots\Bigr).\cr } $$ 此和中索引为 $j$ 的项为 $$f_j {n(n-1)\cdots(n-j+1)\over (n+\alpha-1)(n+\alpha-2)\cdots(n+\alpha-j)},$$ 当 $n\to+\infty$ 时趋于 $f_j$。由此我们推断出 $$[z^n] f(z)(1-z)^{-\alpha}\sim {n+\alpha-1\choose n} (f_0+f_1+\cdots f_n)\sim f(1){n+\alpha-1\choose n}，$$ 因为部分和 $f_0+\cdots+f_n$ 以几何速度收敛到 $f(1)$。由欧拉-麦克劳林公式推导出对二项式系数的近似。

一般来说，系数的渐近性由生成函数在发散点附近的行为决定。当收敛半径不为 1 时，我们可以对一个适用于定理的函数进行重新缩放。这种重新缩放总是引入一个乘法指数因子。

**推论。** 设 $f(z)$ 的收敛半径严格大于 $\rho$，并假设 $f(\rho)\ne0$。对于任意实数 $\alpha\not\in\{0,-1,-2,\ldots\}$，有 $$[z^n] {f(z)\over (1-z/\rho)^\alpha}\sim {f(\rho) \over \Gamma(\alpha)}\rho^{-n} n^{\alpha-1}。**证明。**在定理 5.5 中将变量从 $z$ 更改为 $z/\rho$。

尽管定理 5.5（及其推论）存在局限性，但对于从本书中遇到的许多生成函数中提取系数而言，它是有效的。这是解析组合学第二阶段组成的解析转移定理的杰出示例。

*广义错位。* 我们使用符号方法表明给定排列没有长度小于或等于 $M$ 的循环的概率是 $[z^N]P^*_{>M}(z)$，其中 $$P^*_{>M}(z) = {e^{-z - z²\!/2 \ldots - z^M\!/M}\over 1-z}$$ 从这个表达式，定理 5.5 *立即* 给出了 $$[z^N]P^*_{>M}(z)\sim{1\over e^{H_M}}。$$ 解析组合学的一个主要原则是通常不需要详细计算，因为一般的转移定理可以为大量组合类提供准确的结果，就像在这种情况下一样。

*卡特兰数和二叉树中的叶子。* 类似地，定理 5.5 的推论立即提供了从卡特兰生成函数 $$T(z) = {1 - \sqrt{1 -4z}\over 2}$$ 转移到其系数的渐近形式的转换：忽略常数项，取 $\alpha = -1/2$ 和 $f(z) = -1/2$ 得到渐近结果 $$T_N\sim{4^N\over N\sqrt{\pi N}}。$$ 此外，我们对上述证明有一个更简单的结论，即二叉树中叶子的平均数量约为 $\sim N/4$，因为定理 5.5 的推论立即给出了 $$[z^N] {z\over\sqrt{1 -4z}} = {4^N\over 4\sqrt{\pi N}}$$

像定理 5.5 这样的结果，系数的渐近形式直接“转移”自类似$(1-z)^{-\alpha}$（称为“奇点元素”）的元素，这些元素在有理函数分析中起着非常类似于部分分数元素的作用。更深层次的数学真理正在发挥作用。定理 5.5 只是上个世纪达布尔、波利亚、塞格、本德等人发展的一整套类似结果中最简单的一个。这些方法在 Flajolet 和 Sedgewick 的《解析组合学》中有详细讨论。与我们在这里所能做的不同，它们的完整发展需要复变函数论。这种渐近分析方法称为“奇点分析”。

#### 选定的练习

## 5.1

长度为$N$的比特串有多少个不包含 000？

## 5.3

让$\cal U$为具有节点总数（内部加外部）的二叉树集合，因此其计数序列的生成函数为$U(z) = z + z³ + 2 z⁵ + 5z⁷ + 14z⁹ + \ldots\,\,$。推导出$U(z)$的显式表达式。

## 5.7

推导一个生成函数，用于计算循环长度全为奇数的排列数。

## 5.15

找到大小为$N$且两个子节点都是内部节点的二叉树中内部节点的平均数量。

## 5.16

找到大小为$N$且一个子节点是内部节点一个子节点是外部节点的二叉树中内部节点的平均数量。

## 5.23

证明在长度为$N$的随机排列中，所有循环长度均为奇数的概率是$\sim 1/\sqrt{\pi N/2}$（参见练习 5.7）。

#### 复习问题

## Q5.1

给出(*a*) 不包含 01 的二进制字符串的组合结构 (*b*) 不包含 11 的二进制字符串的组合结构

## Q5.2

给出(*a*) $[z^n]{1\over1-3z}\ln{1\over 1-2z}$ (*b*) $[z^n]{1\over\sqrt{1-3z}}\ln{1\over 1-2z}$的近似值（主导项）。

## Q5.3

对于以下每个组合结构，请指出它描述排列、二进制字符串、循环、错位排列还是以上都不是。$$A = Z+A\times A$$ $$A = SET(CYC_{>1}(Z)$$ $$A = Z+E+Z\star A$$ $$A = CYC_{>0}(Z)$$ $$A = A\times(Z_0+Z_1)$$ $$A = SEQ(Z)$$

## Q5.4

（A. Yin）有多少种方式可以通过每次走 1 步或 3 步来爬$N$阶楼梯？给出形式为$c_1\cdot c_2^N$的答案，其中$c_1$和$c_2$是常数（并给出常数的近似值）。
