# 比特币

# 6.824 2015 讲座 23：比特币

**注意：**这些讲座笔记稍作修改，来自 2015 年春季 6.824 [课程网站](http://nil.csail.mit.edu/6.824/2015/schedule.html)。

## 比特币

+   一种电子货币系统

+   有技术方面和财务、经济、社会方面

+   或许首先要问的是：它是在尝试做些更好的事情吗？它是否为我们解决了问题？

+   在线支付使用信用卡，为什么不直接使用它们？

    +   优点：

        +   它们在线运作

        +   很难盗取我的信用卡（有关信用卡公司如何运作的法律，如果你的信用卡号被盗，你是受保护的）

    +   好/坏：

        +   卡背面的客服号码可以让你撤销费用

            +   这可以预防或制造欺诈

        +   与某个国家的货币挂钩

    +   缺点

        +   作为顾客或商家，没有办法独立验证关于信用卡交易的任何事情：你是否有钱，信用卡号是否有效？

            +   如果你不想让别人知道你有多少钱，这可能是个好东西

        +   依赖第三方：对所有事项收费的好方法

        +   3% 的费用

        +   结算时间相当长（商家在一个月后才确定是否收到款项）

        +   要成为信用卡商家相当困难

            +   信用卡公司承担了很大的风险，向可能不向客户发送产品的商家发送资金，导致信用卡公司不得不退还客户

+   对于比特币：

    +   不需要第三方（好吧，不完全是这样了）

    +   费用远远低于 3%

    +   结算时间可能是 10 分钟

    +   任何人都可以成为商家

+   比特币使每个人都能验证交易序列并达成一致 `=>` 无需依赖第三方

## OneBit

+   简单的电子货币系统

+   它只有一个名为 OneBank 的服务器

+   每个用户拥有一些硬币

设计：

```
OneBank server 
```

+   一个交易：

    1.  新所有者的公钥

    1.  这枚硬币的上一次转移记录的哈希

    1.  上一个所有者的私钥对此记录进行签名

+   银行保留每枚硬币的交易列表

+   `x` 将硬币转移到 `y`

+   `[T7: from=x, to=y; hash=h(prev tx); sig_x(this)]`

+   `y` 将硬币转移到 `z`，从麦当劳买了一个汉堡包

+   `[T8: from y, to=z; hash=h(T7); sig_y(this)]`

+   会出什么问题？

    +   如果有人将硬币转移到 `z`，似乎很不可能有人除了 `z` 以外花费那个硬币：因为没有人能用 `z` 的私钥签署新的交易，因为他们没有 `z` 的私钥

+   我们必须信任一个银行不让用户重复花费钱

    +   如果银行帮助，`y` 也可以用同一枚硬币从汉堡王购买奶昔

    +   `[T8': from y, to=q'; hash=h(T7); sig_y(this)]`

    +   银行可以向麦当劳展示 T8，并向汉堡王展示 T8'

    +   （我爱免费的食物！）

    +   只要麦当劳和汉堡王不相互沟通并验证交易链，他们就不会发现

## 比特币区块链

+   比特币有一个单一的区块链

+   许多服务器：更多或更少的副本，拥有整个区块链的副本

+   区块链中的每个区块看起来都像这样：

    +   上一个区块的哈希

    +   交易集合

    +   随机数

    +   当前时间

+   交易有两个阶段

    +   首先，它被创建并发送到网络上。

    +   然后交易被纳入区块链中。

### 区块是如何创建的？挖矿

比特币网络中的所有节点都试图创建下一个区块：

+   每个节点都会获取自上一个区块创建后到达的所有交易，并尝试将新的区块附加到其中。

+   规则规定区块的哈希值必须小于某个特定数值（即，它有一定数量的前导零，使其难以找到）。

+   每个比特币节点都会调整区块中的`nonce`字段，直到它们获得具有一定数量前导零的哈希。

+   这样做的目的是让创建新区块变得昂贵。

    +   对于一台单独的计算机来说，可能需要几个月才能找到这样的随机数。

+   领先零的数量会调整，以便平均每隔 10 分钟添加一个新区块

    +   客户端监视最后 5 笔交易中的`currentTime`字段，如果它们花费的时间太少，他们会将目标零的数量增加一位。

        +   每个人都遵守协议，因为如果他们不这样做，其他人将拒绝他们的区块（例如，如果区块的零的数量错误或时间戳错误）。

### 空区块链

+   "起初什么都没有，然后中本聪创建了第一个区块。"

+   "然后人们开始挖掘额外的区块，没有交易。"

+   "然后他们为每个挖掘出的区块获得了挖矿奖励。"

+   "这就是用户得到比特币的方式。"

+   "然后他们开始进行交易。"

+   "然后就有了光明。"

### 双重花费需要什么？

如果交易在区块链上，系统是否可以双重花费其硬币？

+   分叉区块链是唯一的方法。

+   分叉是否可以被长时间隐藏？

+   如果发生分叉，矿工将选择其中一个继续挖矿。

+   当一个分支变得更长时，每个人都会转移到它上面。

    +   如果他们留在较短的分支上，他们很可能会被其他人挖掘并浪费工作，所以他们会有动力转移到较长的分支上。

    +   较短分支上的交易将被合并到较长分支上。

    +   承诺的交易可能会被取消 => 人们通常会等待几个额外的区块被创建后，交易的区块才会被取消。

+   这就是 51%规则发挥作用的地方：如果 51%的计算能力是诚实的，协议就能正常工作。

+   如果超过 51%是不诚实的，那么他们很可能会成功地挖掘出他们想要的任何东西。

+   比特币最聪明的地方可能是：只要你相信超过一半的计算能力没有作弊，你就可以确保没有双重支付。

### 设计的优点和缺点

+   (+) 公开可验证的日志

+   (-) 与一种新的货币挂钩，非常不稳定。

    +   许多人因为这个原因不使用它。

+   (+/-) 挖矿 - 分散的信任

很难说会发生什么：

+   我们可能在 30 年后都在使用它。

+   或者，银行可以赶上并设计出自己的可验证日志设计。
