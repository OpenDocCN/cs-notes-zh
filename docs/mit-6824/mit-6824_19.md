# HubSpot

# 6.824 2015 年第 19 讲：HubSpot

**注意：** 这些讲座笔记是从 2015 年春季 6.824 [课程网站](http://nil.csail.mit.edu/6.824/2015/schedule.html)上发布的笔记稍作修改。

## 真实世界中的分布式系统

谁构建分布式系统：

+   SaaS 市场

    +   初创公司：CustomMade，Instagram，HubSpot

    +   成熟：Akamai，Facebook，Twitter

+   企业市场

    +   初创公司：Basho（Riak），Infinio，Hadapt

    +   成熟：VMWare，Vertica

+   ...和研究生

高级组件：

+   前端：负载均衡路由器

+   处理程序，缓存，存储，业务服务

+   基础服务：日志记录，更新，身份验证

低级组件：

+   RPC（语义，故障）

+   协调（一致性，Paxos）

+   持久性（序列化语义）

+   缓存

+   抽象（队列，作业，工作流）

## 构建这个东西

业务需求将影响规模和架构

+   约会网站核心数据：OkCupid 使用 2 台强大的数据库服务器

+   分析分布式数据库：Vertica/Netezza 集群大约有 100 个节点

+   中型 SaaS 公司：HubSpot 使用大约 100 个单节点数据库或大约 10 个节点 HBase 集群

    +   主要是 MySQL

+   Akamai，Facebook，亚马逊：成千上万台机器

小型 SaaS 初创公司：

+   早期最好的事情是弄清楚您是否有一个人们愿意购买的好主意

+   通常使用 Heroku，Google App Engine，AWS，Joyent，CloudFoundry 等平台

中型 SaaS：

+   需要比 PaaS 提供的更多控制

+   规模可能使您能够更便宜地构建更好的解决方案

+   开源解决方案可以帮助您

成熟 SaaS：

+   [Jepsen 工具](http://aphyr.com/tags/jepsen)

+   "确保您的设计在规模变化 10 倍或 20 倍时仍能正常工作；对于 x 的正确解决方案通常不是 100 倍的最佳解决方案"，Jeff Dean

如何考虑您的设计：

+   了解您的系统需要做什么和语义

+   了解工作负载规模，然后估计（L2 访问时间，网络延迟）并计划了解性能

## 运行这个东西

+   "遥测胜过事件记录"

    +   日志可能很难理解：讲述一个好故事很困难

+   日志记录：第一道防线，不易扩展

    +   不同机器上的日志

    +   如果时间戳无用，因为时钟不同步怎么办

    +   许多与日志记录相关的工具

    +   以可查询格式保存日志数据通常非常有用

+   监控，遥测，警报

    +   用时间和计数事件注释代码

    +   测量内存队列的大小或请求花费的时间，您可以对其进行计数

    +   可以在多个粒度上进行遥测，因此我们可以将长时间请求分解为更小的部分并准确定位问题

## 管理：命令和控制

+   在课堂设置中，您不必设置一堆机器

+   随着您的业务规模扩大，需要设置新的机器 => 必须自动化

+   将配置与应用程序分开

+   HubSpot 使用类似 ZooKeeper 的系统，允许应用程序获取配置值

+   Java 中的 Maven 依赖关系

+   Jenkins 用于持续集成测试

## 测试

+   自动化测试使验证代码的新更改变得容易

+   UI 测试可能会有点困难（模拟点击，在不同浏览器中有不同的布局）

    +   前端变化 => 必须更改测试吗？

## 团队

+   人员：如何团结在一起构建事物

+   类比：软件工程过程有点像一个具有不可靠组件的分布式系统。

    +   以某种方式必须按时构建可靠的软件

+   必须照顾好你的员工：文化必须适合人们成长、学习和失败

## 过程

+   瀑布流：先进行大规模设计，然后实施

+   敏捷/Scrum：不知道整个解决方案，需要在设计上进行迭代

+   看板：

+   精益：

## 问题

+   在快速变化的代码库上进行重大更改

    +   如果你分支然后合并你的更改，代码库的变化可能会发生很大

    +   可以尝试部署两个不同的分支，以便新分支可以在生产环境中进行测试

+   随着增长，文化也会发生变化

    +   需要关注员工的文化和幸福感

    +   测量幸福感非常重要

    +   拥有小团队可能有助于人们拥有项目的所有权
