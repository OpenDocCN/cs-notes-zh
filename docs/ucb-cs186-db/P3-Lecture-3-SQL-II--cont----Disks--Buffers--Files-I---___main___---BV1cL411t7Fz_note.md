# è¯¾ç¨‹ P3ï¼šSQL II (ç»­) + ç£ç›˜ã€ç¼“å†²åŒºã€æ–‡ä»¶ I ðŸ“š

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥å­¦ä¹  SQL è¿žæŽ¥çš„é«˜çº§æ¦‚å¿µï¼Œå¹¶åˆæ­¥æŽ¢è®¨æ•°æ®åº“ç³»ç»Ÿçš„åº•å±‚å­˜å‚¨ç»“æž„ï¼ŒåŒ…æ‹¬ç£ç›˜ã€ç¼“å†²åŒºå’Œæ–‡ä»¶ç»„ç»‡ã€‚æˆ‘ä»¬å°†ä»Ž SQL çš„è‡ªç„¶è¿žæŽ¥ã€å¤–è¿žæŽ¥å’Œç©ºå€¼å¤„ç†å¼€å§‹ï¼Œç„¶åŽè¿‡æ¸¡åˆ°æŸ¥è¯¢çš„ç»„åˆä¸ŽåµŒå¥—ï¼Œæœ€åŽæ¦‚è¿°æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ä½“ç³»ç»“æž„ã€‚

---

![](img/cdfb9718f5915ae04934e75e3eafa223_1.png)

## è¿žæŽ¥æ‰©å±• ðŸ”—

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†åŸºæœ¬çš„è¿žæŽ¥æ“ä½œã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ›´é«˜çº§çš„è¿žæŽ¥ç±»åž‹ï¼šè‡ªç„¶è¿žæŽ¥å’Œå¤–è¿žæŽ¥ã€‚

### è‡ªç„¶è¿žæŽ¥

è‡ªç„¶è¿žæŽ¥å…è®¸æˆ‘ä»¬çœç•¥è¿žæŽ¥æ¡ä»¶ã€‚å®ƒéšå¼åœ°å‡è®¾ä¸¤ä¸ªè¡¨ä¸­æ‰€æœ‰å…·æœ‰ç›¸åŒåç§°çš„å±žæ€§å€¼åº”è¯¥ç›¸ç­‰ã€‚

**ç¤ºä¾‹**ï¼š
å‡è®¾æœ‰ä¸¤ä¸ªè¡¨ï¼š`Sailors(sid, sname, rating)` å’Œ `Reserves(sid, bid, day)`ã€‚å®ƒä»¬å…±æœ‰çš„å±žæ€§æ˜¯ `sid`ã€‚
```sql
SELECT * FROM Sailors NATURAL JOIN Reserves;
```
æ­¤æŸ¥è¯¢ç­‰ä»·äºŽï¼š
```sql
SELECT * FROM Sailors, Reserves WHERE Sailors.sid = Reserves.sid;
```
å…³äºŽè‡ªç„¶è¿žæŽ¥éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒæœ‰æ—¶ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æžœï¼Œå°¤å…¶æ˜¯å½“ä¸¤ä¸ªå…³ç³»ä¸­æœ‰è®¸å¤šåç§°ç›¸åŒçš„å±žæ€§ï¼Œä½†ä½ ä¸å¸Œæœ›å®ƒä»¬åœ¨è¿žæŽ¥ä¸­è¢«è§†ä¸ºç›¸ç­‰æ—¶ã€‚

### å¤–è¿žæŽ¥

å¤–è¿žæŽ¥å¯ä»¥æ•èŽ·å†…è¿žæŽ¥æˆ–è‡ªç„¶è¿žæŽ¥ä¸­ä¸åŒ¹é…çš„è¡Œã€‚å®ƒåˆ†ä¸ºå·¦å¤–è¿žæŽ¥ã€å³å¤–è¿žæŽ¥å’Œå…¨å¤–è¿žæŽ¥ã€‚

**å·¦å¤–è¿žæŽ¥**ï¼šè¿”å›žå·¦è¡¨çš„æ‰€æœ‰è¡Œï¼Œä»¥åŠå³è¡¨ä¸­åŒ¹é…çš„è¡Œã€‚å¦‚æžœå³è¡¨æ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™ç»“æžœä¸­å³è¡¨çš„éƒ¨åˆ†å¡«å……ä¸º `NULL`ã€‚
```sql
SELECT * FROM Sailors LEFT OUTER JOIN Reserves ON Sailors.sid = Reserves.sid;
```

**å³å¤–è¿žæŽ¥**ï¼šä¸Žå·¦å¤–è¿žæŽ¥ç›¸åï¼Œè¿”å›žå³è¡¨çš„æ‰€æœ‰è¡Œã€‚
**å…¨å¤–è¿žæŽ¥**ï¼šè¿”å›žä¸¤ä¸ªè¡¨ä¸­æ‰€æœ‰çš„è¡Œï¼Œä¸åŒ¹é…çš„éƒ¨åˆ†ç”¨ `NULL` å¡«å……ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº› SQL å®žçŽ°ï¼ˆå¦‚ SQLiteï¼‰å¯èƒ½ä¸æ”¯æŒå³å¤–è¿žæŽ¥å’Œå…¨å¤–è¿žæŽ¥ï¼Œä½†å¯ä»¥é€šè¿‡è°ƒæ•´è¡¨é¡ºåºå’Œä½¿ç”¨é›†åˆè¿ç®—ç¬¦æ¥æ¨¡æ‹Ÿã€‚

---

## ç©ºå€¼å¤„ç† â“

ç©ºå€¼ï¼ˆ`NULL`ï¼‰ç”¨äºŽè¡¨ç¤ºæœªçŸ¥æˆ–ä¸é€‚ç”¨çš„å€¼ã€‚å®ƒçš„å­˜åœ¨ä½¿å¾—æŸ¥è¯¢é€»è¾‘å˜å¾—æ›´åŠ å¤æ‚ã€‚

### ç©ºå€¼ä¸Žé€‰æ‹©è°“è¯

åœ¨ `WHERE` å­å¥ä¸­ï¼Œæ¶‰åŠ `NULL` çš„æ¯”è¾ƒç»“æžœé€šå¸¸æ˜¯ `NULL`ï¼ˆå³â€œæœªçŸ¥â€ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´è¯¥è¡Œä¸è¢«åŒ…å«åœ¨è¾“å‡ºä¸­ã€‚

**ç¤ºä¾‹**ï¼š
```sql
SELECT * FROM Sailors WHERE rating > 8;
```
å¦‚æžœæŸä¸ªæ°´æ‰‹çš„ `rating` ä¸º `NULL`ï¼Œåˆ™è¯¥æ°´æ‰‹ä¸ä¼šå‡ºçŽ°åœ¨ç»“æžœä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç¡®å®šå…¶è¯„çº§æ˜¯å¦å¤§äºŽ 8ã€‚

ä¸ºäº†æ˜¾å¼å¤„ç† `NULL`ï¼Œå¯ä»¥ä½¿ç”¨ `IS NULL` æˆ– `IS NOT NULL` è°“è¯ã€‚
```sql
SELECT * FROM Sailors WHERE rating > 8 OR rating <= 8 OR rating IS NULL;
```

### ä¸‰å€¼é€»è¾‘

ä¸ºäº†ç»„åˆæ¶‰åŠç©ºå€¼çš„è°“è¯ï¼ŒSQL ä½¿ç”¨äº†ä¸‰å€¼é€»è¾‘ï¼ˆTrue, False, Unknown/NULLï¼‰ã€‚å…¶çœŸå€¼è¡¨æ‰©å±•äº†ä¼ ç»Ÿçš„å¸ƒå°”é€»è¾‘ã€‚

**AND çœŸå€¼è¡¨ç¤ºä¾‹**ï¼š
| AND  | True | False | NULL |
|------|------|-------|------|
| True | True | False | NULL |
| False| False| False | False|
| NULL | NULL | False | NULL |

**OR çœŸå€¼è¡¨ç¤ºä¾‹**ï¼š
| OR   | True | False | NULL |
|------|------|-------|------|
| True | True | True  | True |
| False| True | False | NULL |
| NULL | True | NULL  | NULL |

è§„åˆ™æ˜¯ï¼šå¦‚æžœ `WHERE` å­å¥çš„è®¡ç®—ç»“æžœä¸º `NULL`ï¼ˆæœªçŸ¥ï¼‰ï¼Œåˆ™ä¸è¾“å‡ºè¯¥å…ƒç»„ã€‚

### ç©ºå€¼ä¸Žèšåˆå‡½æ•°

èšåˆå‡½æ•°ï¼ˆå¦‚ `COUNT`, `SUM`, `AVG`ï¼‰ä¼šå¿½ç•¥ `NULL` å€¼ã€‚
*   `COUNT(*)` è®¡ç®—æ‰€æœ‰è¡Œã€‚
*   `COUNT(rating)` åªè®¡ç®— `rating` éžç©ºçš„è¡Œã€‚
*   `SUM(rating)` å’Œ `AVG(rating)` ä¹Ÿåªå¯¹éžç©ºå€¼è¿›è¡Œè®¡ç®—ã€‚

---

## æŸ¥è¯¢ç»„åˆä¸ŽåµŒå¥— ðŸ§©

SQL å…è®¸é€šè¿‡é›†åˆè¿ç®—ç¬¦å’Œå­æŸ¥è¯¢æ¥ç»„åˆæŸ¥è¯¢ç»“æžœã€‚

### é›†åˆä¸ŽåŒ…è¯­ä¹‰

*   **é›†åˆ**ï¼šä¸å…è®¸é‡å¤å…ƒç´ ã€‚
*   **åŒ…**ï¼šå…è®¸é‡å¤å…ƒç´ ã€‚SQL é»˜è®¤ä½¿ç”¨åŒ…è¯­ä¹‰ã€‚

ä»¥ä¸‹æ˜¯é¢å‘é›†åˆå’Œé¢å‘åŒ…çš„è¿ç®—ç¬¦ï¼š

*   `UNION` / `UNION ALL`ï¼šå¹¶é›†ã€‚
*   `INTERSECT` / `INTERSECT ALL`ï¼šäº¤é›†ã€‚
*   `EXCEPT` / `EXCEPT ALL`ï¼šå·®é›†ã€‚

å¸¦æœ‰ `ALL` çš„è¿ç®—ç¬¦æ‰§è¡Œé¢å‘åŒ…çš„æ“ä½œï¼Œä¼šè€ƒè™‘å…ƒç»„çš„é‡å¤æ¬¡æ•°ã€‚

### åµŒå¥—æŸ¥è¯¢

å¯ä»¥å°†ä¸€ä¸ªæŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚

**ä½¿ç”¨ `IN` æ£€æŸ¥æˆå‘˜èµ„æ ¼**ï¼š
```sql
SELECT sname FROM Sailors WHERE sid IN (SELECT sid FROM Reserves WHERE bid = 102);
```

**ç›¸å…³å­æŸ¥è¯¢**ï¼šå­æŸ¥è¯¢å¯ä»¥å¼•ç”¨å¤–å±‚æŸ¥è¯¢çš„å˜é‡ã€‚
```sql
SELECT sname FROM Sailors S WHERE EXISTS (SELECT * FROM Reserves R WHERE R.sid = S.sid AND R.bid = 102);
```
æ¦‚å¿µä¸Šï¼Œå¤–å±‚æŸ¥è¯¢çš„æ¯ä¸€è¡Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚

**å…³ç³»é™¤æ³•ç¤ºä¾‹**ï¼šæŸ¥æ‰¾é¢„è®¢äº†æ‰€æœ‰èˆ¹åªçš„æ°´æ‰‹ã€‚
```sql
SELECT sname FROM Sailors S WHERE NOT EXISTS (
    SELECT B.bid FROM Boats B WHERE NOT EXISTS (
        SELECT * FROM Reserves R WHERE R.sid = S.sid AND R.bid = B.bid
    )
);
```

---

## è§†å›¾ä¸Žå…¬å…±è¡¨è¡¨è¾¾å¼ ðŸ‘“

è§†å›¾å’Œå…¬å…±è¡¨è¡¨è¾¾å¼æ˜¯å‘½åæŸ¥è¯¢çš„æœºåˆ¶ï¼Œç”¨äºŽç®€åŒ–å¤æ‚æŸ¥è¯¢å¹¶æé«˜å®‰å…¨æ€§ã€‚

### è§†å›¾

è§†å›¾æ˜¯å­˜å‚¨çš„æŸ¥è¯¢å®šä¹‰ï¼Œä½¿ç”¨æ—¶ä¼šè¢«é‡å†™å±•å¼€ã€‚
```sql
CREATE VIEW RedCount AS
SELECT B.bid, COUNT(*) AS scount
FROM Boats B, Reserves R
WHERE B.bid = R.bid AND B.color = 'red'
GROUP BY B.bid;
```
ä½¿ç”¨è§†å›¾ï¼š
```sql
SELECT * FROM RedCount WHERE scount < 10;
```

### å…¬å…±è¡¨è¡¨è¾¾å¼

ä½¿ç”¨ `WITH` å­å¥åœ¨æŸ¥è¯¢ä¸­ä¸´æ—¶å®šä¹‰è§†å›¾ã€‚
```sql
WITH RedCount(bid, scount) AS (
    SELECT B.bid, COUNT(*)
    FROM Boats B, Reserves R
    WHERE B.bid = R.bid AND B.color = 'red'
    GROUP BY B.bid
)
SELECT * FROM RedCount WHERE scount < 10;
```

---

## æ•°æ®åº“ç³»ç»Ÿä½“ç³»ç»“æž„æ¦‚è¿° ðŸ—ï¸

ç¼–å†™ SQL æŸ¥è¯¢æ˜¯ä¸€ç§å£°æ˜Žå¼ä½“éªŒã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·±å…¥æŽ¢è®¨æ•°æ®åº“ç³»ç»Ÿå¦‚ä½•æ‰§è¡Œè¿™äº›æŸ¥è¯¢ã€‚

![](img/cdfb9718f5915ae04934e75e3eafa223_3.png)

![](img/cdfb9718f5915ae04934e75e3eafa223_5.png)

æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé€šå¸¸é‡‡ç”¨åˆ†å±‚æž¶æž„ï¼š
1.  **æŸ¥è¯¢å¤„ç†å±‚**ï¼šæŽ¥æ”¶ SQL æŸ¥è¯¢ï¼Œè¿›è¡Œè§£æžã€ä¼˜åŒ–ï¼Œç”ŸæˆæŸ¥è¯¢è®¡åˆ’ã€‚
2.  **æ‰§è¡Œå¼•æ“Žå±‚**ï¼šæ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’ä¸­çš„æ“ä½œç¬¦ï¼ˆå¦‚è¿žæŽ¥ã€æŽ’åºï¼‰ã€‚
3.  **ç¼“å†²åŒºç®¡ç†å±‚**ï¼šç®¡ç†æ•°æ®åœ¨å†…å­˜ï¼ˆç¼“å†²åŒºï¼‰å’Œç£ç›˜ä¹‹é—´çš„ç§»åŠ¨ã€‚
4.  **å­˜å‚¨ç®¡ç†å±‚**ï¼šåœ¨ç£ç›˜ä¸Šç»„ç»‡å’Œç®¡ç†æ•°æ®ï¼ˆæ–‡ä»¶ã€é¡µã€è®°å½•ï¼‰ã€‚

![](img/cdfb9718f5915ae04934e75e3eafa223_6.png)

![](img/cdfb9718f5915ae04934e75e3eafa223_7.png)

![](img/cdfb9718f5915ae04934e75e3eafa223_9.png)

ä¸¤ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹è´¯ç©¿æ‰€æœ‰å±‚æ¬¡ï¼š
*   **å¹¶å‘æŽ§åˆ¶**ï¼šç®¡ç†å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®æ•°æ®ã€‚
*   **æ¢å¤**ï¼šåœ¨ç³»ç»Ÿæ•…éšœåŽç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

---

## å­˜å‚¨ä»‹è´¨ ðŸ’¾

æ•°æ®æœ€ç»ˆå­˜å‚¨åœ¨ç‰©ç†è®¾å¤‡ä¸Šã€‚ä¸åŒçš„å­˜å‚¨ä»‹è´¨åœ¨é€Ÿåº¦ã€å®¹é‡å’Œæˆæœ¬ä¸Šå·®å¼‚å·¨å¤§ã€‚

### å­˜å‚¨å±‚æ¬¡ç»“æž„

ä»Žå¿«åˆ°æ…¢ï¼Œä»Žè´µåˆ°ä¾¿å®œï¼š
1.  CPU å¯„å­˜å™¨
2.  CPU ç¼“å­˜
3.  ä¸»å†…å­˜
4.  å›ºæ€ç¡¬ç›˜
5.  æœºæ¢°ç¡¬ç›˜
6.  ç£å¸¦

è®¿é—®æ—¶é—´å¯èƒ½ä»Žçº³ç§’çº§ï¼ˆå¯„å­˜å™¨ï¼‰åˆ°å¤©çº§ï¼ˆç£å¸¦ï¼‰ã€‚æˆ‘ä»¬é€šå¸¸å°†é¢‘ç¹è®¿é—®çš„æ•°æ®æ”¾åœ¨æ›´å¿«çš„å­˜å‚¨ä¸­ã€‚

### æœºæ¢°ç¡¬ç›˜

æœºæ¢°ç¡¬ç›˜ç”±æ—‹è½¬çš„ç›˜ç‰‡å’Œç§»åŠ¨çš„ç£å¤´ç»„æˆã€‚
*   æ•°æ®å­˜å‚¨åœ¨ç›˜ç‰‡çš„**ç£é“**å’Œ**æ‰‡åŒº**ä¸Šã€‚
*   è¯»å–æ•°æ®æ¶‰åŠå¯»é“ï¼ˆç§»åŠ¨ç£å¤´åˆ°æ­£ç¡®ç£é“ï¼‰å’Œæ—‹è½¬å»¶è¿Ÿï¼ˆç­‰å¾…æ‰€éœ€æ‰‡åŒºè½¬åˆ°ç£å¤´ä¸‹ï¼‰ã€‚
*   å› æ­¤ï¼Œé¡ºåºè¯»å†™è¿œå¿«äºŽéšæœºè¯»å†™ã€‚

æ•°æ®åº“ç³»ç»Ÿä»¥**é¡µ**ï¼ˆé€šå¸¸ç”±å¤šä¸ªæ‰‡åŒºç»„æˆï¼‰ä¸ºå•ä½ä¸Žç£ç›˜äº¤æ¢æ•°æ®ã€‚

---

## æ€»ç»“ ðŸ“

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ï¼š
1.  **SQL è¿žæŽ¥æ‰©å±•**ï¼šåŒ…æ‹¬è‡ªç„¶è¿žæŽ¥çš„éšå¼ç­‰å€¼è¿žæŽ¥ï¼Œä»¥åŠå·¦/å³/å…¨å¤–è¿žæŽ¥å¯¹ä¸åŒ¹é…è¡Œçš„å¤„ç†ã€‚
2.  **ç©ºå€¼å¤„ç†**ï¼šç†è§£äº† `NULL` è¡¨ç¤ºæœªçŸ¥å€¼ï¼Œä»¥åŠåœ¨ä¸‰å€¼é€»è¾‘ä¸‹å¦‚ä½•å½±å“ `WHERE` å­å¥å’Œèšåˆå‡½æ•°ã€‚
3.  **æŸ¥è¯¢ç»„åˆ**ï¼šä½¿ç”¨é›†åˆè¿ç®—ç¬¦å’ŒåµŒå¥—å­æŸ¥è¯¢æ¥æž„å»ºæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå¹¶äº†è§£äº†å…³ç³»é™¤æ³•çš„æ¦‚å¿µã€‚
4.  **è§†å›¾ä¸Ž CTE**ï¼šä½¿ç”¨è§†å›¾å’Œå…¬å…±è¡¨è¡¨è¾¾å¼æ¥æ¨¡å—åŒ–æŸ¥è¯¢ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚
5.  **ç³»ç»Ÿæ¦‚è¿°**ï¼šåˆæ­¥äº†è§£äº†æ•°æ®åº“ç³»ç»Ÿçš„åˆ†å±‚æž¶æž„å’Œæ ¸å¿ƒç»„ä»¶ã€‚
6.  **å­˜å‚¨åŸºç¡€**ï¼šè®¤è¯†äº†ä¸åŒçš„å­˜å‚¨ä»‹è´¨åŠå…¶ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯æœºæ¢°ç¡¬ç›˜çš„å·¥ä½œåŽŸç†ï¼Œä¸ºç†è§£æ•°æ®å¦‚ä½•å­˜å‚¨å’Œè®¿é—®æ‰“ä¸‹åŸºç¡€ã€‚

![](img/cdfb9718f5915ae04934e75e3eafa223_11.png)

æŽŒæ¡ SQL éœ€è¦å¤§é‡ç»ƒä¹ ã€‚è¯·åŠ¡å¿…é€šè¿‡ä½œä¸šå’Œé¡¹ç›®æ¥å·©å›ºè¿™äº›æ¦‚å¿µã€‚åœ¨æŽ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è‡ªåº•å‘ä¸Šåœ°æŽ¢ç´¢æ•°æ®åº“ç³»ç»Ÿçš„å®žçŽ°ç»†èŠ‚ã€‚