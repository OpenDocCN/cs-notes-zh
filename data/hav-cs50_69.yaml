- en: Lecture 4
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 讲座 4
- en: 原文：[https://cs50.harvard.edu/web/notes/4/](https://cs50.harvard.edu/web/notes/4/)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://cs50.harvard.edu/web/notes/4/](https://cs50.harvard.edu/web/notes/4/)
- en: '[Introduction](#introduction)'
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[介绍](#introduction)'
- en: '[SQL](#sql)'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SQL](#sql)'
- en: '[Databases](#databases)'
  id: totrans-4
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[数据库](#databases)'
- en: '[Column Types](#column-types)'
  id: totrans-5
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[列类型](#column-types)'
- en: '[Tables](#tables)'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[表格](#tables)'
- en: '[SELECT](#select)'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[选择](#select)'
- en: '[Working with SQL in the Terminal](#working-with-sql-in-the-terminal)'
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[在终端中使用 SQL](#working-with-sql-in-the-terminal)'
- en: '[Functions](#functions)'
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[函数](#functions)'
- en: '[UPDATE](#update)'
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[更新](#update)'
- en: '[DELETE](#delete)'
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[删除](#delete)'
- en: '[Other Clauses](#other-clauses)'
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[其他子句](#other-clauses)'
- en: '[Joining Tables](#joining-tables)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接表](#joining-tables)'
- en: '[JOIN Query](#join-query)'
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[JOIN 查询](#join-query)'
- en: '[Indexing](#indexing)'
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[索引](#indexing)'
- en: '[SQL Vulnerabilities](#sql-vulnerabilities)'
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SQL 漏洞](#sql-vulnerabilities)'
- en: '[Django Models](#django-models)'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Django 模型](#django-models)'
- en: '[Migrations](#migrations)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[迁移](#migrations)'
- en: '[Shell](#shell)'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Shell](#shell)'
- en: '[Starting our application](#starting-our-application)'
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[启动我们的应用程序](#starting-our-application)'
- en: '[Django Admin](#django-admin)'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Django 管理员](#django-admin)'
- en: '[Many-to-Many Relationships](#many-to-many-relationships)'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[多对多关系](#many-to-many-relationships)'
- en: '[Users](#users)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[用户](#users)'
- en: Introduction
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 介绍
- en: So far, we’ve discussed how to build simple web pages using HTML and CSS, and
    how to use Git and GitHub in order to keep track of changes to our code and collaborate
    with others. We also familiarized ourselves with the Python programming language,
    and started using Django to create web applications.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经讨论了如何使用 HTML 和 CSS 构建简单的网页，以及如何使用 Git 和 GitHub 来跟踪代码更改并与他人协作。我们还熟悉了
    Python 编程语言，并开始使用 Django 来创建网络应用程序。
- en: Today, we’ll learn about using SQL and Django models to efficiently store and
    access data.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 今天，我们将学习如何使用 SQL 和 Django 模型高效地存储和访问数据。
- en: SQL
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SQL
- en: '[SQL](https://www.w3schools.com/sql/), or Structured Query Language, is a programming
    language that allows us to update and query databases.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '[SQL](https://www.w3schools.com/sql/)，或结构化查询语言，是一种编程语言，允许我们更新和查询数据库。'
- en: '![SQL logo](../Images/b70b5244f7237ca9215bcb5722fcc3b1.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![SQL 标志](../Images/b70b5244f7237ca9215bcb5722fcc3b1.png)'
- en: Databases
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 数据库
- en: Before we get into how to use the SQL language, we should discuss how our data
    is stored. When using SQL, we’ll work with a [relational database](https://www.oracle.com/database/what-is-a-relational-database/#:~:text=A%20relational%20database%20is%20a,of%20representing%20data%20in%20tables.)
    where we can find all of our data stored in a number of [tables](https://www.essentialsql.com/what-is-a-database-table/).
    Each of these tables is made up of a set number of columns and a flexible number
    of rows.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入探讨如何使用 SQL 语言之前，我们应该讨论我们的数据是如何存储的。当使用 SQL 时，我们将与一个 [关系数据库](https://www.oracle.com/database/what-is-a-relational-database/#:~:text=A%20relational%20database%20is%20a,of%20representing%20data%20in%20tables.)
    一起工作，在那里我们可以找到所有数据存储在多个 [表格](https://www.essentialsql.com/what-is-a-database-table/)
    中。这些表格中的每一个都由一定数量的列和灵活数量的行组成。
- en: To illustrate how to work with SQL, we’ll use the example of a website for an
    airline used to keep track of flights and passengers. In the following table,
    we see that we’re keeping track of a number of flights, each of which has an `origin`,
    a `destination`, and a `duration`.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明如何使用 SQL，我们将使用一个航空公司的网站示例，该网站用于跟踪航班和乘客。在下面的表格中，我们可以看到我们正在跟踪多个航班，每个航班都有一个
    `origin`（起点）、一个 `destination`（目的地）和一个 `duration`（时长）。
- en: '![Flights 0](../Images/e40d08c2dea81c611e702279114442ab.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![航班 0](../Images/e40d08c2dea81c611e702279114442ab.png)'
- en: 'There are several different relational database management systems that are
    commonly used to store information, and that can easily interact with SQL commands:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种不同的关系数据库管理系统被广泛用于存储信息，并且可以轻松与 SQL 命令交互：
- en: '[MySQL](https://www.mysql.com/)'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[MySQL](https://www.mysql.com/)'
- en: '[PostgreSQL](https://www.postgresql.org/)'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[PostgreSQL](https://www.postgresql.org/)'
- en: '[SQLite](https://www.sqlite.org/index.html)'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SQLite](https://www.sqlite.org/index.html)'
- en: …
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: …
- en: The first two, MySQL and PostgreSQL, are heavier-duty database management systems
    that are typically run on servers separate from those running a website. SQLite,
    on the other hand, is a lighter-weight system that can store all of its data in
    a single file. We’ll be using SQLite throughout this course, as it is the default
    system used by Django.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 前两个，MySQL 和 PostgreSQL，是更重型的数据库管理系统，通常在运行网站的独立服务器上运行。另一方面，SQLite 是一个更轻量级的系统，可以将所有数据存储在一个单独的文件中。在本课程中，我们将使用
    SQLite，因为它是 Django 默认使用的系统。
- en: Column Types
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 列类型
- en: 'Just as we worked with several different variable types in Python, SQLite has
    [types](https://www.sqlite.org/datatype3.html) that represent different forms
    of information. Other management systems may have different data types, but all
    are fairly similar to those of SQLite:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在 Python 中使用了几种不同的变量类型一样，SQLite 有 [类型](https://www.sqlite.org/datatype3.html)
    代表不同形式的信息。其他管理系统可能有不同的数据类型，但它们都与 SQLite 的类型相当相似：
- en: '`TEXT`: For strings of text (Ex. a person’s name)'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`TEXT`: 用于文本字符串（例如，一个人的名字）'
- en: '`NUMERIC`: A more general form of numeric data (Ex. A date or boolean value)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NUMERIC`: 一种更通用的数值数据形式（例如，日期或布尔值）'
- en: '`INTEGER`: Any non-decimal number (Ex. a person’s age)'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INTEGER`: 任何非十进制数字（例如，一个人的年龄）'
- en: '`REAL`: Any real number (Ex. a person’s weight)'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`REAL`: 任何实数（例如，一个人的体重）'
- en: '`BLOB` (Binary Large Object): Any other binary data that we may want to store
    in our database (Ex. an image)'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`BLOB` (二进制大对象): 我们可能想要存储在数据库中的任何其他二进制数据（例如，一张图片）'
- en: Tables
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 表
- en: 'Now, to actually get started with using SQL to interact with a database, let’s
    begin by creating a new table. The [command to create a new table](https://www.w3schools.com/sql/sql_create_table.asp)
    looks something like this:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了真正开始使用 SQL 与数据库交互，让我们首先创建一个新表。创建新表的 [命令](https://www.w3schools.com/sql/sql_create_table.asp)
    大概是这样的：
- en: '[PRE0]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'In the above command, we’re creating a new table that we’ve decided to call
    `flights`, and we’ve added four columns to this table:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，我们创建了一个新表，我们决定将其命名为 `flights`，并且我们向这个表添加了四个列：
- en: '`id`: It is often helpful to have an number that allows us to uniquely identify
    each row in a table. Here we have specified that `id` is an integer, and also
    that it is our [primary key](https://www.w3schools.com/sql/sql_primarykey.ASP),
    meaning it is our unique identifier. We have additionally specified that it will
    `AUTOINCREMENT`, which means we will not have to provide an id every time we add
    to the table because it will be done automatically.'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`id`: 有一个允许我们唯一标识表中每一行的数字通常很有帮助。在这里，我们指定 `id` 是一个整数，并且它也是我们的 [主键](https://www.w3schools.com/sql/sql_primarykey.ASP)，这意味着它是我们的唯一标识符。我们还指定了它将
    `AUTOINCREMENT`，这意味着我们每次向表中添加时不需要提供 id，因为它会自动完成。'
- en: '`origin`: Here we’ve specified that this will be a text field, and by writing
    `NOT NULL` we have required that it have a value.'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`origin`: 在这里我们指定这是一个文本字段，并且通过写入 `NOT NULL` 我们要求它必须有一个值。'
- en: '`destination`: Again we’ve specified that this will be a text field and prevented
    it from being null.'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`destination`: 同样，我们指定这将是一个文本字段，并阻止它为空。'
- en: '`duration`: Again this value cannot be null, but this time it is represented
    by an integer rather than as text.'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`duration`: 同样，这个值不能为空，但这次它是一个整数而不是文本。'
- en: 'We just saw the `NOT NULL` and `PRIMARY KEY` constraint when making a column,
    but there are several other [constraints](https://www.tutorialspoint.com/sqlite/sqlite_constraints.htm)
    available to us:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在创建列时刚刚看到了 `NOT NULL` 和 `PRIMARY KEY` 约束，但还有其他几个 [约束](https://www.tutorialspoint.com/sqlite/sqlite_constraints.htm)
    可供我们使用：
- en: '`CHECK`: Makes sure certain constraints are met before allowing a row to be
    added/modified'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`CHECK`: 确保在允许添加/修改行之前满足某些约束'
- en: '`DEFAULT`: Provides a default value if no value is given'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DEFAULT`: 如果没有给出值，则提供默认值'
- en: '`NOT NULL`: Makes sure a value is provided'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NOT NULL`: 确保提供值'
- en: '`PRIMARY KEY`: Indicates this is the primary way of searching for a row in
    the database'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PRIMARY KEY`: 表示这是在数据库中搜索行的主要方式'
- en: '`UNIQUE`: Ensures that no two rows have the same value in that column.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UNIQUE`: 确保该列中不会有两个行具有相同的值。'
- en: …
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: …
- en: 'Now that we’ve seen how to create a table, let’s look at how we can add rows
    to it. In SQL, we do this using the `INSERT` command:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到了如何创建表，让我们看看我们如何可以向其中添加行。在 SQL 中，我们使用 `INSERT` 命令来完成这个操作：
- en: '[PRE1]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In the above command, we’ve specified the table name we wish to insert into,
    then provided a list of the column names we will be providing information on,
    and then specified the `VALUES` we would like to fill that row in the table, making
    sure the `VALUES` come in the same order as our corresponding list of columns.
    Note that we don’t need to provide a value for `id` because it is automatically
    incrementing.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，我们指定了我们要插入的表名，然后提供了一列列名列表，我们将提供有关这些列的信息，然后指定我们想要填充表中该行的 `VALUES`，确保 `VALUES`
    的顺序与我们的列名列表相对应。请注意，我们不需要为 `id` 提供值，因为它会自动递增。
- en: SELECT
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SELECT
- en: 'Once a table has been populated with some rows, we’ll probably want a way to
    access data within that table. We do this using SQL’s [SELECT](https://www.w3schools.com/sql/sql_select.asp)
    query. The simplest `SELECT` query into our flights table might look something
    like this:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦表格被填充了一些行，我们可能希望有一种方法来访问该表中的数据。我们通过使用SQL的[SELECT](https://www.w3schools.com/sql/sql_select.asp)查询来实现这一点。最简单的`SELECT`查询到我们的航班表可能看起来像这样：
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The above command (*) retrieves all of the data from our flights table
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令（*）检索了我们航班表中的所有数据
- en: '![all](../Images/69852a3e7e06a0efa0e74e0e1e7fa699.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![all](../Images/69852a3e7e06a0efa0e74e0e1e7fa699.png)'
- en: It may be the case though that we don’t really need all of the columns from
    the database, just origin and destination. To access just these columns, we can
    replace the * with the column names we would like access to. The following query
    returns all of the origins and destinations.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，可能我们并不真的需要数据库中的所有列，只需要起点和目的地。为了只访问这些列，我们可以用我们想要访问的列名替换`*`。以下查询返回所有起点和目的地。
- en: '[PRE3]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Just two cols](../Images/ae882208febb4fb7fe987d5e321caee1.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![Just two cols](../Images/ae882208febb4fb7fe987d5e321caee1.png)'
- en: 'As our tables get larger and larger, we will also want to narrow down which
    rows our query returns. We do this by adding a [WHERE](https://www.w3schools.com/sql/sql_where.asp)
    followed by some condition. For example, the following command selects only row
    with an `id` of `3`:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们的表格越来越大，我们可能还想缩小查询返回的行数。我们通过添加一个[WHERE](https://www.w3schools.com/sql/sql_where.asp)并跟上一个条件来实现这一点。例如，以下命令只选择`id`为`3`的行：
- en: '[PRE4]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![only one row](../Images/ea58dc1cd934e2acd0a3932e5e322b58.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![only one row](../Images/ea58dc1cd934e2acd0a3932e5e322b58.png)'
- en: e can filter by any column, not just `id`!
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按任何列过滤，而不仅仅是`id`！
- en: '[PRE5]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Origin is New York](../Images/350e97a53a7439a3d55afba84da56dad.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![Origin is New York](../Images/350e97a53a7439a3d55afba84da56dad.png)'
- en: Working with SQL in the Terminal
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在终端中使用SQL
- en: Now that we know some basic SQL commands, let’s test them out in the terminal!
    In order to work with SQLite on your computer, you must first [download SQLite](https://www.sqlite.org/download.html).
    (We won’t use it in lecture, but you can also [download DB Browser](https://sqlitebrowser.org/dl/)
    for a more user-friendly way to run SQL queries.)
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了一些基本的SQL命令，让我们在终端中测试它们！为了在您的计算机上使用SQLite，您必须首先[下载SQLite](https://www.sqlite.org/download.html)。（我们不会在讲座中使用它，但您也可以[下载DB
    Browser](https://sqlitebrowser.org/dl/)以更用户友好的方式运行SQL查询。）
- en: 'We can start by creating a file for our database either by manually creating
    a new file, or running `touch flights.sql` in the terminal. Now, if we run `sqlite3
    flights.sql` in the terminal, we’ll be brought to a SQLite prompt where we can
    run SQL commands:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过手动创建一个新文件或在终端中运行`touch flights.sql`来为我们的数据库创建一个文件。现在，如果我们通过终端运行`sqlite3
    flights.sql`，我们将进入一个SQLite提示符，在那里我们可以运行SQL命令：
- en: '[PRE6]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We can also use more than just equality to filter out our flights. For integer
    and real values, we can use greater than or less than:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用不仅仅是等于来过滤我们的航班。对于整数和实数值，我们可以使用大于或小于：
- en: '[PRE7]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![> 500](../Images/e11da8a28a30662d0a2f93a6e7598c26.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![> 500](../Images/e11da8a28a30662d0a2f93a6e7598c26.png)'
- en: 'And we can also use other logic ([AND, OR](https://www.w3schools.com/sql/sql_and_or.asp))
    like in Python:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用其他逻辑（[AND, OR](https://www.w3schools.com/sql/sql_and_or.asp)）如Python中的逻辑：
- en: '[PRE8]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![> 500 and paris](../Images/4deda8ff62715d9b4a92761f42a019e9.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![> 500 and paris](../Images/4deda8ff62715d9b4a92761f42a019e9.png)'
- en: '[PRE9]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![> 500 or paris](../Images/aa4fe1c1c2358daa429a3396dab9465f.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![> 500 or paris](../Images/aa4fe1c1c2358daa429a3396dab9465f.png)'
- en: 'We can also use the keyword [IN](https://www.w3schools.com/sql/sql_in.asp)
    to see if a bit of data is one of several options:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用关键字[IN](https://www.w3schools.com/sql/sql_in.asp)来查看数据是否是几个选项之一：
- en: '[PRE10]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![in](../Images/4c8527f627a0b599af2ca9376ac66eb3.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![in](../Images/4c8527f627a0b599af2ca9376ac66eb3.png)'
- en: We can even use regular expressions to search words more broadly using the [LIKE](https://www.w3schools.com/sql/sql_like.asp)
    keyword. The below query finds all results with an `a` in the origin, by using
    `%` as a wildcard character.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 我们甚至可以使用正则表达式通过使用[LIKE](https://www.w3schools.com/sql/sql_like.asp)关键字更广泛地搜索单词。以下查询通过使用`%`作为通配符字符，找到所有在起点中有`a`的结果。
- en: '[PRE11]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![Origin has an ''a''](../Images/17ec4465ad5ecf0649393ad2fe2af2be.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![Origin has an ''a''](../Images/17ec4465ad5ecf0649393ad2fe2af2be.png)'
- en: Functions
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 函数
- en: There are also a number of SQL functions we can apply to the results of a query.
    These can be useful if we don’t need all of the data returned by a query, but
    just some summary statistics of the data.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们还可以将一些SQL函数应用于查询结果。如果我们不需要查询返回的所有数据，而只需要一些数据的摘要统计信息，这些函数可能很有用。
- en: '[AVERAGE](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[平均值](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
- en: '[COUNT](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[COUNT](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
- en: '[MAX](https://www.w3schools.com/sql/sql_min_max.asp)'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[MAX](https://www.w3schools.com/sql/sql_min_max.asp)'
- en: '[MIN](https://www.w3schools.com/sql/sql_min_max.asp)'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[MIN](https://www.w3schools.com/sql/sql_min_max.asp)'
- en: '[SUM](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SUM](https://www.w3schools.com/sql/sql_count_avg_sum.asp)'
- en: …
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: …
- en: UPDATE
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: UPDATE
- en: We’ve now seen how to add to and search tables, but we may also want to be able
    update rows of a table that already exist. We do this using the [UPDATE](https://www.w3schools.com/sql/sql_update.asp)
    command as shown below. As you may have guessed by reading this out loud, the
    command finds any flights that go from New York to London, and then sets their
    durations to 430.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经看到了如何添加和搜索表，但我们可能还希望能够更新已存在的表的行。我们可以使用[UPDATE](https://www.w3schools.com/sql/sql_update.asp)命令来完成这个操作，如下所示。正如你可能通过大声读出来所猜到的，该命令找到所有从纽约飞往伦敦的航班，并将它们的持续时间设置为430。
- en: '[PRE12]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: DELETE
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: DELETE
- en: 'We also might want the ability to delete rows from our database, and we can
    do this using the [DELETE](https://www.w3schools.com/sql/sql_delete.asp) command.
    The following code will remove all flights that land in Tokyo:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可能想要有从我们的数据库中删除行的能力，我们可以使用[DELETE](https://www.w3schools.com/sql/sql_delete.asp)命令来完成这个操作。以下代码将删除所有飞往东京的航班：
- en: '[PRE13]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Other Clauses
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 其他子句
- en: There are a number of additional clauses we can use to control queries coming
    back to us
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用许多额外的子句来控制返回给我们的查询
- en: '[LIMIT](https://www.w3schools.com/sql/sql_top.asp): Limits the number of results
    returned by a query'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[LIMIT](https://www.w3schools.com/sql/sql_top.asp)：限制查询返回的结果数量'
- en: '[ORDER BY](https://www.w3schools.com/sql/sql_orderby.asp): Orders the results
    based on a specified column'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ORDER BY](https://www.w3schools.com/sql/sql_orderby.asp)：根据指定的列对结果进行排序'
- en: '[GROUP BY](https://www.w3schools.com/sql/sql_groupby.asp): Groups results by
    a specified column'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[GROUP BY](https://www.w3schools.com/sql/sql_groupby.asp)：根据指定的列对结果进行分组'
- en: '[HAVING](https://www.w3schools.com/sql/sql_having.asp): Allows for additional
    constraints based on the number of results'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[HAVING](https://www.w3schools.com/sql/sql_having.asp)：允许基于结果数量进行额外的约束'
- en: Joining Tables
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 表的连接
- en: So far, we’ve only been working with one table at a time, but many databases
    in practice are populated by a number of tables that all relate to each other
    in some way. In our flights example, let’s imagine we also want to add an airport
    code to go with the city. The way our table is currently set up, we would have
    to add two more columns to go with each row. We would also be repeating information,
    as we would have to write in multiple places that city X is associated with code
    Y.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直是在一次处理一个表，但实践中许多数据库都是由多个相互关联的表组成的。在我们的航班示例中，让我们想象我们还想添加一个机场代码与城市一起。按照我们目前表的结构，我们可能需要为每一行添加两个额外的列。我们也会重复信息，因为我们必须在多个地方写上城市X与代码Y相关联。
- en: One way we can solve this problem is by deciding to have one table that keeps
    track of flights, and then another table keeping track of airports. The second
    table might look something like this
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以解决这个问题的方法之一是决定有一个表来跟踪航班，然后另一个表来跟踪机场。第二个表可能看起来像这样
- en: '![Airport Table](../Images/9fdb1efdc701ef2ac7dec66bc2a3de25.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![机场表](../Images/9fdb1efdc701ef2ac7dec66bc2a3de25.png)'
- en: Now we have a table relating codes and cities, rather than storing an entire
    city name in our flights table, it will save storage space if we’re able to just
    save the `id` of that airport. Therefore, we should rewrite the flights table
    accordingly. Since we’re using the `id` column of the airports table to populate
    `origin_id` and `destination_id`, we call those values [Foreign Keys](https://www.w3schools.com/sql/sql_foreignkey.asp)
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有一个与代码和城市相关的表，而不是在我们的航班表中存储整个城市名称，如果我们能够只保存那个机场的`id`，那么这将节省存储空间。因此，我们应该相应地重写航班表。由于我们正在使用机场表的`id`列来填充`origin_id`和`destination_id`，我们称这些值为[外键](https://www.w3schools.com/sql/sql_foreignkey.asp)
- en: '![New Flights](../Images/4a83baa5ff3b5d982579a0fdb013216d.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![新航班](../Images/4a83baa5ff3b5d982579a0fdb013216d.png)'
- en: In addition to flights and airports, an airline might also want to store data
    about its passengers, like which flight each passenger will be on. Using the power
    of relational databases, we can add another table that stores first and last names,
    and a foreign key representing the flight they are on
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 除了航班和机场，航空公司可能还想要存储有关其乘客的数据，比如每个乘客将乘坐哪班航班。利用关系型数据库的力量，我们可以添加另一个表来存储姓名和代表他们所乘坐航班的键
- en: '![Simple Passengers Table](../Images/7a7a5599c37632dcd0ec064ea1eaec4c.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![简单的乘客表](../Images/7a7a5599c37632dcd0ec064ea1eaec4c.png)'
- en: We can do even better than this though, as the same person may be on more than
    one flight. To account for this, we can create a `people` table that stores first
    and last names, and a `passengers` table that pairs people with flights
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，我们还能做得更好，因为同一个人可能乘坐多趟航班。为了解决这个问题，我们可以创建一个`people`表来存储姓名，以及一个`passengers`表来将人与航班配对
- en: '![People](../Images/7b2f93d51ce147940f23f5366e700954.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![人物](../Images/7b2f93d51ce147940f23f5366e700954.png)'
- en: '![Passengers](../Images/5d8fb8de416783edefc907f16e987279.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![乘客](../Images/5d8fb8de416783edefc907f16e987279.png)'
- en: ecause in this case a single person can be on many flights and a single flight
    can have many people, we call the relationship between `flights` and `people`
    a **Many to Many** relationship. The `passengers` table that connects the two
    is known as an **association table**.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在这种情况下，一个人可以乘坐多趟航班，而一趟航班可以有很多人，我们称`flights`和`people`之间的关系为**多对多**关系。连接这两个表的`passengers`表被称为**关联表**。
- en: JOIN Query
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: JOIN查询
- en: Although our data is now more efficiently stored, it seems like it may be harder
    to query our data. Thankfully, SQL has a [JOIN](https://www.w3schools.com/sql/sql_join.asp)
    query where we can combine two tables for the purposes of another query.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们的数据现在存储得更高效，但似乎查询数据可能更困难。幸运的是，SQL有一个[JOIN](https://www.w3schools.com/sql/sql_join.asp)查询，我们可以用它来合并两个表以进行另一个查询。
- en: 'For example, let’s say we want to find the origin, destination, and first name
    of every trip a passenger is taking. Also for simplicity in this table, we’re
    going to be using the unoptimized `passengers` table that includes the flight
    id, first name, and last name. The first part of this query looks fairly familiar:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设我们想找到乘客正在乘坐的每次旅行的出发地、目的地和姓名。为了简化这个表，我们将使用包含航班ID、名和姓的非优化`passengers`表。这个查询的第一部分看起来相当熟悉：
- en: '[PRE14]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'But we run into a problem here because `first` is stored in the `passengers`
    table, while `origin` and `destination` are stored in the `flights` table. We
    solve this by joining the two tables using the fact that `flight_id` in the `passengers`
    table corresponds to `id` in the `flights` table:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 但在这里我们遇到了一个问题，因为`first`存储在`passengers`表中，而`origin`和`destination`存储在`flights`表中。我们通过使用`passengers`表中的`flight_id`与`flights`表中的`id`相对应的事实来连接这两个表：
- en: '[PRE15]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![Join blurry](../Images/91b9b7b4abfd1b8d2e76f7a6a52e58ad.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![连接模糊](../Images/91b9b7b4abfd1b8d2e76f7a6a52e58ad.png)'
- en: We’ve just used something called an [INNER JOIN](https://www.w3schools.com/sql/sql_join_inner.asp),
    which means we are ignoring rows that have no matches between the tables, but
    there are other types of joins, including [**LEFT JOIN**s](https://www.w3schools.com/sql/sql_join_left.asp),
    [**RIGHT JOIN**s](https://www.w3schools.com/sql/sql_join_right.asp), and [**FULL
    OUTER JOIN**s](https://www.w3schools.com/sql/sql_join_full.asp), which we won’t
    discuss here in detail.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚使用了叫做[INNER JOIN](https://www.w3schools.com/sql/sql_join_inner.asp)的东西，这意味着我们正在忽略两个表之间没有匹配的行，但还有其他类型的连接，包括[**LEFT
    JOIN**](https://www.w3schools.com/sql/sql_join_left.asp)、[**RIGHT JOIN**](https://www.w3schools.com/sql/sql_join_right.asp)和[**FULL
    OUTER JOIN**](https://www.w3schools.com/sql/sql_join_full.asp)，我们在这里不会详细讨论。
- en: Indexing
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 索引
- en: 'One way we can make our queries more efficient when dealing with large tables
    is to create an index similar to the index you might see in the back of a textbook.
    For example, if we know that we’ll often look up passengers by their last name,
    we could create an index from last name to id using the command:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 当处理大型表时，我们可以通过创建一个类似于教科书背面的索引来使我们的查询更高效。例如，如果我们知道我们经常通过姓氏查找乘客，我们可以使用以下命令创建一个从姓氏到ID的索引：
- en: '[PRE16]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: SQL Vulnerabilities
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: SQL漏洞
- en: Now that we know the basics of using SQL to work with data, it’s important to
    point out the main vulnerabilities associated with using SQL. We’ll start with
    [SQL Injection](https://www.w3schools.com/sql/sql_injection.asp).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了使用SQL处理数据的基础知识，重要的是要指出与使用SQL相关的主要漏洞。我们将从[SQL注入](https://www.w3schools.com/sql/sql_injection.asp)开始。
- en: 'A SQL injection attack is when a malicious user enters SQL code as input on
    a site in order to bypass the sites security measures. For example, let’s say
    we have a table storing usernames and passwords, and then a login form on the
    home site of a page. We may search for the user using a query such as:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: SQL注入攻击是指恶意用户在网站上输入SQL代码作为输入，以绕过网站的安全措施。例如，假设我们有一个存储用户名和密码的表，然后在页面的主页上有一个登录表单。我们可能使用以下查询来搜索用户：
- en: '[PRE17]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'A user named Harry might go to this site and type `harry` as a username and
    `12345` as a password, in which case the query would look like this:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 一个名为Harry的用户可能会访问这个网站，并输入`harry`作为用户名，`12345`作为密码，在这种情况下，查询看起来会是这样：
- en: '[PRE18]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'A hacker, on the other hand, might type `harry" --` as a username and nothing
    as a password. It turns out that `--` stands for a comment in SQL, meaning the
    query would look like:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，一个黑客可能会输入`harry" --`作为用户名，密码为空。结果是`--`在SQL中表示注释，这意味着查询看起来会是这样：
- en: '[PRE19]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Because in this query the password checking has been commented out, the hacker
    can log into Harry’s account without knowing their password. To solve this problem,
    we can use:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 因为在这个查询中，密码检查已经被注释掉了，黑客可以在不知道密码的情况下登录Harry的账户。为了解决这个问题，我们可以使用：
- en: Escape characters to make sure SQL treats the input as plain text and not as
    SQL code.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 转义字符以确保SQL将输入视为纯文本而不是SQL代码。
- en: An abstraction layer on top of SQL which includes its own escape sequence, so
    we don’t have to write SQL queries ourselves.
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在SQL之上有一个抽象层，它包括自己的转义序列，所以我们不需要自己编写SQL查询。
- en: The other main vulnerability when it comes to SQL is known as a [Race Condition](https://searchstorage.techtarget.com/definition/race-condition#:~:text=A%20race%20condition%20is%20an,sequence%20to%20be%20done%20correctly.).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 当涉及到SQL时，另一个主要漏洞被称为[竞态条件](https://searchstorage.techtarget.com/definition/race-condition#:~:text=A%20race%20condition%20is%20an,sequence%20to%20be%20done%20correctly.).
- en: A race condition is a situation that occurs when multiple queries to a database
    occur simultaneously. When these are not adequately handled, problems can arise
    in the precise times that databases are updated. For example, let’s say I have
    $150 in my bank account. A race condition could occur if I log into my bank account
    on both my phone and my laptop, and attempt to withdraw $100 on each device. If
    the bank’s software developers did not deal with race conditions correctly, then
    I may be able to withdraw $200 from an account with only $150 in it. One potential
    solution for this problem would be locking the database. We could not allow any
    other interaction with the database until one transaction has been completed.
    In the bank example, after clicking navigating to the “Make a Withdrawl” page
    on my computer, the bank might not allow me to navigate to that page on my phone.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 竞态条件是在同时对数据库进行多个查询时发生的情况。当这些查询没有得到妥善处理时，数据库更新时的精确时间可能会出现问题。例如，假设我银行账户中有150美元。如果我在手机和笔记本电脑上同时登录我的银行账户，并在每个设备上尝试提取100美元，就可能发生竞态条件。如果银行的软件开发者没有正确处理竞态条件，那么我可能能够从只有150美元的账户中提取200美元。解决这个问题的一个潜在方案是锁定数据库。我们不允许在完成一个事务之前与数据库进行任何其他交互。在银行示例中，在我电脑上点击导航到“提取”页面后，银行可能不允许我在手机上导航到该页面。
- en: Django Models
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Django Models
- en: '[Django Models](https://docs.djangoproject.com/en/4.0/topics/db/models/) are
    a level of [abstraction](https://techterms.com/definition/abstraction) on top
    of SQL that allow us to work with databases using Python classes and objects rather
    than direct SQL queries.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '[Django模型](https://docs.djangoproject.com/en/4.0/topics/db/models/)是在SQL之上的一个[抽象](https://techterms.com/definition/abstraction)层，它允许我们使用Python类和对象而不是直接SQL查询来与数据库交互。'
- en: Let’s get started on using models by creating a django project for our airline,
    and creating an app within that project.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始使用模型，为我们的航空公司创建一个Django项目，并在该项目中创建一个应用程序。
- en: '[PRE20]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now we’ll have to go through the process of adding an app as usual:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将像通常添加应用程序一样进行添加应用程序的过程：
- en: Add `flights` to the `INSTALLED_APPS` list in `settings.py`
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`settings.py`中将`flights`添加到`INSTALLED_APPS`列表中
- en: 'Add a route for `flights` in `urls.py`:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`urls.py`中添加`flights`的路由：
- en: '[PRE21]'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Create a `urls.py` file within the `flights` application. And fill it with standard
    `urls.py` imports and lists.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`flights`应用程序中创建一个`urls.py`文件。并填充标准的`urls.py`导入和列表。
- en: 'Now, rather than creating actual paths and getting started on `views.py`, we’ll
    create some models in the `models.py` file. In this file, we’ll outline what data
    we want to store in our application. Then, Django will determine the SQL syntax
    necessary to store information on each of our models. Let’s take a look at what
    a model for a single flight might look like:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们不再创建实际的路径，而是从`views.py`开始，我们将在`models.py`文件中创建一些模型。在这个文件中，我们将概述我们希望在应用程序中存储的数据。然后，Django将确定存储我们每个模型所需的信息的SQL语法。让我们看看单个航班模型的例子：
- en: '[PRE22]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Let’s take a look at what’s going on in this model definition:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看这个模型定义中发生了什么：
- en: In the first line, we create a new model that **extends** Django’s model class.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第一行中，我们创建了一个新的模型，该模型**扩展**了Django的模型类。
- en: Below, we add fields for origin, destination, and duration. The first two are
    [Char Fields](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#charfield),
    meaning they store strings, and the third is an [Integer Field](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#integerfield).
    These are just two of many [built-in Django Field classes](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes)
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下面，我们添加了起点、终点和持续时间的字段。前两个是[Char Fields](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#charfield)，意味着它们存储字符串，第三个是[Integer
    Field](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#integerfield)。这些只是许多[内置Django字段类](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes)中的两个
- en: We specify maximum lengths of 64 for the two Character Fields. you can check
    the specifications available for a given field by checking the [documentation](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes).
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们为两个字符字段指定了最大长度为64。你可以通过检查[文档](https://docs.djangoproject.com/en/4.0/ref/forms/fields/#built-in-field-classes)来查看给定字段的可用规格。
- en: Migrations
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Migrations
- en: Now, even though we’ve created a model, we do not yet have a database to store
    this information. to create a database from our models, we navigate to the main
    directory of our project and run the command.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，尽管我们已经创建了一个模型，但我们还没有数据库来存储这些信息。要从我们的模型创建数据库，我们导航到项目的根目录并运行以下命令。
- en: '[PRE23]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: This command creates some Python files that will create or edit our database
    to be able to store what we have in our models. You should get an output that
    looks something like the one below, and if you navigate to your `migrations` directory,
    you’ll notice a new file was created for us
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令创建了一些Python文件，这些文件将创建或编辑我们的数据库，以便能够存储我们在模型中的内容。你应该得到一个类似于下面的输出，如果你导航到你的`migrations`目录，你会注意到为我们创建了一个新文件
- en: '![migrations output 0](../Images/ecf5781609bc8e50dcb00361ef4f95f7.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![迁移输出 0](../Images/ecf5781609bc8e50dcb00361ef4f95f7.png)'
- en: Next, to apply these migrations to our database, we run the command
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，要应用这些迁移到我们的数据库，我们运行以下命令
- en: '[PRE24]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Now, you’ll see some default migrations have been applied along with our own,
    and you’ll also notice that we now have a file called `db.sqlite3` in our project’s
    directory
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你会看到一些默认迁移已经应用，并且你也会注意到我们现在在项目的目录中有一个名为`db.sqlite3`的文件
- en: '![migrate output](../Images/1ffd0fc6b384cbd3678be3b0e5f32455.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![迁移输出](../Images/1ffd0fc6b384cbd3678be3b0e5f32455.png)'
- en: Shell
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Shell
- en: Now, to begin working adding information to and manipulating this database,
    we can enter Django’s shell where we can run Python commands within our project.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了开始向数据库添加信息并对其进行操作，我们可以进入Django的shell，在那里我们可以在项目中运行Python命令。
- en: '[PRE25]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'When we query our database, we see that we get just one flight called `Flight
    object (1)`. This isn’t a very informative name, but we can fix that. Inside `models.py`,
    we’ll define a `__str__` function that provides instructions for how to turn a
    Flight object into a string:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们查询数据库时，我们看到我们只得到一个名为`Flight object (1)`的航班。这个名字不是很 informative，但我们可以修复它。在`models.py`中，我们将定义一个`__str__`函数，该函数提供将Flight对象转换为字符串的指令：
- en: '[PRE27]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now, when we go back to the shell, our output is a bit more readable:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们回到shell时，我们的输出更易于阅读：
- en: '[PRE28]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'This is a good start, but thinking back to earlier, we don’t want to have to
    store the city name as an origin and destination for every flight, so we probably
    want another model for an airport that is somehow related to the flight model:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个好的开始，但回想一下之前，我们不想为每个航班存储城市名称作为起点和终点，所以我们可能需要一个与航班模型相关联的机场模型：
- en: '[PRE29]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'We’ve seen everything in our new `Airport` class before, but the changes to
    the `origin` and `destination` fields within the `Flight` class are new to us:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在新的`Airport`类中已经看到了所有内容，但`Flight`类中`origin`和`destination`字段的变化对我们来说是新的：
- en: We specify that the `origin` and `destination` fields are each [Foreign Keys](https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_one/),
    which means they refer to another object.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们指定`origin`和`destination`字段是每个[外键](https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_one/)，这意味着它们引用另一个对象。
- en: By entering `Airport` as our first argument, we are specifying the type of object
    this field refers to.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过将`Airport`作为我们的第一个参数输入，我们指定了这个字段所引用的对象的类型。
- en: The next argument, `on_delete=models.CASCADE` gives instructions for what should
    happen if an airport is deleted. In this case, we specify that when an airport
    is deleted, all flights associated with it should also be deleted. There are [several
    other options](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.on_delete)
    in addition to `CASCADE`.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下一个参数 `on_delete=models.CASCADE` 指示了如果删除机场时应该发生什么。在这种情况下，我们指定当删除机场时，与其关联的所有航班也应该被删除。除了
    `CASCADE` 之外，还有 [其他几个选项](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.on_delete)。
- en: We provide a [related name](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.related_name),
    which gives us a way to search for all flights with a given airport as their origin
    or destination.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们提供了一个 [相关名称](https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey.related_name)，这为我们提供了一种通过给定机场作为起点或终点来搜索所有航班的途径。
- en: Every time we make changes in `models.py`, we have to make migrations and then
    migrate. Note that you may have to delete your existing flight from New York to
    London, as it doesn’t fit in with the new database structure.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 每次我们在 `models.py` 中进行更改时，我们必须进行迁移然后迁移。请注意，您可能需要删除现有的从纽约到伦敦的航班，因为它不符合新的数据库结构。
- en: '[PRE30]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Now, let’s try these new models out in the Django shell:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们在 Django 命令行中尝试这些新的模型：
- en: '[PRE31]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Starting our application
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动我们的应用程序
- en: 'We can now begin to build an application around this process of using models
    to interact with a database. Let’s begin by creating an index route for our airline.
    Inside `urls.py`:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以开始构建一个应用程序，该应用程序围绕使用模型与数据库交互的过程。让我们首先为我们的航空公司创建一个索引路由。在 `urls.py` 中：
- en: '[PRE32]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Inside `views.py`:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `views.py` 文件中：
- en: '[PRE33]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Inside our new `layout.html` file:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的新 `layout.html` 文件中：
- en: '[PRE34]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Inside a new `index.html` file:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在新的 `index.html` 文件中：
- en: '[PRE35]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: What we’ve done here is created a default page where we have a list of all flights
    we’ve created so far. When we open up the page now, it looks like this
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里所做的是创建了一个默认页面，其中列出了我们迄今为止创建的所有航班。当我们现在打开这个页面时，它看起来像这样
- en: '![Just one on the list](../Images/ebd91751b7f4c65c7f9e987b6f6ce180.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![列表上只有一个](../Images/ebd91751b7f4c65c7f9e987b6f6ce180.png)'
- en: 'Now, let’s add some more flights to our application by returning to the Django
    shell:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们通过返回 Django 命令行来为我们的应用程序添加更多航班：
- en: '[PRE36]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now, when we visit our site again
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们再次访问我们的网站时
- en: '![Two flights](../Images/7ebb0c6c490f6df5acdb4e9ad15a4996.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![两架航班](../Images/7ebb0c6c490f6df5acdb4e9ad15a4996.png)'
- en: Django Admin
  id: totrans-211
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Django 管理员
- en: 'Since it is so common for developers to have to create new objects like we’ve
    been doing in the shell, Django comes with a [default admin interface](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)
    that allows us to do this more easily. To begin using this tool, we must first
    create an administrative user:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 由于开发者经常需要创建新对象，就像我们在 shell 中所做的那样，Django 提供了一个 [默认管理界面](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)，这使得我们可以更容易地完成这项工作。要开始使用这个工具，我们必须首先创建一个管理用户：
- en: '[PRE37]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Now, we must add our models to the admin application by entering the `admin.py`
    file within our app, and importing and registering our models. This tells Django
    which models we would like to have access to in the admin app.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们必须通过在我们的应用中进入 `admin.py` 文件，并导入和注册我们的模型，将我们的模型添加到管理应用程序中。这告诉 Django 我们希望在管理应用程序中访问哪些模型。
- en: '[PRE38]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Now, when we visit our site and add `/admin` to the url, we can log into a page
    that looks like this
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们访问我们的网站并将 `/admin` 添加到 URL 中时，我们可以登录到一个看起来像这样的页面
- en: '![login](../Images/6d589b2411be559826d7a1bc9212e533.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![登录](../Images/6d589b2411be559826d7a1bc9212e533.png)'
- en: After loggin in, you’ll be brought to a page like the one below where you can
    create, edit, and delete objects stored in the database
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，您将被带到下面的页面，您可以在其中创建、编辑和删除存储在数据库中的对象
- en: '![admin page](../Images/e5449c35f2b183e06e5d580f6714499f.png)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![管理员页面](../Images/e5449c35f2b183e06e5d580f6714499f.png)'
- en: 'Now, let’s add a few more pages to our site. We’ll begin by adding the ability
    to click on a flight to get more information about it. To do this, let’s create
    a URL path that includes the `id` of a flight:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们为我们的网站添加更多页面。我们将首先添加点击航班以获取更多航班信息的功能。为此，让我们创建一个包含航班 `id` 的 URL 路径：
- en: '[PRE39]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Then, in `views.py` we will create a `flight` function that takes in a flight
    id and renders a new html page:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，在 `views.py` 中，我们将创建一个 `flight` 函数，它接受一个航班 ID 并渲染一个新的 HTML 页面：
- en: '[PRE40]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Now we’ll create a template to display this flight information with a link back
    to the home page
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个模板来显示这些航班信息，并包含一个链接回到主页
- en: '[PRE41]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Finally, we need to add the ability to link from one page to another, so we’ll
    modify our index page to include links:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要添加从一页链接到另一页的能力，因此我们将修改我们的索引页面以包含链接：
- en: '[PRE42]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Now our homepage looks like this
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 现在主页看起来是这样的
- en: '![new home](../Images/0df402245e6e4111e6cfd34a3739647e.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![新家](../Images/0df402245e6e4111e6cfd34a3739647e.png)'
- en: And when we click on flight 5, for example, we’re brought to this page
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，当我们点击航班 5 时，我们会来到这个页面
- en: '![One flight](../Images/8b0f46fbeb486526d63531607a49cf5f.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![单程航班](../Images/8b0f46fbeb486526d63531607a49cf5f.png)'
- en: Many-to-Many Relationships
  id: totrans-232
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 多对多关系
- en: 'Now, let’s work on integrating passengers into our models. We’ll create a passenger
    model to start:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们将乘客集成到我们的模型中。我们将首先创建一个乘客模型：
- en: '[PRE43]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: As we discussed, passengers have a **Many to Many** relationship with flights,
    which we describe in Django using the ManyToManyField.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正如我们讨论的那样，乘客与航班有 **多对多** 的关系，我们在 Django 中使用 ManyToManyField 来描述这种关系。
- en: The first argument in this field is the class of objects that this one is related
    to.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此字段中的第一个参数是与该对象相关联的类的类型。
- en: We have provided the argument `blank=True` which means a passenger can have
    no flights
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们提供了 `blank=True` 参数，这意味着乘客可以没有航班
- en: 'We have added a `related_name` that serves the same purpose as it did earlier:
    it will allow us to find all passengers on a given flight.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们添加了一个 `related_name`，它具有与之前相同的作用：它将允许我们找到给定航班上的所有乘客。
- en: To actually make these changes, we must make migrations and migrate. We can
    then register the Passenger model in `admin.py` and visit the admin page to create
    some passengers!
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 要实际应用这些更改，我们必须进行迁移并执行迁移。然后我们可以在 `admin.py` 中注册 `Passenger` 模型，并访问管理页面来创建一些乘客！
- en: Now that we’ve added some passengers, let’s update our flight page so that it
    displays all passengers on a flight. We’ll first visit `views.py` and update our
    flight view to provide a list of passengers as context. We access the list using
    the related name we defined earlier.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经添加了一些乘客，让我们更新我们的航班页面，以便它显示航班上的所有乘客。我们首先访问 `views.py` 并更新我们的航班视图，以提供乘客列表作为上下文。我们使用之前定义的相关名称来访问列表。
- en: '[PRE44]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Now, add a list of passengers to `flight.html`:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，将乘客列表添加到 `flight.html`：
- en: '[PRE45]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: At this point, when we click on flight 5, we see
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，当我们点击航班 5 时，我们看到
- en: '![new flight 5](../Images/e2901e4aac6569bcb1772205501c93af.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![新航班 5](../Images/e2901e4aac6569bcb1772205501c93af.png)'
- en: 'Now, let’s work on giving visitors to our site the ability to book a flight.
    We’ll do this by adding a booking route in `urls.py`:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来为网站访客提供预订航班的能力。我们将通过在 `urls.py` 中添加一个预订路由来实现这一点：
- en: '[PRE46]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now, we’ll add a book function to `views.py` that adds a passenger to a flight:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将在 `views.py` 中添加一个名为 `book` 的函数，该函数将乘客添加到航班中：
- en: '[PRE47]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Next, we’ll add some context to our flight template so that the page has access
    to everyone who is not currently a passenger on the flight using Django’s ability
    to [exclude](https://docs.djangoproject.com/en/4.0/topics/db/queries/#retrieving-specific-objects-with-filters)
    certain objects from a query:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将向我们的航班模板添加一些上下文，以便页面可以通过 Django 的能力从查询中排除某些对象来访问当前不是航班乘客的每个人：
- en: '[PRE48]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Now, we’ll add a form to our flight page’s HTML using a select input field:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将向我们的航班页面 HTML 添加一个表单，使用选择输入字段：
- en: '[PRE49]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Now, let’s see what the site looks like when I go to a flight page and then
    add a passenger
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看我访问航班页面并添加乘客后网站看起来像什么
- en: '![form](../Images/48fc8dfc2cd2c41b3e2fa6413721c1c5.png)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![表单](../Images/48fc8dfc2cd2c41b3e2fa6413721c1c5.png)'
- en: '![submitted](../Images/a6bc6f2e34a1cec6de4a20b2b809b650.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![已提交](../Images/a6bc6f2e34a1cec6de4a20b2b809b650.png)'
- en: 'Another advantage of using the Django admin app is that it is customizable.
    For example, if we wish to see all aspects of a flight in the admin interface,
    we can create a new class within `admin.py` and add it as an argument when registering
    the `Flight` model:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Django 管理应用的一个优点是它可以自定义。例如，如果我们希望在管理界面中看到航班的各个方面，我们可以在 `admin.py` 中创建一个新的类，并在注册
    `Flight` 模型时将其作为参数添加：
- en: '[PRE50]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Now, when we visit the admin page for flights, we can see the `id` as well
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们访问航班的管理页面时，我们还可以看到 `id`
- en: '![admin table](../Images/c27c80eab17ca59fb3ed9b500ed644dc.png)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![管理表](../Images/c27c80eab17ca59fb3ed9b500ed644dc.png)'
- en: Check out [Django’s admin documentation](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)
    to find more ways to customize the admin app.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 查阅 [Django 的管理文档](https://docs.djangoproject.com/en/4.0/ref/contrib/admin/)
    以找到更多自定义管理应用的方法。
- en: Users
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用户
- en: 'The last thing we’ll discuss in lecture today is the idea of authentication,
    or allowing users to log in and out of a website. Fortunately, Django makes this
    very easy for us, so let’s go through an example of how we would do this. We’ll
    start by creating a new app called `users`. Here we’ll go through all the normal
    steps of creating a new app, but in our new `urls.py` file, we’ll add a few more
    routes:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 今天讲座的最后我们将讨论认证的概念，即允许用户登录和退出网站。幸运的是，Django为我们简化了这一过程，让我们通过一个示例来看看我们如何实现。我们首先创建一个名为`users`的新应用。在这里，我们将完成创建新应用的所有常规步骤，但在我们的新`urls.py`文件中，我们将添加一些额外的路由：
- en: '[PRE51]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Let’s begin by creating a form where a user can log in. We’ll create a `layout.html`
    file as always, and then create a `login.html` file which contains a form, and
    that displays a message if one exists.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从创建一个用户可以登录的表单开始。我们将像往常一样创建一个`layout.html`文件，然后创建一个`login.html`文件，该文件包含一个表单，并在存在消息时显示该消息。
- en: '[PRE52]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Now, in `views.py`, we’ll add three functions:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在`views.py`中，我们将添加三个函数：
- en: '[PRE53]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Next, we can head to the admin site and add some users. After doing that, we’ll
    go back to `views.py` and update our `login_view` function to handle a `POST`
    request with a username and password:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们可以前往管理站点并添加一些用户。完成之后，我们将回到`views.py`并更新我们的`login_view`函数以处理带有用户名和密码的`POST`请求：
- en: '[PRE54]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Now, we’ll create the `user.html` file that the `index` function renders when
    a user is authenticated:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个`user.html`文件，当用户认证时，`index`函数将渲染此文件：
- en: '[PRE55]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Finally, to allow the user to log out, we’ll update the `logout_view` function
    so that it uses Django’s built-in `logout` function:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了允许用户登出，我们将更新`logout_view`函数，使其使用Django的内置`logout`函数：
- en: '[PRE56]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Now that we’re finished, here’s a demonstration of the site
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成，这是一个网站的演示
- en: '![Demo](../Images/60c45d3b167af8807d31d2e68bc434b1.png)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![演示](../Images/60c45d3b167af8807d31d2e68bc434b1.png)'
- en: 'That’s all for this lecture! Next time, we’ll learn our second programming
    language of the course: JavaScript.'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 这节课就到这里！下次，我们将学习课程中的第二种编程语言：JavaScript。
